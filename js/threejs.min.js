"use strict";var THREE={REVISION:"71"};"object"===typeof module&&(module.exports=THREE);void 0===Math.sign&&(Math.sign=function(b){return 0>b?-1:0<b?1:+b});THREE.log=function(){console.log.apply(console,arguments)};THREE.warn=function(){console.warn.apply(console,arguments)};THREE.error=function(){console.error.apply(console,arguments)};THREE.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};THREE.CullFaceNone=0;THREE.CullFaceBack=1;THREE.CullFaceFront=2;THREE.CullFaceFrontBack=3;THREE.FrontFaceDirectionCW=0;THREE.FrontFaceDirectionCCW=1;THREE.BasicShadowMap=0;THREE.PCFShadowMap=1;THREE.PCFSoftShadowMap=2;THREE.FrontSide=0;THREE.BackSide=1;THREE.DoubleSide=2;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.CustomBlending=5;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;THREE.MinEquation=103;THREE.MaxEquation=104;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.AddOperation=2;THREE.UVMapping=300;THREE.CubeReflectionMapping=301;THREE.CubeRefractionMapping=302;THREE.EquirectangularReflectionMapping=303;THREE.EquirectangularRefractionMapping=304;THREE.SphericalReflectionMapping=305;THREE.RepeatWrapping=1000;THREE.ClampToEdgeWrapping=1001;THREE.MirroredRepeatWrapping=1002;THREE.NearestFilter=1003;THREE.NearestMipMapNearestFilter=1004;THREE.NearestMipMapLinearFilter=1005;THREE.LinearFilter=1006;THREE.LinearMipMapNearestFilter=1007;THREE.LinearMipMapLinearFilter=1008;THREE.UnsignedByteType=1009;THREE.ByteType=1010;THREE.ShortType=1011;THREE.UnsignedShortType=1012;THREE.IntType=1013;THREE.UnsignedIntType=1014;THREE.FloatType=1015;THREE.HalfFloatType=1025;THREE.UnsignedShort4444Type=1016;THREE.UnsignedShort5551Type=1017;THREE.UnsignedShort565Type=1018;THREE.AlphaFormat=1019;THREE.RGBFormat=1020;THREE.RGBAFormat=1021;THREE.LuminanceFormat=1022;THREE.LuminanceAlphaFormat=1023;THREE.RGBEFormat=THREE.RGBAFormat;THREE.RGB_S3TC_DXT1_Format=2001;THREE.RGBA_S3TC_DXT1_Format=2002;THREE.RGBA_S3TC_DXT3_Format=2003;THREE.RGBA_S3TC_DXT5_Format=2004;THREE.RGB_PVRTC_4BPPV1_Format=2100;THREE.RGB_PVRTC_2BPPV1_Format=2101;THREE.RGBA_PVRTC_4BPPV1_Format=2102;THREE.RGBA_PVRTC_2BPPV1_Format=2103;THREE.Projector=function(){THREE.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(d,c){THREE.warn("THREE.Projector: .projectVector() is now vector.project().");d.project(c)};this.unprojectVector=function(d,c){THREE.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");d.unproject(c)};this.pickingRay=function(d,c){THREE.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};THREE.CanvasRenderer=function(){THREE.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");this.domElement=document.createElement("canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};THREE.Color=function(b){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(b)};THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(b){b instanceof THREE.Color?this.copy(b):"number"===typeof b?this.setHex(b):"string"===typeof b&&this.setStyle(b);return this},setHex:function(b){b=Math.floor(b);this.r=(b>>16&255)/255;this.g=(b>>8&255)/255;this.b=(b&255)/255;return this},setRGB:function(e,d,f){this.r=e;this.g=d;this.b=f;return this},setHSL:function(f,e,h){if(0===e){this.r=this.g=this.b=h}else{var g=function(i,d,k){0>k&&(k+=1);1<k&&(k-=1);return k<1/6?i+6*(d-i)*k:0.5>k?d:k<2/3?i+6*(d-i)*(2/3-k):i};e=0.5>=h?h*(1+e):h+e-h*e;h=2*h-e;this.r=g(h,e,f+1/3);this.g=g(h,e,f);this.b=g(h,e,f-1/3)}return this},setStyle:function(b){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(b)){return b=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(b),this.r=Math.min(255,parseInt(b[1],10))/255,this.g=Math.min(255,parseInt(b[2],10))/255,this.b=Math.min(255,parseInt(b[3],10))/255,this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(b)){return b=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(b),this.r=Math.min(100,parseInt(b[1],10))/100,this.g=Math.min(100,parseInt(b[2],10))/100,this.b=Math.min(100,parseInt(b[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(b)){return b=/^\#([0-9a-f]{6})$/i.exec(b),this.setHex(parseInt(b[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(b)){return b=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(b),this.setHex(parseInt(b[1]+b[1]+b[2]+b[2]+b[3]+b[3],16)),this}if(/^(\w+)$/i.test(b)){return this.setHex(THREE.ColorKeywords[b]),this}},copy:function(b){this.r=b.r;this.g=b.g;this.b=b.b;return this},copyGammaToLinear:function(d,c){void 0===c&&(c=2);this.r=Math.pow(d.r,c);this.g=Math.pow(d.g,c);this.b=Math.pow(d.b,c);return this},copyLinearToGamma:function(e,d){void 0===d&&(d=2);var f=0<d?1/d:1;this.r=Math.pow(e.r,f);this.g=Math.pow(e.g,f);this.b=Math.pow(e.b,f);return this},convertGammaToLinear:function(){var e=this.r,d=this.g,f=this.b;this.r=e*e;this.g=d*d;this.b=f*f;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(s){s=s||{h:0,s:0,l:0};var r=this.r,q=this.g,p=this.b,o=Math.max(r,q,p),n=Math.min(r,q,p),m,l=(n+o)/2;if(n===o){n=m=0}else{var i=o-n,n=0.5>=l?i/(o+n):i/(2-o-n);switch(o){case r:m=(q-p)/i+(q<p?6:0);break;case q:m=(p-r)/i+2;break;case p:m=(r-q)/i+4}m/=6}s.h=m;s.s=n;s.l=l;return s},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(f,e,h){var g=this.getHSL();g.h+=f;g.s+=e;g.l+=h;this.setHSL(g.h,g.s,g.l);return this},add:function(b){this.r+=b.r;this.g+=b.g;this.b+=b.b;return this},addColors:function(d,c){this.r=d.r+c.r;this.g=d.g+c.g;this.b=d.b+c.b;return this},addScalar:function(b){this.r+=b;this.g+=b;this.b+=b;return this},multiply:function(b){this.r*=b.r;this.g*=b.g;this.b*=b.b;return this},multiplyScalar:function(b){this.r*=b;this.g*=b;this.b*=b;return this},lerp:function(d,c){this.r+=(d.r-this.r)*c;this.g+=(d.g-this.g)*c;this.b+=(d.b-this.b)*c;return this},equals:function(b){return b.r===this.r&&b.g===this.g&&b.b===this.b},fromArray:function(b){this.r=b[0];this.g=b[1];this.b=b[2];return this},toArray:function(d,c){void 0===d&&(d=[]);void 0===c&&(c=0);d[c]=this.r;d[c+1]=this.g;d[c+2]=this.b;return d},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}};THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(f,e,h,g){this._x=f||0;this._y=e||0;this._z=h||0;this._w=void 0!==g?g:1};THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(b){this._x=b;this.onChangeCallback()},get y(){return this._y},set y(b){this._y=b;this.onChangeCallback()},get z(){return this._z},set z(b){this._z=b;this.onChangeCallback()},get w(){return this._w},set w(b){this._w=b;this.onChangeCallback()},set:function(f,e,h,g){this._x=f;this._y=e;this._z=h;this._w=g;this.onChangeCallback();return this},copy:function(b){this._x=b.x;this._y=b.y;this._z=b.z;this._w=b.w;this.onChangeCallback();return this},setFromEuler:function(k,i){if(!1===k instanceof THREE.Euler){throw Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var q=Math.cos(k._x/2),p=Math.cos(k._y/2),o=Math.cos(k._z/2),n=Math.sin(k._x/2),m=Math.sin(k._y/2),l=Math.sin(k._z/2);"XYZ"===k.order?(this._x=n*p*o+q*m*l,this._y=q*m*o-n*p*l,this._z=q*p*l+n*m*o,this._w=q*p*o-n*m*l):"YXZ"===k.order?(this._x=n*p*o+q*m*l,this._y=q*m*o-n*p*l,this._z=q*p*l-n*m*o,this._w=q*p*o+n*m*l):"ZXY"===k.order?(this._x=n*p*o-q*m*l,this._y=q*m*o+n*p*l,this._z=q*p*l+n*m*o,this._w=q*p*o-n*m*l):"ZYX"===k.order?(this._x=n*p*o-q*m*l,this._y=q*m*o+n*p*l,this._z=q*p*l-n*m*o,this._w=q*p*o+n*m*l):"YZX"===k.order?(this._x=n*p*o+q*m*l,this._y=q*m*o+n*p*l,this._z=q*p*l-n*m*o,this._w=q*p*o-n*m*l):"XZY"===k.order&&(this._x=n*p*o-q*m*l,this._y=q*m*o-n*p*l,this._z=q*p*l+n*m*o,this._w=q*p*o+n*m*l);if(!1!==i){this.onChangeCallback()}return this},setFromAxisAngle:function(f,e){var h=e/2,g=Math.sin(h);this._x=f.x*g;this._y=f.y*g;this._z=f.z*g;this._w=Math.cos(h);this.onChangeCallback();return this},setFromRotationMatrix:function(u){var t=u.elements,s=t[0];u=t[4];var r=t[8],q=t[1],p=t[5],o=t[9],n=t[2],m=t[6],t=t[10],i=s+p+t;0<i?(s=0.5/Math.sqrt(i+1),this._w=0.25/s,this._x=(m-o)*s,this._y=(r-n)*s,this._z=(q-u)*s):s>p&&s>t?(s=2*Math.sqrt(1+s-p-t),this._w=(m-o)/s,this._x=0.25*s,this._y=(u+q)/s,this._z=(r+n)/s):p>t?(s=2*Math.sqrt(1+p-s-t),this._w=(r-n)/s,this._x=(u+q)/s,this._y=0.25*s,this._z=(o+m)/s):(s=2*Math.sqrt(1+t-s-p),this._w=(q-u)/s,this._x=(r+n)/s,this._y=(o+m)/s,this._z=0.25*s);this.onChangeCallback();return this},setFromUnitVectors:function(){var d,c;return function(b,a){void 0===d&&(d=new THREE.Vector3);c=b.dot(a)+1;0.000001>c?(c=0,Math.abs(b.x)>Math.abs(b.z)?d.set(-b.y,b.x,0):d.set(0,-b.z,b.y)):d.crossVectors(b,a);this._x=d.x;this._y=d.y;this._z=d.z;this._w=c;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(b){return this._x*b._x+this._y*b._y+this._z*b._z+this._w*b._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var b=this.length();0===b?(this._z=this._y=this._x=0,this._w=1):(b=1/b,this._x*=b,this._y*=b,this._z*=b,this._w*=b);this.onChangeCallback();return this},multiply:function(d,c){return void 0!==c?(THREE.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(d,c)):this.multiplyQuaternions(this,d)},multiplyQuaternions:function(u,t){var s=u._x,r=u._y,q=u._z,p=u._w,o=t._x,n=t._y,m=t._z,i=t._w;this._x=s*i+p*o+r*m-q*n;this._y=r*i+p*n+q*o-s*m;this._z=q*i+p*m+s*n-r*o;this._w=p*i-s*o-r*n-q*m;this.onChangeCallback();return this},multiplyVector3:function(b){THREE.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return b.applyQuaternion(this)},slerp:function(s,r){if(0===r){return this}if(1===r){return this.copy(s)}var q=this._x,p=this._y,o=this._z,n=this._w,m=n*s._w+q*s._x+p*s._y+o*s._z;0>m?(this._w=-s._w,this._x=-s._x,this._y=-s._y,this._z=-s._z,m=-m):this.copy(s);if(1<=m){return this._w=n,this._x=q,this._y=p,this._z=o,this}var l=Math.acos(m),i=Math.sqrt(1-m*m);if(0.001>Math.abs(i)){return this._w=0.5*(n+this._w),this._x=0.5*(q+this._x),this._y=0.5*(p+this._y),this._z=0.5*(o+this._z),this}m=Math.sin((1-r)*l)/i;l=Math.sin(r*l)/i;this._w=n*m+this._w*l;this._x=q*m+this._x*l;this._y=p*m+this._y*l;this._z=o*m+this._z*l;this.onChangeCallback();return this},equals:function(b){return b._x===this._x&&b._y===this._y&&b._z===this._z&&b._w===this._w},fromArray:function(d,c){void 0===c&&(c=0);this._x=d[c];this._y=d[c+1];this._z=d[c+2];this._w=d[c+3];this.onChangeCallback();return this},toArray:function(d,c){void 0===d&&(d=[]);void 0===c&&(c=0);d[c]=this._x;d[c+1]=this._y;d[c+2]=this._z;d[c+3]=this._w;return d},onChange:function(b){this.onChangeCallback=b;return this},onChangeCallback:function(){},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}};THREE.Quaternion.slerp=function(f,e,h,g){return h.copy(f).slerp(e,g)};THREE.Vector2=function(d,c){this.x=d||0;this.y=c||0};THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(d,c){this.x=d;this.y=c;return this},setX:function(b){this.x=b;return this},setY:function(b){this.y=b;return this},setComponent:function(d,c){switch(d){case 0:this.x=c;break;case 1:this.y=c;break;default:throw Error("index is out of range: "+d)}},getComponent:function(b){switch(b){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+b)}},copy:function(b){this.x=b.x;this.y=b.y;return this},add:function(d,c){if(void 0!==c){return THREE.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(d,c)}this.x+=d.x;this.y+=d.y;return this},addScalar:function(b){this.x+=b;this.y+=b;return this},addVectors:function(d,c){this.x=d.x+c.x;this.y=d.y+c.y;return this},sub:function(d,c){if(void 0!==c){return THREE.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(d,c)}this.x-=d.x;this.y-=d.y;return this},subScalar:function(b){this.x-=b;this.y-=b;return this},subVectors:function(d,c){this.x=d.x-c.x;this.y=d.y-c.y;return this},multiply:function(b){this.x*=b.x;this.y*=b.y;return this},multiplyScalar:function(b){this.x*=b;this.y*=b;return this},divide:function(b){this.x/=b.x;this.y/=b.y;return this},divideScalar:function(b){0!==b?(b=1/b,this.x*=b,this.y*=b):this.y=this.x=0;return this},min:function(b){this.x>b.x&&(this.x=b.x);this.y>b.y&&(this.y=b.y);return this},max:function(b){this.x<b.x&&(this.x=b.x);this.y<b.y&&(this.y=b.y);return this},clamp:function(d,c){this.x<d.x?this.x=d.x:this.x>c.x&&(this.x=c.x);this.y<d.y?this.y=d.y:this.y>c.y&&(this.y=c.y);return this},clampScalar:function(){var d,c;return function(b,a){void 0===d&&(d=new THREE.Vector2,c=new THREE.Vector2);d.set(b,b);c.set(a,a);return this.clamp(d,c)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(b){return this.x*b.x+this.y*b.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(b){return Math.sqrt(this.distanceToSquared(b))},distanceToSquared:function(d){var c=this.x-d.x;d=this.y-d.y;return c*c+d*d},setLength:function(d){var c=this.length();0!==c&&d!==c&&this.multiplyScalar(d/c);return this},lerp:function(d,c){this.x+=(d.x-this.x)*c;this.y+=(d.y-this.y)*c;return this},lerpVectors:function(e,d,f){this.subVectors(d,e).multiplyScalar(f).add(e);return this},equals:function(b){return b.x===this.x&&b.y===this.y},fromArray:function(d,c){void 0===c&&(c=0);this.x=d[c];this.y=d[c+1];return this},toArray:function(d,c){void 0===d&&(d=[]);void 0===c&&(c=0);d[c]=this.x;d[c+1]=this.y;return d},fromAttribute:function(e,d,f){void 0===f&&(f=0);d=d*e.itemSize+f;this.x=e.array[d];this.y=e.array[d+1];return this},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(e,d,f){this.x=e||0;this.y=d||0;this.z=f||0};THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,d,f){this.x=e;this.y=d;this.z=f;return this},setX:function(b){this.x=b;return this},setY:function(b){this.y=b;return this},setZ:function(b){this.z=b;return this},setComponent:function(d,c){switch(d){case 0:this.x=c;break;case 1:this.y=c;break;case 2:this.z=c;break;default:throw Error("index is out of range: "+d)}},getComponent:function(b){switch(b){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+b)}},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;return this},add:function(d,c){if(void 0!==c){return THREE.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(d,c)}this.x+=d.x;this.y+=d.y;this.z+=d.z;return this},addScalar:function(b){this.x+=b;this.y+=b;this.z+=b;return this},addVectors:function(d,c){this.x=d.x+c.x;this.y=d.y+c.y;this.z=d.z+c.z;return this},sub:function(d,c){if(void 0!==c){return THREE.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(d,c)}this.x-=d.x;this.y-=d.y;this.z-=d.z;return this},subScalar:function(b){this.x-=b;this.y-=b;this.z-=b;return this},subVectors:function(d,c){this.x=d.x-c.x;this.y=d.y-c.y;this.z=d.z-c.z;return this},multiply:function(d,c){if(void 0!==c){return THREE.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(d,c)}this.x*=d.x;this.y*=d.y;this.z*=d.z;return this},multiplyScalar:function(b){this.x*=b;this.y*=b;this.z*=b;return this},multiplyVectors:function(d,c){this.x=d.x*c.x;this.y=d.y*c.y;this.z=d.z*c.z;return this},applyEuler:function(){var b;return function(a){!1===a instanceof THREE.Euler&&THREE.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.");void 0===b&&(b=new THREE.Quaternion);this.applyQuaternion(b.setFromEuler(a));return this}}(),applyAxisAngle:function(){var b;return function(a,d){void 0===b&&(b=new THREE.Quaternion);this.applyQuaternion(b.setFromAxisAngle(a,d));return this}}(),applyMatrix3:function(f){var e=this.x,h=this.y,g=this.z;f=f.elements;this.x=f[0]*e+f[3]*h+f[6]*g;this.y=f[1]*e+f[4]*h+f[7]*g;this.z=f[2]*e+f[5]*h+f[8]*g;return this},applyMatrix4:function(f){var e=this.x,h=this.y,g=this.z;f=f.elements;this.x=f[0]*e+f[4]*h+f[8]*g+f[12];this.y=f[1]*e+f[5]*h+f[9]*g+f[13];this.z=f[2]*e+f[6]*h+f[10]*g+f[14];return this},applyProjection:function(g){var f=this.x,k=this.y,i=this.z;g=g.elements;var h=1/(g[3]*f+g[7]*k+g[11]*i+g[15]);this.x=(g[0]*f+g[4]*k+g[8]*i+g[12])*h;this.y=(g[1]*f+g[5]*k+g[9]*i+g[13])*h;this.z=(g[2]*f+g[6]*k+g[10]*i+g[14])*h;return this},applyQuaternion:function(u){var t=this.x,s=this.y,r=this.z,q=u.x,p=u.y,o=u.z;u=u.w;var n=u*t+p*r-o*s,m=u*s+o*t-q*r,i=u*r+q*s-p*t,t=-q*t-p*s-o*r;this.x=n*u+t*-q+m*-o-i*-p;this.y=m*u+t*-p+i*-q-n*-o;this.z=i*u+t*-o+n*-p-m*-q;return this},project:function(){var b;return function(a){void 0===b&&(b=new THREE.Matrix4);b.multiplyMatrices(a.projectionMatrix,b.getInverse(a.matrixWorld));return this.applyProjection(b)}}(),unproject:function(){var b;return function(a){void 0===b&&(b=new THREE.Matrix4);b.multiplyMatrices(a.matrixWorld,b.getInverse(a.projectionMatrix));return this.applyProjection(b)}}(),transformDirection:function(f){var e=this.x,h=this.y,g=this.z;f=f.elements;this.x=f[0]*e+f[4]*h+f[8]*g;this.y=f[1]*e+f[5]*h+f[9]*g;this.z=f[2]*e+f[6]*h+f[10]*g;this.normalize();return this},divide:function(b){this.x/=b.x;this.y/=b.y;this.z/=b.z;return this},divideScalar:function(b){0!==b?(b=1/b,this.x*=b,this.y*=b,this.z*=b):this.z=this.y=this.x=0;return this},min:function(b){this.x>b.x&&(this.x=b.x);this.y>b.y&&(this.y=b.y);this.z>b.z&&(this.z=b.z);return this},max:function(b){this.x<b.x&&(this.x=b.x);this.y<b.y&&(this.y=b.y);this.z<b.z&&(this.z=b.z);return this},clamp:function(d,c){this.x<d.x?this.x=d.x:this.x>c.x&&(this.x=c.x);this.y<d.y?this.y=d.y:this.y>c.y&&(this.y=c.y);this.z<d.z?this.z=d.z:this.z>c.z&&(this.z=c.z);return this},clampScalar:function(){var d,c;return function(b,a){void 0===d&&(d=new THREE.Vector3,c=new THREE.Vector3);d.set(b,b,b);c.set(a,a,a);return this.clamp(d,c)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(b){return this.x*b.x+this.y*b.y+this.z*b.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(d){var c=this.length();0!==c&&d!==c&&this.multiplyScalar(d/c);return this},lerp:function(d,c){this.x+=(d.x-this.x)*c;this.y+=(d.y-this.y)*c;this.z+=(d.z-this.z)*c;return this},lerpVectors:function(e,d,f){this.subVectors(d,e).multiplyScalar(f).add(e);return this},cross:function(g,f){if(void 0!==f){return THREE.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(g,f)}var k=this.x,i=this.y,h=this.z;this.x=i*g.z-h*g.y;this.y=h*g.x-k*g.z;this.z=k*g.y-i*g.x;return this},crossVectors:function(k,i){var q=k.x,p=k.y,o=k.z,n=i.x,m=i.y,l=i.z;this.x=p*l-o*m;this.y=o*n-q*l;this.z=q*m-p*n;return this},projectOnVector:function(){var d,c;return function(a){void 0===d&&(d=new THREE.Vector3);d.copy(a).normalize();c=this.dot(d);return this.copy(d).multiplyScalar(c)}}(),projectOnPlane:function(){var b;return function(a){void 0===b&&(b=new THREE.Vector3);b.copy(this).projectOnVector(a);return this.sub(b)}}(),reflect:function(){var b;return function(a){void 0===b&&(b=new THREE.Vector3);return this.sub(b.copy(a).multiplyScalar(2*this.dot(a)))}}(),angleTo:function(b){b=this.dot(b)/(this.length()*b.length());return Math.acos(THREE.Math.clamp(b,-1,1))},distanceTo:function(b){return Math.sqrt(this.distanceToSquared(b))},distanceToSquared:function(e){var d=this.x-e.x,f=this.y-e.y;e=this.z-e.z;return d*d+f*f+e*e},setEulerFromRotationMatrix:function(d,c){THREE.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(d,c){THREE.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(b){THREE.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(b)},getScaleFromMatrix:function(b){THREE.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(b)},getColumnFromMatrix:function(d,c){THREE.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(d,c)},setFromMatrixPosition:function(b){this.x=b.elements[12];this.y=b.elements[13];this.z=b.elements[14];return this},setFromMatrixScale:function(e){var d=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),f=this.set(e.elements[4],e.elements[5],e.elements[6]).length();e=this.set(e.elements[8],e.elements[9],e.elements[10]).length();this.x=d;this.y=f;this.z=e;return this},setFromMatrixColumn:function(f,e){var h=4*f,g=e.elements;this.x=g[h];this.y=g[h+1];this.z=g[h+2];return this},equals:function(b){return b.x===this.x&&b.y===this.y&&b.z===this.z},fromArray:function(d,c){void 0===c&&(c=0);this.x=d[c];this.y=d[c+1];this.z=d[c+2];return this},toArray:function(d,c){void 0===d&&(d=[]);void 0===c&&(c=0);d[c]=this.x;d[c+1]=this.y;d[c+2]=this.z;return d},fromAttribute:function(e,d,f){void 0===f&&(f=0);d=d*e.itemSize+f;this.x=e.array[d];this.y=e.array[d+1];this.z=e.array[d+2];return this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(f,e,h,g){this.x=f||0;this.y=e||0;this.z=h||0;this.w=void 0!==g?g:1};THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(f,e,h,g){this.x=f;this.y=e;this.z=h;this.w=g;return this},setX:function(b){this.x=b;return this},setY:function(b){this.y=b;return this},setZ:function(b){this.z=b;return this},setW:function(b){this.w=b;return this},setComponent:function(d,c){switch(d){case 0:this.x=c;break;case 1:this.y=c;break;case 2:this.z=c;break;case 3:this.w=c;break;default:throw Error("index is out of range: "+d)}},getComponent:function(b){switch(b){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+b)}},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;this.w=void 0!==b.w?b.w:1;return this},add:function(d,c){if(void 0!==c){return THREE.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(d,c)}this.x+=d.x;this.y+=d.y;this.z+=d.z;this.w+=d.w;return this},addScalar:function(b){this.x+=b;this.y+=b;this.z+=b;this.w+=b;return this},addVectors:function(d,c){this.x=d.x+c.x;this.y=d.y+c.y;this.z=d.z+c.z;this.w=d.w+c.w;return this},sub:function(d,c){if(void 0!==c){return THREE.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(d,c)}this.x-=d.x;this.y-=d.y;this.z-=d.z;this.w-=d.w;return this},subScalar:function(b){this.x-=b;this.y-=b;this.z-=b;this.w-=b;return this},subVectors:function(d,c){this.x=d.x-c.x;this.y=d.y-c.y;this.z=d.z-c.z;this.w=d.w-c.w;return this},multiplyScalar:function(b){this.x*=b;this.y*=b;this.z*=b;this.w*=b;return this},applyMatrix4:function(g){var f=this.x,k=this.y,i=this.z,h=this.w;g=g.elements;this.x=g[0]*f+g[4]*k+g[8]*i+g[12]*h;this.y=g[1]*f+g[5]*k+g[9]*i+g[13]*h;this.z=g[2]*f+g[6]*k+g[10]*i+g[14]*h;this.w=g[3]*f+g[7]*k+g[11]*i+g[15]*h;return this},divideScalar:function(b){0!==b?(b=1/b,this.x*=b,this.y*=b,this.z*=b,this.w*=b):(this.z=this.y=this.x=0,this.w=1);return this},setAxisAngleFromQuaternion:function(d){this.w=2*Math.acos(d.w);var c=Math.sqrt(1-d.w*d.w);0.0001>c?(this.x=1,this.z=this.y=0):(this.x=d.x/c,this.y=d.y/c,this.z=d.z/c);return this},setAxisAngleFromRotationMatrix:function(u){var t,s,r;u=u.elements;var q=u[0];r=u[4];var p=u[8],o=u[1],n=u[5],m=u[9];s=u[2];t=u[6];var i=u[10];if(0.01>Math.abs(r-o)&&0.01>Math.abs(p-s)&&0.01>Math.abs(m-t)){if(0.1>Math.abs(r+o)&&0.1>Math.abs(p+s)&&0.1>Math.abs(m+t)&&0.1>Math.abs(q+n+i-3)){return this.set(1,0,0,0),this}u=Math.PI;q=(q+1)/2;n=(n+1)/2;i=(i+1)/2;r=(r+o)/4;p=(p+s)/4;m=(m+t)/4;q>n&&q>i?0.01>q?(t=0,r=s=0.707106781):(t=Math.sqrt(q),s=r/t,r=p/t):n>i?0.01>n?(t=0.707106781,s=0,r=0.707106781):(s=Math.sqrt(n),t=r/s,r=m/s):0.01>i?(s=t=0.707106781,r=0):(r=Math.sqrt(i),t=p/r,s=m/r);this.set(t,s,r,u);return this}u=Math.sqrt((t-m)*(t-m)+(p-s)*(p-s)+(o-r)*(o-r));0.001>Math.abs(u)&&(u=1);this.x=(t-m)/u;this.y=(p-s)/u;this.z=(o-r)/u;this.w=Math.acos((q+n+i-1)/2);return this},min:function(b){this.x>b.x&&(this.x=b.x);this.y>b.y&&(this.y=b.y);this.z>b.z&&(this.z=b.z);this.w>b.w&&(this.w=b.w);return this},max:function(b){this.x<b.x&&(this.x=b.x);this.y<b.y&&(this.y=b.y);this.z<b.z&&(this.z=b.z);this.w<b.w&&(this.w=b.w);return this},clamp:function(d,c){this.x<d.x?this.x=d.x:this.x>c.x&&(this.x=c.x);this.y<d.y?this.y=d.y:this.y>c.y&&(this.y=c.y);this.z<d.z?this.z=d.z:this.z>c.z&&(this.z=c.z);this.w<d.w?this.w=d.w:this.w>c.w&&(this.w=c.w);return this},clampScalar:function(){var d,c;return function(b,a){void 0===d&&(d=new THREE.Vector4,c=new THREE.Vector4);d.set(b,b,b,b);c.set(a,a,a,a);return this.clamp(d,c)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(b){return this.x*b.x+this.y*b.y+this.z*b.z+this.w*b.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(d){var c=this.length();0!==c&&d!==c&&this.multiplyScalar(d/c);return this},lerp:function(d,c){this.x+=(d.x-this.x)*c;this.y+=(d.y-this.y)*c;this.z+=(d.z-this.z)*c;this.w+=(d.w-this.w)*c;return this},lerpVectors:function(e,d,f){this.subVectors(d,e).multiplyScalar(f).add(e);return this},equals:function(b){return b.x===this.x&&b.y===this.y&&b.z===this.z&&b.w===this.w},fromArray:function(d,c){void 0===c&&(c=0);this.x=d[c];this.y=d[c+1];this.z=d[c+2];this.w=d[c+3];return this},toArray:function(d,c){void 0===d&&(d=[]);void 0===c&&(c=0);d[c]=this.x;d[c+1]=this.y;d[c+2]=this.z;d[c+3]=this.w;return d},fromAttribute:function(e,d,f){void 0===f&&(f=0);d=d*e.itemSize+f;this.x=e.array[d];this.y=e.array[d+1];this.z=e.array[d+2];this.w=e.array[d+3];return this},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Euler=function(f,e,h,g){this._x=f||0;this._y=e||0;this._z=h||0;this._order=g||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");THREE.Euler.DefaultOrder="XYZ";THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,get x(){return this._x},set x(b){this._x=b;this.onChangeCallback()},get y(){return this._y},set y(b){this._y=b;this.onChangeCallback()},get z(){return this._z},set z(b){this._z=b;this.onChangeCallback()},get order(){return this._order},set order(b){this._order=b;this.onChangeCallback()},set:function(f,e,h,g){this._x=f;this._y=e;this._z=h;this._order=g||this._order;this.onChangeCallback();return this},copy:function(b){this._x=b._x;this._y=b._y;this._z=b._z;this._order=b._order;this.onChangeCallback();return this},setFromRotationMatrix:function(C,B,A){var v=THREE.Math.clamp,u=C.elements;C=u[0];var t=u[4],s=u[8],r=u[1],o=u[5],n=u[9],m=u[2],i=u[6],u=u[10];B=B||this._order;"XYZ"===B?(this._y=Math.asin(v(s,-1,1)),0.99999>Math.abs(s)?(this._x=Math.atan2(-n,u),this._z=Math.atan2(-t,C)):(this._x=Math.atan2(i,o),this._z=0)):"YXZ"===B?(this._x=Math.asin(-v(n,-1,1)),0.99999>Math.abs(n)?(this._y=Math.atan2(s,u),this._z=Math.atan2(r,o)):(this._y=Math.atan2(-m,C),this._z=0)):"ZXY"===B?(this._x=Math.asin(v(i,-1,1)),0.99999>Math.abs(i)?(this._y=Math.atan2(-m,u),this._z=Math.atan2(-t,o)):(this._y=0,this._z=Math.atan2(r,C))):"ZYX"===B?(this._y=Math.asin(-v(m,-1,1)),0.99999>Math.abs(m)?(this._x=Math.atan2(i,u),this._z=Math.atan2(r,C)):(this._x=0,this._z=Math.atan2(-t,o))):"YZX"===B?(this._z=Math.asin(v(r,-1,1)),0.99999>Math.abs(r)?(this._x=Math.atan2(-n,o),this._y=Math.atan2(-m,C)):(this._x=0,this._y=Math.atan2(s,u))):"XZY"===B?(this._z=Math.asin(-v(t,-1,1)),0.99999>Math.abs(t)?(this._x=Math.atan2(i,o),this._y=Math.atan2(s,C)):(this._x=Math.atan2(-n,u),this._y=0)):THREE.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+B);this._order=B;if(!1!==A){this.onChangeCallback()}return this},setFromQuaternion:function(){var b;return function(a,f,e){void 0===b&&(b=new THREE.Matrix4);b.makeRotationFromQuaternion(a);this.setFromRotationMatrix(b,f,e);return this}}(),setFromVector3:function(d,c){return this.set(d.x,d.y,d.z,c||this._order)},reorder:function(){var b=new THREE.Quaternion;return function(a){b.setFromEuler(this);this.setFromQuaternion(b,a)}}(),equals:function(b){return b._x===this._x&&b._y===this._y&&b._z===this._z&&b._order===this._order},fromArray:function(b){this._x=b[0];this._y=b[1];this._z=b[2];void 0!==b[3]&&(this._order=b[3]);this.onChangeCallback();return this},toArray:function(d,c){void 0===d&&(d=[]);void 0===c&&(c=0);d[c]=this._x;d[c+1]=this._y;d[c+2]=this._z;d[c+3]=this._order;return d},toVector3:function(b){return b?b.set(this._x,this._y,this._z):new THREE.Vector3(this._x,this._y,this._z)},onChange:function(b){this.onChangeCallback=b;return this},onChangeCallback:function(){},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}};THREE.Line3=function(d,c){this.start=void 0!==d?d:new THREE.Vector3;this.end=void 0!==c?c:new THREE.Vector3};THREE.Line3.prototype={constructor:THREE.Line3,set:function(d,c){this.start.copy(d);this.end.copy(c);return this},copy:function(b){this.start.copy(b.start);this.end.copy(b.end);return this},center:function(b){return(b||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(0.5)},delta:function(b){return(b||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,d){var f=d||new THREE.Vector3;return this.delta(f).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var d=new THREE.Vector3,c=new THREE.Vector3;return function(f,b){d.subVectors(f,this.start);c.subVectors(this.end,this.start);var a=c.dot(c),a=c.dot(d)/a;b&&(a=THREE.Math.clamp(a,0,1));return a}}(),closestPointToPoint:function(e,d,f){e=this.closestPointToPointParameter(e,d);f=f||new THREE.Vector3;return this.delta(f).multiplyScalar(e).add(this.start)},applyMatrix4:function(b){this.start.applyMatrix4(b);this.end.applyMatrix4(b);return this},equals:function(b){return b.start.equals(this.start)&&b.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}};THREE.Box2=function(d,c){this.min=void 0!==d?d:new THREE.Vector2(Infinity,Infinity);this.max=void 0!==c?c:new THREE.Vector2(-Infinity,-Infinity)};THREE.Box2.prototype={constructor:THREE.Box2,set:function(d,c){this.min.copy(d);this.max.copy(c);return this},setFromPoints:function(e){this.makeEmpty();for(var d=0,f=e.length;d<f;d++){this.expandByPoint(e[d])}return this},setFromCenterAndSize:function(){var b=new THREE.Vector2;return function(a,f){var e=b.copy(f).multiplyScalar(0.5);this.min.copy(a).sub(e);this.max.copy(a).add(e);return this}}(),copy:function(b){this.min.copy(b.min);this.max.copy(b.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(b){return(b||new THREE.Vector2).addVectors(this.min,this.max).multiplyScalar(0.5)},size:function(b){return(b||new THREE.Vector2).subVectors(this.max,this.min)},expandByPoint:function(b){this.min.min(b);this.max.max(b);return this},expandByVector:function(b){this.min.sub(b);this.max.add(b);return this},expandByScalar:function(b){this.min.addScalar(-b);this.max.addScalar(b);return this},containsPoint:function(b){return b.x<this.min.x||b.x>this.max.x||b.y<this.min.y||b.y>this.max.y?!1:!0},containsBox:function(b){return this.min.x<=b.min.x&&b.max.x<=this.max.x&&this.min.y<=b.min.y&&b.max.y<=this.max.y?!0:!1},getParameter:function(d,c){return(c||new THREE.Vector2).set((d.x-this.min.x)/(this.max.x-this.min.x),(d.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(b){return b.max.x<this.min.x||b.min.x>this.max.x||b.max.y<this.min.y||b.min.y>this.max.y?!1:!0},clampPoint:function(d,c){return(c||new THREE.Vector2).copy(d).clamp(this.min,this.max)},distanceToPoint:function(){var b=new THREE.Vector2;return function(a){return b.copy(a).clamp(this.min,this.max).sub(a).length()}}(),intersect:function(b){this.min.max(b.min);this.max.min(b.max);return this},union:function(b){this.min.min(b.min);this.max.max(b.max);return this},translate:function(b){this.min.add(b);this.max.add(b);return this},equals:function(b){return b.min.equals(this.min)&&b.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}};THREE.Box3=function(d,c){this.min=void 0!==d?d:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=void 0!==c?c:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};THREE.Box3.prototype={constructor:THREE.Box3,set:function(d,c){this.min.copy(d);this.max.copy(c);return this},setFromPoints:function(e){this.makeEmpty();for(var d=0,f=e.length;d<f;d++){this.expandByPoint(e[d])}return this},setFromCenterAndSize:function(){var b=new THREE.Vector3;return function(a,f){var e=b.copy(f).multiplyScalar(0.5);this.min.copy(a).sub(e);this.max.copy(a).add(e);return this}}(),setFromObject:function(){var b=new THREE.Vector3;return function(a){var d=this;a.updateMatrixWorld(!0);this.makeEmpty();a.traverse(function(c){var k=c.geometry;if(void 0!==k){if(k instanceof THREE.Geometry){for(var i=k.vertices,k=0,h=i.length;k<h;k++){b.copy(i[k]),b.applyMatrix4(c.matrixWorld),d.expandByPoint(b)}}else{if(k instanceof THREE.BufferGeometry&&void 0!==k.attributes.position){for(i=k.attributes.position.array,k=0,h=i.length;k<h;k+=3){b.set(i[k],i[k+1],i[k+2]),b.applyMatrix4(c.matrixWorld),d.expandByPoint(b)}}}}});return this}}(),copy:function(b){this.min.copy(b.min);this.max.copy(b.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(b){return(b||new THREE.Vector3).addVectors(this.min,this.max).multiplyScalar(0.5)},size:function(b){return(b||new THREE.Vector3).subVectors(this.max,this.min)},expandByPoint:function(b){this.min.min(b);this.max.max(b);return this},expandByVector:function(b){this.min.sub(b);this.max.add(b);return this},expandByScalar:function(b){this.min.addScalar(-b);this.max.addScalar(b);return this},containsPoint:function(b){return b.x<this.min.x||b.x>this.max.x||b.y<this.min.y||b.y>this.max.y||b.z<this.min.z||b.z>this.max.z?!1:!0},containsBox:function(b){return this.min.x<=b.min.x&&b.max.x<=this.max.x&&this.min.y<=b.min.y&&b.max.y<=this.max.y&&this.min.z<=b.min.z&&b.max.z<=this.max.z?!0:!1},getParameter:function(d,c){return(c||new THREE.Vector3).set((d.x-this.min.x)/(this.max.x-this.min.x),(d.y-this.min.y)/(this.max.y-this.min.y),(d.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(b){return b.max.x<this.min.x||b.min.x>this.max.x||b.max.y<this.min.y||b.min.y>this.max.y||b.max.z<this.min.z||b.min.z>this.max.z?!1:!0},clampPoint:function(d,c){return(c||new THREE.Vector3).copy(d).clamp(this.min,this.max)},distanceToPoint:function(){var b=new THREE.Vector3;return function(a){return b.copy(a).clamp(this.min,this.max).sub(a).length()}}(),getBoundingSphere:function(){var b=new THREE.Vector3;return function(a){a=a||new THREE.Sphere;a.center=this.center();a.radius=0.5*this.size(b).length();return a}}(),intersect:function(b){this.min.max(b.min);this.max.min(b.max);return this},union:function(b){this.min.min(b.min);this.max.max(b.max);return this},applyMatrix4:function(){var b=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(a){b[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(a);b[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(a);b[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(a);b[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(a);b[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(a);b[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(a);b[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(a);b[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(a);this.makeEmpty();this.setFromPoints(b);return this}}(),translate:function(b){this.min.add(b);this.max.add(b);return this},equals:function(b){return b.min.equals(this.min)&&b.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}};THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&THREE.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")};THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(u,t,s,r,q,p,o,n,m){var i=this.elements;i[0]=u;i[3]=t;i[6]=s;i[1]=r;i[4]=q;i[7]=p;i[2]=o;i[5]=n;i[8]=m;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(b){b=b.elements;this.set(b[0],b[3],b[6],b[1],b[4],b[7],b[2],b[5],b[8]);return this},multiplyVector3:function(b){THREE.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return b.applyMatrix3(this)},multiplyVector3Array:function(b){THREE.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(b)},applyToVector3Array:function(){var b=new THREE.Vector3;return function(a,h,g){void 0===h&&(h=0);void 0===g&&(g=a.length);for(var f=0;f<g;f+=3,h+=3){b.x=a[h],b.y=a[h+1],b.z=a[h+2],b.applyMatrix3(this),a[h]=b.x,a[h+1]=b.y,a[h+2]=b.z}return a}}(),multiplyScalar:function(d){var c=this.elements;c[0]*=d;c[3]*=d;c[6]*=d;c[1]*=d;c[4]*=d;c[7]*=d;c[2]*=d;c[5]*=d;c[8]*=d;return this},determinant:function(){var s=this.elements,r=s[0],q=s[1],p=s[2],o=s[3],n=s[4],m=s[5],l=s[6],i=s[7],s=s[8];return r*n*s-r*m*i-q*o*s+q*m*l+p*o*i-p*n*l},getInverse:function(f,e){var h=f.elements,g=this.elements;g[0]=h[10]*h[5]-h[6]*h[9];g[1]=-h[10]*h[1]+h[2]*h[9];g[2]=h[6]*h[1]-h[2]*h[5];g[3]=-h[10]*h[4]+h[6]*h[8];g[4]=h[10]*h[0]-h[2]*h[8];g[5]=-h[6]*h[0]+h[2]*h[4];g[6]=h[9]*h[4]-h[5]*h[8];g[7]=-h[9]*h[0]+h[1]*h[8];g[8]=h[5]*h[0]-h[1]*h[4];h=h[0]*g[0]+h[1]*g[3]+h[2]*g[6];if(0===h){if(e){throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0")}THREE.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/h);return this},transpose:function(){var d,c=this.elements;d=c[1];c[1]=c[3];c[3]=d;d=c[2];c[2]=c[6];c[6]=d;d=c[5];c[5]=c[7];c[7]=d;return this},flattenToArrayOffset:function(e,d){var f=this.elements;e[d]=f[0];e[d+1]=f[1];e[d+2]=f[2];e[d+3]=f[3];e[d+4]=f[4];e[d+5]=f[5];e[d+6]=f[6];e[d+7]=f[7];e[d+8]=f[8];return e},getNormalMatrix:function(b){this.getInverse(b).transpose();return this},transposeIntoArray:function(d){var c=this.elements;d[0]=c[0];d[1]=c[3];d[2]=c[6];d[3]=c[1];d[4]=c[4];d[5]=c[7];d[6]=c[2];d[7]=c[5];d[8]=c[8];return this},fromArray:function(b){this.elements.set(b);return this},toArray:function(){var b=this.elements;return[b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8]]},clone:function(){return(new THREE.Matrix3).fromArray(this.elements)}};THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&THREE.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")};THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(J,I,H,G,F,E,D,C,B,A,o,m,v,L,i,M){var K=this.elements;K[0]=J;K[4]=I;K[8]=H;K[12]=G;K[1]=F;K[5]=E;K[9]=D;K[13]=C;K[2]=B;K[6]=A;K[10]=o;K[14]=m;K[3]=v;K[7]=L;K[11]=i;K[15]=M;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(b){this.elements.set(b.elements);return this},extractPosition:function(b){THREE.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(b)},copyPosition:function(d){var c=this.elements;d=d.elements;c[12]=d[12];c[13]=d[13];c[14]=d[14];return this},extractBasis:function(f,e,h){var g=this.elements;f.set(g[0],g[1],g[2]);e.set(g[4],g[5],g[6]);h.set(g[8],g[9],g[10]);return this},makeBasis:function(e,d,f){this.set(e.x,d.x,f.x,0,e.y,d.y,f.y,0,e.z,d.z,f.z,0,0,0,0,1);return this},extractRotation:function(){var b=new THREE.Vector3;return function(a){var k=this.elements;a=a.elements;var i=1/b.set(a[0],a[1],a[2]).length(),h=1/b.set(a[4],a[5],a[6]).length(),g=1/b.set(a[8],a[9],a[10]).length();k[0]=a[0]*i;k[1]=a[1]*i;k[2]=a[2]*i;k[4]=a[4]*h;k[5]=a[5]*h;k[6]=a[6]*h;k[8]=a[8]*g;k[9]=a[9]*g;k[10]=a[10]*g;return this}}(),makeRotationFromEuler:function(A){!1===A instanceof THREE.Euler&&THREE.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var v=this.elements,u=A.x,t=A.y,s=A.z,r=Math.cos(u),u=Math.sin(u),q=Math.cos(t),t=Math.sin(t),o=Math.cos(s),s=Math.sin(s);if("XYZ"===A.order){A=r*o;var n=r*s,m=u*o,i=u*s;v[0]=q*o;v[4]=-q*s;v[8]=t;v[1]=n+m*t;v[5]=A-i*t;v[9]=-u*q;v[2]=i-A*t;v[6]=m+n*t;v[10]=r*q}else{"YXZ"===A.order?(A=q*o,n=q*s,m=t*o,i=t*s,v[0]=A+i*u,v[4]=m*u-n,v[8]=r*t,v[1]=r*s,v[5]=r*o,v[9]=-u,v[2]=n*u-m,v[6]=i+A*u,v[10]=r*q):"ZXY"===A.order?(A=q*o,n=q*s,m=t*o,i=t*s,v[0]=A-i*u,v[4]=-r*s,v[8]=m+n*u,v[1]=n+m*u,v[5]=r*o,v[9]=i-A*u,v[2]=-r*t,v[6]=u,v[10]=r*q):"ZYX"===A.order?(A=r*o,n=r*s,m=u*o,i=u*s,v[0]=q*o,v[4]=m*t-n,v[8]=A*t+i,v[1]=q*s,v[5]=i*t+A,v[9]=n*t-m,v[2]=-t,v[6]=u*q,v[10]=r*q):"YZX"===A.order?(A=r*q,n=r*t,m=u*q,i=u*t,v[0]=q*o,v[4]=i-A*s,v[8]=m*s+n,v[1]=s,v[5]=r*o,v[9]=-u*o,v[2]=-t*o,v[6]=n*s+m,v[10]=A-i*s):"XZY"===A.order&&(A=r*q,n=r*t,m=u*q,i=u*t,v[0]=q*o,v[4]=-s,v[8]=t*o,v[1]=A*s+i,v[5]=r*o,v[9]=n*s-m,v[2]=m*s-n,v[6]=u*o,v[10]=i*s+A)}v[3]=0;v[7]=0;v[11]=0;v[12]=0;v[13]=0;v[14]=0;v[15]=1;return this},setRotationFromQuaternion:function(b){THREE.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(b)},makeRotationFromQuaternion:function(A){var v=this.elements,u=A.x,t=A.y,s=A.z,r=A.w,q=u+u,o=t+t,n=s+s;A=u*q;var m=u*o,u=u*n,i=t*o,t=t*n,s=s*n,q=r*q,o=r*o,r=r*n;v[0]=1-(i+s);v[4]=m-r;v[8]=u+o;v[1]=m+r;v[5]=1-(A+s);v[9]=t-q;v[2]=u-o;v[6]=t+q;v[10]=1-(A+i);v[3]=0;v[7]=0;v[11]=0;v[12]=0;v[13]=0;v[14]=0;v[15]=1;return this},lookAt:function(){var e=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Vector3;return function(h,c,b){var a=this.elements;f.subVectors(h,c).normalize();0===f.length()&&(f.z=1);e.crossVectors(b,f).normalize();0===e.length()&&(f.x+=0.0001,e.crossVectors(b,f).normalize());d.crossVectors(f,e);a[0]=e.x;a[4]=d.x;a[8]=f.x;a[1]=e.y;a[5]=d.y;a[9]=f.y;a[2]=e.z;a[6]=d.z;a[10]=f.z;return this}}(),multiply:function(d,c){return void 0!==c?(THREE.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(d,c)):this.multiplyMatrices(this,d)},multiplyMatrices:function(at,ar){var aq=at.elements,ap=ar.elements,ao=this.elements,an=aq[0],am=aq[4],al=aq[8],ak=aq[12],aj=aq[1],ah=aq[5],af=aq[9],ai=aq[13],ab=aq[2],ae=aq[6],ad=aq[10],Z=aq[14],X=aq[3],S=aq[7],ac=aq[11],aq=aq[15],V=ap[0],O=ap[4],ag=ap[8],aa=ap[12],W=ap[1],Y=ap[5],K=ap[9],Q=ap[13],i=ap[2],C=ap[6],T=ap[10],J=ap[14],o=ap[3],B=ap[7],m=ap[11],ap=ap[15];ao[0]=an*V+am*W+al*i+ak*o;ao[4]=an*O+am*Y+al*C+ak*B;ao[8]=an*ag+am*K+al*T+ak*m;ao[12]=an*aa+am*Q+al*J+ak*ap;ao[1]=aj*V+ah*W+af*i+ai*o;ao[5]=aj*O+ah*Y+af*C+ai*B;ao[9]=aj*ag+ah*K+af*T+ai*m;ao[13]=aj*aa+ah*Q+af*J+ai*ap;ao[2]=ab*V+ae*W+ad*i+Z*o;ao[6]=ab*O+ae*Y+ad*C+Z*B;ao[10]=ab*ag+ae*K+ad*T+Z*m;ao[14]=ab*aa+ae*Q+ad*J+Z*ap;ao[3]=X*V+S*W+ac*i+aq*o;ao[7]=X*O+S*Y+ac*C+aq*B;ao[11]=X*ag+S*K+ac*T+aq*m;ao[15]=X*aa+S*Q+ac*J+aq*ap;return this},multiplyToArray:function(f,e,h){var g=this.elements;this.multiplyMatrices(f,e);h[0]=g[0];h[1]=g[1];h[2]=g[2];h[3]=g[3];h[4]=g[4];h[5]=g[5];h[6]=g[6];h[7]=g[7];h[8]=g[8];h[9]=g[9];h[10]=g[10];h[11]=g[11];h[12]=g[12];h[13]=g[13];h[14]=g[14];h[15]=g[15];return this},multiplyScalar:function(d){var c=this.elements;c[0]*=d;c[4]*=d;c[8]*=d;c[12]*=d;c[1]*=d;c[5]*=d;c[9]*=d;c[13]*=d;c[2]*=d;c[6]*=d;c[10]*=d;c[14]*=d;c[3]*=d;c[7]*=d;c[11]*=d;c[15]*=d;return this},multiplyVector3:function(b){THREE.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return b.applyProjection(this)},multiplyVector4:function(b){THREE.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return b.applyMatrix4(this)},multiplyVector3Array:function(b){THREE.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(b)},applyToVector3Array:function(){var b=new THREE.Vector3;return function(a,h,g){void 0===h&&(h=0);void 0===g&&(g=a.length);for(var f=0;f<g;f+=3,h+=3){b.x=a[h],b.y=a[h+1],b.z=a[h+2],b.applyMatrix4(this),a[h]=b.x,a[h+1]=b.y,a[h+2]=b.z}return a}}(),rotateAxis:function(b){THREE.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");b.transformDirection(this)},crossVector:function(b){THREE.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return b.applyMatrix4(this)},determinant:function(){var E=this.elements,D=E[0],C=E[4],B=E[8],A=E[12],v=E[1],u=E[5],t=E[9],s=E[13],r=E[2],m=E[6],i=E[10],o=E[14];return E[3]*(+A*t*m-B*s*m-A*u*i+C*s*i+B*u*o-C*t*o)+E[7]*(+D*t*o-D*s*i+A*v*i-B*v*o+B*s*r-A*t*r)+E[11]*(+D*s*m-D*u*o-A*v*m+C*v*o+A*u*r-C*s*r)+E[15]*(-B*u*r-D*t*m+D*u*i+B*v*m-C*v*i+C*t*r)},transpose:function(){var d=this.elements,c;c=d[1];d[1]=d[4];d[4]=c;c=d[2];d[2]=d[8];d[8]=c;c=d[6];d[6]=d[9];d[9]=c;c=d[3];d[3]=d[12];d[12]=c;c=d[7];d[7]=d[13];d[13]=c;c=d[11];d[11]=d[14];d[14]=c;return this},flattenToArrayOffset:function(e,d){var f=this.elements;e[d]=f[0];e[d+1]=f[1];e[d+2]=f[2];e[d+3]=f[3];e[d+4]=f[4];e[d+5]=f[5];e[d+6]=f[6];e[d+7]=f[7];e[d+8]=f[8];e[d+9]=f[9];e[d+10]=f[10];e[d+11]=f[11];e[d+12]=f[12];e[d+13]=f[13];e[d+14]=f[14];e[d+15]=f[15];return e},getPosition:function(){var b=new THREE.Vector3;return function(){THREE.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var a=this.elements;return b.set(a[12],a[13],a[14])}}(),setPosition:function(d){var c=this.elements;c[12]=d.x;c[13]=d.y;c[14]=d.z;return this},getInverse:function(P,O){var N=this.elements,M=P.elements,L=M[0],K=M[4],J=M[8],I=M[12],H=M[1],G=M[5],E=M[9],D=M[13],F=M[2],A=M[6],C=M[10],B=M[14],o=M[3],m=M[7],i=M[11],M=M[15];N[0]=E*B*m-D*C*m+D*A*i-G*B*i-E*A*M+G*C*M;N[4]=I*C*m-J*B*m-I*A*i+K*B*i+J*A*M-K*C*M;N[8]=J*D*m-I*E*m+I*G*i-K*D*i-J*G*M+K*E*M;N[12]=I*E*A-J*D*A-I*G*C+K*D*C+J*G*B-K*E*B;N[1]=D*C*o-E*B*o-D*F*i+H*B*i+E*F*M-H*C*M;N[5]=J*B*o-I*C*o+I*F*i-L*B*i-J*F*M+L*C*M;N[9]=I*E*o-J*D*o-I*H*i+L*D*i+J*H*M-L*E*M;N[13]=J*D*F-I*E*F+I*H*C-L*D*C-J*H*B+L*E*B;N[2]=G*B*o-D*A*o+D*F*m-H*B*m-G*F*M+H*A*M;N[6]=I*A*o-K*B*o-I*F*m+L*B*m+K*F*M-L*A*M;N[10]=K*D*o-I*G*o+I*H*m-L*D*m-K*H*M+L*G*M;N[14]=I*G*F-K*D*F-I*H*A+L*D*A+K*H*B-L*G*B;N[3]=E*A*o-G*C*o-E*F*m+H*C*m+G*F*i-H*A*i;N[7]=K*C*o-J*A*o+J*F*m-L*C*m-K*F*i+L*A*i;N[11]=J*G*o-K*E*o-J*H*m+L*E*m+K*H*i-L*G*i;N[15]=K*E*F-J*G*F+J*H*A-L*E*A-K*H*C+L*G*C;N=L*N[0]+H*N[4]+F*N[8]+o*N[12];if(0==N){if(O){throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0")}THREE.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/N);return this},translate:function(b){THREE.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(b){THREE.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(b){THREE.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(b){THREE.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(d,c){THREE.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(f){var e=this.elements,h=f.x,g=f.y;f=f.z;e[0]*=h;e[4]*=g;e[8]*=f;e[1]*=h;e[5]*=g;e[9]*=f;e[2]*=h;e[6]*=g;e[10]*=f;e[3]*=h;e[7]*=g;e[11]*=f;return this},getMaxScaleOnAxis:function(){var b=this.elements;return Math.sqrt(Math.max(b[0]*b[0]+b[1]*b[1]+b[2]*b[2],Math.max(b[4]*b[4]+b[5]*b[5]+b[6]*b[6],b[8]*b[8]+b[9]*b[9]+b[10]*b[10])))},makeTranslation:function(e,d,f){this.set(1,0,0,e,0,1,0,d,0,0,1,f,0,0,0,1);return this},makeRotationX:function(d){var c=Math.cos(d);d=Math.sin(d);this.set(1,0,0,0,0,c,-d,0,0,d,c,0,0,0,0,1);return this},makeRotationY:function(d){var c=Math.cos(d);d=Math.sin(d);this.set(c,0,d,0,0,1,0,0,-d,0,c,0,0,0,0,1);return this},makeRotationZ:function(d){var c=Math.cos(d);d=Math.sin(d);this.set(c,-d,0,0,d,c,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(u,t){var s=Math.cos(t),r=Math.sin(t),q=1-s,p=u.x,o=u.y,n=u.z,m=q*p,i=q*o;this.set(m*p+s,m*o-r*n,m*n+r*o,0,m*o+r*n,i*o+s,i*n-r*p,0,m*n-r*o,i*n+r*p,q*n*n+s,0,0,0,0,1);return this},makeScale:function(e,d,f){this.set(e,0,0,0,0,d,0,0,0,0,f,0,0,0,0,1);return this},compose:function(e,d,f){this.makeRotationFromQuaternion(d);this.scale(f);this.setPosition(e);return this},decompose:function(){var d=new THREE.Vector3,c=new THREE.Matrix4;return function(q,p,o){var n=this.elements,m=d.set(n[0],n[1],n[2]).length(),i=d.set(n[4],n[5],n[6]).length(),b=d.set(n[8],n[9],n[10]).length();0>this.determinant()&&(m=-m);q.x=n[12];q.y=n[13];q.z=n[14];c.elements.set(this.elements);q=1/m;var n=1/i,a=1/b;c.elements[0]*=q;c.elements[1]*=q;c.elements[2]*=q;c.elements[4]*=n;c.elements[5]*=n;c.elements[6]*=n;c.elements[8]*=a;c.elements[9]*=a;c.elements[10]*=a;p.setFromRotationMatrix(c);o.x=m;o.y=i;o.z=b;return this}}(),makeFrustum:function(i,h,o,n,m,l){var k=this.elements;k[0]=2*m/(h-i);k[4]=0;k[8]=(h+i)/(h-i);k[12]=0;k[1]=0;k[5]=2*m/(n-o);k[9]=(n+o)/(n-o);k[13]=0;k[2]=0;k[6]=0;k[10]=-(l+m)/(l-m);k[14]=-2*l*m/(l-m);k[3]=0;k[7]=0;k[11]=-1;k[15]=0;return this},makePerspective:function(g,f,k,i){g=k*Math.tan(THREE.Math.degToRad(0.5*g));var h=-g;return this.makeFrustum(h*f,g*f,h,g,k,i)},makeOrthographic:function(u,t,s,r,q,p){var o=this.elements,n=t-u,m=s-r,i=p-q;o[0]=2/n;o[4]=0;o[8]=0;o[12]=-((t+u)/n);o[1]=0;o[5]=2/m;o[9]=0;o[13]=-((s+r)/m);o[2]=0;o[6]=0;o[10]=-2/i;o[14]=-((p+q)/i);o[3]=0;o[7]=0;o[11]=0;o[15]=1;return this},fromArray:function(b){this.elements.set(b);return this},toArray:function(){var b=this.elements;return[b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12],b[13],b[14],b[15]]},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)}};THREE.Ray=function(d,c){this.origin=void 0!==d?d:new THREE.Vector3;this.direction=void 0!==c?c:new THREE.Vector3};THREE.Ray.prototype={constructor:THREE.Ray,set:function(d,c){this.origin.copy(d);this.direction.copy(c);return this},copy:function(b){this.origin.copy(b.origin);this.direction.copy(b.direction);return this},at:function(d,c){return(c||new THREE.Vector3).copy(this.direction).multiplyScalar(d).add(this.origin)},recast:function(){var b=new THREE.Vector3;return function(a){this.origin.copy(this.at(a,b));return this}}(),closestPointToPoint:function(f,e){var h=e||new THREE.Vector3;h.subVectors(f,this.origin);var g=h.dot(this.direction);return 0>g?h.copy(this.origin):h.copy(this.direction).multiplyScalar(g).add(this.origin)},distanceToPoint:function(){var b=new THREE.Vector3;return function(a){var d=b.subVectors(a,this.origin).dot(this.direction);if(0>d){return this.origin.distanceTo(a)}b.copy(this.direction).multiplyScalar(d).add(this.origin);return b.distanceTo(a)}}(),distanceSqToSegment:function(){var e=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Vector3;return function(v,u,s,r){e.copy(v).add(u).multiplyScalar(0.5);d.copy(u).sub(v).normalize();f.copy(this.origin).sub(e);var o=0.5*v.distanceTo(u),m=-this.direction.dot(d),i=f.dot(this.direction),b=-f.dot(d),a=f.lengthSq(),c=Math.abs(1-m*m),A;0<c?(v=m*b-i,u=m*i-b,A=o*c,0<=v?u>=-A?u<=A?(o=1/c,v*=o,u*=o,m=v*(v+m*u+2*i)+u*(m*v+u+2*b)+a):(u=o,v=Math.max(0,-(m*u+i)),m=-v*v+u*(u+2*b)+a):(u=-o,v=Math.max(0,-(m*u+i)),m=-v*v+u*(u+2*b)+a):u<=-A?(v=Math.max(0,-(-m*o+i)),u=0<v?-o:Math.min(Math.max(-o,-b),o),m=-v*v+u*(u+2*b)+a):u<=A?(v=0,u=Math.min(Math.max(-o,-b),o),m=u*(u+2*b)+a):(v=Math.max(0,-(m*o+i)),u=0<v?o:Math.min(Math.max(-o,-b),o),m=-v*v+u*(u+2*b)+a)):(u=0<m?-o:o,v=Math.max(0,-(m*u+i)),m=-v*v+u*(u+2*b)+a);s&&s.copy(this.direction).multiplyScalar(v).add(this.origin);r&&r.copy(d).multiplyScalar(u).add(e);return m}}(),isIntersectionSphere:function(b){return this.distanceToPoint(b.center)<=b.radius},intersectSphere:function(){var b=new THREE.Vector3;return function(a,k){b.subVectors(a.center,this.origin);var i=b.dot(this.direction),h=b.dot(b)-i*i,g=a.radius*a.radius;if(h>g){return null}g=Math.sqrt(g-h);h=i-g;i+=g;return 0>h&&0>i?null:0>h?this.at(i,k):this.at(h,k)}}(),isIntersectionPlane:function(d){var c=d.distanceToPoint(this.origin);return 0===c||0>d.normal.dot(this.direction)*c?!0:!1},distanceToPlane:function(d){var c=d.normal.dot(this.direction);if(0==c){return 0==d.distanceToPoint(this.origin)?0:null}d=-(this.origin.dot(d.normal)+d.constant)/c;return 0<=d?d:null},intersectPlane:function(e,d){var f=this.distanceToPlane(e);return null===f?null:this.at(f,d)},isIntersectionBox:function(){var b=new THREE.Vector3;return function(a){return null!==this.intersectBox(a,b)}}(),intersectBox:function(k,i){var q,p,o,n,m;p=1/this.direction.x;n=1/this.direction.y;m=1/this.direction.z;var l=this.origin;0<=p?(q=(k.min.x-l.x)*p,p*=k.max.x-l.x):(q=(k.max.x-l.x)*p,p*=k.min.x-l.x);0<=n?(o=(k.min.y-l.y)*n,n*=k.max.y-l.y):(o=(k.max.y-l.y)*n,n*=k.min.y-l.y);if(q>n||o>p){return null}if(o>q||q!==q){q=o}if(n<p||p!==p){p=n}0<=m?(o=(k.min.z-l.z)*m,m*=k.max.z-l.z):(o=(k.max.z-l.z)*m,m*=k.min.z-l.z);if(q>m||o>p){return null}if(o>q||q!==q){q=o}if(m<p||p!==p){p=m}return 0>p?null:this.at(0<=q?q:p,i)},intersectTriangle:function(){var f=new THREE.Vector3,e=new THREE.Vector3,h=new THREE.Vector3,g=new THREE.Vector3;return function(i,d,c,b,a){e.subVectors(d,i);h.subVectors(c,i);g.crossVectors(e,h);d=this.direction.dot(g);if(0<d){if(b){return null}b=1}else{if(0>d){b=-1,d=-d}else{return null}}f.subVectors(this.origin,i);i=b*this.direction.dot(h.crossVectors(f,h));if(0>i){return null}c=b*this.direction.dot(e.cross(f));if(0>c||i+c>d){return null}i=-b*f.dot(g);return 0>i?null:this.at(i/d,a)}}(),applyMatrix4:function(b){this.direction.add(this.origin).applyMatrix4(b);this.origin.applyMatrix4(b);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(b){return b.origin.equals(this.origin)&&b.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}};THREE.Sphere=function(d,c){this.center=void 0!==d?d:new THREE.Vector3;this.radius=void 0!==c?c:0};THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(d,c){this.center.copy(d);this.radius=c;return this},setFromPoints:function(){var b=new THREE.Box3;return function(a,m){var l=this.center;void 0!==m?l.copy(m):b.setFromPoints(a).center(l);for(var k=0,i=0,h=a.length;i<h;i++){k=Math.max(k,l.distanceToSquared(a[i]))}this.radius=Math.sqrt(k);return this}}(),copy:function(b){this.center.copy(b.center);this.radius=b.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(b){return b.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(b){return b.distanceTo(this.center)-this.radius},intersectsSphere:function(d){var c=this.radius+d.radius;return d.center.distanceToSquared(this.center)<=c*c},clampPoint:function(f,e){var h=this.center.distanceToSquared(f),g=e||new THREE.Vector3;g.copy(f);h>this.radius*this.radius&&(g.sub(this.center).normalize(),g.multiplyScalar(this.radius).add(this.center));return g},getBoundingBox:function(b){b=b||new THREE.Box3;b.set(this.center,this.center);b.expandByScalar(this.radius);return b},applyMatrix4:function(b){this.center.applyMatrix4(b);this.radius*=b.getMaxScaleOnAxis();return this},translate:function(b){this.center.add(b);return this},equals:function(b){return b.center.equals(this.center)&&b.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}};THREE.Frustum=function(h,g,m,l,k,i){this.planes=[void 0!==h?h:new THREE.Plane,void 0!==g?g:new THREE.Plane,void 0!==m?m:new THREE.Plane,void 0!==l?l:new THREE.Plane,void 0!==k?k:new THREE.Plane,void 0!==i?i:new THREE.Plane]};THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(i,h,o,n,m,l){var k=this.planes;k[0].copy(i);k[1].copy(h);k[2].copy(o);k[3].copy(n);k[4].copy(m);k[5].copy(l);return this},copy:function(e){for(var d=this.planes,f=0;6>f;f++){d[f].copy(e.planes[f])}return this},setFromMatrix:function(J){var I=this.planes,H=J.elements;J=H[0];var G=H[1],F=H[2],E=H[3],D=H[4],C=H[5],B=H[6],A=H[7],o=H[8],m=H[9],v=H[10],L=H[11],i=H[12],M=H[13],K=H[14],H=H[15];I[0].setComponents(E-J,A-D,L-o,H-i).normalize();I[1].setComponents(E+J,A+D,L+o,H+i).normalize();I[2].setComponents(E+G,A+C,L+m,H+M).normalize();I[3].setComponents(E-G,A-C,L-m,H-M).normalize();I[4].setComponents(E-F,A-B,L-v,H-K).normalize();I[5].setComponents(E+F,A+B,L+v,H+K).normalize();return this},intersectsObject:function(){var b=new THREE.Sphere;return function(a){var d=a.geometry;null===d.boundingSphere&&d.computeBoundingSphere();b.copy(d.boundingSphere);b.applyMatrix4(a.matrixWorld);return this.intersectsSphere(b)}}(),intersectsSphere:function(f){var e=this.planes,h=f.center;f=-f.radius;for(var g=0;6>g;g++){if(e[g].distanceToPoint(h)<f){return !1}}return !0},intersectsBox:function(){var d=new THREE.Vector3,c=new THREE.Vector3;return function(k){for(var i=this.planes,h=0;6>h;h++){var b=i[h];d.x=0<b.normal.x?k.min.x:k.max.x;c.x=0<b.normal.x?k.max.x:k.min.x;d.y=0<b.normal.y?k.min.y:k.max.y;c.y=0<b.normal.y?k.max.y:k.min.y;d.z=0<b.normal.z?k.min.z:k.max.z;c.z=0<b.normal.z?k.max.z:k.min.z;var a=b.distanceToPoint(d),b=b.distanceToPoint(c);if(0>a&&0>b){return !1}}return !0}}(),containsPoint:function(e){for(var d=this.planes,f=0;6>f;f++){if(0>d[f].distanceToPoint(e)){return !1}}return !0},clone:function(){return(new THREE.Frustum).copy(this)}};THREE.Plane=function(d,c){this.normal=void 0!==d?d:new THREE.Vector3(1,0,0);this.constant=void 0!==c?c:0};THREE.Plane.prototype={constructor:THREE.Plane,set:function(d,c){this.normal.copy(d);this.constant=c;return this},setComponents:function(f,e,h,g){this.normal.set(f,e,h);this.constant=g;return this},setFromNormalAndCoplanarPoint:function(d,c){this.normal.copy(d);this.constant=-c.dot(this.normal);return this},setFromCoplanarPoints:function(){var d=new THREE.Vector3,c=new THREE.Vector3;return function(f,b,a){b=d.subVectors(a,b).cross(c.subVectors(f,b)).normalize();this.setFromNormalAndCoplanarPoint(b,f);return this}}(),copy:function(b){this.normal.copy(b.normal);this.constant=b.constant;return this},normalize:function(){var b=1/this.normal.length();this.normal.multiplyScalar(b);this.constant*=b;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(b){return this.normal.dot(b)+this.constant},distanceToSphere:function(b){return this.distanceToPoint(b.center)-b.radius},projectPoint:function(d,c){return this.orthoPoint(d,c).sub(d).negate()},orthoPoint:function(e,d){var f=this.distanceToPoint(e);return(d||new THREE.Vector3).copy(this.normal).multiplyScalar(f)},isIntersectionLine:function(d){var c=this.distanceToPoint(d.start);d=this.distanceToPoint(d.end);return 0>c&&0<d||0>d&&0<c},intersectLine:function(){var b=new THREE.Vector3;return function(a,k){var i=k||new THREE.Vector3,h=a.delta(b),g=this.normal.dot(h);if(0==g){if(0==this.distanceToPoint(a.start)){return i.copy(a.start)}}else{return g=-(a.start.dot(this.normal)+this.constant)/g,0>g||1<g?void 0:i.copy(h).multiplyScalar(g).add(a.start)}}}(),coplanarPoint:function(b){return(b||new THREE.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Matrix3;return function(h,c){var b=c||f.getNormalMatrix(h),b=e.copy(this.normal).applyMatrix3(b),a=this.coplanarPoint(d);a.applyMatrix4(h);this.setFromNormalAndCoplanarPoint(b,a);return this}}(),translate:function(b){this.constant-=b.dot(this.normal);return this},equals:function(b){return b.normal.equals(this.normal)&&b.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}};THREE.Math={generateUUID:function(){var f="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=Array(36),h=0,g;return function(){for(var a=0;36>a;a++){8==a||13==a||18==a||23==a?e[a]="-":14==a?e[a]="4":(2>=h&&(h=33554432+16777216*Math.random()|0),g=h&15,h>>=4,e[a]=f[19==a?g&3|8:g])}return e.join("")}}(),clamp:function(e,d,f){return e<d?d:e>f?f:e},clampBottom:function(d,c){return d<c?c:d},mapLinear:function(g,f,k,i,h){return i+(g-f)*(h-i)/(k-f)},smoothstep:function(e,d,f){if(e<=d){return 0}if(e>=f){return 1}e=(e-d)/(f-d);return e*e*(3-2*e)},smootherstep:function(e,d,f){if(e<=d){return 0}if(e>=f){return 1}e=(e-d)/(f-d);return e*e*e*(e*(6*e-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(d,c){return Math.floor(this.randFloat(d,c))},randFloat:function(d,c){return d+Math.random()*(c-d)},randFloatSpread:function(b){return b*(0.5-Math.random())},degToRad:function(){var b=Math.PI/180;return function(a){return a*b}}(),radToDeg:function(){var b=180/Math.PI;return function(a){return a*b}}(),isPowerOfTwo:function(b){return 0===(b&b-1)&&0!==b},nextPowerOfTwo:function(b){b--;b|=b>>1;b|=b>>2;b|=b>>4;b|=b>>8;b|=b>>16;b++;return b}};THREE.Spline=function(E){function D(k,h,F,q,p,n,l){k=0.5*(F-k);q=0.5*(q-h);return(2*(h-F)+k+q)*l+(-3*(h-F)-2*k-q)*n+k*p+h}this.points=E;var C=[],B={x:0,y:0,z:0},A,v,u,t,s,r,m,i,o;this.initFromArray=function(d){this.points=[];for(var c=0;c<d.length;c++){this.points[c]={x:d[c][0],y:d[c][1],z:d[c][2]}}};this.getPoint=function(b){A=(this.points.length-1)*b;v=Math.floor(A);u=A-v;C[0]=0===v?v:v-1;C[1]=v;C[2]=v>this.points.length-2?this.points.length-1:v+1;C[3]=v>this.points.length-3?this.points.length-1:v+2;r=this.points[C[0]];m=this.points[C[1]];i=this.points[C[2]];o=this.points[C[3]];t=u*u;s=u*t;B.x=D(r.x,m.x,i.x,o.x,u,t,s);B.y=D(r.y,m.y,i.y,o.y,u,t,s);B.z=D(r.z,m.z,i.z,o.z,u,t,s);return B};this.getControlPointsArray=function(){var f,e,h=this.points.length,g=[];for(f=0;f<h;f++){e=this.points[f],g[f]=[e.x,e.y,e.z]}return g};this.getLength=function(J){var I,H,G,F=I=I=0,q=new THREE.Vector3,p=new THREE.Vector3,n=[],l=0;n[0]=0;J||(J=100);H=this.points.length*J;q.copy(this.points[0]);for(J=1;J<H;J++){I=J/H,G=this.getPoint(I),p.copy(G),l+=p.distanceTo(q),q.copy(G),I*=this.points.length-1,I=Math.floor(I),I!=F&&(n[I]=l,F=I)}n[n.length]=l;return{chunks:n,total:l}};this.reparametrizeByArcLength=function(L){var K,J,I,H,G,F,q=[],p=new THREE.Vector3,l=this.getLength();q.push(p.copy(this.points[0]).clone());for(K=1;K<this.points.length;K++){J=l.chunks[K]-l.chunks[K-1];F=Math.ceil(L*J/l.total);H=(K-1)/(this.points.length-1);G=K/(this.points.length-1);for(J=1;J<F-1;J++){I=H+1/F*J*(G-H),I=this.getPoint(I),q.push(p.copy(I).clone())}q.push(p.copy(this.points[K]).clone())}this.points=q}};THREE.Triangle=function(e,d,f){this.a=void 0!==e?e:new THREE.Vector3;this.b=void 0!==d?d:new THREE.Vector3;this.c=void 0!==f?f:new THREE.Vector3};THREE.Triangle.normal=function(){var b=new THREE.Vector3;return function(a,h,g,f){f=f||new THREE.Vector3;f.subVectors(g,h);b.subVectors(a,h);f.cross(b);a=f.lengthSq();return 0<a?f.multiplyScalar(1/Math.sqrt(a)):f.set(0,0,0)}}();THREE.Triangle.barycoordFromPoint=function(){var e=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Vector3;return function(o,n,m,i,c){e.subVectors(i,n);d.subVectors(m,n);f.subVectors(o,n);o=e.dot(e);n=e.dot(d);m=e.dot(f);var b=d.dot(d);i=d.dot(f);var a=o*b-n*n;c=c||new THREE.Vector3;if(0==a){return c.set(-2,-1,-1)}a=1/a;b=(b*m-n*i)*a;o=(o*i-n*m)*a;return c.set(1-b-o,o,b)}}();THREE.Triangle.containsPoint=function(){var b=new THREE.Vector3;return function(a,h,g,f){a=THREE.Triangle.barycoordFromPoint(a,h,g,f,b);return 0<=a.x&&0<=a.y&&1>=a.x+a.y}}();THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(e,d,f){this.a.copy(e);this.b.copy(d);this.c.copy(f);return this},setFromPointsAndIndices:function(f,e,h,g){this.a.copy(f[e]);this.b.copy(f[h]);this.c.copy(f[g]);return this},copy:function(b){this.a.copy(b.a);this.b.copy(b.b);this.c.copy(b.c);return this},area:function(){var d=new THREE.Vector3,c=new THREE.Vector3;return function(){d.subVectors(this.c,this.b);c.subVectors(this.a,this.b);return 0.5*d.cross(c).length()}}(),midpoint:function(b){return(b||new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(b){return THREE.Triangle.normal(this.a,this.b,this.c,b)},plane:function(b){return(b||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(d,c){return THREE.Triangle.barycoordFromPoint(d,this.a,this.b,this.c,c)},containsPoint:function(b){return THREE.Triangle.containsPoint(b,this.a,this.b,this.c)},equals:function(b){return b.a.equals(this.a)&&b.b.equals(this.b)&&b.c.equals(this.c)},clone:function(){return(new THREE.Triangle).copy(this)}};THREE.Clock=function(b){this.autoStart=void 0!==b?b:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.oldTime=this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var d=0;this.autoStart&&!this.running&&this.start();if(this.running){var c=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),d=0.001*(c-this.oldTime);this.oldTime=c;this.elapsedTime+=d}return d}};THREE.EventDispatcher=function(){};THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(b){b.addEventListener=THREE.EventDispatcher.prototype.addEventListener;b.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener;b.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener;b.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,d){void 0===this._listeners&&(this._listeners={});var f=this._listeners;void 0===f[e]&&(f[e]=[]);-1===f[e].indexOf(d)&&f[e].push(d)},hasEventListener:function(e,d){if(void 0===this._listeners){return !1}var f=this._listeners;return void 0!==f[e]&&-1!==f[e].indexOf(d)?!0:!1},removeEventListener:function(f,e){if(void 0!==this._listeners){var h=this._listeners[f];if(void 0!==h){var g=h.indexOf(e);-1!==g&&h.splice(g,1)}}},dispatchEvent:function(g){if(void 0!==this._listeners){var f=this._listeners[g.type];if(void 0!==f){g.target=this;for(var k=[],i=f.length,h=0;h<i;h++){k[h]=f[h]}for(h=0;h<i;h++){k[h].call(this,g)}}}}};(function(e){e.Raycaster=function(a,k,i,h){this.ray=new e.Ray(a,k);this.near=i||0;this.far=h||Infinity;this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var d=function(g,c){return g.distance-c.distance},f=function(i,c,m,l){i.raycast(c,m);if(!0===l){i=i.children;l=0;for(var k=i.length;l<k;l++){f(i[l],c,m,!0)}}};e.Raycaster.prototype={constructor:e.Raycaster,precision:0.0001,linePrecision:1,set:function(g,c){this.ray.set(g,c)},setFromCamera:function(a,g){g instanceof e.PerspectiveCamera?(this.ray.origin.copy(g.position),this.ray.direction.set(a.x,a.y,0.5).unproject(g).sub(g.position).normalize()):g instanceof e.OrthographicCamera?(this.ray.origin.set(a.x,a.y,-1).unproject(g),this.ray.direction.set(0,0,-1).transformDirection(g.matrixWorld)):e.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(b,g){var c=[];f(b,this,c,g);c.sort(d);return c},intersectObjects:function(k,i){var c=[];if(!1===k instanceof Array){return e.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),c}for(var b=0,a=k.length;b<a;b++){f(k[b],this,c,i)}c.sort(d);return c}}})(THREE);THREE.Object3D=function(){Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Object3D";this.parent=void 0;this.children=[];this.up=THREE.Object3D.DefaultUp.clone();var f=new THREE.Vector3,e=new THREE.Euler,h=new THREE.Quaternion,g=new THREE.Vector3(1,1,1);e.onChange(function(){h.setFromEuler(e,!1)});h.onChange(function(){e.setFromQuaternion(h,void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:f},rotation:{enumerable:!0,value:e},quaternion:{enumerable:!0,value:h},scale:{enumerable:!0,value:g}});this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixAutoUpdate=!0;this.matrixWorldNeedsUpdate=!1;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData={}};THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0);THREE.Object3D.prototype={constructor:THREE.Object3D,get eulerOrder(){THREE.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");return this.rotation.order},set eulerOrder(b){THREE.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");this.rotation.order=b},get useQuaternion(){THREE.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(b){THREE.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(b){this.matrix.multiplyMatrices(b,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(d,c){this.quaternion.setFromAxisAngle(d,c)},setRotationFromEuler:function(b){this.quaternion.setFromEuler(b,!0)},setRotationFromMatrix:function(b){this.quaternion.setFromRotationMatrix(b)},setRotationFromQuaternion:function(b){this.quaternion.copy(b)},rotateOnAxis:function(){var b=new THREE.Quaternion;return function(a,d){b.setFromAxisAngle(a,d);this.quaternion.multiply(b);return this}}(),rotateX:function(){var b=new THREE.Vector3(1,0,0);return function(a){return this.rotateOnAxis(b,a)}}(),rotateY:function(){var b=new THREE.Vector3(0,1,0);return function(a){return this.rotateOnAxis(b,a)}}(),rotateZ:function(){var b=new THREE.Vector3(0,0,1);return function(a){return this.rotateOnAxis(b,a)}}(),translateOnAxis:function(){var b=new THREE.Vector3;return function(a,d){b.copy(a).applyQuaternion(this.quaternion);this.position.add(b.multiplyScalar(d));return this}}(),translate:function(d,c){THREE.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(c,d)},translateX:function(){var b=new THREE.Vector3(1,0,0);return function(a){return this.translateOnAxis(b,a)}}(),translateY:function(){var b=new THREE.Vector3(0,1,0);return function(a){return this.translateOnAxis(b,a)}}(),translateZ:function(){var b=new THREE.Vector3(0,0,1);return function(a){return this.translateOnAxis(b,a)}}(),localToWorld:function(b){return b.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var b=new THREE.Matrix4;return function(a){return a.applyMatrix4(b.getInverse(this.matrixWorld))}}(),lookAt:function(){var b=new THREE.Matrix4;return function(a){b.lookAt(a,this.position,this.up);this.quaternion.setFromRotationMatrix(b)}}(),add:function(d){if(1<arguments.length){for(var c=0;c<arguments.length;c++){this.add(arguments[c])}return this}if(d===this){return THREE.error("THREE.Object3D.add: object can't be added as a child of itself.",d),this}d instanceof THREE.Object3D?(void 0!==d.parent&&d.parent.remove(d),d.parent=this,d.dispatchEvent({type:"added"}),this.children.push(d)):THREE.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",d);return this},remove:function(d){if(1<arguments.length){for(var c=0;c<arguments.length;c++){this.remove(arguments[c])}}c=this.children.indexOf(d);-1!==c&&(d.parent=void 0,d.dispatchEvent({type:"removed"}),this.children.splice(c,1))},getChildByName:function(b){THREE.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(b)},getObjectById:function(b){return this.getObjectByProperty("id",b)},getObjectByName:function(b){return this.getObjectByProperty("name",b)},getObjectByProperty:function(g,f){if(this[g]===f){return this}for(var k=0,i=this.children.length;k<i;k++){var h=this.children[k].getObjectByProperty(g,f);if(void 0!==h){return h}}},getWorldPosition:function(b){b=b||new THREE.Vector3;this.updateMatrixWorld(!0);return b.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var d=new THREE.Vector3,c=new THREE.Vector3;return function(a){a=a||new THREE.Quaternion;this.updateMatrixWorld(!0);this.matrixWorld.decompose(d,a,c);return a}}(),getWorldRotation:function(){var b=new THREE.Quaternion;return function(a){a=a||new THREE.Euler;this.getWorldQuaternion(b);return a.setFromQuaternion(b,this.rotation.order,!1)}}(),getWorldScale:function(){var d=new THREE.Vector3,c=new THREE.Quaternion;return function(a){a=a||new THREE.Vector3;this.updateMatrixWorld(!0);this.matrixWorld.decompose(d,c,a);return a}}(),getWorldDirection:function(){var b=new THREE.Quaternion;return function(a){a=a||new THREE.Vector3;this.getWorldQuaternion(b);return a.set(0,0,1).applyQuaternion(b)}}(),raycast:function(){},traverse:function(e){e(this);for(var d=0,f=this.children.length;d<f;d++){this.children[d].traverse(e)}},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var d=0,f=this.children.length;d<f;d++){this.children[d].traverseVisible(e)}}},traverseAncestors:function(b){this.parent&&(b(this.parent),this.parent.traverseAncestors(b))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===e){void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0}for(var d=0,f=this.children.length;d<f;d++){this.children[d].updateMatrixWorld(e)}},toJSON:function(){var g={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}},f={},k={},i=function(a){void 0===g.materials&&(g.materials=[]);if(void 0===k[a.uuid]){var c=a.toJSON();delete c.metadata;k[a.uuid]=c;g.materials.push(c)}return a.uuid},h=function(e){var d={};d.uuid=e.uuid;d.type=e.type;""!==e.name&&(d.name=e.name);"{}"!==JSON.stringify(e.userData)&&(d.userData=e.userData);!0!==e.visible&&(d.visible=e.visible);if(e instanceof THREE.PerspectiveCamera){d.fov=e.fov,d.aspect=e.aspect,d.near=e.near,d.far=e.far}else{if(e instanceof THREE.OrthographicCamera){d.left=e.left,d.right=e.right,d.top=e.top,d.bottom=e.bottom,d.near=e.near,d.far=e.far}else{if(e instanceof THREE.AmbientLight){d.color=e.color.getHex()}else{if(e instanceof THREE.DirectionalLight){d.color=e.color.getHex(),d.intensity=e.intensity}else{if(e instanceof THREE.PointLight){d.color=e.color.getHex(),d.intensity=e.intensity,d.distance=e.distance,d.decay=e.decay}else{if(e instanceof THREE.SpotLight){d.color=e.color.getHex(),d.intensity=e.intensity,d.distance=e.distance,d.angle=e.angle,d.exponent=e.exponent,d.decay=e.decay}else{if(e instanceof THREE.HemisphereLight){d.color=e.color.getHex(),d.groundColor=e.groundColor.getHex()}else{if(e instanceof THREE.Mesh||e instanceof THREE.Line||e instanceof THREE.PointCloud){var b=e.geometry;void 0===g.geometries&&(g.geometries=[]);if(void 0===f[b.uuid]){var a=b.toJSON();delete a.metadata;f[b.uuid]=a;g.geometries.push(a)}d.geometry=b.uuid;d.material=i(e.material);e instanceof THREE.Line&&(d.mode=e.mode)}else{e instanceof THREE.Sprite&&(d.material=i(e.material))}}}}}}}}d.matrix=e.matrix.toArray();if(0<e.children.length){for(d.children=[],b=0;b<e.children.length;b++){d.children.push(h(e.children[b]))}}return d};g.object=h(this);return g},clone:function(e,d){void 0===e&&(e=new THREE.Object3D);void 0===d&&(d=!0);e.name=this.name;e.up.copy(this.up);e.position.copy(this.position);e.quaternion.copy(this.quaternion);e.scale.copy(this.scale);e.rotationAutoUpdate=this.rotationAutoUpdate;e.matrix.copy(this.matrix);e.matrixWorld.copy(this.matrixWorld);e.matrixAutoUpdate=this.matrixAutoUpdate;e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;e.visible=this.visible;e.castShadow=this.castShadow;e.receiveShadow=this.receiveShadow;e.frustumCulled=this.frustumCulled;e.userData=JSON.parse(JSON.stringify(this.userData));if(!0===d){for(var f=0;f<this.children.length;f++){e.add(this.children[f].clone())}}return e}};THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);THREE.Object3DIdCount=0;THREE.Face3=function(h,g,m,l,k,i){this.a=h;this.b=g;this.c=m;this.normal=l instanceof THREE.Vector3?l:new THREE.Vector3;this.vertexNormals=l instanceof Array?l:[];this.color=k instanceof THREE.Color?k:new THREE.Color;this.vertexColors=k instanceof Array?k:[];this.vertexTangents=[];this.materialIndex=void 0!==i?i:0};THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var e=new THREE.Face3(this.a,this.b,this.c);e.normal.copy(this.normal);e.color.copy(this.color);e.materialIndex=this.materialIndex;for(var d=0,f=this.vertexNormals.length;d<f;d++){e.vertexNormals[d]=this.vertexNormals[d].clone()}d=0;for(f=this.vertexColors.length;d<f;d++){e.vertexColors[d]=this.vertexColors[d].clone()}d=0;for(f=this.vertexTangents.length;d<f;d++){e.vertexTangents[d]=this.vertexTangents[d].clone()}return e}};THREE.Face4=function(i,h,o,n,m,l,k){THREE.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new THREE.Face3(i,h,o,m,l,k)};THREE.BufferAttribute=function(d,c){this.array=d;this.itemSize=c;this.needsUpdate=!1};THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get length(){return this.array.length},copyAt:function(g,f,k){g*=this.itemSize;k*=f.itemSize;for(var i=0,h=this.itemSize;i<h;i++){this.array[g+i]=f.array[k+i]}return this},set:function(d,c){void 0===c&&(c=0);this.array.set(d,c);return this},setX:function(d,c){this.array[d*this.itemSize]=c;return this},setY:function(d,c){this.array[d*this.itemSize+1]=c;return this},setZ:function(d,c){this.array[d*this.itemSize+2]=c;return this},setXY:function(e,d,f){e*=this.itemSize;this.array[e]=d;this.array[e+1]=f;return this},setXYZ:function(f,e,h,g){f*=this.itemSize;this.array[f]=e;this.array[f+1]=h;this.array[f+2]=g;return this},setXYZW:function(g,f,k,i,h){g*=this.itemSize;this.array[g]=f;this.array[g+1]=k;this.array[g+2]=i;this.array[g+3]=h;return this},clone:function(){return new THREE.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}};THREE.Int8Attribute=function(d,c){THREE.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(d,c)};THREE.Uint8Attribute=function(d,c){THREE.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(d,c)};THREE.Uint8ClampedAttribute=function(d,c){THREE.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(d,c)};THREE.Int16Attribute=function(d,c){THREE.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(d,c)};THREE.Uint16Attribute=function(d,c){THREE.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(d,c)};THREE.Int32Attribute=function(d,c){THREE.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(d,c)};THREE.Uint32Attribute=function(d,c){THREE.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(d,c)};THREE.Float32Attribute=function(d,c){THREE.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(d,c)};THREE.Float64Attribute=function(d,c){THREE.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(d,c)};THREE.DynamicBufferAttribute=function(d,c){THREE.BufferAttribute.call(this,d,c);this.updateRange={offset:0,count:-1}};THREE.DynamicBufferAttribute.prototype=Object.create(THREE.BufferAttribute.prototype);THREE.DynamicBufferAttribute.prototype.constructor=THREE.DynamicBufferAttribute;THREE.DynamicBufferAttribute.prototype.clone=function(){return new THREE.DynamicBufferAttribute(new this.array.constructor(this.array),this.itemSize)};THREE.BufferGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="BufferGeometry";this.attributes={};this.attributesKeys=[];this.offsets=this.drawcalls=[];this.boundingSphere=this.boundingBox=null};THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(e,d,f){!1===d instanceof THREE.BufferAttribute?(THREE.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.attributes[e]={array:d,itemSize:f}):(this.attributes[e]=d,this.attributesKeys=Object.keys(this.attributes))},getAttribute:function(b){return this.attributes[b]},addDrawCall:function(e,d,f){this.drawcalls.push({start:e,count:d,index:void 0!==f?f:0})},applyMatrix:function(d){var c=this.attributes.position;void 0!==c&&(d.applyToVector3Array(c.array),c.needsUpdate=!0);c=this.attributes.normal;void 0!==c&&((new THREE.Matrix3).getNormalMatrix(d).applyToVector3Array(c.array),c.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere()},center:function(){this.computeBoundingBox();var b=this.boundingBox.center().negate();this.applyMatrix((new THREE.Matrix4).setPosition(b));return b},fromGeometry:function(P,O){O=O||{vertexColors:THREE.NoColors};var N=P.vertices,M=P.faces,L=P.faceVertexUvs,K=O.vertexColors,J=0<L[0].length,I=3==M[0].vertexNormals.length,H=new Float32Array(9*M.length);this.addAttribute("position",new THREE.BufferAttribute(H,3));var G=new Float32Array(9*M.length);this.addAttribute("normal",new THREE.BufferAttribute(G,3));if(K!==THREE.NoColors){var E=new Float32Array(9*M.length);this.addAttribute("color",new THREE.BufferAttribute(E,3))}if(!0===J){var D=new Float32Array(6*M.length);this.addAttribute("uv",new THREE.BufferAttribute(D,2))}for(var F=0,A=0,C=0;F<M.length;F++,A+=6,C+=9){var B=M[F],o=N[B.a],m=N[B.b],i=N[B.c];H[C]=o.x;H[C+1]=o.y;H[C+2]=o.z;H[C+3]=m.x;H[C+4]=m.y;H[C+5]=m.z;H[C+6]=i.x;H[C+7]=i.y;H[C+8]=i.z;!0===I?(o=B.vertexNormals[0],m=B.vertexNormals[1],i=B.vertexNormals[2],G[C]=o.x,G[C+1]=o.y,G[C+2]=o.z,G[C+3]=m.x,G[C+4]=m.y,G[C+5]=m.z,G[C+6]=i.x,G[C+7]=i.y,G[C+8]=i.z):(o=B.normal,G[C]=o.x,G[C+1]=o.y,G[C+2]=o.z,G[C+3]=o.x,G[C+4]=o.y,G[C+5]=o.z,G[C+6]=o.x,G[C+7]=o.y,G[C+8]=o.z);K===THREE.FaceColors?(B=B.color,E[C]=B.r,E[C+1]=B.g,E[C+2]=B.b,E[C+3]=B.r,E[C+4]=B.g,E[C+5]=B.b,E[C+6]=B.r,E[C+7]=B.g,E[C+8]=B.b):K===THREE.VertexColors&&(o=B.vertexColors[0],m=B.vertexColors[1],B=B.vertexColors[2],E[C]=o.r,E[C+1]=o.g,E[C+2]=o.b,E[C+3]=m.r,E[C+4]=m.g,E[C+5]=m.b,E[C+6]=B.r,E[C+7]=B.g,E[C+8]=B.b);!0===J&&(B=L[0][F][0],o=L[0][F][1],m=L[0][F][2],D[A]=B.x,D[A+1]=B.y,D[A+2]=o.x,D[A+3]=o.y,D[A+4]=m.x,D[A+5]=m.y)}this.computeBoundingSphere();return this},computeBoundingBox:function(){var b=new THREE.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var a=this.attributes.position.array;if(a){var h=this.boundingBox;h.makeEmpty();for(var g=0,f=a.length;g<f;g+=3){b.set(a[g],a[g+1],a[g+2]),h.expandByPoint(b)}}if(void 0===a||0===a.length){this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)}(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&THREE.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}(),computeBoundingSphere:function(){var d=new THREE.Box3,c=new THREE.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var k=this.attributes.position.array;if(k){d.makeEmpty();for(var i=this.boundingSphere.center,h=0,b=k.length;h<b;h+=3){c.set(k[h],k[h+1],k[h+2]),d.expandByPoint(c)}d.center(i);for(var a=0,h=0,b=k.length;h<b;h+=3){c.set(k[h],k[h+1],k[h+2]),a=Math.max(a,i.distanceToSquared(c))}this.boundingSphere.radius=Math.sqrt(a);isNaN(this.boundingSphere.radius)&&THREE.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var O=this.attributes;if(O.position){var N=O.position.array;if(void 0===O.normal){this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(N.length),3))}else{for(var M=O.normal.array,L=0,K=M.length;L<K;L++){M[L]=0}}var M=O.normal.array,J,I,H,G=new THREE.Vector3,F=new THREE.Vector3,D=new THREE.Vector3,C=new THREE.Vector3,E=new THREE.Vector3;if(O.index){for(var o=O.index.array,B=0<this.offsets.length?this.offsets:[{start:0,count:o.length,index:0}],A=0,m=B.length;A<m;++A){K=B[A].start;J=B[A].count;for(var i=B[A].index,L=K,K=K+J;L<K;L+=3){J=3*(i+o[L]),I=3*(i+o[L+1]),H=3*(i+o[L+2]),G.fromArray(N,J),F.fromArray(N,I),D.fromArray(N,H),C.subVectors(D,F),E.subVectors(G,F),C.cross(E),M[J]+=C.x,M[J+1]+=C.y,M[J+2]+=C.z,M[I]+=C.x,M[I+1]+=C.y,M[I+2]+=C.z,M[H]+=C.x,M[H+1]+=C.y,M[H+2]+=C.z}}}else{for(L=0,K=N.length;L<K;L+=9){G.fromArray(N,L),F.fromArray(N,L+3),D.fromArray(N,L+6),C.subVectors(D,F),E.subVectors(G,F),C.cross(E),M[L]=C.x,M[L+1]=C.y,M[L+2]=C.z,M[L+3]=C.x,M[L+4]=C.y,M[L+5]=C.z,M[L+6]=C.x,M[L+7]=C.y,M[L+8]=C.z}}this.normalizeNormals();O.normal.needsUpdate=!0}},computeTangents:function(){function aE(e,d,f){ar.fromArray(aB,3*e);au.fromArray(aB,3*d);ao.fromArray(aB,3*f);aq.fromArray(az,2*e);ap.fromArray(az,2*d);an.fromArray(az,2*f);am=au.x-ar.x;aj=ao.x-ar.x;ad=au.y-ar.y;ak=ao.y-ar.y;ai=au.z-ar.z;ae=ao.z-ar.z;ac=ap.x-aq.x;aa=an.x-aq.x;ab=ap.y-aq.y;ah=an.y-aq.y;Y=1/(ac*ah-aa*ab);B.set((ah*am-ab*aj)*Y,(ah*ad-ab*ak)*Y,(ah*ai-ab*ae)*Y);T.set((ac*aj-aa*am)*Y,(ac*ak-aa*ad)*Y,(ac*ae-aa*ai)*Y);aw[e].add(B);aw[d].add(B);aw[f].add(B);av[e].add(T);av[d].add(T);av[f].add(T)}function aD(b){i.fromArray(aA,3*b);Q.copy(i);aF=aw[b];al.copy(aF);al.sub(i.multiplyScalar(i.dot(aF))).normalize();af.crossVectors(Q,aF);o=af.dot(av[b]);ag=0>o?-1:1;ax[4*b]=al.x;ax[4*b+1]=al.y;ax[4*b+2]=al.z;ax[4*b+3]=ag}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv){THREE.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()")}else{var aC=this.attributes.index.array,aB=this.attributes.position.array,aA=this.attributes.normal.array,az=this.attributes.uv.array,ay=aB.length/3;void 0===this.attributes.tangent&&this.addAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*ay),4));for(var ax=this.attributes.tangent.array,aw=[],av=[],at=0;at<ay;at++){aw[at]=new THREE.Vector3,av[at]=new THREE.Vector3}var ar=new THREE.Vector3,au=new THREE.Vector3,ao=new THREE.Vector3,aq=new THREE.Vector2,ap=new THREE.Vector2,an=new THREE.Vector2,am,aj,ad,ak,ai,ae,ac,aa,ab,ah,Y,B=new THREE.Vector3,T=new THREE.Vector3,Z,W,K,S,C;0===this.drawcalls.length&&this.addDrawCall(0,aC.length,0);var m=this.drawcalls,at=0;for(W=m.length;at<W;++at){Z=m[at].start;K=m[at].count;var X=m[at].index,ay=Z;for(Z+=K;ay<Z;ay+=3){K=X+aC[ay],S=X+aC[ay+1],C=X+aC[ay+2],aE(K,S,C)}}var al=new THREE.Vector3,af=new THREE.Vector3,i=new THREE.Vector3,Q=new THREE.Vector3,ag,aF,o,at=0;for(W=m.length;at<W;++at){for(Z=m[at].start,K=m[at].count,X=m[at].index,ay=Z,Z+=K;ay<Z;ay+=3){K=X+aC[ay],S=X+aC[ay+1],C=X+aC[ay+2],aD(K),aD(S),aD(C)}}}},computeOffsets:function(I){void 0===I&&(I=65535);for(var H=this.attributes.index.array,G=this.attributes.position.array,F=H.length/3,E=new Uint16Array(H.length),D=0,C=0,B=[{start:0,count:0,index:0}],A=B[0],v=0,o=0,m=new Int32Array(6),u=new Int32Array(G.length),J=new Int32Array(G.length),i=0;i<G.length;i++){u[i]=-1,J[i]=-1}for(G=0;G<F;G++){for(var K=o=0;3>K;K++){i=H[3*G+K],-1==u[i]?(m[2*K]=i,m[2*K+1]=-1,o++):u[i]<A.index?(m[2*K]=i,m[2*K+1]=-1,v++):(m[2*K]=i,m[2*K+1]=u[i])}if(C+o>A.index+I){for(A={start:D,count:0,index:C},B.push(A),o=0;6>o;o+=2){K=m[o+1],-1<K&&K<A.index&&(m[o+1]=-1)}}for(o=0;6>o;o+=2){i=m[o],K=m[o+1],-1===K&&(K=C++),u[i]=K,J[K]=i,E[D++]=K-A.index,A.count++}}this.reorderBuffers(E,J,C);return this.drawcalls=this.offsets=B},merge:function(k,i){if(!1===k instanceof THREE.BufferGeometry){THREE.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",k)}else{void 0===i&&(i=0);var q=this.attributes,p;for(p in q){if(void 0!==k.attributes[p]){for(var o=q[p].array,n=k.attributes[p],m=n.array,l=0,n=n.itemSize*i;l<m.length;l++,n++){o[n]=m[l]}}}return this}},normalizeNormals:function(){for(var h=this.attributes.normal.array,g,m,l,k=0,i=h.length;k<i;k+=3){g=h[k],m=h[k+1],l=h[k+2],g=1/Math.sqrt(g*g+m*m+l*l),h[k]*=g,h[k+1]*=g,h[k+2]*=g}},reorderBuffers:function(A,v,u){var t={},s;for(s in this.attributes){"index"!=s&&(t[s]=new this.attributes[s].array.constructor(this.attributes[s].itemSize*u))}for(var r=0;r<u;r++){var q=v[r];for(s in this.attributes){if("index"!=s){for(var o=this.attributes[s].array,n=this.attributes[s].itemSize,m=t[s],i=0;i<n;i++){m[r*n+i]=o[q*n+i]}}}}this.attributes.index.array=A;for(s in this.attributes){"index"!=s&&(this.attributes[s].array=t[s],this.attributes[s].numItems=this.attributes[s].itemSize*u)}},toJSON:function(){var i={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}},h=this.attributes,o=this.offsets,n=this.boundingSphere,m;for(m in h){var l=h[m],k=Array.prototype.slice.call(l.array);i.data.attributes[m]={itemSize:l.itemSize,type:l.array.constructor.name,array:k}}0<o.length&&(i.data.offsets=JSON.parse(JSON.stringify(o)));null!==n&&(i.data.boundingSphere={center:n.center.toArray(),radius:n.radius});return i},clone:function(){var f=new THREE.BufferGeometry,e;for(e in this.attributes){f.addAttribute(e,this.attributes[e].clone())}e=0;for(var h=this.offsets.length;e<h;e++){var g=this.offsets[e];f.offsets.push({start:g.start,index:g.index,count:g.count})}return f},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);THREE.Geometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.hasTangents=!1;this.dynamic=!0;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.tangentsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.elementsNeedUpdate=this.verticesNeedUpdate=!1};THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(h){for(var g=(new THREE.Matrix3).getNormalMatrix(h),m=0,l=this.vertices.length;m<l;m++){this.vertices[m].applyMatrix4(h)}m=0;for(l=this.faces.length;m<l;m++){h=this.faces[m];h.normal.applyMatrix3(g).normalize();for(var k=0,i=h.vertexNormals.length;k<i;k++){h.vertexNormals[k].applyMatrix3(g).normalize()}}null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();this.normalsNeedUpdate=this.verticesNeedUpdate=!0},fromBufferGeometry:function(H){for(var G=this,F=H.attributes,E=F.position.array,D=void 0!==F.index?F.index.array:void 0,C=void 0!==F.normal?F.normal.array:void 0,B=void 0!==F.color?F.color.array:void 0,A=void 0!==F.uv?F.uv.array:void 0,v=[],u=[],o=F=0;F<E.length;F+=3,o+=2){G.vertices.push(new THREE.Vector3(E[F],E[F+1],E[F+2])),void 0!==C&&v.push(new THREE.Vector3(C[F],C[F+1],C[F+2])),void 0!==B&&G.colors.push(new THREE.Color(B[F],B[F+1],B[F+2])),void 0!==A&&u.push(new THREE.Vector2(A[o],A[o+1]))}var m=function(b,k,g){var f=void 0!==C?[v[b].clone(),v[k].clone(),v[g].clone()]:[],h=void 0!==B?[G.colors[b].clone(),G.colors[k].clone(),G.colors[g].clone()]:[];G.faces.push(new THREE.Face3(b,k,g,f,h));void 0!==A&&G.faceVertexUvs[0].push([u[b].clone(),u[k].clone(),u[g].clone()])};if(void 0!==D){if(E=H.drawcalls,0<E.length){for(F=0;F<E.length;F++){for(var o=E[F],s=o.start,I=o.count,i=o.index,o=s,s=s+I;o<s;o+=3){m(i+D[o],i+D[o+1],i+D[o+2])}}}else{for(F=0;F<D.length;F+=3){m(D[F],D[F+1],D[F+2])}}}else{for(F=0;F<E.length/3;F+=3){m(F,F+1,F+2)}}this.computeFaceNormals();null!==H.boundingBox&&(this.boundingBox=H.boundingBox.clone());null!==H.boundingSphere&&(this.boundingSphere=H.boundingSphere.clone());return this},center:function(){this.computeBoundingBox();var b=this.boundingBox.center().negate();this.applyMatrix((new THREE.Matrix4).setPosition(b));return b},computeFaceNormals:function(){for(var i=new THREE.Vector3,h=new THREE.Vector3,o=0,n=this.faces.length;o<n;o++){var m=this.faces[o],l=this.vertices[m.a],k=this.vertices[m.b];i.subVectors(this.vertices[m.c],k);h.subVectors(l,k);i.cross(h);i.normalize();m.normal.copy(i)}},computeVertexNormals:function(s){var r,q,p;p=Array(this.vertices.length);r=0;for(q=this.vertices.length;r<q;r++){p[r]=new THREE.Vector3}if(s){var o,n,m,l=new THREE.Vector3,i=new THREE.Vector3;s=0;for(r=this.faces.length;s<r;s++){q=this.faces[s],o=this.vertices[q.a],n=this.vertices[q.b],m=this.vertices[q.c],l.subVectors(m,n),i.subVectors(o,n),l.cross(i),p[q.a].add(l),p[q.b].add(l),p[q.c].add(l)}}else{for(s=0,r=this.faces.length;s<r;s++){q=this.faces[s],p[q.a].add(q.normal),p[q.b].add(q.normal),p[q.c].add(q.normal)}}r=0;for(q=this.vertices.length;r<q;r++){p[r].normalize()}s=0;for(r=this.faces.length;s<r;s++){q=this.faces[s],q.vertexNormals[0]=p[q.a].clone(),q.vertexNormals[1]=p[q.b].clone(),q.vertexNormals[2]=p[q.c].clone()}},computeMorphNormals:function(){var s,r,q,p,o;q=0;for(p=this.faces.length;q<p;q++){for(o=this.faces[q],o.__originalFaceNormal?o.__originalFaceNormal.copy(o.normal):o.__originalFaceNormal=o.normal.clone(),o.__originalVertexNormals||(o.__originalVertexNormals=[]),s=0,r=o.vertexNormals.length;s<r;s++){o.__originalVertexNormals[s]?o.__originalVertexNormals[s].copy(o.vertexNormals[s]):o.__originalVertexNormals[s]=o.vertexNormals[s].clone()}}var n=new THREE.Geometry;n.faces=this.faces;s=0;for(r=this.morphTargets.length;s<r;s++){if(!this.morphNormals[s]){this.morphNormals[s]={};this.morphNormals[s].faceNormals=[];this.morphNormals[s].vertexNormals=[];o=this.morphNormals[s].faceNormals;var m=this.morphNormals[s].vertexNormals,l,i;q=0;for(p=this.faces.length;q<p;q++){l=new THREE.Vector3,i={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3},o.push(l),m.push(i)}}m=this.morphNormals[s];n.vertices=this.morphTargets[s].vertices;n.computeFaceNormals();n.computeVertexNormals();q=0;for(p=this.faces.length;q<p;q++){o=this.faces[q],l=m.faceNormals[q],i=m.vertexNormals[q],l.copy(o.normal),i.a.copy(o.vertexNormals[0]),i.b.copy(o.vertexNormals[1]),i.c.copy(o.vertexNormals[2])}}q=0;for(p=this.faces.length;q<p;q++){o=this.faces[q],o.normal=o.__originalFaceNormal,o.vertexNormals=o.__originalVertexNormals}},computeTangents:function(){var V,U,T,S,R,Q,P,O,N,M,K,I,L,E,H,G,C,B=[],m=[];T=new THREE.Vector3;var F=new THREE.Vector3,o=new THREE.Vector3,i=new THREE.Vector3,J=new THREE.Vector3;V=0;for(U=this.vertices.length;V<U;V++){B[V]=new THREE.Vector3,m[V]=new THREE.Vector3}V=0;for(U=this.faces.length;V<U;V++){R=this.faces[V],Q=this.faceVertexUvs[0][V],S=R.a,C=R.b,R=R.c,P=this.vertices[S],O=this.vertices[C],N=this.vertices[R],M=Q[0],K=Q[1],I=Q[2],Q=O.x-P.x,L=N.x-P.x,E=O.y-P.y,H=N.y-P.y,O=O.z-P.z,P=N.z-P.z,N=K.x-M.x,G=I.x-M.x,K=K.y-M.y,M=I.y-M.y,I=1/(N*M-G*K),T.set((M*Q-K*L)*I,(M*E-K*H)*I,(M*O-K*P)*I),F.set((N*L-G*Q)*I,(N*H-G*E)*I,(N*P-G*O)*I),B[S].add(T),B[C].add(T),B[R].add(T),m[S].add(F),m[C].add(F),m[R].add(F)}F=["a","b","c","d"];V=0;for(U=this.faces.length;V<U;V++){for(R=this.faces[V],T=0;T<Math.min(R.vertexNormals.length,3);T++){J.copy(R.vertexNormals[T]),S=R[F[T]],C=B[S],o.copy(C),o.sub(J.multiplyScalar(J.dot(C))).normalize(),i.crossVectors(R.vertexNormals[T],C),S=i.dot(m[S]),S=0>S?-1:1,R.vertexTangents[T]=new THREE.Vector4(o.x,o.y,o.z,S)}}this.hasTangents=!0},computeLineDistances:function(){for(var f=0,e=this.vertices,h=0,g=e.length;h<g;h++){0<h&&(f+=e[h].distanceTo(e[h-1])),this.lineDistances[h]=f}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);this.boundingSphere.setFromPoints(this.vertices)},merge:function(I,H,G){if(!1===I instanceof THREE.Geometry){THREE.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",I)}else{var F,E=this.vertices.length,D=this.vertices,C=I.vertices,B=this.faces,A=I.faces,v=this.faceVertexUvs[0];I=I.faceVertexUvs[0];void 0===G&&(G=0);void 0!==H&&(F=(new THREE.Matrix3).getNormalMatrix(H));for(var o=0,m=C.length;o<m;o++){var u=C[o].clone();void 0!==H&&u.applyMatrix4(H);D.push(u)}o=0;for(m=A.length;o<m;o++){var C=A[o],J,i=C.vertexNormals,K=C.vertexColors,u=new THREE.Face3(C.a+E,C.b+E,C.c+E);u.normal.copy(C.normal);void 0!==F&&u.normal.applyMatrix3(F).normalize();H=0;for(D=i.length;H<D;H++){J=i[H].clone(),void 0!==F&&J.applyMatrix3(F).normalize(),u.vertexNormals.push(J)}u.color.copy(C.color);H=0;for(D=K.length;H<D;H++){J=K[H],u.vertexColors.push(J.clone())}u.materialIndex=C.materialIndex+G;B.push(u)}o=0;for(m=I.length;o<m;o++){if(G=I[o],F=[],void 0!==G){H=0;for(D=G.length;H<D;H++){F.push(G[H].clone())}v.push(F)}}}},mergeMesh:function(b){!1===b instanceof THREE.Mesh?THREE.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",b):(b.matrixAutoUpdate&&b.updateMatrix(),this.merge(b.geometry,b.matrix))},mergeVertices:function(){var i={},h=[],o=[],n,m=Math.pow(10,4),l,k;l=0;for(k=this.vertices.length;l<k;l++){n=this.vertices[l],n=Math.round(n.x*m)+"_"+Math.round(n.y*m)+"_"+Math.round(n.z*m),void 0===i[n]?(i[n]=l,h.push(this.vertices[l]),o[l]=h.length-1):o[l]=o[i[n]]}i=[];l=0;for(k=this.faces.length;l<k;l++){for(m=this.faces[l],m.a=o[m.a],m.b=o[m.b],m.c=o[m.c],m=[m.a,m.b,m.c],n=0;3>n;n++){if(m[n]==m[(n+1)%3]){i.push(l);break}}}for(l=i.length-1;0<=l;l--){for(m=i[l],this.faces.splice(m,1),o=0,k=this.faceVertexUvs.length;o<k;o++){this.faceVertexUvs[o].splice(m,1)}}l=this.vertices.length-h.length;this.vertices=h;return l},toJSON:function(){function S(e,d,f){return f?e|1<<d:e&~(1<<d)}function R(d){var c=d.x.toString()+d.y.toString()+d.z.toString();if(void 0!==J[c]){return J[c]}J[c]=K.length/3;K.push(d.x,d.y,d.z);return J[c]}function Q(d){var c=d.r.toString()+d.g.toString()+d.b.toString();if(void 0!==G[c]){return G[c]}G[c]=H.length;H.push(d.getHex());return G[c]}function P(d){var c=d.x.toString()+d.y.toString();if(void 0!==B[c]){return B[c]}B[c]=I.length/2;I.push(d.x,d.y);return B[c]}var O={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};""!==this.name&&(O.name=this.name);if(void 0!==this.parameters){var N=this.parameters,M;for(M in N){void 0!==N[M]&&(O[M]=N[M])}return O}N=[];for(M=0;M<this.vertices.length;M++){var L=this.vertices[M];N.push(L.x,L.y,L.z)}var L=[],K=[],J={},H=[],G={},I=[],B={};for(M=0;M<this.faces.length;M++){var F=this.faces[M],E=void 0!==this.faceVertexUvs[0][M],A=0<F.normal.length(),o=0<F.vertexNormals.length,i=1!==F.color.r||1!==F.color.g||1!==F.color.b,C=0<F.vertexColors.length,m=0,m=S(m,0,0),m=S(m,1,!1),m=S(m,2,!1),m=S(m,3,E),m=S(m,4,A),m=S(m,5,o),m=S(m,6,i),m=S(m,7,C);L.push(m);L.push(F.a,F.b,F.c);E&&(E=this.faceVertexUvs[0][M],L.push(P(E[0]),P(E[1]),P(E[2])));A&&L.push(R(F.normal));o&&(A=F.vertexNormals,L.push(R(A[0]),R(A[1]),R(A[2])));i&&L.push(Q(F.color));C&&(F=F.vertexColors,L.push(Q(F[0]),Q(F[1]),Q(F[2])))}O.data={};O.data.vertices=N;O.data.normals=K;0<H.length&&(O.data.colors=H);0<I.length&&(O.data.uvs=[I]);O.data.faces=L;return O},clone:function(){for(var u=new THREE.Geometry,t=this.vertices,s=0,r=t.length;s<r;s++){u.vertices.push(t[s].clone())}t=this.faces;s=0;for(r=t.length;s<r;s++){u.faces.push(t[s].clone())}s=0;for(r=this.faceVertexUvs.length;s<r;s++){t=this.faceVertexUvs[s];void 0===u.faceVertexUvs[s]&&(u.faceVertexUvs[s]=[]);for(var q=0,p=t.length;q<p;q++){for(var o=t[q],n=[],m=0,i=o.length;m<i;m++){n.push(o[m].clone())}u.faceVertexUvs[s].push(n)}}return u},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype);THREE.GeometryIdCount=0;THREE.Camera=function(){THREE.Object3D.call(this);this.type="Camera";this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.getWorldDirection=function(){var b=new THREE.Quaternion;return function(a){a=a||new THREE.Vector3;this.getWorldQuaternion(b);return a.set(0,0,-1).applyQuaternion(b)}}();THREE.Camera.prototype.lookAt=function(){var b=new THREE.Matrix4;return function(a){b.lookAt(this.position,a,this.up);this.quaternion.setFromRotationMatrix(b)}}();THREE.Camera.prototype.clone=function(b){void 0===b&&(b=new THREE.Camera);THREE.Object3D.prototype.clone.call(this,b);b.matrixWorldInverse.copy(this.matrixWorldInverse);b.projectionMatrix.copy(this.projectionMatrix);return b};THREE.CubeCamera=function(s,r,q){THREE.Object3D.call(this);this.type="CubeCamera";var p=new THREE.PerspectiveCamera(90,1,s,r);p.up.set(0,-1,0);p.lookAt(new THREE.Vector3(1,0,0));this.add(p);var o=new THREE.PerspectiveCamera(90,1,s,r);o.up.set(0,-1,0);o.lookAt(new THREE.Vector3(-1,0,0));this.add(o);var n=new THREE.PerspectiveCamera(90,1,s,r);n.up.set(0,0,1);n.lookAt(new THREE.Vector3(0,1,0));this.add(n);var m=new THREE.PerspectiveCamera(90,1,s,r);m.up.set(0,0,-1);m.lookAt(new THREE.Vector3(0,-1,0));this.add(m);var l=new THREE.PerspectiveCamera(90,1,s,r);l.up.set(0,-1,0);l.lookAt(new THREE.Vector3(0,0,1));this.add(l);var i=new THREE.PerspectiveCamera(90,1,s,r);i.up.set(0,-1,0);i.lookAt(new THREE.Vector3(0,0,-1));this.add(i);this.renderTarget=new THREE.WebGLRenderTargetCube(q,q,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(e,d){var g=this.renderTarget,f=g.generateMipmaps;g.generateMipmaps=!1;g.activeCubeFace=0;e.render(d,p,g);g.activeCubeFace=1;e.render(d,o,g);g.activeCubeFace=2;e.render(d,n,g);g.activeCubeFace=3;e.render(d,m,g);g.activeCubeFace=4;e.render(d,l,g);g.generateMipmaps=f;g.activeCubeFace=5;e.render(d,i,g)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.CubeCamera.prototype.constructor=THREE.CubeCamera;THREE.OrthographicCamera=function(h,g,m,l,k,i){THREE.Camera.call(this);this.type="OrthographicCamera";this.zoom=1;this.left=h;this.right=g;this.top=m;this.bottom=l;this.near=void 0!==k?k:0.1;this.far=void 0!==i?i:2000;this.updateProjectionMatrix()};THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype);THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera;THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){var f=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),h=(this.right+this.left)/2,g=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(h-f,h+f,g+e,g-e,this.near,this.far)};THREE.OrthographicCamera.prototype.clone=function(){var b=new THREE.OrthographicCamera;THREE.Camera.prototype.clone.call(this,b);b.zoom=this.zoom;b.left=this.left;b.right=this.right;b.top=this.top;b.bottom=this.bottom;b.near=this.near;b.far=this.far;b.projectionMatrix.copy(this.projectionMatrix);return b};THREE.PerspectiveCamera=function(f,e,h,g){THREE.Camera.call(this);this.type="PerspectiveCamera";this.zoom=1;this.fov=void 0!==f?f:50;this.aspect=void 0!==e?e:1;this.near=void 0!==h?h:0.1;this.far=void 0!==g?g:2000;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype);THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera;THREE.PerspectiveCamera.prototype.setLens=function(d,c){void 0===c&&(c=24);this.fov=2*THREE.Math.radToDeg(Math.atan(c/(2*d)));this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.setViewOffset=function(h,g,m,l,k,i){this.fullWidth=h;this.fullHeight=g;this.x=m;this.y=l;this.width=k;this.height=i;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var f=THREE.Math.radToDeg(2*Math.atan(Math.tan(0.5*THREE.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var e=this.fullWidth/this.fullHeight,f=Math.tan(THREE.Math.degToRad(0.5*f))*this.near,h=-f,g=e*h,e=Math.abs(e*f-g),h=Math.abs(f-h);this.projectionMatrix.makeFrustum(g+this.x*e/this.fullWidth,g+(this.x+this.width)*e/this.fullWidth,f-(this.y+this.height)*h/this.fullHeight,f-this.y*h/this.fullHeight,this.near,this.far)}else{this.projectionMatrix.makePerspective(f,this.aspect,this.near,this.far)}};THREE.PerspectiveCamera.prototype.clone=function(){var b=new THREE.PerspectiveCamera;THREE.Camera.prototype.clone.call(this,b);b.zoom=this.zoom;b.fov=this.fov;b.aspect=this.aspect;b.near=this.near;b.far=this.far;b.projectionMatrix.copy(this.projectionMatrix);return b};THREE.Light=function(b){THREE.Object3D.call(this);this.type="Light";this.color=new THREE.Color(b)};THREE.Light.prototype=Object.create(THREE.Object3D.prototype);THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.clone=function(b){void 0===b&&(b=new THREE.Light);THREE.Object3D.prototype.clone.call(this,b);b.color.copy(this.color);return b};THREE.AmbientLight=function(b){THREE.Light.call(this,b);this.type="AmbientLight"};THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype);THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.AmbientLight.prototype.clone=function(){var b=new THREE.AmbientLight;THREE.Light.prototype.clone.call(this,b);return b};THREE.AreaLight=function(d,c){THREE.Light.call(this,d);this.type="AreaLight";this.normal=new THREE.Vector3(0,-1,0);this.right=new THREE.Vector3(1,0,0);this.intensity=void 0!==c?c:1;this.height=this.width=1;this.constantAttenuation=1.5;this.linearAttenuation=0.5;this.quadraticAttenuation=0.1};THREE.AreaLight.prototype=Object.create(THREE.Light.prototype);THREE.AreaLight.prototype.constructor=THREE.AreaLight;THREE.DirectionalLight=function(d,c){THREE.Light.call(this,d);this.type="DirectionalLight";this.position.set(0,1,0);this.target=new THREE.Object3D;this.intensity=void 0!==c?c:1;this.onlyShadow=this.castShadow=!1;this.shadowCameraNear=50;this.shadowCameraFar=5000;this.shadowCameraLeft=-500;this.shadowCameraTop=this.shadowCameraRight=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=!1;this.shadowBias=0;this.shadowDarkness=0.5;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowCascade=!1;this.shadowCascadeOffset=new THREE.Vector3(0,0,-1000);this.shadowCascadeCount=2;this.shadowCascadeBias=[0,0,0];this.shadowCascadeWidth=[512,512,512];this.shadowCascadeHeight=[512,512,512];this.shadowCascadeNearZ=[-1,0.99,0.998];this.shadowCascadeFarZ=[0.99,0.998,1];this.shadowCascadeArray=[];this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null};THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype);THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.DirectionalLight.prototype.clone=function(){var b=new THREE.DirectionalLight;THREE.Light.prototype.clone.call(this,b);b.target=this.target.clone();b.intensity=this.intensity;b.castShadow=this.castShadow;b.onlyShadow=this.onlyShadow;b.shadowCameraNear=this.shadowCameraNear;b.shadowCameraFar=this.shadowCameraFar;b.shadowCameraLeft=this.shadowCameraLeft;b.shadowCameraRight=this.shadowCameraRight;b.shadowCameraTop=this.shadowCameraTop;b.shadowCameraBottom=this.shadowCameraBottom;b.shadowCameraVisible=this.shadowCameraVisible;b.shadowBias=this.shadowBias;b.shadowDarkness=this.shadowDarkness;b.shadowMapWidth=this.shadowMapWidth;b.shadowMapHeight=this.shadowMapHeight;b.shadowCascade=this.shadowCascade;b.shadowCascadeOffset.copy(this.shadowCascadeOffset);b.shadowCascadeCount=this.shadowCascadeCount;b.shadowCascadeBias=this.shadowCascadeBias.slice(0);b.shadowCascadeWidth=this.shadowCascadeWidth.slice(0);b.shadowCascadeHeight=this.shadowCascadeHeight.slice(0);b.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0);b.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0);return b};THREE.HemisphereLight=function(e,d,f){THREE.Light.call(this,e);this.type="HemisphereLight";this.position.set(0,100,0);this.groundColor=new THREE.Color(d);this.intensity=void 0!==f?f:1};THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype);THREE.HemisphereLight.prototype.constructor=THREE.HemisphereLight;THREE.HemisphereLight.prototype.clone=function(){var b=new THREE.HemisphereLight;THREE.Light.prototype.clone.call(this,b);b.groundColor.copy(this.groundColor);b.intensity=this.intensity;return b};THREE.PointLight=function(f,e,h,g){THREE.Light.call(this,f);this.type="PointLight";this.intensity=void 0!==e?e:1;this.distance=void 0!==h?h:0;this.decay=void 0!==g?g:1};THREE.PointLight.prototype=Object.create(THREE.Light.prototype);THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.PointLight.prototype.clone=function(){var b=new THREE.PointLight;THREE.Light.prototype.clone.call(this,b);b.intensity=this.intensity;b.distance=this.distance;b.decay=this.decay;return b};THREE.SpotLight=function(h,g,m,l,k,i){THREE.Light.call(this,h);this.type="SpotLight";this.position.set(0,1,0);this.target=new THREE.Object3D;this.intensity=void 0!==g?g:1;this.distance=void 0!==m?m:0;this.angle=void 0!==l?l:Math.PI/3;this.exponent=void 0!==k?k:10;this.decay=void 0!==i?i:1;this.onlyShadow=this.castShadow=!1;this.shadowCameraNear=50;this.shadowCameraFar=5000;this.shadowCameraFov=50;this.shadowCameraVisible=!1;this.shadowBias=0;this.shadowDarkness=0.5;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null};THREE.SpotLight.prototype=Object.create(THREE.Light.prototype);THREE.SpotLight.prototype.constructor=THREE.SpotLight;THREE.SpotLight.prototype.clone=function(){var b=new THREE.SpotLight;THREE.Light.prototype.clone.call(this,b);b.target=this.target.clone();b.intensity=this.intensity;b.distance=this.distance;b.angle=this.angle;b.exponent=this.exponent;b.decay=this.decay;b.castShadow=this.castShadow;b.onlyShadow=this.onlyShadow;b.shadowCameraNear=this.shadowCameraNear;b.shadowCameraFar=this.shadowCameraFar;b.shadowCameraFov=this.shadowCameraFov;b.shadowCameraVisible=this.shadowCameraVisible;b.shadowBias=this.shadowBias;b.shadowDarkness=this.shadowDarkness;b.shadowMapWidth=this.shadowMapWidth;b.shadowMapHeight=this.shadowMapHeight;return b};THREE.Cache={files:{},add:function(d,c){this.files[d]=c},get:function(b){return this.files[b]},remove:function(b){delete this.files[b]},clear:function(){this.files={}}};THREE.Loader=function(b){this.statusDomElement=(this.showStatus=b)?THREE.Loader.prototype.addStatusElement():null;this.imageLoader=new THREE.ImageLoader;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:void 0,addStatusElement:function(){var b=document.createElement("div");b.style.position="absolute";b.style.right="0px";b.style.top="0px";b.style.fontSize="0.8em";b.style.textAlign="left";b.style.background="rgba(0,0,0,0.25)";b.style.color="#fff";b.style.width="120px";b.style.padding="0.5em 0.5em 0.5em 0.5em";b.style.zIndex=1000;b.innerHTML="Loading ...";return b},updateProgress:function(d){var c="Loaded ",c=d.total?c+((100*d.loaded/d.total).toFixed(0)+"%"):c+((d.loaded/1024).toFixed(2)+" KB");this.statusDomElement.innerHTML=c},extractUrlBase:function(b){b=b.split("/");if(1===b.length){return"./"}b.pop();return b.join("/")+"/"},initMaterials:function(f,e){for(var h=[],g=0;g<f.length;++g){h[g]=this.createMaterial(f[g],e)}return h},needsTangents:function(e){for(var d=0,f=e.length;d<f;d++){if(e[d] instanceof THREE.ShaderMaterial){return !0}}return !1},createMaterial:function(s,r){function q(b){b=Math.log(b)/Math.LN2;return Math.pow(2,Math.round(b))}function p(C,A,t,f,c,b,F){var E=r+t,D,B=THREE.Loader.Handlers.get(E);null!==B?D=B.load(E):(D=new THREE.Texture,B=n.imageLoader,B.crossOrigin=n.crossOrigin,B.load(E,function(h){if(!1===THREE.Math.isPowerOfTwo(h.width)||!1===THREE.Math.isPowerOfTwo(h.height)){var g=q(h.width),u=q(h.height),k=document.createElement("canvas");k.width=g;k.height=u;k.getContext("2d").drawImage(h,0,0,g,u);D.image=k}else{D.image=h}D.needsUpdate=!0}));D.sourceFile=t;f&&(D.repeat.set(f[0],f[1]),1!==f[0]&&(D.wrapS=THREE.RepeatWrapping),1!==f[1]&&(D.wrapT=THREE.RepeatWrapping));c&&D.offset.set(c[0],c[1]);b&&(t={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},void 0!==t[b[0]]&&(D.wrapS=t[b[0]]),void 0!==t[b[1]]&&(D.wrapT=t[b[1]]));F&&(D.anisotropy=F);C[A]=D}function o(b){return(255*b[0]<<16)+(255*b[1]<<8)+255*b[2]}var n=this,m="MeshLambertMaterial",l={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(s.shading){var i=s.shading.toLowerCase();"phong"===i?m="MeshPhongMaterial":"basic"===i&&(m="MeshBasicMaterial")}void 0!==s.blending&&void 0!==THREE[s.blending]&&(l.blending=THREE[s.blending]);void 0!==s.transparent&&(l.transparent=s.transparent);void 0!==s.opacity&&1>s.opacity&&(l.transparent=!0);void 0!==s.depthTest&&(l.depthTest=s.depthTest);void 0!==s.depthWrite&&(l.depthWrite=s.depthWrite);void 0!==s.visible&&(l.visible=s.visible);void 0!==s.flipSided&&(l.side=THREE.BackSide);void 0!==s.doubleSided&&(l.side=THREE.DoubleSide);void 0!==s.wireframe&&(l.wireframe=s.wireframe);void 0!==s.vertexColors&&("face"===s.vertexColors?l.vertexColors=THREE.FaceColors:s.vertexColors&&(l.vertexColors=THREE.VertexColors));s.colorDiffuse?l.color=o(s.colorDiffuse):s.DbgColor&&(l.color=s.DbgColor);s.colorSpecular&&(l.specular=o(s.colorSpecular));s.colorEmissive&&(l.emissive=o(s.colorEmissive));void 0!==s.transparency&&(console.warn("THREE.Loader: transparency has been renamed to opacity"),s.opacity=s.transparency);void 0!==s.opacity&&(l.opacity=s.opacity);s.specularCoef&&(l.shininess=s.specularCoef);s.mapDiffuse&&r&&p(l,"map",s.mapDiffuse,s.mapDiffuseRepeat,s.mapDiffuseOffset,s.mapDiffuseWrap,s.mapDiffuseAnisotropy);s.mapLight&&r&&p(l,"lightMap",s.mapLight,s.mapLightRepeat,s.mapLightOffset,s.mapLightWrap,s.mapLightAnisotropy);s.mapBump&&r&&p(l,"bumpMap",s.mapBump,s.mapBumpRepeat,s.mapBumpOffset,s.mapBumpWrap,s.mapBumpAnisotropy);s.mapNormal&&r&&p(l,"normalMap",s.mapNormal,s.mapNormalRepeat,s.mapNormalOffset,s.mapNormalWrap,s.mapNormalAnisotropy);s.mapSpecular&&r&&p(l,"specularMap",s.mapSpecular,s.mapSpecularRepeat,s.mapSpecularOffset,s.mapSpecularWrap,s.mapSpecularAnisotropy);s.mapAlpha&&r&&p(l,"alphaMap",s.mapAlpha,s.mapAlphaRepeat,s.mapAlphaOffset,s.mapAlphaWrap,s.mapAlphaAnisotropy);s.mapBumpScale&&(l.bumpScale=s.mapBumpScale);s.mapNormalFactor&&(l.normalScale=new THREE.Vector2(s.mapNormalFactor,s.mapNormalFactor));m=new THREE[m](l);void 0!==s.DbgName&&(m.name=s.DbgName);return m}};THREE.Loader.Handlers={handlers:[],add:function(d,c){this.handlers.push(d,c)},get:function(f){for(var e=0,h=this.handlers.length;e<h;e+=2){var g=this.handlers[e+1];if(this.handlers[e].test(f)){return g}}return null}};THREE.XHRLoader=function(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager};THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(h,g,m,l){var k=this,i=THREE.Cache.get(h);void 0!==i?g&&g(i):(i=new XMLHttpRequest,i.open("GET",h,!0),i.addEventListener("load",function(a){THREE.Cache.add(h,this.response);g&&g(this.response);k.manager.itemEnd(h)},!1),void 0!==m&&i.addEventListener("progress",function(b){m(b)},!1),void 0!==l&&i.addEventListener("error",function(b){l(b)},!1),void 0!==this.crossOrigin&&(i.crossOrigin=this.crossOrigin),void 0!==this.responseType&&(i.responseType=this.responseType),i.send(null),k.manager.itemStart(h))},setResponseType:function(b){this.responseType=b},setCrossOrigin:function(b){this.crossOrigin=b}};THREE.ImageLoader=function(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager};THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(h,g,m,l){var k=this,i=THREE.Cache.get(h);if(void 0!==i){g(i)}else{return i=document.createElement("img"),i.addEventListener("load",function(a){THREE.Cache.add(h,this);g&&g(this);k.manager.itemEnd(h)},!1),void 0!==m&&i.addEventListener("progress",function(b){m(b)},!1),void 0!==l&&i.addEventListener("error",function(b){l(b)},!1),void 0!==this.crossOrigin&&(i.crossOrigin=this.crossOrigin),i.src=h,k.manager.itemStart(h),i}},setCrossOrigin:function(b){this.crossOrigin=b}};THREE.JSONLoader=function(b){THREE.Loader.call(this,b);this.withCredentials=!1};THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype);THREE.JSONLoader.prototype.constructor=THREE.JSONLoader;THREE.JSONLoader.prototype.load=function(e,d,f){f=f&&"string"===typeof f?f:this.extractUrlBase(e);this.onLoadStart();this.loadAjaxJSON(this,e,d,f)};THREE.JSONLoader.prototype.loadAjaxJSON=function(i,h,o,n,m){var l=new XMLHttpRequest,k=0;l.onreadystatechange=function(){if(l.readyState===l.DONE){if(200===l.status||0===l.status){if(l.responseText){var b=JSON.parse(l.responseText),a=b.metadata;if(void 0!==a){if("object"===a.type){THREE.error("THREE.JSONLoader: "+h+" should be loaded with THREE.ObjectLoader instead.");return}if("scene"===a.type){THREE.error("THREE.JSONLoader: "+h+" seems to be a Scene. Use THREE.SceneLoader instead.");return}}b=i.parse(b,n);o(b.geometry,b.materials)}else{THREE.error("THREE.JSONLoader: "+h+" seems to be unreachable or the file is empty.")}i.onLoadComplete()}else{THREE.error("THREE.JSONLoader: Couldn't load "+h+" ("+l.status+")")}}else{l.readyState===l.LOADING?m&&(0===k&&(k=l.getResponseHeader("Content-Length")),m({total:k,loaded:l.responseText.length})):l.readyState===l.HEADERS_RECEIVED&&void 0!==m&&(k=l.getResponseHeader("Content-Length"))}};l.open("GET",h,!0);l.withCredentials=this.withCredentials;l.send(null)};THREE.JSONLoader.prototype.parse=function(f,e){var h=new THREE.Geometry,g=void 0!==f.scale?1/f.scale:1;(function(N){var M,L,K,J,I,G,F,H,A,E,B,o,m,c=f.faces;G=f.vertices;var C=f.normals,i=f.colors,a=0;if(void 0!==f.uvs){for(M=0;M<f.uvs.length;M++){f.uvs[M].length&&a++}for(M=0;M<a;M++){h.faceVertexUvs[M]=[]}}J=0;for(I=G.length;J<I;){M=new THREE.Vector3,M.x=G[J++]*N,M.y=G[J++]*N,M.z=G[J++]*N,h.vertices.push(M)}J=0;for(I=c.length;J<I;){if(N=c[J++],A=N&1,K=N&2,M=N&8,F=N&16,E=N&32,G=N&64,N&=128,A){A=new THREE.Face3;A.a=c[J];A.b=c[J+1];A.c=c[J+3];B=new THREE.Face3;B.a=c[J+1];B.b=c[J+2];B.c=c[J+3];J+=4;K&&(K=c[J++],A.materialIndex=K,B.materialIndex=K);K=h.faces.length;if(M){for(M=0;M<a;M++){for(o=f.uvs[M],h.faceVertexUvs[M][K]=[],h.faceVertexUvs[M][K+1]=[],L=0;4>L;L++){H=c[J++],m=o[2*H],H=o[2*H+1],m=new THREE.Vector2(m,H),2!==L&&h.faceVertexUvs[M][K].push(m),0!==L&&h.faceVertexUvs[M][K+1].push(m)}}}F&&(F=3*c[J++],A.normal.set(C[F++],C[F++],C[F]),B.normal.copy(A.normal));if(E){for(M=0;4>M;M++){F=3*c[J++],E=new THREE.Vector3(C[F++],C[F++],C[F]),2!==M&&A.vertexNormals.push(E),0!==M&&B.vertexNormals.push(E)}}G&&(G=c[J++],G=i[G],A.color.setHex(G),B.color.setHex(G));if(N){for(M=0;4>M;M++){G=c[J++],G=i[G],2!==M&&A.vertexColors.push(new THREE.Color(G)),0!==M&&B.vertexColors.push(new THREE.Color(G))}}h.faces.push(A);h.faces.push(B)}else{A=new THREE.Face3;A.a=c[J++];A.b=c[J++];A.c=c[J++];K&&(K=c[J++],A.materialIndex=K);K=h.faces.length;if(M){for(M=0;M<a;M++){for(o=f.uvs[M],h.faceVertexUvs[M][K]=[],L=0;3>L;L++){H=c[J++],m=o[2*H],H=o[2*H+1],m=new THREE.Vector2(m,H),h.faceVertexUvs[M][K].push(m)}}}F&&(F=3*c[J++],A.normal.set(C[F++],C[F++],C[F]));if(E){for(M=0;3>M;M++){F=3*c[J++],E=new THREE.Vector3(C[F++],C[F++],C[F]),A.vertexNormals.push(E)}}G&&(G=c[J++],A.color.setHex(i[G]));if(N){for(M=0;3>M;M++){G=c[J++],A.vertexColors.push(new THREE.Color(i[G]))}}h.faces.push(A)}}})(g);(function(){var a=void 0!==f.influencesPerVertex?f.influencesPerVertex:2;if(f.skinWeights){for(var i=0,c=f.skinWeights.length;i<c;i+=a){h.skinWeights.push(new THREE.Vector4(f.skinWeights[i],1<a?f.skinWeights[i+1]:0,2<a?f.skinWeights[i+2]:0,3<a?f.skinWeights[i+3]:0))}}if(f.skinIndices){for(i=0,c=f.skinIndices.length;i<c;i+=a){h.skinIndices.push(new THREE.Vector4(f.skinIndices[i],1<a?f.skinIndices[i+1]:0,2<a?f.skinIndices[i+2]:0,3<a?f.skinIndices[i+3]:0))}}h.bones=f.bones;h.bones&&0<h.bones.length&&(h.skinWeights.length!==h.skinIndices.length||h.skinIndices.length!==h.vertices.length)&&THREE.warn("THREE.JSONLoader: When skinning, number of vertices ("+h.vertices.length+"), skinIndices ("+h.skinIndices.length+"), and skinWeights ("+h.skinWeights.length+") should match.");h.animation=f.animation;h.animations=f.animations})();(function(a){if(void 0!==f.morphTargets){var s,n,m,i,c,r;s=0;for(n=f.morphTargets.length;s<n;s++){for(h.morphTargets[s]={},h.morphTargets[s].name=f.morphTargets[s].name,h.morphTargets[s].vertices=[],c=h.morphTargets[s].vertices,r=f.morphTargets[s].vertices,m=0,i=r.length;m<i;m+=3){var o=new THREE.Vector3;o.x=r[m]*a;o.y=r[m+1]*a;o.z=r[m+2]*a;c.push(o)}}}if(void 0!==f.morphColors){for(s=0,n=f.morphColors.length;s<n;s++){for(h.morphColors[s]={},h.morphColors[s].name=f.morphColors[s].name,h.morphColors[s].colors=[],i=h.morphColors[s].colors,c=f.morphColors[s].colors,a=0,m=c.length;a<m;a+=3){r=new THREE.Color(16755200),r.setRGB(c[a],c[a+1],c[a+2]),i.push(r)}}}})(g);h.computeFaceNormals();h.computeBoundingSphere();if(void 0===f.materials||0===f.materials.length){return{geometry:h}}g=this.initMaterials(f.materials,e);this.needsTangents(g)&&h.computeTangents();return{geometry:h,materials:g}};THREE.LoadingManager=function(h,g,m){var l=this,k=0,i=0;this.onLoad=h;this.onProgress=g;this.onError=m;this.itemStart=function(b){i++};this.itemEnd=function(b){k++;if(void 0!==l.onProgress){l.onProgress(b,k,i)}if(k===i&&void 0!==l.onLoad){l.onLoad()}}};THREE.DefaultLoadingManager=new THREE.LoadingManager;THREE.BufferGeometryLoader=function(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager};THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(h,g,m,l){var k=this,i=new THREE.XHRLoader(k.manager);i.setCrossOrigin(this.crossOrigin);i.load(h,function(b){g(k.parse(JSON.parse(b)))},m,l)},setCrossOrigin:function(b){this.crossOrigin=b},parse:function(h){var g=new THREE.BufferGeometry,m=h.data.attributes,l;for(l in m){var k=m[l],i=new self[k.type](k.array);g.addAttribute(l,new THREE.BufferAttribute(i,k.itemSize))}m=h.data.offsets;void 0!==m&&(g.offsets=JSON.parse(JSON.stringify(m)));h=h.data.boundingSphere;void 0!==h&&(m=new THREE.Vector3,void 0!==h.center&&m.fromArray(h.center),g.boundingSphere=new THREE.Sphere(m,h.radius));return g}};THREE.MaterialLoader=function(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager};THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(h,g,m,l){var k=this,i=new THREE.XHRLoader(k.manager);i.setCrossOrigin(this.crossOrigin);i.load(h,function(b){g(k.parse(JSON.parse(b)))},m,l)},setCrossOrigin:function(b){this.crossOrigin=b},parse:function(f){var e=new THREE[f.type];void 0!==f.color&&e.color.setHex(f.color);void 0!==f.emissive&&e.emissive.setHex(f.emissive);void 0!==f.specular&&e.specular.setHex(f.specular);void 0!==f.shininess&&(e.shininess=f.shininess);void 0!==f.uniforms&&(e.uniforms=f.uniforms);void 0!==f.vertexShader&&(e.vertexShader=f.vertexShader);void 0!==f.fragmentShader&&(e.fragmentShader=f.fragmentShader);void 0!==f.vertexColors&&(e.vertexColors=f.vertexColors);void 0!==f.shading&&(e.shading=f.shading);void 0!==f.blending&&(e.blending=f.blending);void 0!==f.side&&(e.side=f.side);void 0!==f.opacity&&(e.opacity=f.opacity);void 0!==f.transparent&&(e.transparent=f.transparent);void 0!==f.wireframe&&(e.wireframe=f.wireframe);void 0!==f.size&&(e.size=f.size);void 0!==f.sizeAttenuation&&(e.sizeAttenuation=f.sizeAttenuation);if(void 0!==f.materials){for(var h=0,g=f.materials.length;h<g;h++){e.materials.push(this.parse(f.materials[h]))}}return e}};THREE.ObjectLoader=function(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager;this.texturePath=""};THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(h,g,m,l){""===this.texturePath&&(this.texturePath=h.substring(0,h.lastIndexOf("/")+1));var k=this,i=new THREE.XHRLoader(k.manager);i.setCrossOrigin(this.crossOrigin);i.load(h,function(b){k.parse(JSON.parse(b),g)},m,l)},setTexturePath:function(b){this.texturePath=b},setCrossOrigin:function(b){this.crossOrigin=b},parse:function(g,f){var k=this.parseGeometries(g.geometries),i=this.parseImages(g.images,function(){void 0!==f&&f(h)}),i=this.parseTextures(g.textures,i),i=this.parseMaterials(g.materials,i),h=this.parseObject(g.object,k,i);void 0!==g.images&&0!==g.images.length||void 0===f||f(h);return h},parseGeometries:function(k){var i={};if(void 0!==k){for(var q=new THREE.JSONLoader,p=new THREE.BufferGeometryLoader,o=0,n=k.length;o<n;o++){var m,l=k[o];switch(l.type){case"PlaneGeometry":case"PlaneBufferGeometry":m=new THREE[l.type](l.width,l.height,l.widthSegments,l.heightSegments);break;case"BoxGeometry":case"CubeGeometry":m=new THREE.BoxGeometry(l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments);break;case"CircleGeometry":m=new THREE.CircleGeometry(l.radius,l.segments);break;case"CylinderGeometry":m=new THREE.CylinderGeometry(l.radiusTop,l.radiusBottom,l.height,l.radialSegments,l.heightSegments,l.openEnded);break;case"SphereGeometry":m=new THREE.SphereGeometry(l.radius,l.widthSegments,l.heightSegments,l.phiStart,l.phiLength,l.thetaStart,l.thetaLength);break;case"IcosahedronGeometry":m=new THREE.IcosahedronGeometry(l.radius,l.detail);break;case"TorusGeometry":m=new THREE.TorusGeometry(l.radius,l.tube,l.radialSegments,l.tubularSegments,l.arc);break;case"TorusKnotGeometry":m=new THREE.TorusKnotGeometry(l.radius,l.tube,l.radialSegments,l.tubularSegments,l.p,l.q,l.heightScale);break;case"BufferGeometry":m=p.parse(l);break;case"Geometry":m=q.parse(l.data).geometry}m.uuid=l.uuid;void 0!==l.name&&(m.name=l.name);i[l.uuid]=m}}return i},parseMaterials:function(s,r){var q={};if(void 0!==s){for(var p=function(b){void 0===r[b]&&THREE.warn("THREE.ObjectLoader: Undefined texture",b);return r[b]},o=new THREE.MaterialLoader,n=0,m=s.length;n<m;n++){var l=s[n],i=o.parse(l);i.uuid=l.uuid;void 0!==l.name&&(i.name=l.name);void 0!==l.map&&(i.map=p(l.map));void 0!==l.bumpMap&&(i.bumpMap=p(l.bumpMap),l.bumpScale&&(i.bumpScale=new THREE.Vector2(l.bumpScale,l.bumpScale)));void 0!==l.alphaMap&&(i.alphaMap=p(l.alphaMap));void 0!==l.envMap&&(i.envMap=p(l.envMap));void 0!==l.normalMap&&(i.normalMap=p(l.normalMap),l.normalScale&&(i.normalScale=new THREE.Vector2(l.normalScale,l.normalScale)));void 0!==l.lightMap&&(i.lightMap=p(l.lightMap));void 0!==l.specularMap&&(i.specularMap=p(l.specularMap));q[l.uuid]=i}}return q},parseImages:function(u,t){var s=this,r={};if(void 0!==u&&0<u.length){var q=new THREE.LoadingManager(t),p=new THREE.ImageLoader(q);p.setCrossOrigin(this.crossOrigin);for(var q=function(b){s.manager.itemStart(b);return p.load(b,function(){s.manager.itemEnd(b)})},o=0,n=u.length;o<n;o++){var m=u[o],i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(m.url)?m.url:s.texturePath+m.url;r[m.uuid]=q(i)}}return r},parseTextures:function(i,h){var o={};if(void 0!==i){for(var n=0,m=i.length;n<m;n++){var l=i[n];void 0===l.image&&THREE.warn('THREE.ObjectLoader: No "image" speficied for',l.uuid);void 0===h[l.image]&&THREE.warn("THREE.ObjectLoader: Undefined image",l.image);var k=new THREE.Texture(h[l.image]);k.needsUpdate=!0;k.uuid=l.uuid;void 0!==l.name&&(k.name=l.name);void 0!==l.repeat&&(k.repeat=new THREE.Vector2(l.repeat[0],l.repeat[1]));void 0!==l.minFilter&&(k.minFilter=THREE[l.minFilter]);void 0!==l.magFilter&&(k.magFilter=THREE[l.magFilter]);void 0!==l.anisotropy&&(k.anisotropy=l.anisotropy);l.wrap instanceof Array&&(k.wrapS=THREE[l.wrap[0]],k.wrapT=THREE[l.wrap[1]]);o[l.uuid]=k}}return o},parseObject:function(){var b=new THREE.Matrix4;return function(a,m,l){var k;k=function(c){void 0===m[c]&&THREE.warn("THREE.ObjectLoader: Undefined geometry",c);return m[c]};var i=function(c){void 0===l[c]&&THREE.warn("THREE.ObjectLoader: Undefined material",c);return l[c]};switch(a.type){case"Scene":k=new THREE.Scene;break;case"PerspectiveCamera":k=new THREE.PerspectiveCamera(a.fov,a.aspect,a.near,a.far);break;case"OrthographicCamera":k=new THREE.OrthographicCamera(a.left,a.right,a.top,a.bottom,a.near,a.far);break;case"AmbientLight":k=new THREE.AmbientLight(a.color);break;case"DirectionalLight":k=new THREE.DirectionalLight(a.color,a.intensity);break;case"PointLight":k=new THREE.PointLight(a.color,a.intensity,a.distance,a.decay);break;case"SpotLight":k=new THREE.SpotLight(a.color,a.intensity,a.distance,a.angle,a.exponent,a.decay);break;case"HemisphereLight":k=new THREE.HemisphereLight(a.color,a.groundColor,a.intensity);break;case"Mesh":k=new THREE.Mesh(k(a.geometry),i(a.material));break;case"Line":k=new THREE.Line(k(a.geometry),i(a.material),a.mode);break;case"PointCloud":k=new THREE.PointCloud(k(a.geometry),i(a.material));break;case"Sprite":k=new THREE.Sprite(i(a.material));break;case"Group":k=new THREE.Group;break;default:k=new THREE.Object3D}k.uuid=a.uuid;void 0!==a.name&&(k.name=a.name);void 0!==a.matrix?(b.fromArray(a.matrix),b.decompose(k.position,k.quaternion,k.scale)):(void 0!==a.position&&k.position.fromArray(a.position),void 0!==a.rotation&&k.rotation.fromArray(a.rotation),void 0!==a.scale&&k.scale.fromArray(a.scale));void 0!==a.visible&&(k.visible=a.visible);void 0!==a.userData&&(k.userData=a.userData);if(void 0!==a.children){for(var h in a.children){k.add(this.parseObject(a.children[h],m,l))}}return k}}()};THREE.TextureLoader=function(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager};THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(g,f,k,i){var h=new THREE.ImageLoader(this.manager);h.setCrossOrigin(this.crossOrigin);h.load(g,function(b){b=new THREE.Texture(b);b.needsUpdate=!0;void 0!==f&&f(b)},k,i)},setCrossOrigin:function(b){this.crossOrigin=b}};THREE.DataTextureLoader=THREE.BinaryTextureLoader=function(){this._parser=null};THREE.BinaryTextureLoader.prototype={constructor:THREE.BinaryTextureLoader,load:function(i,h,o,n){var m=this,l=new THREE.DataTexture,k=new THREE.XHRLoader;k.setResponseType("arraybuffer");k.load(i,function(b){if(b=m._parser(b)){void 0!==b.image?l.image=b.image:void 0!==b.data&&(l.image.width=b.width,l.image.height=b.height,l.image.data=b.data),l.wrapS=void 0!==b.wrapS?b.wrapS:THREE.ClampToEdgeWrapping,l.wrapT=void 0!==b.wrapT?b.wrapT:THREE.ClampToEdgeWrapping,l.magFilter=void 0!==b.magFilter?b.magFilter:THREE.LinearFilter,l.minFilter=void 0!==b.minFilter?b.minFilter:THREE.LinearMipMapLinearFilter,l.anisotropy=void 0!==b.anisotropy?b.anisotropy:1,void 0!==b.format&&(l.format=b.format),void 0!==b.type&&(l.type=b.type),void 0!==b.mipmaps&&(l.mipmaps=b.mipmaps),1===b.mipmapCount&&(l.minFilter=THREE.LinearFilter),l.needsUpdate=!0,h&&h(l,b)}},o,n);return l}};THREE.CompressedTextureLoader=function(){this._parser=null};THREE.CompressedTextureLoader.prototype={constructor:THREE.CompressedTextureLoader,load:function(u,t,s){var r=this,q=[],p=new THREE.CompressedTexture;p.image=q;var o=new THREE.XHRLoader;o.setResponseType("arraybuffer");if(u instanceof Array){var n=0;s=function(a){o.load(u[a],function(b){b=r._parser(b,!0);q[a]={width:b.width,height:b.height,format:b.format,mipmaps:b.mipmaps};n+=1;6===n&&(1==b.mipmapCount&&(p.minFilter=THREE.LinearFilter),p.format=b.format,p.needsUpdate=!0,t&&t(p))})};for(var m=0,i=u.length;m<i;++m){s(m)}}else{o.load(u,function(b){b=r._parser(b,!0);if(b.isCubemap){for(var f=b.mipmaps.length/b.mipmapCount,e=0;e<f;e++){q[e]={mipmaps:[]};for(var d=0;d<b.mipmapCount;d++){q[e].mipmaps.push(b.mipmaps[e*b.mipmapCount+d]),q[e].format=b.format,q[e].width=b.width,q[e].height=b.height}}}else{p.image.width=b.width,p.image.height=b.height,p.mipmaps=b.mipmaps}1===b.mipmapCount&&(p.minFilter=THREE.LinearFilter);p.format=b.format;p.needsUpdate=!0;t&&t(p)})}return p}};THREE.Material=function(){Object.defineProperty(this,"id",{value:THREE.MaterialIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Material";this.side=THREE.FrontSide;this.opacity=1;this.transparent=!1;this.blending=THREE.NormalBlending;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.colorWrite=this.depthWrite=this.depthTest=!0;this.polygonOffset=!1;this.overdraw=this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0;this._needsUpdate=this.visible=!0};THREE.Material.prototype={constructor:THREE.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(b){!0===b&&this.update();this._needsUpdate=b},setValues:function(f){if(void 0!==f){for(var e in f){var h=f[e];if(void 0===h){THREE.warn("THREE.Material: '"+e+"' parameter is undefined.")}else{if(e in this){var g=this[e];g instanceof THREE.Color?g.set(h):g instanceof THREE.Vector3&&h instanceof THREE.Vector3?g.copy(h):this[e]="overdraw"==e?Number(h):h}}}}},toJSON:function(){var b={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};""!==this.name&&(b.name=this.name);this instanceof THREE.MeshBasicMaterial?(b.color=this.color.getHex(),this.vertexColors!==THREE.NoColors&&(b.vertexColors=this.vertexColors),this.blending!==THREE.NormalBlending&&(b.blending=this.blending),this.side!==THREE.FrontSide&&(b.side=this.side)):this instanceof THREE.MeshLambertMaterial?(b.color=this.color.getHex(),b.emissive=this.emissive.getHex(),this.vertexColors!==THREE.NoColors&&(b.vertexColors=this.vertexColors),this.shading!==THREE.SmoothShading&&(b.shading=this.shading),this.blending!==THREE.NormalBlending&&(b.blending=this.blending),this.side!==THREE.FrontSide&&(b.side=this.side)):this instanceof THREE.MeshPhongMaterial?(b.color=this.color.getHex(),b.emissive=this.emissive.getHex(),b.specular=this.specular.getHex(),b.shininess=this.shininess,this.vertexColors!==THREE.NoColors&&(b.vertexColors=this.vertexColors),this.shading!==THREE.SmoothShading&&(b.shading=this.shading),this.blending!==THREE.NormalBlending&&(b.blending=this.blending),this.side!==THREE.FrontSide&&(b.side=this.side)):this instanceof THREE.MeshNormalMaterial?(this.blending!==THREE.NormalBlending&&(b.blending=this.blending),this.side!==THREE.FrontSide&&(b.side=this.side)):this instanceof THREE.MeshDepthMaterial?(this.blending!==THREE.NormalBlending&&(b.blending=this.blending),this.side!==THREE.FrontSide&&(b.side=this.side)):this instanceof THREE.PointCloudMaterial?(b.size=this.size,b.sizeAttenuation=this.sizeAttenuation,b.color=this.color.getHex(),this.vertexColors!==THREE.NoColors&&(b.vertexColors=this.vertexColors),this.blending!==THREE.NormalBlending&&(b.blending=this.blending)):this instanceof THREE.ShaderMaterial?(b.uniforms=this.uniforms,b.vertexShader=this.vertexShader,b.fragmentShader=this.fragmentShader):this instanceof THREE.SpriteMaterial&&(b.color=this.color.getHex());1>this.opacity&&(b.opacity=this.opacity);!1!==this.transparent&&(b.transparent=this.transparent);!1!==this.wireframe&&(b.wireframe=this.wireframe);return b},clone:function(b){void 0===b&&(b=new THREE.Material);b.name=this.name;b.side=this.side;b.opacity=this.opacity;b.transparent=this.transparent;b.blending=this.blending;b.blendSrc=this.blendSrc;b.blendDst=this.blendDst;b.blendEquation=this.blendEquation;b.blendSrcAlpha=this.blendSrcAlpha;b.blendDstAlpha=this.blendDstAlpha;b.blendEquationAlpha=this.blendEquationAlpha;b.depthTest=this.depthTest;b.depthWrite=this.depthWrite;b.polygonOffset=this.polygonOffset;b.polygonOffsetFactor=this.polygonOffsetFactor;b.polygonOffsetUnits=this.polygonOffsetUnits;b.alphaTest=this.alphaTest;b.overdraw=this.overdraw;b.visible=this.visible;return b},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Material.prototype);THREE.MaterialIdCount=0;THREE.LineBasicMaterial=function(b){THREE.Material.call(this);this.type="LineBasicMaterial";this.color=new THREE.Color(16777215);this.linewidth=1;this.linejoin=this.linecap="round";this.vertexColors=THREE.NoColors;this.fog=!0;this.setValues(b)};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;THREE.LineBasicMaterial.prototype.clone=function(){var b=new THREE.LineBasicMaterial;THREE.Material.prototype.clone.call(this,b);b.color.copy(this.color);b.linewidth=this.linewidth;b.linecap=this.linecap;b.linejoin=this.linejoin;b.vertexColors=this.vertexColors;b.fog=this.fog;return b};THREE.LineDashedMaterial=function(b){THREE.Material.call(this);this.type="LineDashedMaterial";this.color=new THREE.Color(16777215);this.scale=this.linewidth=1;this.dashSize=3;this.gapSize=1;this.vertexColors=!1;this.fog=!0;this.setValues(b)};THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineDashedMaterial.prototype.constructor=THREE.LineDashedMaterial;THREE.LineDashedMaterial.prototype.clone=function(){var b=new THREE.LineDashedMaterial;THREE.Material.prototype.clone.call(this,b);b.color.copy(this.color);b.linewidth=this.linewidth;b.scale=this.scale;b.dashSize=this.dashSize;b.gapSize=this.gapSize;b.vertexColors=this.vertexColors;b.fog=this.fog;return b};THREE.MeshBasicMaterial=function(b){THREE.Material.call(this);this.type="MeshBasicMaterial";this.color=new THREE.Color(16777215);this.envMap=this.alphaMap=this.specularMap=this.lightMap=this.map=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=0.98;this.fog=!0;this.shading=THREE.SmoothShading;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=THREE.NoColors;this.morphTargets=this.skinning=!1;this.setValues(b)};THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;THREE.MeshBasicMaterial.prototype.clone=function(){var b=new THREE.MeshBasicMaterial;THREE.Material.prototype.clone.call(this,b);b.color.copy(this.color);b.map=this.map;b.lightMap=this.lightMap;b.specularMap=this.specularMap;b.alphaMap=this.alphaMap;b.envMap=this.envMap;b.combine=this.combine;b.reflectivity=this.reflectivity;b.refractionRatio=this.refractionRatio;b.fog=this.fog;b.shading=this.shading;b.wireframe=this.wireframe;b.wireframeLinewidth=this.wireframeLinewidth;b.wireframeLinecap=this.wireframeLinecap;b.wireframeLinejoin=this.wireframeLinejoin;b.vertexColors=this.vertexColors;b.skinning=this.skinning;b.morphTargets=this.morphTargets;return b};THREE.MeshLambertMaterial=function(b){THREE.Material.call(this);this.type="MeshLambertMaterial";this.color=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.wrapAround=!1;this.wrapRGB=new THREE.Vector3(1,1,1);this.envMap=this.alphaMap=this.specularMap=this.lightMap=this.map=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=0.98;this.fog=!0;this.shading=THREE.SmoothShading;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=THREE.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(b)};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;THREE.MeshLambertMaterial.prototype.clone=function(){var b=new THREE.MeshLambertMaterial;THREE.Material.prototype.clone.call(this,b);b.color.copy(this.color);b.emissive.copy(this.emissive);b.wrapAround=this.wrapAround;b.wrapRGB.copy(this.wrapRGB);b.map=this.map;b.lightMap=this.lightMap;b.specularMap=this.specularMap;b.alphaMap=this.alphaMap;b.envMap=this.envMap;b.combine=this.combine;b.reflectivity=this.reflectivity;b.refractionRatio=this.refractionRatio;b.fog=this.fog;b.shading=this.shading;b.wireframe=this.wireframe;b.wireframeLinewidth=this.wireframeLinewidth;b.wireframeLinecap=this.wireframeLinecap;b.wireframeLinejoin=this.wireframeLinejoin;b.vertexColors=this.vertexColors;b.skinning=this.skinning;b.morphTargets=this.morphTargets;b.morphNormals=this.morphNormals;return b};THREE.MeshPhongMaterial=function(b){THREE.Material.call(this);this.type="MeshPhongMaterial";this.color=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.specular=new THREE.Color(1118481);this.shininess=30;this.wrapAround=this.metal=!1;this.wrapRGB=new THREE.Vector3(1,1,1);this.bumpMap=this.lightMap=this.map=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.envMap=this.alphaMap=this.specularMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=0.98;this.fog=!0;this.shading=THREE.SmoothShading;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=THREE.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(b)};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;THREE.MeshPhongMaterial.prototype.clone=function(){var b=new THREE.MeshPhongMaterial;THREE.Material.prototype.clone.call(this,b);b.color.copy(this.color);b.emissive.copy(this.emissive);b.specular.copy(this.specular);b.shininess=this.shininess;b.metal=this.metal;b.wrapAround=this.wrapAround;b.wrapRGB.copy(this.wrapRGB);b.map=this.map;b.lightMap=this.lightMap;b.bumpMap=this.bumpMap;b.bumpScale=this.bumpScale;b.normalMap=this.normalMap;b.normalScale.copy(this.normalScale);b.specularMap=this.specularMap;b.alphaMap=this.alphaMap;b.envMap=this.envMap;b.combine=this.combine;b.reflectivity=this.reflectivity;b.refractionRatio=this.refractionRatio;b.fog=this.fog;b.shading=this.shading;b.wireframe=this.wireframe;b.wireframeLinewidth=this.wireframeLinewidth;b.wireframeLinecap=this.wireframeLinecap;b.wireframeLinejoin=this.wireframeLinejoin;b.vertexColors=this.vertexColors;b.skinning=this.skinning;b.morphTargets=this.morphTargets;b.morphNormals=this.morphNormals;return b};THREE.MeshDepthMaterial=function(b){THREE.Material.call(this);this.type="MeshDepthMaterial";this.wireframe=this.morphTargets=!1;this.wireframeLinewidth=1;this.setValues(b)};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;THREE.MeshDepthMaterial.prototype.clone=function(){var b=new THREE.MeshDepthMaterial;THREE.Material.prototype.clone.call(this,b);b.wireframe=this.wireframe;b.wireframeLinewidth=this.wireframeLinewidth;return b};THREE.MeshNormalMaterial=function(b){THREE.Material.call(this,b);this.type="MeshNormalMaterial";this.wireframe=!1;this.wireframeLinewidth=1;this.morphTargets=!1;this.setValues(b)};THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshNormalMaterial.prototype.clone=function(){var b=new THREE.MeshNormalMaterial;THREE.Material.prototype.clone.call(this,b);b.wireframe=this.wireframe;b.wireframeLinewidth=this.wireframeLinewidth;return b};THREE.MeshFaceMaterial=function(b){this.uuid=THREE.Math.generateUUID();this.type="MeshFaceMaterial";this.materials=b instanceof Array?b:[]};THREE.MeshFaceMaterial.prototype={constructor:THREE.MeshFaceMaterial,toJSON:function(){for(var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},d=0,f=this.materials.length;d<f;d++){e.materials.push(this.materials[d].toJSON())}return e},clone:function(){for(var d=new THREE.MeshFaceMaterial,c=0;c<this.materials.length;c++){d.materials.push(this.materials[c].clone())}return d}};THREE.PointCloudMaterial=function(b){THREE.Material.call(this);this.type="PointCloudMaterial";this.color=new THREE.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=!0;this.vertexColors=THREE.NoColors;this.fog=!0;this.setValues(b)};THREE.PointCloudMaterial.prototype=Object.create(THREE.Material.prototype);THREE.PointCloudMaterial.prototype.constructor=THREE.PointCloudMaterial;THREE.PointCloudMaterial.prototype.clone=function(){var b=new THREE.PointCloudMaterial;THREE.Material.prototype.clone.call(this,b);b.color.copy(this.color);b.map=this.map;b.size=this.size;b.sizeAttenuation=this.sizeAttenuation;b.vertexColors=this.vertexColors;b.fog=this.fog;return b};THREE.ParticleBasicMaterial=function(b){THREE.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial.");return new THREE.PointCloudMaterial(b)};THREE.ParticleSystemMaterial=function(b){THREE.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial.");return new THREE.PointCloudMaterial(b)};THREE.ShaderMaterial=function(b){THREE.Material.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.attributes=null;this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.shading=THREE.SmoothShading;this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.vertexColors=THREE.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;this.setValues(b)};THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial;THREE.ShaderMaterial.prototype.clone=function(){var b=new THREE.ShaderMaterial;THREE.Material.prototype.clone.call(this,b);b.fragmentShader=this.fragmentShader;b.vertexShader=this.vertexShader;b.uniforms=THREE.UniformsUtils.clone(this.uniforms);b.attributes=this.attributes;b.defines=this.defines;b.shading=this.shading;b.wireframe=this.wireframe;b.wireframeLinewidth=this.wireframeLinewidth;b.fog=this.fog;b.lights=this.lights;b.vertexColors=this.vertexColors;b.skinning=this.skinning;b.morphTargets=this.morphTargets;b.morphNormals=this.morphNormals;return b};THREE.RawShaderMaterial=function(b){THREE.ShaderMaterial.call(this,b);this.type="RawShaderMaterial"};THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);THREE.RawShaderMaterial.prototype.constructor=THREE.RawShaderMaterial;THREE.RawShaderMaterial.prototype.clone=function(){var b=new THREE.RawShaderMaterial;THREE.ShaderMaterial.prototype.clone.call(this,b);return b};THREE.SpriteMaterial=function(b){THREE.Material.call(this);this.type="SpriteMaterial";this.color=new THREE.Color(16777215);this.map=null;this.rotation=0;this.fog=!1;this.setValues(b)};THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteMaterial.prototype.constructor=THREE.SpriteMaterial;THREE.SpriteMaterial.prototype.clone=function(){var b=new THREE.SpriteMaterial;THREE.Material.prototype.clone.call(this,b);b.color.copy(this.color);b.map=this.map;b.rotation=this.rotation;b.fog=this.fog;return b};THREE.Texture=function(s,r,q,p,o,n,m,l,i){Object.defineProperty(this,"id",{value:THREE.TextureIdCount++});this.uuid=THREE.Math.generateUUID();this.sourceFile=this.name="";this.image=void 0!==s?s:THREE.Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==r?r:THREE.Texture.DEFAULT_MAPPING;this.wrapS=void 0!==q?q:THREE.ClampToEdgeWrapping;this.wrapT=void 0!==p?p:THREE.ClampToEdgeWrapping;this.magFilter=void 0!==o?o:THREE.LinearFilter;this.minFilter=void 0!==n?n:THREE.LinearMipMapLinearFilter;this.anisotropy=void 0!==i?i:1;this.format=void 0!==m?m:THREE.RGBAFormat;this.type=void 0!==l?l:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this._needsUpdate=!1;this.onUpdate=null};THREE.Texture.DEFAULT_IMAGE=void 0;THREE.Texture.DEFAULT_MAPPING=THREE.UVMapping;THREE.Texture.prototype={constructor:THREE.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(b){!0===b&&this.update();this._needsUpdate=b},clone:function(b){void 0===b&&(b=new THREE.Texture);b.image=this.image;b.mipmaps=this.mipmaps.slice(0);b.mapping=this.mapping;b.wrapS=this.wrapS;b.wrapT=this.wrapT;b.magFilter=this.magFilter;b.minFilter=this.minFilter;b.anisotropy=this.anisotropy;b.format=this.format;b.type=this.type;b.offset.copy(this.offset);b.repeat.copy(this.repeat);b.generateMipmaps=this.generateMipmaps;b.premultiplyAlpha=this.premultiplyAlpha;b.flipY=this.flipY;b.unpackAlignment=this.unpackAlignment;return b},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype);THREE.TextureIdCount=0;THREE.CubeTexture=function(s,r,q,p,o,n,m,l,i){r=void 0!==r?r:THREE.CubeReflectionMapping;THREE.Texture.call(this,s,r,q,p,o,n,m,l,i);this.images=s};THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CubeTexture.prototype.constructor=THREE.CubeTexture;THREE.CubeTexture.clone=function(b){void 0===b&&(b=new THREE.CubeTexture);THREE.Texture.prototype.clone.call(this,b);b.images=this.images;return b};THREE.CompressedTexture=function(A,v,u,t,s,r,q,o,n,m,i){THREE.Texture.call(this,null,r,q,o,n,m,t,s,i);this.image={width:v,height:u};this.mipmaps=A;this.generateMipmaps=this.flipY=!1};THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CompressedTexture.prototype.constructor=THREE.CompressedTexture;THREE.CompressedTexture.prototype.clone=function(){var b=new THREE.CompressedTexture;THREE.Texture.prototype.clone.call(this,b);return b};THREE.DataTexture=function(A,v,u,t,s,r,q,o,n,m,i){THREE.Texture.call(this,null,r,q,o,n,m,t,s,i);this.image={data:A,width:v,height:u}};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DataTexture.prototype.constructor=THREE.DataTexture;THREE.DataTexture.prototype.clone=function(){var b=new THREE.DataTexture;THREE.Texture.prototype.clone.call(this,b);return b};THREE.VideoTexture=function(A,v,u,t,s,r,q,o,n){THREE.Texture.call(this,A,v,u,t,s,r,q,o,n);this.generateMipmaps=!1;var m=this,i=function(){requestAnimationFrame(i);A.readyState===A.HAVE_ENOUGH_DATA&&(m.needsUpdate=!0)};i()};THREE.VideoTexture.prototype=Object.create(THREE.Texture.prototype);THREE.VideoTexture.prototype.constructor=THREE.VideoTexture;THREE.Group=function(){THREE.Object3D.call(this);this.type="Group"};THREE.Group.prototype=Object.create(THREE.Object3D.prototype);THREE.Group.prototype.constructor=THREE.Group;THREE.PointCloud=function(d,c){THREE.Object3D.call(this);this.type="PointCloud";this.geometry=void 0!==d?d:new THREE.Geometry;this.material=void 0!==c?c:new THREE.PointCloudMaterial({color:16777215*Math.random()})};THREE.PointCloud.prototype=Object.create(THREE.Object3D.prototype);THREE.PointCloud.prototype.constructor=THREE.PointCloud;THREE.PointCloud.prototype.raycast=function(){var d=new THREE.Matrix4,c=new THREE.Ray;return function(F,E){var D=this,C=D.geometry,B=F.params.PointCloud.threshold;d.getInverse(this.matrixWorld);c.copy(F.ray).applyMatrix4(d);if(null===C.boundingBox||!1!==c.isIntersectionBox(C.boundingBox)){var A=B/((this.scale.x+this.scale.y+this.scale.z)/3),v=new THREE.Vector3,B=function(e,p){var l=c.distanceToPoint(e);if(l<A){var h=c.closestPointToPoint(e);h.applyMatrix4(D.matrixWorld);var q=F.ray.origin.distanceTo(h);E.push({distance:q,distanceToRay:l,point:h.clone(),index:p,face:null,object:D})}};if(C instanceof THREE.BufferGeometry){var o=C.attributes,i=o.position.array;if(void 0!==o.index){var o=o.index.array,b=C.offsets;0===b.length&&(b=[{start:0,count:o.length,index:0}]);for(var m=0,H=b.length;m<H;++m){for(var a=b[m].start,I=b[m].index,C=a,a=a+b[m].count;C<a;C++){var G=I+o[C];v.fromArray(i,3*G);B(v,G)}}}else{for(o=i.length/3,C=0;C<o;C++){v.set(i[3*C],i[3*C+1],i[3*C+2]),B(v,C)}}}else{for(v=this.geometry.vertices,C=0;C<v.length;C++){B(v[C],C)}}}}}();THREE.PointCloud.prototype.clone=function(b){void 0===b&&(b=new THREE.PointCloud(this.geometry,this.material));THREE.Object3D.prototype.clone.call(this,b);return b};THREE.ParticleSystem=function(d,c){THREE.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud.");return new THREE.PointCloud(d,c)};THREE.Line=function(e,d,f){THREE.Object3D.call(this);this.type="Line";this.geometry=void 0!==e?e:new THREE.Geometry;this.material=void 0!==d?d:new THREE.LineBasicMaterial({color:16777215*Math.random()});this.mode=void 0!==f?f:THREE.LineStrip};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=Object.create(THREE.Object3D.prototype);THREE.Line.prototype.constructor=THREE.Line;THREE.Line.prototype.raycast=function(){var e=new THREE.Matrix4,d=new THREE.Ray,f=new THREE.Sphere;return function(G,F){var E=G.linePrecision,E=E*E,C=this.geometry;null===C.boundingSphere&&C.computeBoundingSphere();f.copy(C.boundingSphere);f.applyMatrix4(this.matrixWorld);if(!1!==G.ray.isIntersectionSphere(f)){e.getInverse(this.matrixWorld);d.copy(G.ray).applyMatrix4(e);var B=new THREE.Vector3,A=new THREE.Vector3,o=new THREE.Vector3,i=new THREE.Vector3,c=this.mode===THREE.LineStrip?1:2;if(C instanceof THREE.BufferGeometry){var m=C.attributes;if(void 0!==m.index){var K=m.index.array,m=m.position.array,b=C.offsets;0===b.length&&(b=[{start:0,count:K.length,index:0}]);for(var L=0;L<b.length;L++){for(var J=b[L].start,I=b[L].count,H=b[L].index,C=J;C<J+I-1;C+=c){var a=H+K[C+1];B.fromArray(m,3*(H+K[C]));A.fromArray(m,3*a);a=d.distanceSqToSegment(B,A,i,o);a>E||(a=d.origin.distanceTo(i),a<G.near||a>G.far||F.push({distance:a,point:o.clone().applyMatrix4(this.matrixWorld),index:C,offsetIndex:L,face:null,faceIndex:null,object:this}))}}}else{for(m=m.position.array,C=0;C<m.length/3-1;C+=c){B.fromArray(m,3*C),A.fromArray(m,3*C+3),a=d.distanceSqToSegment(B,A,i,o),a>E||(a=d.origin.distanceTo(i),a<G.near||a>G.far||F.push({distance:a,point:o.clone().applyMatrix4(this.matrixWorld),index:C,face:null,faceIndex:null,object:this}))}}}else{if(C instanceof THREE.Geometry){for(B=C.vertices,A=B.length,C=0;C<A-1;C+=c){a=d.distanceSqToSegment(B[C],B[C+1],i,o),a>E||(a=d.origin.distanceTo(i),a<G.near||a>G.far||F.push({distance:a,point:o.clone().applyMatrix4(this.matrixWorld),index:C,face:null,faceIndex:null,object:this}))}}}}}}();THREE.Line.prototype.clone=function(b){void 0===b&&(b=new THREE.Line(this.geometry,this.material,this.mode));THREE.Object3D.prototype.clone.call(this,b);return b};THREE.Mesh=function(d,c){THREE.Object3D.call(this);this.type="Mesh";this.geometry=void 0!==d?d:new THREE.Geometry;this.material=void 0!==c?c:new THREE.MeshBasicMaterial({color:16777215*Math.random()});this.updateMorphTargets()};THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype);THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var d=0,c=this.geometry.morphTargets.length;d<c;d++){this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[d].name]=d}}};THREE.Mesh.prototype.getMorphTargetIndexByName=function(b){if(void 0!==this.morphTargetDictionary[b]){return this.morphTargetDictionary[b]}THREE.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+b+" does not exist. Returning 0.");return 0};THREE.Mesh.prototype.raycast=function(){var h=new THREE.Matrix4,g=new THREE.Ray,m=new THREE.Sphere,l=new THREE.Vector3,k=new THREE.Vector3,i=new THREE.Vector3;return function(R,Q){var P=this.geometry;null===P.boundingSphere&&P.computeBoundingSphere();m.copy(P.boundingSphere);m.applyMatrix4(this.matrixWorld);if(!1!==R.ray.isIntersectionSphere(m)&&(h.getInverse(this.matrixWorld),g.copy(R.ray).applyMatrix4(h),null===P.boundingBox||!1!==g.isIntersectionBox(P.boundingBox))){if(P instanceof THREE.BufferGeometry){var O=this.material;if(void 0!==O){var M=P.attributes,K,N,C=R.precision;if(void 0!==M.index){var J=M.index.array,H=M.position.array,o=P.offsets;0===o.length&&(o=[{start:0,count:J.length,index:0}]);for(var e=0,b=o.length;e<b;++e){for(var M=o[e].start,I=o[e].index,P=M,c=M+o[e].count;P<c;P+=3){M=I+J[P];K=I+J[P+1];N=I+J[P+2];l.fromArray(H,3*M);k.fromArray(H,3*K);i.fromArray(H,3*N);var a=O.side===THREE.BackSide?g.intersectTriangle(i,k,l,!0):g.intersectTriangle(l,k,i,O.side!==THREE.DoubleSide);if(null!==a){a.applyMatrix4(this.matrixWorld);var L=R.ray.origin.distanceTo(a);L<C||L<R.near||L>R.far||Q.push({distance:L,point:a,face:new THREE.Face3(M,K,N,THREE.Triangle.normal(l,k,i)),faceIndex:null,object:this})}}}}else{for(H=M.position.array,J=P=0,c=H.length;P<c;P+=3,J+=9){M=P,K=P+1,N=P+2,l.fromArray(H,J),k.fromArray(H,J+3),i.fromArray(H,J+6),a=O.side===THREE.BackSide?g.intersectTriangle(i,k,l,!0):g.intersectTriangle(l,k,i,O.side!==THREE.DoubleSide),null!==a&&(a.applyMatrix4(this.matrixWorld),L=R.ray.origin.distanceTo(a),L<C||L<R.near||L>R.far||Q.push({distance:L,point:a,face:new THREE.Face3(M,K,N,THREE.Triangle.normal(l,k,i)),faceIndex:null,object:this}))}}}}else{if(P instanceof THREE.Geometry){for(J=this.material instanceof THREE.MeshFaceMaterial,H=!0===J?this.material.materials:null,C=R.precision,o=P.vertices,e=0,b=P.faces.length;e<b;e++){if(I=P.faces[e],O=!0===J?H[I.materialIndex]:this.material,void 0!==O){M=o[I.a];K=o[I.b];N=o[I.c];if(!0===O.morphTargets){a=P.morphTargets;L=this.morphTargetInfluences;l.set(0,0,0);k.set(0,0,0);i.set(0,0,0);for(var c=0,B=a.length;c<B;c++){var d=L[c];if(0!==d){var f=a[c].vertices;l.x+=(f[I.a].x-M.x)*d;l.y+=(f[I.a].y-M.y)*d;l.z+=(f[I.a].z-M.z)*d;k.x+=(f[I.b].x-K.x)*d;k.y+=(f[I.b].y-K.y)*d;k.z+=(f[I.b].z-K.z)*d;i.x+=(f[I.c].x-N.x)*d;i.y+=(f[I.c].y-N.y)*d;i.z+=(f[I.c].z-N.z)*d}}l.add(M);k.add(K);i.add(N);M=l;K=k;N=i}a=O.side===THREE.BackSide?g.intersectTriangle(N,K,M,!0):g.intersectTriangle(M,K,N,O.side!==THREE.DoubleSide);null!==a&&(a.applyMatrix4(this.matrixWorld),L=R.ray.origin.distanceTo(a),L<C||L<R.near||L>R.far||Q.push({distance:L,point:a,face:I,faceIndex:e,object:this}))}}}}}}}();THREE.Mesh.prototype.clone=function(d,c){void 0===d&&(d=new THREE.Mesh(this.geometry,this.material));THREE.Object3D.prototype.clone.call(this,d,c);return d};THREE.Bone=function(b){THREE.Object3D.call(this);this.type="Bone";this.skin=b};THREE.Bone.prototype=Object.create(THREE.Object3D.prototype);THREE.Bone.prototype.constructor=THREE.Bone;THREE.Skeleton=function(e,d,f){this.useVertexTexture=void 0!==f?f:!0;this.identityMatrix=new THREE.Matrix4;e=e||[];this.bones=e.slice(0);this.useVertexTexture?(this.boneTextureHeight=this.boneTextureWidth=e=256<this.bones.length?64:64<this.bones.length?32:16<this.bones.length?16:8,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType),this.boneTexture.minFilter=THREE.NearestFilter,this.boneTexture.magFilter=THREE.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===d){this.calculateInverses()}else{if(this.bones.length===d.length){this.boneInverses=d.slice(0)}else{for(THREE.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[],d=0,e=this.bones.length;d<e;d++){this.boneInverses.push(new THREE.Matrix4)}}}};THREE.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,d=this.bones.length;e<d;e++){var f=new THREE.Matrix4;this.bones[e]&&f.getInverse(this.bones[e].matrixWorld);this.boneInverses.push(f)}};THREE.Skeleton.prototype.pose=function(){for(var e,d=0,f=this.bones.length;d<f;d++){(e=this.bones[d])&&e.matrixWorld.getInverse(this.boneInverses[d])}d=0;for(f=this.bones.length;d<f;d++){if(e=this.bones[d]){e.parent?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale)}}};THREE.Skeleton.prototype.update=function(){var b=new THREE.Matrix4;return function(){for(var a=0,d=this.bones.length;a<d;a++){b.multiplyMatrices(this.bones[a]?this.bones[a].matrixWorld:this.identityMatrix,this.boneInverses[a]),b.flattenToArrayOffset(this.boneMatrices,16*a)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}();THREE.SkinnedMesh=function(s,r,q){THREE.Mesh.call(this,s,r);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new THREE.Matrix4;this.bindMatrixInverse=new THREE.Matrix4;s=[];if(this.geometry&&void 0!==this.geometry.bones){for(var p,o,n,m,l=0,i=this.geometry.bones.length;l<i;++l){p=this.geometry.bones[l],o=p.pos,n=p.rotq,m=p.scl,r=new THREE.Bone(this),s.push(r),r.name=p.name,r.position.set(o[0],o[1],o[2]),r.quaternion.set(n[0],n[1],n[2],n[3]),void 0!==m?r.scale.set(m[0],m[1],m[2]):r.scale.set(1,1,1)}l=0;for(i=this.geometry.bones.length;l<i;++l){p=this.geometry.bones[l],-1!==p.parent?s[p.parent].add(s[l]):this.add(s[l])}}this.normalizeSkinWeights();this.updateMatrixWorld(!0);this.bind(new THREE.Skeleton(s,void 0,q))};THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;THREE.SkinnedMesh.prototype.bind=function(d,c){this.skeleton=d;void 0===c&&(this.updateMatrixWorld(!0),c=this.matrixWorld);this.bindMatrix.copy(c);this.bindMatrixInverse.getInverse(c)};THREE.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()};THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry){for(var e=0;e<this.geometry.skinIndices.length;e++){var d=this.geometry.skinWeights[e],f=1/d.lengthManhattan();Infinity!==f?d.multiplyScalar(f):d.set(1)}}};THREE.SkinnedMesh.prototype.updateMatrixWorld=function(b){THREE.Mesh.prototype.updateMatrixWorld.call(this,!0);"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):THREE.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)};THREE.SkinnedMesh.prototype.clone=function(b){void 0===b&&(b=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture));THREE.Mesh.prototype.clone.call(this,b);return b};THREE.MorphAnimMesh=function(d,c){THREE.Mesh.call(this,d,c);this.type="MorphAnimMesh";this.duration=1000;this.mirroredLoop=!1;this.currentKeyframe=this.lastKeyframe=this.time=0;this.direction=1;this.directionBackwards=!1;this.setFrameRange(0,this.geometry.morphTargets.length-1)};THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphAnimMesh.prototype.constructor=THREE.MorphAnimMesh;THREE.MorphAnimMesh.prototype.setFrameRange=function(d,c){this.startKeyframe=d;this.endKeyframe=c;this.length=this.endKeyframe-this.startKeyframe+1};THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=!1};THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=!0};THREE.MorphAnimMesh.prototype.parseAnimations=function(){var k=this.geometry;k.animations||(k.animations={});for(var i,q=k.animations,p=/([a-z]+)_?(\d+)/,o=0,n=k.morphTargets.length;o<n;o++){var m=k.morphTargets[o].name.match(p);if(m&&1<m.length){m=m[1];q[m]||(q[m]={start:Infinity,end:-Infinity});var l=q[m];o<l.start&&(l.start=o);o>l.end&&(l.end=o);i||(i=m)}}k.firstAnimation=i};THREE.MorphAnimMesh.prototype.setAnimationLabel=function(e,d,f){this.geometry.animations||(this.geometry.animations={});this.geometry.animations[e]={start:d,end:f}};THREE.MorphAnimMesh.prototype.playAnimation=function(e,d){var f=this.geometry.animations[e];f?(this.setFrameRange(f.start,f.end),this.duration=(f.end-f.start)/d*1000,this.time=0):THREE.warn("THREE.MorphAnimMesh: animation["+e+"] undefined in .playAnimation()")};THREE.MorphAnimMesh.prototype.updateAnimation=function(d){var c=this.duration/this.length;this.time+=this.direction*d;if(this.mirroredLoop){if(this.time>this.duration||0>this.time){this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),0>this.time&&(this.time=0,this.directionBackwards=!1)}}else{this.time%=this.duration,0>this.time&&(this.time+=this.duration)}d=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/c),0,this.length-1);d!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[d]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=d);c=this.time%c/c;this.directionBackwards&&(c=1-c);this.morphTargetInfluences[this.currentKeyframe]=c;this.morphTargetInfluences[this.lastKeyframe]=1-c};THREE.MorphAnimMesh.prototype.interpolateTargets=function(h,g,m){for(var l=this.morphTargetInfluences,k=0,i=l.length;k<i;k++){l[k]=0}-1<h&&(l[h]=1-m);-1<g&&(l[g]=m)};THREE.MorphAnimMesh.prototype.clone=function(b){void 0===b&&(b=new THREE.MorphAnimMesh(this.geometry,this.material));b.duration=this.duration;b.mirroredLoop=this.mirroredLoop;b.time=this.time;b.lastKeyframe=this.lastKeyframe;b.currentKeyframe=this.currentKeyframe;b.direction=this.direction;b.directionBackwards=this.directionBackwards;THREE.Mesh.prototype.clone.call(this,b);return b};THREE.LOD=function(){THREE.Object3D.call(this);this.objects=[]};THREE.LOD.prototype=Object.create(THREE.Object3D.prototype);THREE.LOD.prototype.constructor=THREE.LOD;THREE.LOD.prototype.addLevel=function(e,d){void 0===d&&(d=0);d=Math.abs(d);for(var f=0;f<this.objects.length&&!(d<this.objects[f].distance);f++){}this.objects.splice(f,0,{distance:d,object:e});this.add(e)};THREE.LOD.prototype.getObjectForDistance=function(e){for(var d=1,f=this.objects.length;d<f&&!(e<this.objects[d].distance);d++){}return this.objects[d-1].object};THREE.LOD.prototype.raycast=function(){var b=new THREE.Vector3;return function(a,f){b.setFromMatrixPosition(this.matrixWorld);var e=a.ray.origin.distanceTo(b);this.getObjectForDistance(e).raycast(a,f)}}();THREE.LOD.prototype.update=function(){var d=new THREE.Vector3,c=new THREE.Vector3;return function(f){if(1<this.objects.length){d.setFromMatrixPosition(f.matrixWorld);c.setFromMatrixPosition(this.matrixWorld);f=d.distanceTo(c);this.objects[0].object.visible=!0;for(var b=1,a=this.objects.length;b<a;b++){if(f>=this.objects[b].distance){this.objects[b-1].object.visible=!1,this.objects[b].object.visible=!0}else{break}}for(;b<a;b++){this.objects[b].object.visible=!1}}}}();THREE.LOD.prototype.clone=function(f){void 0===f&&(f=new THREE.LOD);THREE.Object3D.prototype.clone.call(this,f);for(var e=0,h=this.objects.length;e<h;e++){var g=this.objects[e].object.clone();g.visible=0===e;f.addLevel(g,this.objects[e].distance)}return f};THREE.Sprite=function(){var f=new Uint16Array([0,1,2,0,2,3]),e=new Float32Array([-0.5,-0.5,0,0.5,-0.5,0,0.5,0.5,0,-0.5,0.5,0]),h=new Float32Array([0,0,1,0,1,1,0,1]),g=new THREE.BufferGeometry;g.addAttribute("index",new THREE.BufferAttribute(f,1));g.addAttribute("position",new THREE.BufferAttribute(e,3));g.addAttribute("uv",new THREE.BufferAttribute(h,2));return function(b){THREE.Object3D.call(this);this.type="Sprite";this.geometry=g;this.material=void 0!==b?b:new THREE.SpriteMaterial}}();THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype);THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.raycast=function(){var b=new THREE.Vector3;return function(a,f){b.setFromMatrixPosition(this.matrixWorld);var e=a.ray.distanceToPoint(b);e>this.scale.x||f.push({distance:e,point:this.position,face:null,object:this})}}();THREE.Sprite.prototype.clone=function(b){void 0===b&&(b=new THREE.Sprite(this.material));THREE.Object3D.prototype.clone.call(this,b);return b};THREE.Particle=THREE.Sprite;THREE.LensFlare=function(g,f,k,i,h){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3;this.customUpdateCallback=void 0;void 0!==g&&this.add(g,f,k,i,h)};THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype);THREE.LensFlare.prototype.constructor=THREE.LensFlare;THREE.LensFlare.prototype.add=function(h,g,m,l,k,i){void 0===g&&(g=-1);void 0===m&&(m=0);void 0===i&&(i=1);void 0===k&&(k=new THREE.Color(16777215));void 0===l&&(l=THREE.NormalBlending);m=Math.min(m,Math.max(0,m));this.lensFlares.push({texture:h,size:g,distance:m,x:0,y:0,z:0,scale:1,rotation:1,opacity:i,color:k,blending:l})};THREE.LensFlare.prototype.updateLensFlares=function(){var g,f=this.lensFlares.length,k,i=2*-this.positionScreen.x,h=2*-this.positionScreen.y;for(g=0;g<f;g++){k=this.lensFlares[g],k.x=this.positionScreen.x+i*k.distance,k.y=this.positionScreen.y+h*k.distance,k.wantedRotation=k.x*Math.PI*0.25,k.rotation+=0.25*(k.wantedRotation-k.rotation)}};THREE.Scene=function(){THREE.Object3D.call(this);this.type="Scene";this.overrideMaterial=this.fog=null;this.autoUpdate=!0};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.clone=function(b){void 0===b&&(b=new THREE.Scene);THREE.Object3D.prototype.clone.call(this,b);null!==this.fog&&(b.fog=this.fog.clone());null!==this.overrideMaterial&&(b.overrideMaterial=this.overrideMaterial.clone());b.autoUpdate=this.autoUpdate;b.matrixAutoUpdate=this.matrixAutoUpdate;return b};THREE.Fog=function(e,d,f){this.name="";this.color=new THREE.Color(e);this.near=void 0!==d?d:1;this.far=void 0!==f?f:1000};THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)};THREE.FogExp2=function(d,c){this.name="";this.color=new THREE.Color(d);this.density=void 0!==c?c:0.00025};THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)};THREE.ShaderChunk={};THREE.ShaderChunk.common="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\nfloat square( in float a ) { return a*a; }\nvec2  square( in vec2 a )  { return vec2( a.x*a.x, a.y*a.y ); }\nvec3  square( in vec3 a )  { return vec3( a.x*a.x, a.y*a.y, a.z*a.z ); }\nvec4  square( in vec4 a )  { return vec4( a.x*a.x, a.y*a.y, a.z*a.z, a.w*a.w ); }\nfloat saturate( in float a ) { return clamp( a, 0.0, 1.0 ); }\nvec2  saturate( in vec2 a )  { return clamp( a, 0.0, 1.0 ); }\nvec3  saturate( in vec3 a )  { return clamp( a, 0.0, 1.0 ); }\nvec4  saturate( in vec4 a )  { return clamp( a, 0.0, 1.0 ); }\nfloat average( in float a ) { return a; }\nfloat average( in vec2 a )  { return ( a.x + a.y) * 0.5; }\nfloat average( in vec3 a )  { return ( a.x + a.y + a.z) / 3.0; }\nfloat average( in vec4 a )  { return ( a.x + a.y + a.z + a.w) * 0.25; }\nfloat whiteCompliment( in float a ) { return saturate( 1.0 - a ); }\nvec2  whiteCompliment( in vec2 a )  { return saturate( vec2(1.0) - a ); }\nvec3  whiteCompliment( in vec3 a )  { return saturate( vec3(1.0) - a ); }\nvec4  whiteCompliment( in vec4 a )  { return saturate( vec4(1.0) - a ); }\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n}\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal) {\n\tfloat distance = dot( planeNormal, point-pointOnPlane );\n\treturn point - distance * planeNormal;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn pointOnLine + lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) );\n}\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n\tif ( decayExponent > 0.0 ) {\n\t  return pow( saturate( 1.0 - lightDistance / cutoffDistance ), decayExponent );\n\t}\n\treturn 1.0;\n}\n\nvec3 inputToLinear( in vec3 a ) {\n#ifdef GAMMA_INPUT\n\treturn pow( a, vec3( float( GAMMA_FACTOR ) ) );\n#else\n\treturn a;\n#endif\n}\nvec3 linearToOutput( in vec3 a ) {\n#ifdef GAMMA_OUTPUT\n\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n#else\n\treturn a;\n#endif\n}\n";THREE.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n";THREE.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n\tfloat dotProduct = dot( transformedNormal, dirVector );\n\tvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t#endif\n\n\t#endif\n\n\t#ifdef WRAP_AROUND\n\n\t\tvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\tdirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tdirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n\t\t#endif\n\n\t#endif\n\n\tvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n\t#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\tpointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tpointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\tvLightFront += pointLightColor[ i ] * pointLightWeighting * attenuation;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += pointLightColor[ i ] * pointLightWeightingBack * attenuation;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\t\tlVector = normalize( lVector );\n\n\t\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\t\t\tvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\t\tvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\t\tspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n\t\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\t\tspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvLightFront += spotLightColor[ i ] * spotLightWeighting * attenuation * spotEffect;\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvLightBack += spotLightColor[ i ] * spotLightWeightingBack * attenuation * spotEffect;\n\n\t\t\t#endif\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\t\tfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n\t\t#endif\n\n\t}\n\n#endif\n\nvLightFront += ambientLightColor;\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack += ambientLightColor;\n\n#endif\n";THREE.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n\n#endif\n";THREE.ShaderChunk.default_vertex="#ifdef USE_SKINNING\n\n\tvec4 mvPosition = modelViewMatrix * skinned;\n\n#elif defined( USE_MORPHTARGETS )\n\n\tvec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#else\n\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n";THREE.ShaderChunk.map_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif";THREE.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\t#ifdef USE_MORPHNORMALS\n\n\tvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n\t#else\n\n\tvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n\tuniform float logDepthBufFC;\n\n#endif";THREE.ShaderChunk.lightmap_pars_vertex="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\n#endif";THREE.ShaderChunk.lights_phong_fragment="#ifndef FLAT_SHADED\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n\t#endif\n\n#else\n\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef USE_NORMALMAP\n\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\ttotalDiffuseLight += pointLightColor[ i ] * pointDiffuseWeight * attenuation;\n\n\t\t\t\t// specular\n\n\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\n\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * attenuation * specularNormalization;\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\t// diffuse\n\n\t\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n\t\t\t#else\n\n\t\t\t\tfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t\t#endif\n\n\t\t\ttotalDiffuseLight += spotLightColor[ i ] * spotDiffuseWeight * attenuation * spotEffect;\n\n\t\t\t// specular\n\n\t\t\tvec3 spotHalfVector = normalize( lVector + viewPosition );\n\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n\t\t\tfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n\t\t\ttotalSpecularLight += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * attenuation * specularNormalization * spotEffect;\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, dirVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\ttotalDiffuseLight += directionalLightColor[ i ] * dirDiffuseWeight;\n\n\t\t// specular\n\n\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\n\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n\t\t/*\n\t\t// fresnel term from skin shader\n\t\tconst float F0 = 0.128;\n\n\t\tfloat base = 1.0 - dot( viewPosition, dirHalfVector );\n\t\tfloat exponential = pow( base, 5.0 );\n\n\t\tfloat fresnel = exponential + F0 * ( 1.0 - exponential );\n\t\t*/\n\n\t\t/*\n\t\t// fresnel term from fresnel shader\n\t\tconst float mFresnelBias = 0.08;\n\t\tconst float mFresnelScale = 0.3;\n\t\tconst float mFresnelPower = 5.0;\n\n\t\tfloat fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n\t\t*/\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t// \t\tdirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\ttotalDiffuseLight += hemiColor;\n\n\t\t// specular (sky light)\n\n\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n\t\tfloat hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n\t\t// specular (ground light)\n\n\t\tvec3 lVectorGround = -lVector;\n\n\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n\t\tfloat hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n\t\tfloat dotProductGround = dot( normal, lVectorGround );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n\t}\n\n#endif\n\n#ifdef METAL\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) * specular + totalSpecularLight + emissive;\n\n#else\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) + totalSpecularLight + emissive;\n\n#endif\n";THREE.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n\n#endif";THREE.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n\tvec3 morphedNormal = vec3( 0.0 );\n\n\tmorphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tmorphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tmorphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tmorphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n\tmorphedNormal += normal;\n\n#endif";THREE.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tuniform float refractionRatio;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif";THREE.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n";THREE.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n";THREE.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\tuniform sampler2D lightMap;\n\n#endif";THREE.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n\t}\n\n#endif";THREE.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif";THREE.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor.xyz = inputToLinear( texelColor.xyz );\n\n\tdiffuseColor *= texelColor;\n\n#endif";THREE.ShaderChunk.lightmap_vertex="#ifdef USE_LIGHTMAP\n\n\tvUv2 = uv2;\n\n#endif";THREE.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n\tdiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n";THREE.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n";THREE.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n\tvColor.xyz = inputToLinear( color.xyz );\n\n#endif";THREE.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n\t#ifdef USE_MORPHTARGETS\n\n\tvec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n\n#endif\n";THREE.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvarying vec3 vReflect;\n\n\tuniform float refractionRatio;\n\n#endif\n";THREE.ShaderChunk.linear_to_gamma_fragment="\n\toutgoingLight = linearToOutput( outgoingLight );\n";THREE.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif";THREE.ShaderChunk.lights_lambert_pars_vertex="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n";THREE.ShaderChunk.map_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n\n#endif\n";THREE.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\t#else\n\t\tfloat flipNormal = 1.0;\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#endif\n\n\tenvColor.xyz = inputToLinear( envColor.xyz );\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif";THREE.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n\t#endif\n\n#endif";THREE.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif";THREE.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif";THREE.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t#else\n\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t#endif\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = exp2( - square( fogDensity ) * square( depth ) * LOG2 );\n\t\tfogFactor = whiteCompliment( fogFactor );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\n\t#endif\n\t\n\toutgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif";THREE.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n\t// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n";THREE.ShaderChunk.defaultnormal_vertex="#ifdef USE_SKINNING\n\n\tvec3 objectNormal = skinnedNormal.xyz;\n\n#elif defined( USE_MORPHNORMALS )\n\n\tvec3 objectNormal = morphedNormal;\n\n#else\n\n\tvec3 objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n\tobjectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n";THREE.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n";THREE.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif";THREE.ShaderChunk.map_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif";THREE.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n\toutgoingLight *= diffuseColor.xyz * texture2D( lightMap, vUv2 ).xyz;\n\n#endif";THREE.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif";THREE.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif";THREE.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n\tvec3 morphed = vec3( 0.0 );\n\tmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\tmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\tmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\tmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\tmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\tmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\tmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\tmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n\tmorphed += position;\n\n#endif";THREE.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvec3 worldNormal = transformDirection( objectNormal, modelMatrix );\n\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t#else\n\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n\t#ifdef SHADOWMAP_DEBUG\n\n\t\tvec3 frustumColors[3];\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n\t#endif\n\n\t#ifdef SHADOWMAP_CASCADE\n\n\t\tint inFrustumCount = 0;\n\n\t#endif\n\n\tfloat fDepth;\n\tvec3 shadowColor = vec3( 1.0 );\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\t\t\t// don't shadow pixels outside of light frustum\n\t\t\t\t// use just first frustum (for cascades)\n\t\t\t\t// don't shadow pixels behind far plane of light frustum\n\n\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\tinFrustumCount += int( inFrustum );\n\t\t\tbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n\t\t#else\n\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\t#endif\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t\tshadowCoord.z += shadowBias[ i ];\n\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t/*\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n\t\t\t\t\t\t// must enroll loop manually\n\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\n\t\t\t\t\t\t\tshadow += 1.0;\n\n\t\t\t\t}\n\n\t\t\t\tshadow /= 9.0;\n\n\t\t*/\n\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\n\n\t\t\t\tmat3 shadowKernel;\n\t\t\t\tmat3 depthKernel;\n\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\n\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n\t\t\t\tvec4 shadowValues;\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#else\n\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\tif ( fDepth < shadowCoord.z )\n\n\t\t// spot with multiple shadows is darker\n\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n\t\t// spot with multiple shadows has the same color as single shadow spot\n\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n\t\t\t#endif\n\n\t\t}\n\n\n\t\t#ifdef SHADOWMAP_DEBUG\n\n\t\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\t\tif ( inFrustum && inFrustumCount == 1 ) outgoingLight *= frustumColors[ i ];\n\n\t\t\t#else\n\n\t\t\t\tif ( inFrustum ) outgoingLight *= frustumColors[ i ];\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t}\n\n\t// NOTE: I am unsure if this is correct in linear space.  -bhouston, Dec 29, 2014\n\tshadowColor = inputToLinear( shadowColor );\n\n\toutgoingLight = outgoingLight * shadowColor;\n\n#endif\n";THREE.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n\t#ifdef USE_SKINNING\n\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\n\t#elif defined( USE_MORPHTARGETS )\n\n\t\tvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\n\tuniform float shadowBias[ MAX_SHADOWS ];\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\n\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\tfloat depth = dot( rgba_depth, bit_shift );\n\t\treturn depth;\n\n\t}\n\n#endif";THREE.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n\tuniform float logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\t#extension GL_EXT_frag_depth : enable\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n#endif";THREE.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n";THREE.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n";THREE.UniformsUtils={merge:function(g){for(var f={},k=0;k<g.length;k++){var i=this.clone(g[k]),h;for(h in i){f[h]=i[h]}}return f},clone:function(g){var f={},k;for(k in g){f[k]={};for(var i in g[k]){var h=g[k][i];f[k][i]=h instanceof THREE.Color||h instanceof THREE.Vector2||h instanceof THREE.Vector3||h instanceof THREE.Vector4||h instanceof THREE.Matrix4||h instanceof THREE.Texture?h.clone():h instanceof Array?h.slice():h}}return f}};THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:0.00025},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2000},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},fogDensity:{type:"f",value:0.00025},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2000},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}};THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"\t#ifdef USE_ENVMAP",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"\t#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"\toutgoingLight = diffuseColor.rgb;",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"\t#ifdef DOUBLE_SIDED\n\t\tif ( gl_FrontFacing )\n\t\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;\n\t\telse\n\t\t\toutgoingLight += diffuseColor.rgb * vLightBack + emissive;\n\t#else\n\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;\n\t#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"\tvViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\tgl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( psColor, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphatest_fragment,"\toutgoingLight = diffuseColor.rgb;",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.color_fragment,"\toutgoingLight = diffuseColor.rgb;",THREE.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2000},opacity:{type:"f",value:1}},vertexShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;\nuniform float mFar;\nuniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );\n\tgl_FragColor = vec4( vec3( color ), opacity );\n}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk.common,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n\tvNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vNormal;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\nvec3 direction = normalize( vWorldPosition );\nvec2 sampleUV;\nsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\nsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\ngl_FragColor = texture2D( tEquirect, sampleUV );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {\n\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\n\tres -= res.xxyz * bit_mask;\n\treturn res;\n}\nvoid main() {",THREE.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );\n\t#else\n\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n\t#endif\n}"].join("\n")}};THREE.WebGLRenderer=function(aW){function aU(h){var g=h.geometry;h=h.material;var n=g.vertices.length;if(h.attributes){void 0===g.__webglCustomAttributesList&&(g.__webglCustomAttributesList=[]);for(var m in h.attributes){var l=h.attributes[m];if(!l.__webglInitialized||l.createUniqueBuffers){l.__webglInitialized=!0;var k=1;"v2"===l.type?k=2:"v3"===l.type?k=3:"v4"===l.type?k=4:"c"===l.type&&(k=3);l.size=k;l.array=new Float32Array(n*k);l.buffer=aG.createBuffer();l.buffer.belongsToAttribute=m;l.needsUpdate=!0}g.__webglCustomAttributesList.push(l)}}}function aT(d,c){return d.material instanceof THREE.MeshFaceMaterial?d.material.materials[c.materialIndex]:d.material}function aR(A,v,u,t){u=u.attributes;var s=v.attributes;v=v.attributesKeys;for(var r=0,q=v.length;r<q;r++){var p=v[r],m=s[p];if(0<=m){var l=u[p];void 0!==l?(p=l.itemSize,aG.bindBuffer(aG.ARRAY_BUFFER,l.buffer),a1.enableAttribute(m),aG.vertexAttribPointer(m,p,aG.FLOAT,!1,0,t*p*4)):void 0!==A.defaultAttributeValues&&(2===A.defaultAttributeValues[p].length?aG.vertexAttrib2fv(m,A.defaultAttributeValues[p]):3===A.defaultAttributeValues[p].length&&aG.vertexAttrib3fv(m,A.defaultAttributeValues[p]))}}a1.disableUnusedAttributes()}function aP(d,c){return d.object.renderOrder!==c.object.renderOrder?d.object.renderOrder-c.object.renderOrder:d.material.id!==c.material.id?d.material.id-c.material.id:d.z!==c.z?d.z-c.z:d.id-c.id}function aO(d,c){return d.object.renderOrder!==c.object.renderOrder?d.object.renderOrder-c.object.renderOrder:d.z!==c.z?c.z-d.z:d.id-c.id}function aM(d,c){return c[0]-d[0]}function aL(u){if(!1!==u.visible){if(!(u instanceof THREE.Scene||u instanceof THREE.Group)){void 0===u.__webglInit&&(u.__webglInit=!0,u._modelViewMatrix=new THREE.Matrix4,u._normalMatrix=new THREE.Matrix3,u.addEventListener("removed",Y));var t=u.geometry;if(void 0!==t&&void 0===t.__webglInit){if(t.__webglInit=!0,t.addEventListener("dispose",ag),t instanceof THREE.BufferGeometry){bp.info.memory.geometries++}else{if(u instanceof THREE.Mesh){aB(u,t)}else{if(u instanceof THREE.Line){if(void 0===t.__webglVertexBuffer){t.__webglVertexBuffer=aG.createBuffer();t.__webglColorBuffer=aG.createBuffer();t.__webglLineDistanceBuffer=aG.createBuffer();bp.info.memory.geometries++;var s=t.vertices.length;t.__vertexArray=new Float32Array(3*s);t.__colorArray=new Float32Array(3*s);t.__lineDistanceArray=new Float32Array(1*s);t.__webglLineCount=s;aU(u);t.verticesNeedUpdate=!0;t.colorsNeedUpdate=!0;t.lineDistancesNeedUpdate=!0}}else{u instanceof THREE.PointCloud&&void 0===t.__webglVertexBuffer&&(t.__webglVertexBuffer=aG.createBuffer(),t.__webglColorBuffer=aG.createBuffer(),bp.info.memory.geometries++,s=t.vertices.length,t.__vertexArray=new Float32Array(3*s),t.__colorArray=new Float32Array(3*s),t.__webglParticleCount=s,aU(u),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0)}}}}if(void 0===u.__webglActive){if(u.__webglActive=!0,u instanceof THREE.Mesh){if(t instanceof THREE.BufferGeometry){aE(a7,t,u)}else{if(t instanceof THREE.Geometry){for(var t=bu[t.id],s=0,r=t.length;s<r;s++){aE(a7,t[s],u)}}}}else{u instanceof THREE.Line||u instanceof THREE.PointCloud?aE(a7,t,u):(u instanceof THREE.ImmediateRenderObject||u.immediateRenderCallback)&&T.push({id:null,object:u,opaque:null,transparent:null,z:0})}}if(u instanceof THREE.Light){aF.push(u)}else{if(u instanceof THREE.Sprite){ac.push(u)}else{if(u instanceof THREE.LensFlare){C.push(u)}else{if((t=a7[u.id])&&(!1===u.frustumCulled||!0===aD.intersectsObject(u))){for(s=0,r=t.length;s<r;s++){var q=t[s],n=q,m=n.object,h=n.buffer,b=m.geometry,m=m.material;m instanceof THREE.MeshFaceMaterial?(m=m.materials[b instanceof THREE.BufferGeometry?0:h.materialIndex],n.material=m,m.transparent?ap.push(n):al.push(n)):m&&(n.material=m,m.transparent?ap.push(n):al.push(n));q.render=!0;!0===bp.sortObjects&&(Z.setFromMatrixPosition(u.matrixWorld),Z.applyProjection(ad),q.z=Z.z)}}}}}}s=0;for(r=u.children.length;s<r;s++){aL(u.children[s])}}}function aJ(A,v,u,t,s){for(var r,q=0,p=A.length;q<p;q++){r=A[q];var n=r.object,l=r.buffer;av(n,v);if(s){r=s}else{r=r.material;if(!r){continue}ax(r)}bp.setMaterialFaces(r);l instanceof THREE.BufferGeometry?bp.renderBufferDirect(v,u,t,r,l,n):bp.renderBuffer(v,u,t,r,l,n)}}function aH(A,v,u,t,s,r){for(var q,p=0,n=A.length;p<n;p++){q=A[p];var l=q.object;if(l.visible){if(r){q=r}else{q=q[v];if(!q){continue}ax(q)}bp.renderImmediateObject(u,t,s,q,l)}}}function aC(d){var c=d.object.material;c.transparent?(d.transparent=c,d.opaque=null):(d.opaque=c,d.transparent=null)}function aB(J,I){var H=J.material,G=!1;if(void 0===bu[I.id]||!0===I.groupsNeedUpdate){delete a7[J.id];for(var F=bu,E=I.id,H=H instanceof THREE.MeshFaceMaterial,D=ae.get("OES_element_index_uint")?4294967296:65535,B,G={},A=I.morphTargets.length,n=I.morphNormals.length,m,P={},O=[],c=0,L=I.faces.length;c<L;c++){B=I.faces[c];var N=H?B.materialIndex:0;N in G||(G[N]={hash:N,counter:0});B=G[N].hash+"_"+G[N].counter;B in P||(m={id:ao++,faces3:[],materialIndex:N,vertices:0,numMorphTargets:A,numMorphNormals:n},P[B]=m,O.push(m));P[B].vertices+3>D&&(G[N].counter+=1,B=G[N].hash+"_"+G[N].counter,B in P||(m={id:ao++,faces3:[],materialIndex:N,vertices:0,numMorphTargets:A,numMorphNormals:n},P[B]=m,O.push(m)));P[B].faces3.push(c);P[B].vertices+=3}F[E]=O;I.groupsNeedUpdate=!1}F=bu[I.id];E=0;for(H=F.length;E<H;E++){D=F[E];if(void 0===D.__webglVertexBuffer){G=D;G.__webglVertexBuffer=aG.createBuffer();G.__webglNormalBuffer=aG.createBuffer();G.__webglTangentBuffer=aG.createBuffer();G.__webglColorBuffer=aG.createBuffer();G.__webglUVBuffer=aG.createBuffer();G.__webglUV2Buffer=aG.createBuffer();G.__webglSkinIndicesBuffer=aG.createBuffer();G.__webglSkinWeightsBuffer=aG.createBuffer();G.__webglFaceBuffer=aG.createBuffer();G.__webglLineBuffer=aG.createBuffer();if(n=G.numMorphTargets){for(G.__webglMorphTargetsBuffers=[],A=0;A<n;A++){G.__webglMorphTargetsBuffers.push(aG.createBuffer())}}if(n=G.numMorphNormals){for(G.__webglMorphNormalsBuffers=[],A=0;A<n;A++){G.__webglMorphNormalsBuffers.push(aG.createBuffer())}}bp.info.memory.geometries++;G=D;c=J;L=c.geometry;n=G.faces3;A=3*n.length;P=1*n.length;O=3*n.length;n=aT(c,G);G.__vertexArray=new Float32Array(3*A);G.__normalArray=new Float32Array(3*A);G.__colorArray=new Float32Array(3*A);G.__uvArray=new Float32Array(2*A);1<L.faceVertexUvs.length&&(G.__uv2Array=new Float32Array(2*A));L.hasTangents&&(G.__tangentArray=new Float32Array(4*A));c.geometry.skinWeights.length&&c.geometry.skinIndices.length&&(G.__skinIndexArray=new Float32Array(4*A),G.__skinWeightArray=new Float32Array(4*A));c=null!==ae.get("OES_element_index_uint")&&21845<P?Uint32Array:Uint16Array;G.__typeArray=c;G.__faceArray=new c(3*P);G.__lineArray=new c(2*O);if(L=G.numMorphTargets){for(G.__morphTargetsArrays=[],c=0;c<L;c++){G.__morphTargetsArrays.push(new Float32Array(3*A))}}if(L=G.numMorphNormals){for(G.__morphNormalsArrays=[],c=0;c<L;c++){G.__morphNormalsArrays.push(new Float32Array(3*A))}}G.__webglFaceCount=3*P;G.__webglLineCount=2*O;if(n.attributes){for(P in void 0===G.__webglCustomAttributesList&&(G.__webglCustomAttributesList=[]),P=void 0,n.attributes){var O=n.attributes[P],c={},M;for(M in O){c[M]=O[M]}if(!c.__webglInitialized||c.createUniqueBuffers){c.__webglInitialized=!0,L=1,"v2"===c.type?L=2:"v3"===c.type?L=3:"v4"===c.type?L=4:"c"===c.type&&(L=3),c.size=L,c.array=new Float32Array(A*L),c.buffer=aG.createBuffer(),c.buffer.belongsToAttribute=P,O.needsUpdate=!0,c.__original=O}G.__webglCustomAttributesList.push(c)}}G.__inittedArrays=!0;I.verticesNeedUpdate=!0;I.morphTargetsNeedUpdate=!0;I.elementsNeedUpdate=!0;I.uvsNeedUpdate=!0;I.normalsNeedUpdate=!0;I.tangentsNeedUpdate=!0;G=I.colorsNeedUpdate=!0}else{G=!1}(G||void 0===J.__webglActive)&&aE(a7,D,J)}J.__webglActive=!0}function aE(f,e,h){var g=h.id;f[g]=f[g]||[];f[g].push({id:g,buffer:e,object:h,material:null,z:0})}function ay(c8){var c7=c8.geometry;if(c7 instanceof THREE.BufferGeometry){for(var c6=c7.attributes,c5=c7.attributesKeys,c3=0,c1=c5.length;c3<c1;c3++){var cZ=c5[c3],cY=c6[cZ],cW="index"===cZ?aG.ELEMENT_ARRAY_BUFFER:aG.ARRAY_BUFFER;void 0===cY.buffer?(cY.buffer=aG.createBuffer(),aG.bindBuffer(cW,cY.buffer),aG.bufferData(cW,cY.array,cY instanceof THREE.DynamicBufferAttribute?aG.DYNAMIC_DRAW:aG.STATIC_DRAW),cY.needsUpdate=!1):!0===cY.needsUpdate&&(aG.bindBuffer(cW,cY.buffer),void 0===cY.updateRange||-1===cY.updateRange.count?aG.bufferSubData(cW,0,cY.array):0===cY.updateRange.count?console.error("THREE.WebGLRenderer.updateObject: using updateRange for THREE.DynamicBufferAttribute and marked as needsUpdate but count is 0, ensure you are using set methods or updating manually."):(aG.bufferSubData(cW,cY.updateRange.offset*cY.array.BYTES_PER_ELEMENT,cY.array.subarray(cY.updateRange.offset,cY.updateRange.offset+cY.updateRange.count)),cY.updateRange.count=0),cY.needsUpdate=!1)}}else{if(c8 instanceof THREE.Mesh){!0===c7.groupsNeedUpdate&&aB(c8,c7);for(var cX=bu[c7.id],c3=0,cV=cX.length;c3<cV;c3++){var cT=cX[c3],cQ=aT(c8,cT),cS=cQ.attributes&&aA(cQ);if(c7.verticesNeedUpdate||c7.morphTargetsNeedUpdate||c7.elementsNeedUpdate||c7.uvsNeedUpdate||c7.normalsNeedUpdate||c7.colorsNeedUpdate||c7.tangentsNeedUpdate||cS){var cR=cT,cP=c8,dI=aG.DYNAMIC_DRAW,dL=!c7.dynamic,dH=cQ;if(cR.__inittedArrays){var dE=!1===dH instanceof THREE.MeshPhongMaterial&&dH.shading===THREE.FlatShading,cO=void 0,cM=void 0,dG=void 0,dK=void 0,dA=void 0,dC=void 0,dw=void 0,dq=void 0,dt=void 0,dl=void 0,du=void 0,dz=void 0,dx=void 0,dv=void 0,cK=void 0,dk=void 0,dj=void 0,bU=void 0,cx=void 0,cF=void 0,cI=void 0,dF=void 0,bT=void 0,b2=void 0,bL=void 0,ds=void 0,b8=void 0,b0=void 0,de=void 0,dh=void 0,b3=void 0,cN=void 0,dW=void 0,df=void 0,c4=void 0,cE=void 0,b6=void 0,cf=void 0,dR=void 0,bP=void 0,cC=0,cu=0,bK=0,d5=0,dT=0,bN=0,cq=0,cz=0,d0=0,m=0,cw=0,dy=0,dU=void 0,r=cR.__vertexArray,cp=cR.__uvArray,c=cR.__uv2Array,cm=cR.__normalArray,co=cR.__tangentArray,bY=cR.__colorArray,bR=cR.__skinIndexArray,bJ=cR.__skinWeightArray,d7=cR.__morphTargetsArrays,cg=cR.__morphNormalsArrays,d1=cR.__webglCustomAttributesList,dJ=void 0,dr=cR.__faceArray,d4=cR.__lineArray,cA=cP.geometry,cr=cA.elementsNeedUpdate,bV=cA.uvsNeedUpdate,ct=cA.normalsNeedUpdate,b9=cA.tangentsNeedUpdate,bZ=cA.colorsNeedUpdate,cn=cA.morphTargetsNeedUpdate,b5=cA.vertices,dY=cR.faces3,s=cA.faces,dZ=cA.faceVertexUvs[0],cd=cA.faceVertexUvs[1],dN=cA.skinIndices,d8=cA.skinWeights,dQ=cA.morphTargets,dD=cA.morphNormals;if(cA.verticesNeedUpdate){cO=0;for(cM=dY.length;cO<cM;cO++){dK=s[dY[cO]],dz=b5[dK.a],dx=b5[dK.b],dv=b5[dK.c],r[cu]=dz.x,r[cu+1]=dz.y,r[cu+2]=dz.z,r[cu+3]=dx.x,r[cu+4]=dx.y,r[cu+5]=dx.z,r[cu+6]=dv.x,r[cu+7]=dv.y,r[cu+8]=dv.z,cu+=9}aG.bindBuffer(aG.ARRAY_BUFFER,cR.__webglVertexBuffer);aG.bufferData(aG.ARRAY_BUFFER,r,dI)}if(cn){for(c4=0,cE=dQ.length;c4<cE;c4++){cO=cw=0;for(cM=dY.length;cO<cM;cO++){dR=dY[cO],dK=s[dR],dz=dQ[c4].vertices[dK.a],dx=dQ[c4].vertices[dK.b],dv=dQ[c4].vertices[dK.c],b6=d7[c4],b6[cw]=dz.x,b6[cw+1]=dz.y,b6[cw+2]=dz.z,b6[cw+3]=dx.x,b6[cw+4]=dx.y,b6[cw+5]=dx.z,b6[cw+6]=dv.x,b6[cw+7]=dv.y,b6[cw+8]=dv.z,dH.morphNormals&&(dE?cF=cx=bU=dD[c4].faceNormals[dR]:(bP=dD[c4].vertexNormals[dR],bU=bP.a,cx=bP.b,cF=bP.c),cf=cg[c4],cf[cw]=bU.x,cf[cw+1]=bU.y,cf[cw+2]=bU.z,cf[cw+3]=cx.x,cf[cw+4]=cx.y,cf[cw+5]=cx.z,cf[cw+6]=cF.x,cf[cw+7]=cF.y,cf[cw+8]=cF.z),cw+=9}aG.bindBuffer(aG.ARRAY_BUFFER,cR.__webglMorphTargetsBuffers[c4]);aG.bufferData(aG.ARRAY_BUFFER,d7[c4],dI);dH.morphNormals&&(aG.bindBuffer(aG.ARRAY_BUFFER,cR.__webglMorphNormalsBuffers[c4]),aG.bufferData(aG.ARRAY_BUFFER,cg[c4],dI))}}if(d8.length){cO=0;for(cM=dY.length;cO<cM;cO++){dK=s[dY[cO]],b2=d8[dK.a],bL=d8[dK.b],ds=d8[dK.c],bJ[m]=b2.x,bJ[m+1]=b2.y,bJ[m+2]=b2.z,bJ[m+3]=b2.w,bJ[m+4]=bL.x,bJ[m+5]=bL.y,bJ[m+6]=bL.z,bJ[m+7]=bL.w,bJ[m+8]=ds.x,bJ[m+9]=ds.y,bJ[m+10]=ds.z,bJ[m+11]=ds.w,b8=dN[dK.a],b0=dN[dK.b],de=dN[dK.c],bR[m]=b8.x,bR[m+1]=b8.y,bR[m+2]=b8.z,bR[m+3]=b8.w,bR[m+4]=b0.x,bR[m+5]=b0.y,bR[m+6]=b0.z,bR[m+7]=b0.w,bR[m+8]=de.x,bR[m+9]=de.y,bR[m+10]=de.z,bR[m+11]=de.w,m+=12}0<m&&(aG.bindBuffer(aG.ARRAY_BUFFER,cR.__webglSkinIndicesBuffer),aG.bufferData(aG.ARRAY_BUFFER,bR,dI),aG.bindBuffer(aG.ARRAY_BUFFER,cR.__webglSkinWeightsBuffer),aG.bufferData(aG.ARRAY_BUFFER,bJ,dI))}if(bZ){cO=0;for(cM=dY.length;cO<cM;cO++){dK=s[dY[cO]],dw=dK.vertexColors,dq=dK.color,3===dw.length&&dH.vertexColors===THREE.VertexColors?(cI=dw[0],dF=dw[1],bT=dw[2]):bT=dF=cI=dq,bY[d0]=cI.r,bY[d0+1]=cI.g,bY[d0+2]=cI.b,bY[d0+3]=dF.r,bY[d0+4]=dF.g,bY[d0+5]=dF.b,bY[d0+6]=bT.r,bY[d0+7]=bT.g,bY[d0+8]=bT.b,d0+=9}0<d0&&(aG.bindBuffer(aG.ARRAY_BUFFER,cR.__webglColorBuffer),aG.bufferData(aG.ARRAY_BUFFER,bY,dI))}if(b9&&cA.hasTangents){cO=0;for(cM=dY.length;cO<cM;cO++){dK=s[dY[cO]],dt=dK.vertexTangents,cK=dt[0],dk=dt[1],dj=dt[2],co[cq]=cK.x,co[cq+1]=cK.y,co[cq+2]=cK.z,co[cq+3]=cK.w,co[cq+4]=dk.x,co[cq+5]=dk.y,co[cq+6]=dk.z,co[cq+7]=dk.w,co[cq+8]=dj.x,co[cq+9]=dj.y,co[cq+10]=dj.z,co[cq+11]=dj.w,cq+=12}aG.bindBuffer(aG.ARRAY_BUFFER,cR.__webglTangentBuffer);aG.bufferData(aG.ARRAY_BUFFER,co,dI)}if(ct){cO=0;for(cM=dY.length;cO<cM;cO++){if(dK=s[dY[cO]],dA=dK.vertexNormals,dC=dK.normal,3===dA.length&&!1===dE){for(dh=0;3>dh;dh++){cN=dA[dh],cm[bN]=cN.x,cm[bN+1]=cN.y,cm[bN+2]=cN.z,bN+=3}}else{for(dh=0;3>dh;dh++){cm[bN]=dC.x,cm[bN+1]=dC.y,cm[bN+2]=dC.z,bN+=3}}}aG.bindBuffer(aG.ARRAY_BUFFER,cR.__webglNormalBuffer);aG.bufferData(aG.ARRAY_BUFFER,cm,dI)}if(bV&&dZ){cO=0;for(cM=dY.length;cO<cM;cO++){if(dG=dY[cO],dl=dZ[dG],void 0!==dl){for(dh=0;3>dh;dh++){dW=dl[dh],cp[bK]=dW.x,cp[bK+1]=dW.y,bK+=2}}}0<bK&&(aG.bindBuffer(aG.ARRAY_BUFFER,cR.__webglUVBuffer),aG.bufferData(aG.ARRAY_BUFFER,cp,dI))}if(bV&&cd){cO=0;for(cM=dY.length;cO<cM;cO++){if(dG=dY[cO],du=cd[dG],void 0!==du){for(dh=0;3>dh;dh++){df=du[dh],c[d5]=df.x,c[d5+1]=df.y,d5+=2}}}0<d5&&(aG.bindBuffer(aG.ARRAY_BUFFER,cR.__webglUV2Buffer),aG.bufferData(aG.ARRAY_BUFFER,c,dI))}if(cr){cO=0;for(cM=dY.length;cO<cM;cO++){dr[dT]=cC,dr[dT+1]=cC+1,dr[dT+2]=cC+2,dT+=3,d4[cz]=cC,d4[cz+1]=cC+1,d4[cz+2]=cC,d4[cz+3]=cC+2,d4[cz+4]=cC+1,d4[cz+5]=cC+2,cz+=6,cC+=3}aG.bindBuffer(aG.ELEMENT_ARRAY_BUFFER,cR.__webglFaceBuffer);aG.bufferData(aG.ELEMENT_ARRAY_BUFFER,dr,dI);aG.bindBuffer(aG.ELEMENT_ARRAY_BUFFER,cR.__webglLineBuffer);aG.bufferData(aG.ELEMENT_ARRAY_BUFFER,d4,dI)}if(d1){for(dh=0,b3=d1.length;dh<b3;dh++){if(dJ=d1[dh],dJ.__original.needsUpdate){dy=0;if(1===dJ.size){if(void 0===dJ.boundTo||"vertices"===dJ.boundTo){for(cO=0,cM=dY.length;cO<cM;cO++){dK=s[dY[cO]],dJ.array[dy]=dJ.value[dK.a],dJ.array[dy+1]=dJ.value[dK.b],dJ.array[dy+2]=dJ.value[dK.c],dy+=3}}else{if("faces"===dJ.boundTo){for(cO=0,cM=dY.length;cO<cM;cO++){dU=dJ.value[dY[cO]],dJ.array[dy]=dU,dJ.array[dy+1]=dU,dJ.array[dy+2]=dU,dy+=3}}}}else{if(2===dJ.size){if(void 0===dJ.boundTo||"vertices"===dJ.boundTo){for(cO=0,cM=dY.length;cO<cM;cO++){dK=s[dY[cO]],dz=dJ.value[dK.a],dx=dJ.value[dK.b],dv=dJ.value[dK.c],dJ.array[dy]=dz.x,dJ.array[dy+1]=dz.y,dJ.array[dy+2]=dx.x,dJ.array[dy+3]=dx.y,dJ.array[dy+4]=dv.x,dJ.array[dy+5]=dv.y,dy+=6}}else{if("faces"===dJ.boundTo){for(cO=0,cM=dY.length;cO<cM;cO++){dv=dx=dz=dU=dJ.value[dY[cO]],dJ.array[dy]=dz.x,dJ.array[dy+1]=dz.y,dJ.array[dy+2]=dx.x,dJ.array[dy+3]=dx.y,dJ.array[dy+4]=dv.x,dJ.array[dy+5]=dv.y,dy+=6}}}}else{if(3===dJ.size){var dm;dm="c"===dJ.type?["r","g","b"]:["x","y","z"];if(void 0===dJ.boundTo||"vertices"===dJ.boundTo){for(cO=0,cM=dY.length;cO<cM;cO++){dK=s[dY[cO]],dz=dJ.value[dK.a],dx=dJ.value[dK.b],dv=dJ.value[dK.c],dJ.array[dy]=dz[dm[0]],dJ.array[dy+1]=dz[dm[1]],dJ.array[dy+2]=dz[dm[2]],dJ.array[dy+3]=dx[dm[0]],dJ.array[dy+4]=dx[dm[1]],dJ.array[dy+5]=dx[dm[2]],dJ.array[dy+6]=dv[dm[0]],dJ.array[dy+7]=dv[dm[1]],dJ.array[dy+8]=dv[dm[2]],dy+=9}}else{if("faces"===dJ.boundTo){for(cO=0,cM=dY.length;cO<cM;cO++){dv=dx=dz=dU=dJ.value[dY[cO]],dJ.array[dy]=dz[dm[0]],dJ.array[dy+1]=dz[dm[1]],dJ.array[dy+2]=dz[dm[2]],dJ.array[dy+3]=dx[dm[0]],dJ.array[dy+4]=dx[dm[1]],dJ.array[dy+5]=dx[dm[2]],dJ.array[dy+6]=dv[dm[0]],dJ.array[dy+7]=dv[dm[1]],dJ.array[dy+8]=dv[dm[2]],dy+=9}}else{if("faceVertices"===dJ.boundTo){for(cO=0,cM=dY.length;cO<cM;cO++){dU=dJ.value[dY[cO]],dz=dU[0],dx=dU[1],dv=dU[2],dJ.array[dy]=dz[dm[0]],dJ.array[dy+1]=dz[dm[1]],dJ.array[dy+2]=dz[dm[2]],dJ.array[dy+3]=dx[dm[0]],dJ.array[dy+4]=dx[dm[1]],dJ.array[dy+5]=dx[dm[2]],dJ.array[dy+6]=dv[dm[0]],dJ.array[dy+7]=dv[dm[1]],dJ.array[dy+8]=dv[dm[2]],dy+=9}}}}}else{if(4===dJ.size){if(void 0===dJ.boundTo||"vertices"===dJ.boundTo){for(cO=0,cM=dY.length;cO<cM;cO++){dK=s[dY[cO]],dz=dJ.value[dK.a],dx=dJ.value[dK.b],dv=dJ.value[dK.c],dJ.array[dy]=dz.x,dJ.array[dy+1]=dz.y,dJ.array[dy+2]=dz.z,dJ.array[dy+3]=dz.w,dJ.array[dy+4]=dx.x,dJ.array[dy+5]=dx.y,dJ.array[dy+6]=dx.z,dJ.array[dy+7]=dx.w,dJ.array[dy+8]=dv.x,dJ.array[dy+9]=dv.y,dJ.array[dy+10]=dv.z,dJ.array[dy+11]=dv.w,dy+=12}}else{if("faces"===dJ.boundTo){for(cO=0,cM=dY.length;cO<cM;cO++){dv=dx=dz=dU=dJ.value[dY[cO]],dJ.array[dy]=dz.x,dJ.array[dy+1]=dz.y,dJ.array[dy+2]=dz.z,dJ.array[dy+3]=dz.w,dJ.array[dy+4]=dx.x,dJ.array[dy+5]=dx.y,dJ.array[dy+6]=dx.z,dJ.array[dy+7]=dx.w,dJ.array[dy+8]=dv.x,dJ.array[dy+9]=dv.y,dJ.array[dy+10]=dv.z,dJ.array[dy+11]=dv.w,dy+=12}}else{if("faceVertices"===dJ.boundTo){for(cO=0,cM=dY.length;cO<cM;cO++){dU=dJ.value[dY[cO]],dz=dU[0],dx=dU[1],dv=dU[2],dJ.array[dy]=dz.x,dJ.array[dy+1]=dz.y,dJ.array[dy+2]=dz.z,dJ.array[dy+3]=dz.w,dJ.array[dy+4]=dx.x,dJ.array[dy+5]=dx.y,dJ.array[dy+6]=dx.z,dJ.array[dy+7]=dx.w,dJ.array[dy+8]=dv.x,dJ.array[dy+9]=dv.y,dJ.array[dy+10]=dv.z,dJ.array[dy+11]=dv.w,dy+=12}}}}}}}}aG.bindBuffer(aG.ARRAY_BUFFER,dJ.buffer);aG.bufferData(aG.ARRAY_BUFFER,dJ.array,dI)}}}dL&&(delete cR.__inittedArrays,delete cR.__colorArray,delete cR.__normalArray,delete cR.__tangentArray,delete cR.__uvArray,delete cR.__uv2Array,delete cR.__faceArray,delete cR.__vertexArray,delete cR.__lineArray,delete cR.__skinIndexArray,delete cR.__skinWeightArray)}}}c7.verticesNeedUpdate=!1;c7.morphTargetsNeedUpdate=!1;c7.elementsNeedUpdate=!1;c7.uvsNeedUpdate=!1;c7.normalsNeedUpdate=!1;c7.colorsNeedUpdate=!1;c7.tangentsNeedUpdate=!1;cQ.attributes&&az(cQ)}else{if(c8 instanceof THREE.Line){cQ=aT(c8,c7);cS=cQ.attributes&&aA(cQ);if(c7.verticesNeedUpdate||c7.colorsNeedUpdate||c7.lineDistancesNeedUpdate||cS){var bX=aG.DYNAMIC_DRAW,dn,dX,dg,ch,di,bQ,bM=c7.vertices,dO=c7.colors,cj=c7.lineDistances,d6=bM.length,cL=dO.length,cD=cj.length,cU=c7.__vertexArray,ce=c7.__colorArray,b7=c7.__lineDistanceArray,dM=c7.colorsNeedUpdate,bI=c7.lineDistancesNeedUpdate,q=c7.__webglCustomAttributesList,c9,c2,b4,cJ,dP,cs;if(c7.verticesNeedUpdate){for(dn=0;dn<d6;dn++){ch=bM[dn],di=3*dn,cU[di]=ch.x,cU[di+1]=ch.y,cU[di+2]=ch.z}aG.bindBuffer(aG.ARRAY_BUFFER,c7.__webglVertexBuffer);aG.bufferData(aG.ARRAY_BUFFER,cU,bX)}if(dM){for(dX=0;dX<cL;dX++){bQ=dO[dX],di=3*dX,ce[di]=bQ.r,ce[di+1]=bQ.g,ce[di+2]=bQ.b}aG.bindBuffer(aG.ARRAY_BUFFER,c7.__webglColorBuffer);aG.bufferData(aG.ARRAY_BUFFER,ce,bX)}if(bI){for(dg=0;dg<cD;dg++){b7[dg]=cj[dg]}aG.bindBuffer(aG.ARRAY_BUFFER,c7.__webglLineDistanceBuffer);aG.bufferData(aG.ARRAY_BUFFER,b7,bX)}if(q){for(c9=0,c2=q.length;c9<c2;c9++){if(cs=q[c9],cs.needsUpdate&&(void 0===cs.boundTo||"vertices"===cs.boundTo)){di=0;cJ=cs.value.length;if(1===cs.size){for(b4=0;b4<cJ;b4++){cs.array[b4]=cs.value[b4]}}else{if(2===cs.size){for(b4=0;b4<cJ;b4++){dP=cs.value[b4],cs.array[di]=dP.x,cs.array[di+1]=dP.y,di+=2}}else{if(3===cs.size){if("c"===cs.type){for(b4=0;b4<cJ;b4++){dP=cs.value[b4],cs.array[di]=dP.r,cs.array[di+1]=dP.g,cs.array[di+2]=dP.b,di+=3}}else{for(b4=0;b4<cJ;b4++){dP=cs.value[b4],cs.array[di]=dP.x,cs.array[di+1]=dP.y,cs.array[di+2]=dP.z,di+=3}}}else{if(4===cs.size){for(b4=0;b4<cJ;b4++){dP=cs.value[b4],cs.array[di]=dP.x,cs.array[di+1]=dP.y,cs.array[di+2]=dP.z,cs.array[di+3]=dP.w,di+=4}}}}}aG.bindBuffer(aG.ARRAY_BUFFER,cs.buffer);aG.bufferData(aG.ARRAY_BUFFER,cs.array,bX);cs.needsUpdate=!1}}}}c7.verticesNeedUpdate=!1;c7.colorsNeedUpdate=!1;c7.lineDistancesNeedUpdate=!1;cQ.attributes&&az(cQ)}else{if(c8 instanceof THREE.PointCloud){cQ=aT(c8,c7);cS=cQ.attributes&&aA(cQ);if(c7.verticesNeedUpdate||c7.colorsNeedUpdate||cS){var cH=aG.DYNAMIC_DRAW,d3,dS,dV,d2,dB,cl=c7.vertices,dp=cl.length,b1=c7.colors,cv=b1.length,c0=c7.__vertexArray,cG=c7.__colorArray,bO=c7.colorsNeedUpdate,ci=c7.__webglCustomAttributesList,cy,bS,bW,cB,dd,ck;if(c7.verticesNeedUpdate){for(d3=0;d3<dp;d3++){dV=cl[d3],d2=3*d3,c0[d2]=dV.x,c0[d2+1]=dV.y,c0[d2+2]=dV.z}aG.bindBuffer(aG.ARRAY_BUFFER,c7.__webglVertexBuffer);aG.bufferData(aG.ARRAY_BUFFER,c0,cH)}if(bO){for(dS=0;dS<cv;dS++){dB=b1[dS],d2=3*dS,cG[d2]=dB.r,cG[d2+1]=dB.g,cG[d2+2]=dB.b}aG.bindBuffer(aG.ARRAY_BUFFER,c7.__webglColorBuffer);aG.bufferData(aG.ARRAY_BUFFER,cG,cH)}if(ci){for(cy=0,bS=ci.length;cy<bS;cy++){ck=ci[cy];if(ck.needsUpdate&&(void 0===ck.boundTo||"vertices"===ck.boundTo)){if(cB=ck.value.length,d2=0,1===ck.size){for(bW=0;bW<cB;bW++){ck.array[bW]=ck.value[bW]}}else{if(2===ck.size){for(bW=0;bW<cB;bW++){dd=ck.value[bW],ck.array[d2]=dd.x,ck.array[d2+1]=dd.y,d2+=2}}else{if(3===ck.size){if("c"===ck.type){for(bW=0;bW<cB;bW++){dd=ck.value[bW],ck.array[d2]=dd.r,ck.array[d2+1]=dd.g,ck.array[d2+2]=dd.b,d2+=3}}else{for(bW=0;bW<cB;bW++){dd=ck.value[bW],ck.array[d2]=dd.x,ck.array[d2+1]=dd.y,ck.array[d2+2]=dd.z,d2+=3}}}else{if(4===ck.size){for(bW=0;bW<cB;bW++){dd=ck.value[bW],ck.array[d2]=dd.x,ck.array[d2+1]=dd.y,ck.array[d2+2]=dd.z,ck.array[d2+3]=dd.w,d2+=4}}}}}}aG.bindBuffer(aG.ARRAY_BUFFER,ck.buffer);aG.bufferData(aG.ARRAY_BUFFER,ck.array,cH);ck.needsUpdate=!1}}}c7.verticesNeedUpdate=!1;c7.colorsNeedUpdate=!1;cQ.attributes&&az(cQ)}}}}}function aA(d){for(var c in d.attributes){if(d.attributes[c].needsUpdate){return !0}}return !1}function az(d){for(var c in d.attributes){d.attributes[c].needsUpdate=!1}}function ax(b){!0===b.transparent?a1.setBlending(b.blending,b.blendEquation,b.blendSrc,b.blendDst,b.blendEquationAlpha,b.blendSrcAlpha,b.blendDstAlpha):a1.setBlending(THREE.NoBlending);a1.setDepthTest(b.depthTest);a1.setDepthWrite(b.depthWrite);a1.setColorWrite(b.colorWrite);a1.setPolygonOffset(b.polygonOffset,b.polygonOffsetFactor,b.polygonOffsetUnits)}function aw(cy,cx,cw,cu,cs){var cr,cq,cp,ck;bH=0;if(cu.needsUpdate){cu.program&&bd(cu);cu.addEventListener("dispose",aI);var ch=ai[cu.type];if(ch){var cj=THREE.ShaderLib[ch];cu.__webglShader={uniforms:THREE.UniformsUtils.clone(cj.uniforms),vertexShader:cj.vertexShader,fragmentShader:cj.fragmentShader}}else{cu.__webglShader={uniforms:cu.uniforms,vertexShader:cu.vertexShader,fragmentShader:cu.fragmentShader}}for(var cf=0,ce=0,cd=0,cc=0,b9=0,b6=cx.length;b9<b6;b9++){var b7=cx[b9];b7.onlyShadow||!1===b7.visible||(b7 instanceof THREE.DirectionalLight&&cf++,b7 instanceof THREE.PointLight&&ce++,b7 instanceof THREE.SpotLight&&cd++,b7 instanceof THREE.HemisphereLight&&cc++)}cr=cf;cq=ce;cp=cd;ck=cc;for(var b8,b3=0,cW=0,cY=cx.length;cW<cY;cW++){var cS=cx[cW];cS.castShadow&&(cS instanceof THREE.SpotLight&&b3++,cS instanceof THREE.DirectionalLight&&!cS.shadowCascade&&b3++)}b8=b3;var cV;if(bz&&cs&&cs.skeleton&&cs.skeleton.useVertexTexture){cV=1024}else{var cN=aG.getParameter(aG.MAX_VERTEX_UNIFORM_VECTORS),cO=Math.floor((cN-20)/4);void 0!==cs&&cs instanceof THREE.SkinnedMesh&&(cO=Math.min(cs.skeleton.bones.length,cO),cO<cs.skeleton.bones.length&&THREE.warn("WebGLRenderer: too many bones - "+cs.skeleton.bones.length+", this GPU supports just "+cO+" (try OpenGL instead of ANGLE)"));cV=cO}var cK={precision:be,supportsVertexTextures:a0,map:!!cu.map,envMap:!!cu.envMap,envMapMode:cu.envMap&&cu.envMap.mapping,lightMap:!!cu.lightMap,bumpMap:!!cu.bumpMap,normalMap:!!cu.normalMap,specularMap:!!cu.specularMap,alphaMap:!!cu.alphaMap,combine:cu.combine,vertexColors:cu.vertexColors,fog:cw,useFog:cu.fog,fogExp:cw instanceof THREE.FogExp2,flatShading:cu.shading===THREE.FlatShading,sizeAttenuation:cu.sizeAttenuation,logarithmicDepthBuffer:ah,skinning:cu.skinning,maxBones:cV,useVertexTexture:bz&&cs&&cs.skeleton&&cs.skeleton.useVertexTexture,morphTargets:cu.morphTargets,morphNormals:cu.morphNormals,maxMorphTargets:bp.maxMorphTargets,maxMorphNormals:bp.maxMorphNormals,maxDirLights:cr,maxPointLights:cq,maxSpotLights:cp,maxHemiLights:ck,maxShadows:b8,shadowMapEnabled:bp.shadowMapEnabled&&cs.receiveShadow&&0<b8,shadowMapType:bp.shadowMapType,shadowMapDebug:bp.shadowMapDebug,shadowMapCascade:bp.shadowMapCascade,alphaTest:cu.alphaTest,metal:cu.metal,wrapAround:cu.wrapAround,doubleSided:cu.side===THREE.DoubleSide,flipSided:cu.side===THREE.BackSide},cH=[];ch?cH.push(ch):(cH.push(cu.fragmentShader),cH.push(cu.vertexShader));if(void 0!==cu.defines){for(var cM in cu.defines){cH.push(cM),cH.push(cu.defines[cM])}}for(cM in cK){cH.push(cM),cH.push(cK[cM])}for(var b0=cH.join(),cE,cD=0,b2=aZ.length;cD<b2;cD++){var I=aZ[cD];if(I.code===b0){cE=I;cE.usedTimes++;break}}void 0===cE&&(cE=new THREE.WebGLProgram(bp,b0,cu,cK),aZ.push(cE),bp.info.memory.programs=aZ.length);cu.program=cE;var bT=cE.attributes;if(cu.morphTargets){cu.numSupportedMorphTargets=0;for(var ci,bV="morphTarget",cL=0;cL<bp.maxMorphTargets;cL++){ci=bV+cL,0<=bT[ci]&&cu.numSupportedMorphTargets++}}if(cu.morphNormals){for(cu.numSupportedMorphNormals=0,bV="morphNormal",cL=0;cL<bp.maxMorphNormals;cL++){ci=bV+cL,0<=bT[ci]&&cu.numSupportedMorphNormals++}}cu.uniformsList=[];for(var cT in cu.__webglShader.uniforms){var c5=cu.program.uniforms[cT];c5&&cu.uniformsList.push([cu.__webglShader.uniforms[cT],c5])}cu.needsUpdate=!1}cu.morphTargets&&!cs.__webglMorphTargetInfluences&&(cs.__webglMorphTargetInfluences=new Float32Array(bp.maxMorphTargets));var dc=!1,cv=!1,bN=!1,c9=cu.program,bK=c9.uniforms,cI=cu.__webglShader.uniforms;c9.id!==aQ&&(aG.useProgram(c9.program),aQ=c9.id,bN=cv=dc=!0);cu.id!==aX&&(-1===aX&&(bN=!0),aX=cu.id,cv=!0);if(dc||cy!==an){aG.uniformMatrix4fv(bK.projectionMatrix,!1,cy.projectionMatrix.elements),ah&&aG.uniform1f(bK.logDepthBufFC,2/(Math.log(cy.far+1)/Math.LN2)),cy!==an&&(an=cy),(cu instanceof THREE.ShaderMaterial||cu instanceof THREE.MeshPhongMaterial||cu.envMap)&&null!==bK.cameraPosition&&(Z.setFromMatrixPosition(cy.matrixWorld),aG.uniform3f(bK.cameraPosition,Z.x,Z.y,Z.z)),(cu instanceof THREE.MeshPhongMaterial||cu instanceof THREE.MeshLambertMaterial||cu instanceof THREE.MeshBasicMaterial||cu instanceof THREE.ShaderMaterial||cu.skinning)&&null!==bK.viewMatrix&&aG.uniformMatrix4fv(bK.viewMatrix,!1,cy.matrixWorldInverse.elements)}if(cu.skinning){if(cs.bindMatrix&&null!==bK.bindMatrix&&aG.uniformMatrix4fv(bK.bindMatrix,!1,cs.bindMatrix.elements),cs.bindMatrixInverse&&null!==bK.bindMatrixInverse&&aG.uniformMatrix4fv(bK.bindMatrixInverse,!1,cs.bindMatrixInverse.elements),bz&&cs.skeleton&&cs.skeleton.useVertexTexture){if(null!==bK.boneTexture){var bU=bn();aG.uniform1i(bK.boneTexture,bU);bp.setTexture(cs.skeleton.boneTexture,bU)}null!==bK.boneTextureWidth&&aG.uniform1i(bK.boneTextureWidth,cs.skeleton.boneTextureWidth);null!==bK.boneTextureHeight&&aG.uniform1i(bK.boneTextureHeight,cs.skeleton.boneTextureHeight)}else{cs.skeleton&&cs.skeleton.boneMatrices&&null!==bK.boneGlobalMatrices&&aG.uniformMatrix4fv(bK.boneGlobalMatrices,!1,cs.skeleton.boneMatrices)}}if(cv){cw&&cu.fog&&(cI.fogColor.value=cw.color,cw instanceof THREE.Fog?(cI.fogNear.value=cw.near,cI.fogFar.value=cw.far):cw instanceof THREE.FogExp2&&(cI.fogDensity.value=cw.density));if(cu instanceof THREE.MeshPhongMaterial||cu instanceof THREE.MeshLambertMaterial||cu.lights){if(br){var bN=!0,cn,dt,cB,cJ=0,cg=0,cl=0,m,bZ,bM,cU,bW,c0=af,dC=c0.directional.colors,bO=c0.directional.positions,dE=c0.point.colors,bI=c0.point.positions,dp=c0.point.distances,c7=c0.point.decays,bR=c0.spot.colors,dx=c0.spot.positions,L=c0.spot.distances,dj=c0.spot.directions,dA=c0.spot.anglesCos,dD=c0.spot.exponents,cQ=c0.spot.decays,c8=c0.hemi.skyColors,D=c0.hemi.groundColors,dw=c0.hemi.positions,dy=0,dn=0,dm=0,co=0,bY=0,bL=0,dz=0,df=0,dh=0,c3=0,cA=0,dr=0;cn=0;for(dt=cx.length;cn<dt;cn++){cB=cx[cn],cB.onlyShadow||(m=cB.color,cU=cB.intensity,bW=cB.distance,cB instanceof THREE.AmbientLight?cB.visible&&(cJ+=m.r,cg+=m.g,cl+=m.b):cB instanceof THREE.DirectionalLight?(bY+=1,cB.visible&&(ak.setFromMatrixPosition(cB.matrixWorld),Z.setFromMatrixPosition(cB.target.matrixWorld),ak.sub(Z),ak.normalize(),dh=3*dy,bO[dh]=ak.x,bO[dh+1]=ak.y,bO[dh+2]=ak.z,at(dC,dh,m,cU),dy+=1)):cB instanceof THREE.PointLight?(bL+=1,cB.visible&&(c3=3*dn,at(dE,c3,m,cU),Z.setFromMatrixPosition(cB.matrixWorld),bI[c3]=Z.x,bI[c3+1]=Z.y,bI[c3+2]=Z.z,dp[dn]=bW,c7[dn]=0===cB.distance?0:cB.decay,dn+=1)):cB instanceof THREE.SpotLight?(dz+=1,cB.visible&&(cA=3*dm,at(bR,cA,m,cU),ak.setFromMatrixPosition(cB.matrixWorld),dx[cA]=ak.x,dx[cA+1]=ak.y,dx[cA+2]=ak.z,L[dm]=bW,Z.setFromMatrixPosition(cB.target.matrixWorld),ak.sub(Z),ak.normalize(),dj[cA]=ak.x,dj[cA+1]=ak.y,dj[cA+2]=ak.z,dA[dm]=Math.cos(cB.angle),dD[dm]=cB.exponent,cQ[dm]=0===cB.distance?0:cB.decay,dm+=1)):cB instanceof THREE.HemisphereLight&&(df+=1,cB.visible&&(ak.setFromMatrixPosition(cB.matrixWorld),ak.normalize(),dr=3*co,dw[dr]=ak.x,dw[dr+1]=ak.y,dw[dr+2]=ak.z,bZ=cB.color,bM=cB.groundColor,at(c8,dr,bZ,cU),at(D,dr,bM,cU),co+=1)))}cn=3*dy;for(dt=Math.max(dC.length,3*bY);cn<dt;cn++){dC[cn]=0}cn=3*dn;for(dt=Math.max(dE.length,3*bL);cn<dt;cn++){dE[cn]=0}cn=3*dm;for(dt=Math.max(bR.length,3*dz);cn<dt;cn++){bR[cn]=0}cn=3*co;for(dt=Math.max(c8.length,3*df);cn<dt;cn++){c8[cn]=0}cn=3*co;for(dt=Math.max(D.length,3*df);cn<dt;cn++){D[cn]=0}c0.directional.length=dy;c0.point.length=dn;c0.spot.length=dm;c0.hemi.length=co;c0.ambient[0]=cJ;c0.ambient[1]=cg;c0.ambient[2]=cl;br=!1}if(bN){var U=af;cI.ambientLightColor.value=U.ambient;cI.directionalLightColor.value=U.directional.colors;cI.directionalLightDirection.value=U.directional.positions;cI.pointLightColor.value=U.point.colors;cI.pointLightPosition.value=U.point.positions;cI.pointLightDistance.value=U.point.distances;cI.pointLightDecay.value=U.point.decays;cI.spotLightColor.value=U.spot.colors;cI.spotLightPosition.value=U.spot.positions;cI.spotLightDistance.value=U.spot.distances;cI.spotLightDirection.value=U.spot.directions;cI.spotLightAngleCos.value=U.spot.anglesCos;cI.spotLightExponent.value=U.spot.exponents;cI.spotLightDecay.value=U.spot.decays;cI.hemisphereLightSkyColor.value=U.hemi.skyColors;cI.hemisphereLightGroundColor.value=U.hemi.groundColors;cI.hemisphereLightDirection.value=U.hemi.positions;au(cI,!0)}else{au(cI,!1)}}if(cu instanceof THREE.MeshBasicMaterial||cu instanceof THREE.MeshLambertMaterial||cu instanceof THREE.MeshPhongMaterial){cI.opacity.value=cu.opacity;cI.diffuse.value=cu.color;cI.map.value=cu.map;cI.lightMap.value=cu.lightMap;cI.specularMap.value=cu.specularMap;cI.alphaMap.value=cu.alphaMap;cu.bumpMap&&(cI.bumpMap.value=cu.bumpMap,cI.bumpScale.value=cu.bumpScale);cu.normalMap&&(cI.normalMap.value=cu.normalMap,cI.normalScale.value.copy(cu.normalScale));var dv;cu.map?dv=cu.map:cu.specularMap?dv=cu.specularMap:cu.normalMap?dv=cu.normalMap:cu.bumpMap?dv=cu.bumpMap:cu.alphaMap&&(dv=cu.alphaMap);if(void 0!==dv){var bP=dv.offset,b1=dv.repeat;cI.offsetRepeat.value.set(bP.x,bP.y,b1.x,b1.y)}cI.envMap.value=cu.envMap;cI.flipEnvMap.value=cu.envMap instanceof THREE.WebGLRenderTargetCube?1:-1;cI.reflectivity.value=cu.reflectivity;cI.refractionRatio.value=cu.refractionRatio}if(cu instanceof THREE.LineBasicMaterial){cI.diffuse.value=cu.color,cI.opacity.value=cu.opacity}else{if(cu instanceof THREE.LineDashedMaterial){cI.diffuse.value=cu.color,cI.opacity.value=cu.opacity,cI.dashSize.value=cu.dashSize,cI.totalSize.value=cu.dashSize+cu.gapSize,cI.scale.value=cu.scale}else{if(cu instanceof THREE.PointCloudMaterial){if(cI.psColor.value=cu.color,cI.opacity.value=cu.opacity,cI.size.value=cu.size,cI.scale.value=a3.height/2,cI.map.value=cu.map,null!==cu.map){var b4=cu.map.offset,bS=cu.map.repeat;cI.offsetRepeat.value.set(b4.x,b4.y,bS.x,bS.y)}}else{cu instanceof THREE.MeshPhongMaterial?(cI.shininess.value=cu.shininess,cI.emissive.value=cu.emissive,cI.specular.value=cu.specular,cu.wrapAround&&cI.wrapRGB.value.copy(cu.wrapRGB)):cu instanceof THREE.MeshLambertMaterial?(cI.emissive.value=cu.emissive,cu.wrapAround&&cI.wrapRGB.value.copy(cu.wrapRGB)):cu instanceof THREE.MeshDepthMaterial?(cI.mNear.value=cy.near,cI.mFar.value=cy.far,cI.opacity.value=cu.opacity):cu instanceof THREE.MeshNormalMaterial&&(cI.opacity.value=cu.opacity)}}}if(cs.receiveShadow&&!cu._shadowPass&&cI.shadowMatrix){for(var dl=0,cR=0,dk=cx.length;cR<dk;cR++){var B=cx[cR];B.castShadow&&(B instanceof THREE.SpotLight||B instanceof THREE.DirectionalLight&&!B.shadowCascade)&&(cI.shadowMap.value[dl]=B.shadowMap,cI.shadowMapSize.value[dl]=B.shadowMapSize,cI.shadowMatrix.value[dl]=B.shadowMatrix,cI.shadowDarkness.value[dl]=B.shadowDarkness,cI.shadowBias.value[dl]=B.shadowBias,dl++)}}for(var di=cu.uniformsList,c6,c2,dB,cX=0,du=di.length;cX<du;cX++){var cF=di[cX][0];if(!1!==cF.needsUpdate){var cm=cF.type,cG=cF.value,dd=di[cX][1];switch(cm){case"1i":aG.uniform1i(dd,cG);break;case"1f":aG.uniform1f(dd,cG);break;case"2f":aG.uniform2f(dd,cG[0],cG[1]);break;case"3f":aG.uniform3f(dd,cG[0],cG[1],cG[2]);break;case"4f":aG.uniform4f(dd,cG[0],cG[1],cG[2],cG[3]);break;case"1iv":aG.uniform1iv(dd,cG);break;case"3iv":aG.uniform3iv(dd,cG);break;case"1fv":aG.uniform1fv(dd,cG);break;case"2fv":aG.uniform2fv(dd,cG);break;case"3fv":aG.uniform3fv(dd,cG);break;case"4fv":aG.uniform4fv(dd,cG);break;case"Matrix3fv":aG.uniformMatrix3fv(dd,!1,cG);break;case"Matrix4fv":aG.uniformMatrix4fv(dd,!1,cG);break;case"i":aG.uniform1i(dd,cG);break;case"f":aG.uniform1f(dd,cG);break;case"v2":aG.uniform2f(dd,cG.x,cG.y);break;case"v3":aG.uniform3f(dd,cG.x,cG.y,cG.z);break;case"v4":aG.uniform4f(dd,cG.x,cG.y,cG.z,cG.w);break;case"c":aG.uniform3f(dd,cG.r,cG.g,cG.b);break;case"iv1":aG.uniform1iv(dd,cG);break;case"iv":aG.uniform3iv(dd,cG);break;case"fv1":aG.uniform1fv(dd,cG);break;case"fv":aG.uniform3fv(dd,cG);break;case"v2v":void 0===cF._array&&(cF._array=new Float32Array(2*cG.length));for(var cz=0,dg=cG.length;cz<dg;cz++){dB=2*cz,cF._array[dB]=cG[cz].x,cF._array[dB+1]=cG[cz].y}aG.uniform2fv(dd,cF._array);break;case"v3v":void 0===cF._array&&(cF._array=new Float32Array(3*cG.length));cz=0;for(dg=cG.length;cz<dg;cz++){dB=3*cz,cF._array[dB]=cG[cz].x,cF._array[dB+1]=cG[cz].y,cF._array[dB+2]=cG[cz].z}aG.uniform3fv(dd,cF._array);break;case"v4v":void 0===cF._array&&(cF._array=new Float32Array(4*cG.length));cz=0;for(dg=cG.length;cz<dg;cz++){dB=4*cz,cF._array[dB]=cG[cz].x,cF._array[dB+1]=cG[cz].y,cF._array[dB+2]=cG[cz].z,cF._array[dB+3]=cG[cz].w}aG.uniform4fv(dd,cF._array);break;case"m3":aG.uniformMatrix3fv(dd,!1,cG.elements);break;case"m3v":void 0===cF._array&&(cF._array=new Float32Array(9*cG.length));cz=0;for(dg=cG.length;cz<dg;cz++){cG[cz].flattenToArrayOffset(cF._array,9*cz)}aG.uniformMatrix3fv(dd,!1,cF._array);break;case"m4":aG.uniformMatrix4fv(dd,!1,cG.elements);break;case"m4v":void 0===cF._array&&(cF._array=new Float32Array(16*cG.length));cz=0;for(dg=cG.length;cz<dg;cz++){cG[cz].flattenToArrayOffset(cF._array,16*cz)}aG.uniformMatrix4fv(dd,!1,cF._array);break;case"t":c6=cG;c2=bn();aG.uniform1i(dd,c2);if(!c6){continue}if(c6 instanceof THREE.CubeTexture||c6.image instanceof Array&&6===c6.image.length){var cC=c6,bX=c2;if(6===cC.image.length){if(cC.needsUpdate){cC.image.__webglTextureCube||(cC.addEventListener("dispose",aY),cC.image.__webglTextureCube=aG.createTexture(),bp.info.memory.textures++);aG.activeTexture(aG.TEXTURE0+bX);aG.bindTexture(aG.TEXTURE_CUBE_MAP,cC.image.__webglTextureCube);aG.pixelStorei(aG.UNPACK_FLIP_Y_WEBGL,cC.flipY);for(var bQ=cC instanceof THREE.CompressedTexture,cZ=cC.image[0] instanceof THREE.DataTexture,de=[],dq=0;6>dq;dq++){de[dq]=!bp.autoScaleCubemaps||bQ||cZ?cZ?cC.image[dq].image:cC.image[dq]:bm(cC.image[dq],Q)}var E=de[0],ds=THREE.Math.isPowerOfTwo(E.width)&&THREE.Math.isPowerOfTwo(E.height),b5=bh(cC.format),c4=bh(cC.type);bq(aG.TEXTURE_CUBE_MAP,cC,ds);for(dq=0;6>dq;dq++){if(bQ){for(var cP,c1=de[dq].mipmaps,bJ=0,A=c1.length;bJ<A;bJ++){cP=c1[bJ],cC.format!==THREE.RGBAFormat&&cC.format!==THREE.RGBFormat?-1<K().indexOf(b5)?aG.compressedTexImage2D(aG.TEXTURE_CUBE_MAP_POSITIVE_X+dq,bJ,b5,cP.width,cP.height,0,cP.data):THREE.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()"):aG.texImage2D(aG.TEXTURE_CUBE_MAP_POSITIVE_X+dq,bJ,b5,cP.width,cP.height,0,b5,c4,cP.data)}}else{cZ?aG.texImage2D(aG.TEXTURE_CUBE_MAP_POSITIVE_X+dq,0,b5,de[dq].width,de[dq].height,0,b5,c4,de[dq].data):aG.texImage2D(aG.TEXTURE_CUBE_MAP_POSITIVE_X+dq,0,b5,b5,c4,de[dq])}}cC.generateMipmaps&&ds&&aG.generateMipmap(aG.TEXTURE_CUBE_MAP);cC.needsUpdate=!1;if(cC.onUpdate){cC.onUpdate()}}else{aG.activeTexture(aG.TEXTURE0+bX),aG.bindTexture(aG.TEXTURE_CUBE_MAP,cC.image.__webglTextureCube)}}}else{if(c6 instanceof THREE.WebGLRenderTargetCube){var ct=c6;aG.activeTexture(aG.TEXTURE0+c2);aG.bindTexture(aG.TEXTURE_CUBE_MAP,ct.__webglTexture)}else{bp.setTexture(c6,c2)}}break;case"tv":void 0===cF._array&&(cF._array=[]);cz=0;for(dg=cF.value.length;cz<dg;cz++){cF._array[cz]=bn()}aG.uniform1iv(dd,cF._array);cz=0;for(dg=cF.value.length;cz<dg;cz++){c6=cF.value[cz],c2=cF._array[cz],c6&&bp.setTexture(c6,c2)}break;default:THREE.warn("THREE.WebGLRenderer: Unknown uniform type: "+cm)}}}}aG.uniformMatrix4fv(bK.modelViewMatrix,!1,cs._modelViewMatrix.elements);bK.normalMatrix&&aG.uniformMatrix3fv(bK.normalMatrix,!1,cs._normalMatrix.elements);null!==bK.modelMatrix&&aG.uniformMatrix4fv(bK.modelMatrix,!1,cs.matrixWorld.elements);return c9}function au(d,c){d.ambientLightColor.needsUpdate=c;d.directionalLightColor.needsUpdate=c;d.directionalLightDirection.needsUpdate=c;d.pointLightColor.needsUpdate=c;d.pointLightPosition.needsUpdate=c;d.pointLightDistance.needsUpdate=c;d.pointLightDecay.needsUpdate=c;d.spotLightColor.needsUpdate=c;d.spotLightPosition.needsUpdate=c;d.spotLightDistance.needsUpdate=c;d.spotLightDirection.needsUpdate=c;d.spotLightAngleCos.needsUpdate=c;d.spotLightExponent.needsUpdate=c;d.spotLightDecay.needsUpdate=c;d.hemisphereLightSkyColor.needsUpdate=c;d.hemisphereLightGroundColor.needsUpdate=c;d.hemisphereLightDirection.needsUpdate=c}function bn(){var b=bH;b>=ar&&THREE.warn("WebGLRenderer: trying to use "+b+" texture units while this GPU supports only "+ar);bH+=1;return b}function av(d,c){d._modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,d.matrixWorld);d._normalMatrix.getNormalMatrix(d._modelViewMatrix)}function at(f,e,h,g){f[e]=h.r*g;f[e+1]=h.g*g;f[e+2]=h.b*g}function bq(e,d,f){f?(aG.texParameteri(e,aG.TEXTURE_WRAP_S,bh(d.wrapS)),aG.texParameteri(e,aG.TEXTURE_WRAP_T,bh(d.wrapT)),aG.texParameteri(e,aG.TEXTURE_MAG_FILTER,bh(d.magFilter)),aG.texParameteri(e,aG.TEXTURE_MIN_FILTER,bh(d.minFilter))):(aG.texParameteri(e,aG.TEXTURE_WRAP_S,aG.CLAMP_TO_EDGE),aG.texParameteri(e,aG.TEXTURE_WRAP_T,aG.CLAMP_TO_EDGE),d.wrapS===THREE.ClampToEdgeWrapping&&d.wrapT===THREE.ClampToEdgeWrapping||THREE.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+d.sourceFile+" )"),aG.texParameteri(e,aG.TEXTURE_MAG_FILTER,aq(d.magFilter)),aG.texParameteri(e,aG.TEXTURE_MIN_FILTER,aq(d.minFilter)),d.minFilter!==THREE.NearestFilter&&d.minFilter!==THREE.LinearFilter&&THREE.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+d.sourceFile+" )"));(f=ae.get("EXT_texture_filter_anisotropic"))&&d.type!==THREE.FloatType&&d.type!==THREE.HalfFloatType&&(1<d.anisotropy||d.__currentAnisotropy)&&(aG.texParameterf(e,f.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(d.anisotropy,bp.getMaxAnisotropy())),d.__currentAnisotropy=d.anisotropy)}function bm(f,e){if(f.width>e||f.height>e){var h=e/Math.max(f.width,f.height),g=document.createElement("canvas");g.width=Math.floor(f.width*h);g.height=Math.floor(f.height*h);g.getContext("2d").drawImage(f,0,0,f.width,f.height,0,0,g.width,g.height);THREE.warn("THREE.WebGLRenderer: image is too big ("+f.width+"x"+f.height+"). Resized to "+g.width+"x"+g.height,f);return g}return f}function bk(d,c){aG.bindRenderbuffer(aG.RENDERBUFFER,d);c.depthBuffer&&!c.stencilBuffer?(aG.renderbufferStorage(aG.RENDERBUFFER,aG.DEPTH_COMPONENT16,c.width,c.height),aG.framebufferRenderbuffer(aG.FRAMEBUFFER,aG.DEPTH_ATTACHMENT,aG.RENDERBUFFER,d)):c.depthBuffer&&c.stencilBuffer?(aG.renderbufferStorage(aG.RENDERBUFFER,aG.DEPTH_STENCIL,c.width,c.height),aG.framebufferRenderbuffer(aG.FRAMEBUFFER,aG.DEPTH_STENCIL_ATTACHMENT,aG.RENDERBUFFER,d)):aG.renderbufferStorage(aG.RENDERBUFFER,aG.RGBA4,c.width,c.height)}function bl(b){b instanceof THREE.WebGLRenderTargetCube?(aG.bindTexture(aG.TEXTURE_CUBE_MAP,b.__webglTexture),aG.generateMipmap(aG.TEXTURE_CUBE_MAP),aG.bindTexture(aG.TEXTURE_CUBE_MAP,null)):(aG.bindTexture(aG.TEXTURE_2D,b.__webglTexture),aG.generateMipmap(aG.TEXTURE_2D),aG.bindTexture(aG.TEXTURE_2D,null))}function aq(b){return b===THREE.NearestFilter||b===THREE.NearestMipMapNearestFilter||b===THREE.NearestMipMapLinearFilter?aG.NEAREST:aG.LINEAR}function bh(d){var c;if(d===THREE.RepeatWrapping){return aG.REPEAT}if(d===THREE.ClampToEdgeWrapping){return aG.CLAMP_TO_EDGE}if(d===THREE.MirroredRepeatWrapping){return aG.MIRRORED_REPEAT}if(d===THREE.NearestFilter){return aG.NEAREST}if(d===THREE.NearestMipMapNearestFilter){return aG.NEAREST_MIPMAP_NEAREST}if(d===THREE.NearestMipMapLinearFilter){return aG.NEAREST_MIPMAP_LINEAR}if(d===THREE.LinearFilter){return aG.LINEAR}if(d===THREE.LinearMipMapNearestFilter){return aG.LINEAR_MIPMAP_NEAREST}if(d===THREE.LinearMipMapLinearFilter){return aG.LINEAR_MIPMAP_LINEAR}if(d===THREE.UnsignedByteType){return aG.UNSIGNED_BYTE}if(d===THREE.UnsignedShort4444Type){return aG.UNSIGNED_SHORT_4_4_4_4}if(d===THREE.UnsignedShort5551Type){return aG.UNSIGNED_SHORT_5_5_5_1}if(d===THREE.UnsignedShort565Type){return aG.UNSIGNED_SHORT_5_6_5}if(d===THREE.ByteType){return aG.BYTE}if(d===THREE.ShortType){return aG.SHORT}if(d===THREE.UnsignedShortType){return aG.UNSIGNED_SHORT}if(d===THREE.IntType){return aG.INT}if(d===THREE.UnsignedIntType){return aG.UNSIGNED_INT}if(d===THREE.FloatType){return aG.FLOAT}c=ae.get("OES_texture_half_float");if(null!==c&&d===THREE.HalfFloatType){return c.HALF_FLOAT_OES}if(d===THREE.AlphaFormat){return aG.ALPHA}if(d===THREE.RGBFormat){return aG.RGB}if(d===THREE.RGBAFormat){return aG.RGBA}if(d===THREE.LuminanceFormat){return aG.LUMINANCE}if(d===THREE.LuminanceAlphaFormat){return aG.LUMINANCE_ALPHA}if(d===THREE.AddEquation){return aG.FUNC_ADD}if(d===THREE.SubtractEquation){return aG.FUNC_SUBTRACT}if(d===THREE.ReverseSubtractEquation){return aG.FUNC_REVERSE_SUBTRACT}if(d===THREE.ZeroFactor){return aG.ZERO}if(d===THREE.OneFactor){return aG.ONE}if(d===THREE.SrcColorFactor){return aG.SRC_COLOR}if(d===THREE.OneMinusSrcColorFactor){return aG.ONE_MINUS_SRC_COLOR}if(d===THREE.SrcAlphaFactor){return aG.SRC_ALPHA}if(d===THREE.OneMinusSrcAlphaFactor){return aG.ONE_MINUS_SRC_ALPHA}if(d===THREE.DstAlphaFactor){return aG.DST_ALPHA}if(d===THREE.OneMinusDstAlphaFactor){return aG.ONE_MINUS_DST_ALPHA}if(d===THREE.DstColorFactor){return aG.DST_COLOR}if(d===THREE.OneMinusDstColorFactor){return aG.ONE_MINUS_DST_COLOR}if(d===THREE.SrcAlphaSaturateFactor){return aG.SRC_ALPHA_SATURATE}c=ae.get("WEBGL_compressed_texture_s3tc");if(null!==c){if(d===THREE.RGB_S3TC_DXT1_Format){return c.COMPRESSED_RGB_S3TC_DXT1_EXT}if(d===THREE.RGBA_S3TC_DXT1_Format){return c.COMPRESSED_RGBA_S3TC_DXT1_EXT}if(d===THREE.RGBA_S3TC_DXT3_Format){return c.COMPRESSED_RGBA_S3TC_DXT3_EXT}if(d===THREE.RGBA_S3TC_DXT5_Format){return c.COMPRESSED_RGBA_S3TC_DXT5_EXT}}c=ae.get("WEBGL_compressed_texture_pvrtc");if(null!==c){if(d===THREE.RGB_PVRTC_4BPPV1_Format){return c.COMPRESSED_RGB_PVRTC_4BPPV1_IMG}if(d===THREE.RGB_PVRTC_2BPPV1_Format){return c.COMPRESSED_RGB_PVRTC_2BPPV1_IMG}if(d===THREE.RGBA_PVRTC_4BPPV1_Format){return c.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG}if(d===THREE.RGBA_PVRTC_2BPPV1_Format){return c.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}}c=ae.get("EXT_blend_minmax");if(null!==c){if(d===THREE.MinEquation){return c.MIN_EXT}if(d===THREE.MaxEquation){return c.MAX_EXT}}return 0}console.log("THREE.WebGLRenderer",THREE.REVISION);aW=aW||{};var a3=void 0!==aW.canvas?aW.canvas:document.createElement("canvas"),bc=void 0!==aW.context?aW.context:null,bi=1,be=void 0!==aW.precision?aW.precision:"highp",a6=void 0!==aW.alpha?aW.alpha:!1,a9=void 0!==aW.depth?aW.depth:!0,a4=void 0!==aW.stencil?aW.stencil:!0,a2=void 0!==aW.antialias?aW.antialias:!1,bf=void 0!==aW.premultipliedAlpha?aW.premultipliedAlpha:!0,aS=void 0!==aW.preserveDrawingBuffer?aW.preserveDrawingBuffer:!1,ah=void 0!==aW.logarithmicDepthBuffer?aW.logarithmicDepthBuffer:!1,bg=new THREE.Color(0),a8=0,aF=[],a7={},T=[],al=[],ap=[],ac=[],C=[];this.domElement=a3;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.gammaFactor=2;this.shadowMapEnabled=this.gammaOutput=this.gammaInput=!1;this.shadowMapType=THREE.PCFShadowMap;this.shadowMapCullFace=THREE.CullFaceFront;this.shadowMapCascade=this.shadowMapDebug=!1;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=!0;this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var bp=this,aZ=[],aQ=null,bv=null,aX=-1,bs="",an=null,bH=0,aK=0,a5=0,aj=a3.width,S=a3.height,aa=0,bC=0,aD=new THREE.Frustum,ad=new THREE.Matrix4,Z=new THREE.Vector3,ak=new THREE.Vector3,br=!0,af={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},aG;try{var o={alpha:a6,depth:a9,stencil:a4,antialias:a2,premultipliedAlpha:bf,preserveDrawingBuffer:aS};aG=bc||a3.getContext("webgl",o)||a3.getContext("experimental-webgl",o);if(null===aG){if(null!==a3.getContext("webgl")){throw"Error creating WebGL context with your selected attributes."}throw"Error creating WebGL context."}a3.addEventListener("webglcontextlost",function(b){b.preventDefault();bB();bE();a7={}},!1)}catch(bF){THREE.error("THREE.WebGLRenderer: "+bF)}var a1=new THREE.WebGLState(aG,bh);void 0===aG.getShaderPrecisionFormat&&(aG.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var ae=new THREE.WebGLExtensions(aG);ae.get("OES_texture_float");ae.get("OES_texture_float_linear");ae.get("OES_texture_half_float");ae.get("OES_texture_half_float_linear");ae.get("OES_standard_derivatives");ah&&ae.get("EXT_frag_depth");var bG=function(f,e,h,g){!0===bf&&(f*=g,e*=g,h*=g);aG.clearColor(f,e,h,g)},bE=function(){aG.clearColor(0,0,0,1);aG.clearDepth(1);aG.clearStencil(0);aG.enable(aG.DEPTH_TEST);aG.depthFunc(aG.LEQUAL);aG.frontFace(aG.CCW);aG.cullFace(aG.BACK);aG.enable(aG.CULL_FACE);aG.enable(aG.BLEND);aG.blendEquation(aG.FUNC_ADD);aG.blendFunc(aG.SRC_ALPHA,aG.ONE_MINUS_SRC_ALPHA);aG.viewport(aK,a5,aj,S);bG(bg.r,bg.g,bg.b,a8)},bB=function(){an=aQ=null;bs="";aX=-1;br=!0;a1.reset()};bE();this.context=aG;this.state=a1;var ar=aG.getParameter(aG.MAX_TEXTURE_IMAGE_UNITS),by=aG.getParameter(aG.MAX_VERTEX_TEXTURE_IMAGE_UNITS),bo=aG.getParameter(aG.MAX_TEXTURE_SIZE),Q=aG.getParameter(aG.MAX_CUBE_MAP_TEXTURE_SIZE),a0=0<by,bz=a0&&ae.get("OES_texture_float"),aV=aG.getShaderPrecisionFormat(aG.VERTEX_SHADER,aG.HIGH_FLOAT),am=aG.getShaderPrecisionFormat(aG.VERTEX_SHADER,aG.MEDIUM_FLOAT),X=aG.getShaderPrecisionFormat(aG.FRAGMENT_SHADER,aG.HIGH_FLOAT),i=aG.getShaderPrecisionFormat(aG.FRAGMENT_SHADER,aG.MEDIUM_FLOAT),K=function(){var b;return function(){if(void 0!==b){return b}b=[];if(ae.get("WEBGL_compressed_texture_pvrtc")||ae.get("WEBGL_compressed_texture_s3tc")){for(var a=aG.getParameter(aG.COMPRESSED_TEXTURE_FORMATS),d=0;d<a.length;d++){b.push(a[d])}}return b}}(),bA=0<aV.precision&&0<X.precision,bx=0<am.precision&&0<i.precision;"highp"!==be||bA||(bx?(be="mediump",THREE.warn("THREE.WebGLRenderer: highp not supported, using mediump.")):(be="lowp",THREE.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp.")));"mediump"!==be||bx||(be="lowp",THREE.warn("THREE.WebGLRenderer: mediump not supported, using lowp."));var bt=new THREE.ShadowMapPlugin(this,aF,a7,T),bD=new THREE.SpritePlugin(this,ac),bw=new THREE.LensFlarePlugin(this,C);this.getContext=function(){return aG};this.forceContextLoss=function(){ae.get("WEBGL_lose_context").loseContext()};this.supportsVertexTextures=function(){return a0};this.supportsFloatTextures=function(){return ae.get("OES_texture_float")};this.supportsHalfFloatTextures=function(){return ae.get("OES_texture_half_float")};this.supportsStandardDerivatives=function(){return ae.get("OES_standard_derivatives")};this.supportsCompressedTextureS3TC=function(){return ae.get("WEBGL_compressed_texture_s3tc")};this.supportsCompressedTexturePVRTC=function(){return ae.get("WEBGL_compressed_texture_pvrtc")};this.supportsBlendMinMax=function(){return ae.get("EXT_blend_minmax")};this.getMaxAnisotropy=function(){var b;return function(){if(void 0!==b){return b}var a=ae.get("EXT_texture_filter_anisotropic");return b=null!==a?aG.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}();this.getPrecision=function(){return be};this.getPixelRatio=function(){return bi};this.setPixelRatio=function(b){bi=b};this.setSize=function(e,d,f){a3.width=e*bi;a3.height=d*bi;!1!==f&&(a3.style.width=e+"px",a3.style.height=d+"px");this.setViewport(0,0,e,d)};this.setViewport=function(f,e,h,g){aK=f*bi;a5=e*bi;aj=h*bi;S=g*bi;aG.viewport(aK,a5,aj,S)};this.setScissor=function(f,e,h,g){aG.scissor(f*bi,e*bi,h*bi,g*bi)};this.enableScissorTest=function(b){b?aG.enable(aG.SCISSOR_TEST):aG.disable(aG.SCISSOR_TEST)};this.getClearColor=function(){return bg};this.setClearColor=function(d,c){bg.set(d);a8=void 0!==c?c:1;bG(bg.r,bg.g,bg.b,a8)};this.getClearAlpha=function(){return a8};this.setClearAlpha=function(b){a8=b;bG(bg.r,bg.g,bg.b,a8)};this.clear=function(f,e,h){var g=0;if(void 0===f||f){g|=aG.COLOR_BUFFER_BIT}if(void 0===e||e){g|=aG.DEPTH_BUFFER_BIT}if(void 0===h||h){g|=aG.STENCIL_BUFFER_BIT}aG.clear(g)};this.clearColor=function(){aG.clear(aG.COLOR_BUFFER_BIT)};this.clearDepth=function(){aG.clear(aG.DEPTH_BUFFER_BIT)};this.clearStencil=function(){aG.clear(aG.STENCIL_BUFFER_BIT)};this.clearTarget=function(f,e,h,g){this.setRenderTarget(f);this.clear(e,h,g)};this.resetGLState=bB;var Y=function(b){b.target.traverse(function(e){e.removeEventListener("remove",Y);if(e instanceof THREE.Mesh||e instanceof THREE.PointCloud||e instanceof THREE.Line){delete a7[e.id]}else{if(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback){for(var d=T,f=d.length-1;0<=f;f--){d[f].object===e&&d.splice(f,1)}}}delete e.__webglInit;delete e._modelViewMatrix;delete e._normalMatrix;delete e.__webglActive})},ag=function(k){k=k.target;k.removeEventListener("dispose",ag);delete k.__webglInit;if(k instanceof THREE.BufferGeometry){for(var h in k.attributes){var q=k.attributes[h];void 0!==q.buffer&&(aG.deleteBuffer(q.buffer),delete q.buffer)}bp.info.memory.geometries--}else{if(h=bu[k.id],void 0!==h){for(var q=0,p=h.length;q<p;q++){var n=h[q];if(void 0!==n.numMorphTargets){for(var m=0,l=n.numMorphTargets;m<l;m++){aG.deleteBuffer(n.__webglMorphTargetsBuffers[m])}delete n.__webglMorphTargetsBuffers}if(void 0!==n.numMorphNormals){m=0;for(l=n.numMorphNormals;m<l;m++){aG.deleteBuffer(n.__webglMorphNormalsBuffers[m])}delete n.__webglMorphNormalsBuffers}bj(n)}delete bu[k.id]}else{bj(k)}}bs=""},aY=function(b){b=b.target;b.removeEventListener("dispose",aY);b.image&&b.image.__webglTextureCube?(aG.deleteTexture(b.image.__webglTextureCube),delete b.image.__webglTextureCube):void 0!==b.__webglInit&&(aG.deleteTexture(b.__webglTexture),delete b.__webglTexture,delete b.__webglInit);bp.info.memory.textures--},aN=function(d){d=d.target;d.removeEventListener("dispose",aN);if(d&&void 0!==d.__webglTexture){aG.deleteTexture(d.__webglTexture);delete d.__webglTexture;if(d instanceof THREE.WebGLRenderTargetCube){for(var c=0;6>c;c++){aG.deleteFramebuffer(d.__webglFramebuffer[c]),aG.deleteRenderbuffer(d.__webglRenderbuffer[c])}}else{aG.deleteFramebuffer(d.__webglFramebuffer),aG.deleteRenderbuffer(d.__webglRenderbuffer)}delete d.__webglFramebuffer;delete d.__webglRenderbuffer}bp.info.memory.textures--},aI=function(b){b=b.target;b.removeEventListener("dispose",aI);bd(b)},bj=function(g){for(var f="__webglVertexBuffer __webglNormalBuffer __webglTangentBuffer __webglColorBuffer __webglUVBuffer __webglUV2Buffer __webglSkinIndicesBuffer __webglSkinWeightsBuffer __webglFaceBuffer __webglLineBuffer __webglLineDistanceBuffer".split(" "),l=0,k=f.length;l<k;l++){var h=f[l];void 0!==g[h]&&(aG.deleteBuffer(g[h]),delete g[h])}if(void 0!==g.__webglCustomAttributesList){for(h in g.__webglCustomAttributesList){aG.deleteBuffer(g.__webglCustomAttributesList[h].buffer)}delete g.__webglCustomAttributesList}bp.info.memory.geometries--},bd=function(g){var f=g.program.program;if(void 0!==f){g.program=void 0;var l,k,h=!1;g=0;for(l=aZ.length;g<l;g++){if(k=aZ[g],k.program===f){k.usedTimes--;0===k.usedTimes&&(h=!0);break}}if(!0===h){h=[];g=0;for(l=aZ.length;g<l;g++){k=aZ[g],k.program!==f&&h.push(k)}aZ=h;aG.deleteProgram(f);bp.info.memory.programs--}}};this.renderBufferImmediate=function(L,J,I){a1.initAttributes();L.hasPositions&&!L.__webglVertexBuffer&&(L.__webglVertexBuffer=aG.createBuffer());L.hasNormals&&!L.__webglNormalBuffer&&(L.__webglNormalBuffer=aG.createBuffer());L.hasUvs&&!L.__webglUvBuffer&&(L.__webglUvBuffer=aG.createBuffer());L.hasColors&&!L.__webglColorBuffer&&(L.__webglColorBuffer=aG.createBuffer());L.hasPositions&&(aG.bindBuffer(aG.ARRAY_BUFFER,L.__webglVertexBuffer),aG.bufferData(aG.ARRAY_BUFFER,L.positionArray,aG.DYNAMIC_DRAW),a1.enableAttribute(J.attributes.position),aG.vertexAttribPointer(J.attributes.position,3,aG.FLOAT,!1,0,0));if(L.hasNormals){aG.bindBuffer(aG.ARRAY_BUFFER,L.__webglNormalBuffer);if(!1===I instanceof THREE.MeshPhongMaterial&&I.shading===THREE.FlatShading){var H,G,F,E,D,B,v,A,u,t,m,M=3*L.count;for(m=0;m<M;m+=9){t=L.normalArray,H=t[m],G=t[m+1],F=t[m+2],E=t[m+3],B=t[m+4],A=t[m+5],D=t[m+6],v=t[m+7],u=t[m+8],H=(H+E+D)/3,G=(G+B+v)/3,F=(F+A+u)/3,t[m]=H,t[m+1]=G,t[m+2]=F,t[m+3]=H,t[m+4]=G,t[m+5]=F,t[m+6]=H,t[m+7]=G,t[m+8]=F}}aG.bufferData(aG.ARRAY_BUFFER,L.normalArray,aG.DYNAMIC_DRAW);a1.enableAttribute(J.attributes.normal);aG.vertexAttribPointer(J.attributes.normal,3,aG.FLOAT,!1,0,0)}L.hasUvs&&I.map&&(aG.bindBuffer(aG.ARRAY_BUFFER,L.__webglUvBuffer),aG.bufferData(aG.ARRAY_BUFFER,L.uvArray,aG.DYNAMIC_DRAW),a1.enableAttribute(J.attributes.uv),aG.vertexAttribPointer(J.attributes.uv,2,aG.FLOAT,!1,0,0));L.hasColors&&I.vertexColors!==THREE.NoColors&&(aG.bindBuffer(aG.ARRAY_BUFFER,L.__webglColorBuffer),aG.bufferData(aG.ARRAY_BUFFER,L.colorArray,aG.DYNAMIC_DRAW),a1.enableAttribute(J.attributes.color),aG.vertexAttribPointer(J.attributes.color,3,aG.FLOAT,!1,0,0));a1.disableUnusedAttributes();aG.drawArrays(aG.TRIANGLES,0,L.count);L.count=0};this.renderBufferDirect=function(F,E,D,B,A,v){if(!1!==B.visible){if(ay(v),F=aw(F,E,D,B,v),E=!1,D="direct_"+A.id+"_"+F.id+"_"+(B.wireframe?1:0),D!==bs&&(bs=D,E=!0),E&&a1.initAttributes(),v instanceof THREE.Mesh){v=!0===B.wireframe?aG.LINES:aG.TRIANGLES;var u=A.attributes.index;if(u){var t,r;u.array instanceof Uint32Array&&ae.get("OES_element_index_uint")?(t=aG.UNSIGNED_INT,r=4):(t=aG.UNSIGNED_SHORT,r=2);D=A.offsets;if(0===D.length){E&&(aR(B,F,A,0),aG.bindBuffer(aG.ELEMENT_ARRAY_BUFFER,u.buffer)),aG.drawElements(v,u.array.length,t,0),bp.info.render.calls++,bp.info.render.vertices+=u.array.length,bp.info.render.faces+=u.array.length/3}else{E=!0;for(var s=0,m=D.length;s<m;s++){var d=D[s].index;E&&(aR(B,F,A,d),aG.bindBuffer(aG.ELEMENT_ARRAY_BUFFER,u.buffer));aG.drawElements(v,D[s].count,t,D[s].start*r);bp.info.render.calls++;bp.info.render.vertices+=D[s].count;bp.info.render.faces+=D[s].count/3}}}else{E&&aR(B,F,A,0),B=A.attributes.position,aG.drawArrays(v,0,B.array.length/B.itemSize),bp.info.render.calls++,bp.info.render.vertices+=B.array.length/B.itemSize,bp.info.render.faces+=B.array.length/(3*B.itemSize)}}else{if(v instanceof THREE.PointCloud){if(v=aG.POINTS,u=A.attributes.index){if(u.array instanceof Uint32Array&&ae.get("OES_element_index_uint")?(t=aG.UNSIGNED_INT,r=4):(t=aG.UNSIGNED_SHORT,r=2),D=A.offsets,0===D.length){E&&(aR(B,F,A,0),aG.bindBuffer(aG.ELEMENT_ARRAY_BUFFER,u.buffer)),aG.drawElements(v,u.array.length,t,0),bp.info.render.calls++,bp.info.render.points+=u.array.length}else{for(1<D.length&&(E=!0),s=0,m=D.length;s<m;s++){d=D[s].index,E&&(aR(B,F,A,d),aG.bindBuffer(aG.ELEMENT_ARRAY_BUFFER,u.buffer)),aG.drawElements(v,D[s].count,t,D[s].start*r),bp.info.render.calls++,bp.info.render.points+=D[s].count}}}else{if(E&&aR(B,F,A,0),B=A.attributes.position,D=A.offsets,0===D.length){aG.drawArrays(v,0,B.array.length/3),bp.info.render.calls++,bp.info.render.points+=B.array.length/3}else{for(s=0,m=D.length;s<m;s++){aG.drawArrays(v,D[s].index,D[s].count),bp.info.render.calls++,bp.info.render.points+=D[s].count}}}}else{if(v instanceof THREE.Line){if(v=v.mode===THREE.LineStrip?aG.LINE_STRIP:aG.LINES,a1.setLineWidth(B.linewidth*bi),u=A.attributes.index){if(u.array instanceof Uint32Array?(t=aG.UNSIGNED_INT,r=4):(t=aG.UNSIGNED_SHORT,r=2),D=A.offsets,0===D.length){E&&(aR(B,F,A,0),aG.bindBuffer(aG.ELEMENT_ARRAY_BUFFER,u.buffer)),aG.drawElements(v,u.array.length,t,0),bp.info.render.calls++,bp.info.render.vertices+=u.array.length}else{for(1<D.length&&(E=!0),s=0,m=D.length;s<m;s++){d=D[s].index,E&&(aR(B,F,A,d),aG.bindBuffer(aG.ELEMENT_ARRAY_BUFFER,u.buffer)),aG.drawElements(v,D[s].count,t,D[s].start*r),bp.info.render.calls++,bp.info.render.vertices+=D[s].count}}}else{if(E&&aR(B,F,A,0),B=A.attributes.position,D=A.offsets,0===D.length){aG.drawArrays(v,0,B.array.length/3),bp.info.render.calls++,bp.info.render.vertices+=B.array.length/3}else{for(s=0,m=D.length;s<m;s++){aG.drawArrays(v,D[s].index,D[s].count),bp.info.render.calls++,bp.info.render.vertices+=D[s].count}}}}}}}};this.renderBuffer=function(F,E,D,B,A,v){if(!1!==B.visible){ay(v);D=aw(F,E,D,B,v);E=D.attributes;F=!1;D=A.id+"_"+D.id+"_"+(B.wireframe?1:0);D!==bs&&(bs=D,F=!0);F&&a1.initAttributes();if(!B.morphTargets&&0<=E.position){F&&(aG.bindBuffer(aG.ARRAY_BUFFER,A.__webglVertexBuffer),a1.enableAttribute(E.position),aG.vertexAttribPointer(E.position,3,aG.FLOAT,!1,0,0))}else{if(v.morphTargetBase){D=B.program.attributes;-1!==v.morphTargetBase&&0<=D.position?(aG.bindBuffer(aG.ARRAY_BUFFER,A.__webglMorphTargetsBuffers[v.morphTargetBase]),a1.enableAttribute(D.position),aG.vertexAttribPointer(D.position,3,aG.FLOAT,!1,0,0)):0<=D.position&&(aG.bindBuffer(aG.ARRAY_BUFFER,A.__webglVertexBuffer),a1.enableAttribute(D.position),aG.vertexAttribPointer(D.position,3,aG.FLOAT,!1,0,0));if(v.morphTargetForcedOrder.length){for(var u=0,t=v.morphTargetForcedOrder,r=v.morphTargetInfluences,s;u<B.numSupportedMorphTargets&&u<t.length;){s=D["morphTarget"+u],0<=s&&(aG.bindBuffer(aG.ARRAY_BUFFER,A.__webglMorphTargetsBuffers[t[u]]),a1.enableAttribute(s),aG.vertexAttribPointer(s,3,aG.FLOAT,!1,0,0)),s=D["morphNormal"+u],0<=s&&B.morphNormals&&(aG.bindBuffer(aG.ARRAY_BUFFER,A.__webglMorphNormalsBuffers[t[u]]),a1.enableAttribute(s),aG.vertexAttribPointer(s,3,aG.FLOAT,!1,0,0)),v.__webglMorphTargetInfluences[u]=r[t[u]],u++}}else{t=[];r=v.morphTargetInfluences;u=v.geometry.morphTargets;r.length>u.length&&(console.warn("THREE.WebGLRenderer: Influences array is bigger than morphTargets array."),r.length=u.length);u=0;for(s=r.length;u<s;u++){t.push([r[u],u])}t.length>B.numSupportedMorphTargets?(t.sort(aM),t.length=B.numSupportedMorphTargets):t.length>B.numSupportedMorphNormals?t.sort(aM):0===t.length&&t.push([0,0]);for(var u=0,m=B.numSupportedMorphTargets;u<m;u++){if(t[u]){var g=t[u][1];s=D["morphTarget"+u];0<=s&&(aG.bindBuffer(aG.ARRAY_BUFFER,A.__webglMorphTargetsBuffers[g]),a1.enableAttribute(s),aG.vertexAttribPointer(s,3,aG.FLOAT,!1,0,0));s=D["morphNormal"+u];0<=s&&B.morphNormals&&(aG.bindBuffer(aG.ARRAY_BUFFER,A.__webglMorphNormalsBuffers[g]),a1.enableAttribute(s),aG.vertexAttribPointer(s,3,aG.FLOAT,!1,0,0));v.__webglMorphTargetInfluences[u]=r[g]}else{v.__webglMorphTargetInfluences[u]=0}}}null!==B.program.uniforms.morphTargetInfluences&&aG.uniform1fv(B.program.uniforms.morphTargetInfluences,v.__webglMorphTargetInfluences)}}if(F){if(A.__webglCustomAttributesList){for(D=0,r=A.__webglCustomAttributesList.length;D<r;D++){t=A.__webglCustomAttributesList[D],0<=E[t.buffer.belongsToAttribute]&&(aG.bindBuffer(aG.ARRAY_BUFFER,t.buffer),a1.enableAttribute(E[t.buffer.belongsToAttribute]),aG.vertexAttribPointer(E[t.buffer.belongsToAttribute],t.size,aG.FLOAT,!1,0,0))}}0<=E.color&&(0<v.geometry.colors.length||0<v.geometry.faces.length?(aG.bindBuffer(aG.ARRAY_BUFFER,A.__webglColorBuffer),a1.enableAttribute(E.color),aG.vertexAttribPointer(E.color,3,aG.FLOAT,!1,0,0)):void 0!==B.defaultAttributeValues&&aG.vertexAttrib3fv(E.color,B.defaultAttributeValues.color));0<=E.normal&&(aG.bindBuffer(aG.ARRAY_BUFFER,A.__webglNormalBuffer),a1.enableAttribute(E.normal),aG.vertexAttribPointer(E.normal,3,aG.FLOAT,!1,0,0));0<=E.tangent&&(aG.bindBuffer(aG.ARRAY_BUFFER,A.__webglTangentBuffer),a1.enableAttribute(E.tangent),aG.vertexAttribPointer(E.tangent,4,aG.FLOAT,!1,0,0));0<=E.uv&&(v.geometry.faceVertexUvs[0]?(aG.bindBuffer(aG.ARRAY_BUFFER,A.__webglUVBuffer),a1.enableAttribute(E.uv),aG.vertexAttribPointer(E.uv,2,aG.FLOAT,!1,0,0)):void 0!==B.defaultAttributeValues&&aG.vertexAttrib2fv(E.uv,B.defaultAttributeValues.uv));0<=E.uv2&&(v.geometry.faceVertexUvs[1]?(aG.bindBuffer(aG.ARRAY_BUFFER,A.__webglUV2Buffer),a1.enableAttribute(E.uv2),aG.vertexAttribPointer(E.uv2,2,aG.FLOAT,!1,0,0)):void 0!==B.defaultAttributeValues&&aG.vertexAttrib2fv(E.uv2,B.defaultAttributeValues.uv2));B.skinning&&0<=E.skinIndex&&0<=E.skinWeight&&(aG.bindBuffer(aG.ARRAY_BUFFER,A.__webglSkinIndicesBuffer),a1.enableAttribute(E.skinIndex),aG.vertexAttribPointer(E.skinIndex,4,aG.FLOAT,!1,0,0),aG.bindBuffer(aG.ARRAY_BUFFER,A.__webglSkinWeightsBuffer),a1.enableAttribute(E.skinWeight),aG.vertexAttribPointer(E.skinWeight,4,aG.FLOAT,!1,0,0));0<=E.lineDistance&&(aG.bindBuffer(aG.ARRAY_BUFFER,A.__webglLineDistanceBuffer),a1.enableAttribute(E.lineDistance),aG.vertexAttribPointer(E.lineDistance,1,aG.FLOAT,!1,0,0))}a1.disableUnusedAttributes();v instanceof THREE.Mesh?(v=A.__typeArray===Uint32Array?aG.UNSIGNED_INT:aG.UNSIGNED_SHORT,B.wireframe?(a1.setLineWidth(B.wireframeLinewidth*bi),F&&aG.bindBuffer(aG.ELEMENT_ARRAY_BUFFER,A.__webglLineBuffer),aG.drawElements(aG.LINES,A.__webglLineCount,v,0)):(F&&aG.bindBuffer(aG.ELEMENT_ARRAY_BUFFER,A.__webglFaceBuffer),aG.drawElements(aG.TRIANGLES,A.__webglFaceCount,v,0)),bp.info.render.calls++,bp.info.render.vertices+=A.__webglFaceCount,bp.info.render.faces+=A.__webglFaceCount/3):v instanceof THREE.Line?(v=v.mode===THREE.LineStrip?aG.LINE_STRIP:aG.LINES,a1.setLineWidth(B.linewidth*bi),aG.drawArrays(v,0,A.__webglLineCount),bp.info.render.calls++):v instanceof THREE.PointCloud&&(aG.drawArrays(aG.POINTS,0,A.__webglParticleCount),bp.info.render.calls++,bp.info.render.points+=A.__webglParticleCount)}};this.render=function(h,f,s,p){if(!1===f instanceof THREE.Camera){THREE.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")}else{var k=h.fog;bs="";aX=-1;an=null;br=!0;!0===h.autoUpdate&&h.updateMatrixWorld();void 0===f.parent&&f.updateMatrixWorld();h.traverse(function(b){b instanceof THREE.SkinnedMesh&&b.skeleton.update()});f.matrixWorldInverse.getInverse(f.matrixWorld);ad.multiplyMatrices(f.projectionMatrix,f.matrixWorldInverse);aD.setFromMatrix(ad);aF.length=0;al.length=0;ap.length=0;ac.length=0;C.length=0;aL(h);!0===bp.sortObjects&&(al.sort(aP),ap.sort(aO));bt.render(h,f);bp.info.render.calls=0;bp.info.render.vertices=0;bp.info.render.faces=0;bp.info.render.points=0;this.setRenderTarget(s);(this.autoClear||p)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);p=0;for(var r=T.length;p<r;p++){var e=T[p],l=e.object;l.visible&&(av(l,f),aC(e))}h.overrideMaterial?(p=h.overrideMaterial,ax(p),aJ(al,f,aF,k,p),aJ(ap,f,aF,k,p),aH(T,"",f,aF,k,p)):(a1.setBlending(THREE.NoBlending),aJ(al,f,aF,k,null),aH(T,"opaque",f,aF,k,null),aJ(ap,f,aF,k,null),aH(T,"transparent",f,aF,k,null));bD.render(h,f);bw.render(h,f,aa,bC);s&&s.generateMipmaps&&s.minFilter!==THREE.NearestFilter&&s.minFilter!==THREE.LinearFilter&&bl(s);a1.setDepthTest(!0);a1.setDepthWrite(!0);a1.setColorWrite(!0)}};this.renderImmediateObject=function(h,g,n,m,l){var k=aw(h,g,n,m,l);bs="";bp.setMaterialFaces(m);l.immediateRenderCallback?l.immediateRenderCallback(k,aG,aD):l.render(function(b){bp.renderBufferImmediate(b,k,m)})};var bu={},ao=0,ai={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointCloudMaterial:"particle_basic"};this.setFaceCulling=function(d,c){d===THREE.CullFaceNone?aG.disable(aG.CULL_FACE):(c===THREE.FrontFaceDirectionCW?aG.frontFace(aG.CW):aG.frontFace(aG.CCW),d===THREE.CullFaceBack?aG.cullFace(aG.BACK):d===THREE.CullFaceFront?aG.cullFace(aG.FRONT):aG.cullFace(aG.FRONT_AND_BACK),aG.enable(aG.CULL_FACE))};this.setMaterialFaces=function(b){a1.setDoubleSided(b.side===THREE.DoubleSide);a1.setFlipSided(b.side===THREE.BackSide)};this.uploadTexture=function(l){void 0===l.__webglInit&&(l.__webglInit=!0,l.addEventListener("dispose",aY),l.__webglTexture=aG.createTexture(),bp.info.memory.textures++);aG.bindTexture(aG.TEXTURE_2D,l.__webglTexture);aG.pixelStorei(aG.UNPACK_FLIP_Y_WEBGL,l.flipY);aG.pixelStorei(aG.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l.premultiplyAlpha);aG.pixelStorei(aG.UNPACK_ALIGNMENT,l.unpackAlignment);l.image=bm(l.image,bo);var k=l.image,s=THREE.Math.isPowerOfTwo(k.width)&&THREE.Math.isPowerOfTwo(k.height),r=bh(l.format),q=bh(l.type);bq(aG.TEXTURE_2D,l,s);var p=l.mipmaps;if(l instanceof THREE.DataTexture){if(0<p.length&&s){for(var n=0,m=p.length;n<m;n++){k=p[n],aG.texImage2D(aG.TEXTURE_2D,n,r,k.width,k.height,0,r,q,k.data)}l.generateMipmaps=!1}else{aG.texImage2D(aG.TEXTURE_2D,0,r,k.width,k.height,0,r,q,k.data)}}else{if(l instanceof THREE.CompressedTexture){for(n=0,m=p.length;n<m;n++){k=p[n],l.format!==THREE.RGBAFormat&&l.format!==THREE.RGBFormat?-1<K().indexOf(r)?aG.compressedTexImage2D(aG.TEXTURE_2D,n,r,k.width,k.height,0,k.data):THREE.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):aG.texImage2D(aG.TEXTURE_2D,n,r,k.width,k.height,0,r,q,k.data)}}else{if(0<p.length&&s){n=0;for(m=p.length;n<m;n++){k=p[n],aG.texImage2D(aG.TEXTURE_2D,n,r,r,q,k)}l.generateMipmaps=!1}else{aG.texImage2D(aG.TEXTURE_2D,0,r,r,q,l.image)}}}l.generateMipmaps&&s&&aG.generateMipmap(aG.TEXTURE_2D);l.needsUpdate=!1;if(l.onUpdate){l.onUpdate()}};this.setTexture=function(d,c){aG.activeTexture(aG.TEXTURE0+c);d.needsUpdate?bp.uploadTexture(d):aG.bindTexture(aG.TEXTURE_2D,d.__webglTexture)};this.setRenderTarget=function(l){var k=l instanceof THREE.WebGLRenderTargetCube;if(l&&void 0===l.__webglFramebuffer){void 0===l.depthBuffer&&(l.depthBuffer=!0);void 0===l.stencilBuffer&&(l.stencilBuffer=!0);l.addEventListener("dispose",aN);l.__webglTexture=aG.createTexture();bp.info.memory.textures++;var s=THREE.Math.isPowerOfTwo(l.width)&&THREE.Math.isPowerOfTwo(l.height),r=bh(l.format),q=bh(l.type);if(k){l.__webglFramebuffer=[];l.__webglRenderbuffer=[];aG.bindTexture(aG.TEXTURE_CUBE_MAP,l.__webglTexture);bq(aG.TEXTURE_CUBE_MAP,l,s);for(var p=0;6>p;p++){l.__webglFramebuffer[p]=aG.createFramebuffer();l.__webglRenderbuffer[p]=aG.createRenderbuffer();aG.texImage2D(aG.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,r,l.width,l.height,0,r,q,null);var n=l,m=aG.TEXTURE_CUBE_MAP_POSITIVE_X+p;aG.bindFramebuffer(aG.FRAMEBUFFER,l.__webglFramebuffer[p]);aG.framebufferTexture2D(aG.FRAMEBUFFER,aG.COLOR_ATTACHMENT0,m,n.__webglTexture,0);bk(l.__webglRenderbuffer[p],l)}s&&aG.generateMipmap(aG.TEXTURE_CUBE_MAP)}else{l.__webglFramebuffer=aG.createFramebuffer(),l.__webglRenderbuffer=l.shareDepthFrom?l.shareDepthFrom.__webglRenderbuffer:aG.createRenderbuffer(),aG.bindTexture(aG.TEXTURE_2D,l.__webglTexture),bq(aG.TEXTURE_2D,l,s),aG.texImage2D(aG.TEXTURE_2D,0,r,l.width,l.height,0,r,q,null),r=aG.TEXTURE_2D,aG.bindFramebuffer(aG.FRAMEBUFFER,l.__webglFramebuffer),aG.framebufferTexture2D(aG.FRAMEBUFFER,aG.COLOR_ATTACHMENT0,r,l.__webglTexture,0),l.shareDepthFrom?l.depthBuffer&&!l.stencilBuffer?aG.framebufferRenderbuffer(aG.FRAMEBUFFER,aG.DEPTH_ATTACHMENT,aG.RENDERBUFFER,l.__webglRenderbuffer):l.depthBuffer&&l.stencilBuffer&&aG.framebufferRenderbuffer(aG.FRAMEBUFFER,aG.DEPTH_STENCIL_ATTACHMENT,aG.RENDERBUFFER,l.__webglRenderbuffer):bk(l.__webglRenderbuffer,l),s&&aG.generateMipmap(aG.TEXTURE_2D)}k?aG.bindTexture(aG.TEXTURE_CUBE_MAP,null):aG.bindTexture(aG.TEXTURE_2D,null);aG.bindRenderbuffer(aG.RENDERBUFFER,null);aG.bindFramebuffer(aG.FRAMEBUFFER,null)}l?(k=k?l.__webglFramebuffer[l.activeCubeFace]:l.__webglFramebuffer,s=l.width,l=l.height,q=r=0):(k=null,s=aj,l=S,r=aK,q=a5);k!==bv&&(aG.bindFramebuffer(aG.FRAMEBUFFER,k),aG.viewport(r,q,s,l),bv=k);aa=s;bC=l};this.readRenderTargetPixels=function(k,h,q,p,n,m){if(!(k instanceof THREE.WebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")}else{if(k.__webglFramebuffer){if(k.format!==THREE.RGBAFormat){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.")}else{var l=!1;k.__webglFramebuffer!==bv&&(aG.bindFramebuffer(aG.FRAMEBUFFER,k.__webglFramebuffer),l=!0);aG.checkFramebufferStatus(aG.FRAMEBUFFER)===aG.FRAMEBUFFER_COMPLETE?aG.readPixels(h,q,p,n,aG.RGBA,aG.UNSIGNED_BYTE,m):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.");l&&aG.bindFramebuffer(aG.FRAMEBUFFER,bv)}}}};this.initMaterial=function(){THREE.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};this.addPrePlugin=function(){THREE.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};this.addPostPlugin=function(){THREE.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};this.updateShadowMap=function(){THREE.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}};THREE.WebGLRenderTarget=function(e,d,f){this.width=e;this.height=d;f=f||{};this.wrapS=void 0!==f.wrapS?f.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=void 0!==f.wrapT?f.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=void 0!==f.magFilter?f.magFilter:THREE.LinearFilter;this.minFilter=void 0!==f.minFilter?f.minFilter:THREE.LinearMipMapLinearFilter;this.anisotropy=void 0!==f.anisotropy?f.anisotropy:1;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=void 0!==f.format?f.format:THREE.RGBAFormat;this.type=void 0!==f.type?f.type:THREE.UnsignedByteType;this.depthBuffer=void 0!==f.depthBuffer?f.depthBuffer:!0;this.stencilBuffer=void 0!==f.stencilBuffer?f.stencilBuffer:!0;this.generateMipmaps=!0;this.shareDepthFrom=void 0!==f.shareDepthFrom?f.shareDepthFrom:null};THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,setSize:function(d,c){this.width=d;this.height=c},clone:function(){var b=new THREE.WebGLRenderTarget(this.width,this.height);b.wrapS=this.wrapS;b.wrapT=this.wrapT;b.magFilter=this.magFilter;b.minFilter=this.minFilter;b.anisotropy=this.anisotropy;b.offset.copy(this.offset);b.repeat.copy(this.repeat);b.format=this.format;b.type=this.type;b.depthBuffer=this.depthBuffer;b.stencilBuffer=this.stencilBuffer;b.generateMipmaps=this.generateMipmaps;b.shareDepthFrom=this.shareDepthFrom;return b},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube=function(e,d,f){THREE.WebGLRenderTarget.call(this,e,d,f);this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube;THREE.WebGLExtensions=function(d){var c={};this.get=function(b){if(void 0!==c[b]){return c[b]}var a;switch(b){case"EXT_texture_filter_anisotropic":a=d.getExtension("EXT_texture_filter_anisotropic")||d.getExtension("MOZ_EXT_texture_filter_anisotropic")||d.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":a=d.getExtension("WEBGL_compressed_texture_s3tc")||d.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||d.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":a=d.getExtension("WEBGL_compressed_texture_pvrtc")||d.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:a=d.getExtension(b)}null===a&&THREE.warn("THREE.WebGLRenderer: "+b+" extension not supported.");return c[b]=a}};THREE.WebGLProgram=function(){var b=0;return function(R,Q,P,O){var N=R.context,M=P.defines,L=P.__webglShader.uniforms,K=P.attributes,J=P.__webglShader.vertexShader,H=P.__webglShader.fragmentShader,G=P.index0AttributeName;void 0===G&&!0===O.morphTargets&&(G="position");var I="SHADOWMAP_TYPE_BASIC";O.shadowMapType===THREE.PCFShadowMap?I="SHADOWMAP_TYPE_PCF":O.shadowMapType===THREE.PCFSoftShadowMap&&(I="SHADOWMAP_TYPE_PCF_SOFT");var B="ENVMAP_TYPE_CUBE",F="ENVMAP_MODE_REFLECTION",E="ENVMAP_BLENDING_MULTIPLY";if(O.envMap){switch(P.envMap.mapping){case THREE.CubeReflectionMapping:case THREE.CubeRefractionMapping:B="ENVMAP_TYPE_CUBE";break;case THREE.EquirectangularReflectionMapping:case THREE.EquirectangularRefractionMapping:B="ENVMAP_TYPE_EQUIREC";break;case THREE.SphericalReflectionMapping:B="ENVMAP_TYPE_SPHERE"}switch(P.envMap.mapping){case THREE.CubeRefractionMapping:case THREE.EquirectangularRefractionMapping:F="ENVMAP_MODE_REFRACTION"}switch(P.combine){case THREE.MultiplyOperation:E="ENVMAP_BLENDING_MULTIPLY";break;case THREE.MixOperation:E="ENVMAP_BLENDING_MIX";break;case THREE.AddOperation:E="ENVMAP_BLENDING_ADD"}}var A=0<R.gammaFactor?R.gammaFactor:1,o,i;o=[];for(var C in M){i=M[C],!1!==i&&(i="#define "+C+" "+i,o.push(i))}o=o.join("\n");M=N.createProgram();P instanceof THREE.RawShaderMaterial?R=P="":(P=["precision "+O.precision+" float;","precision "+O.precision+" int;",o,O.supportsVertexTextures?"#define VERTEX_TEXTURES":"",R.gammaInput?"#define GAMMA_INPUT":"",R.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+A,"#define MAX_DIR_LIGHTS "+O.maxDirLights,"#define MAX_POINT_LIGHTS "+O.maxPointLights,"#define MAX_SPOT_LIGHTS "+O.maxSpotLights,"#define MAX_HEMI_LIGHTS "+O.maxHemiLights,"#define MAX_SHADOWS "+O.maxShadows,"#define MAX_BONES "+O.maxBones,O.map?"#define USE_MAP":"",O.envMap?"#define USE_ENVMAP":"",O.envMap?"#define "+F:"",O.lightMap?"#define USE_LIGHTMAP":"",O.bumpMap?"#define USE_BUMPMAP":"",O.normalMap?"#define USE_NORMALMAP":"",O.specularMap?"#define USE_SPECULARMAP":"",O.alphaMap?"#define USE_ALPHAMAP":"",O.vertexColors?"#define USE_COLOR":"",O.flatShading?"#define FLAT_SHADED":"",O.skinning?"#define USE_SKINNING":"",O.useVertexTexture?"#define BONE_TEXTURE":"",O.morphTargets?"#define USE_MORPHTARGETS":"",O.morphNormals?"#define USE_MORPHNORMALS":"",O.wrapAround?"#define WRAP_AROUND":"",O.doubleSided?"#define DOUBLE_SIDED":"",O.flipSided?"#define FLIP_SIDED":"",O.shadowMapEnabled?"#define USE_SHADOWMAP":"",O.shadowMapEnabled?"#define "+I:"",O.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",O.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",O.sizeAttenuation?"#define USE_SIZEATTENUATION":"",O.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\n\tattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\n\tattribute vec3 morphTarget0;\n\tattribute vec3 morphTarget1;\n\tattribute vec3 morphTarget2;\n\tattribute vec3 morphTarget3;\n\t#ifdef USE_MORPHNORMALS\n\t\tattribute vec3 morphNormal0;\n\t\tattribute vec3 morphNormal1;\n\t\tattribute vec3 morphNormal2;\n\t\tattribute vec3 morphNormal3;\n\t#else\n\t\tattribute vec3 morphTarget4;\n\t\tattribute vec3 morphTarget5;\n\t\tattribute vec3 morphTarget6;\n\t\tattribute vec3 morphTarget7;\n\t#endif\n#endif\n#ifdef USE_SKINNING\n\tattribute vec4 skinIndex;\n\tattribute vec4 skinWeight;\n#endif\n"].join("\n"),R=["precision "+O.precision+" float;","precision "+O.precision+" int;",O.bumpMap||O.normalMap||O.flatShading?"#extension GL_OES_standard_derivatives : enable":"",o,"#define MAX_DIR_LIGHTS "+O.maxDirLights,"#define MAX_POINT_LIGHTS "+O.maxPointLights,"#define MAX_SPOT_LIGHTS "+O.maxSpotLights,"#define MAX_HEMI_LIGHTS "+O.maxHemiLights,"#define MAX_SHADOWS "+O.maxShadows,O.alphaTest?"#define ALPHATEST "+O.alphaTest:"",R.gammaInput?"#define GAMMA_INPUT":"",R.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+A,O.useFog&&O.fog?"#define USE_FOG":"",O.useFog&&O.fogExp?"#define FOG_EXP2":"",O.map?"#define USE_MAP":"",O.envMap?"#define USE_ENVMAP":"",O.envMap?"#define "+B:"",O.envMap?"#define "+F:"",O.envMap?"#define "+E:"",O.lightMap?"#define USE_LIGHTMAP":"",O.bumpMap?"#define USE_BUMPMAP":"",O.normalMap?"#define USE_NORMALMAP":"",O.specularMap?"#define USE_SPECULARMAP":"",O.alphaMap?"#define USE_ALPHAMAP":"",O.vertexColors?"#define USE_COLOR":"",O.flatShading?"#define FLAT_SHADED":"",O.metal?"#define METAL":"",O.wrapAround?"#define WRAP_AROUND":"",O.doubleSided?"#define DOUBLE_SIDED":"",O.flipSided?"#define FLIP_SIDED":"",O.shadowMapEnabled?"#define USE_SHADOWMAP":"",O.shadowMapEnabled?"#define "+I:"",O.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",O.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",O.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"));J=new THREE.WebGLShader(N,N.VERTEX_SHADER,P+J);H=new THREE.WebGLShader(N,N.FRAGMENT_SHADER,R+H);N.attachShader(M,J);N.attachShader(M,H);void 0!==G&&N.bindAttribLocation(M,0,G);N.linkProgram(M);G=N.getProgramInfoLog(M);!1===N.getProgramParameter(M,N.LINK_STATUS)&&THREE.error("THREE.WebGLProgram: shader error: "+N.getError(),"gl.VALIDATE_STATUS",N.getProgramParameter(M,N.VALIDATE_STATUS),"gl.getPRogramInfoLog",G);""!==G&&THREE.warn("THREE.WebGLProgram: gl.getProgramInfoLog()"+G);N.deleteShader(J);N.deleteShader(H);G="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition morphTargetInfluences bindMatrix bindMatrixInverse".split(" ");O.useVertexTexture?(G.push("boneTexture"),G.push("boneTextureWidth"),G.push("boneTextureHeight")):G.push("boneGlobalMatrices");O.logarithmicDepthBuffer&&G.push("logDepthBufFC");for(var m in L){G.push(m)}L=G;m={};G=0;for(R=L.length;G<R;G++){I=L[G],m[I]=N.getUniformLocation(M,I)}this.uniforms=m;G="position normal uv uv2 tangent color skinIndex skinWeight lineDistance".split(" ");for(L=0;L<O.maxMorphTargets;L++){G.push("morphTarget"+L)}for(L=0;L<O.maxMorphNormals;L++){G.push("morphNormal"+L)}for(var a in K){G.push(a)}O=G;K={};a=0;for(L=O.length;a<L;a++){m=O[a],K[m]=N.getAttribLocation(M,m)}this.attributes=K;this.attributesKeys=Object.keys(this.attributes);this.id=b++;this.code=Q;this.usedTimes=1;this.program=M;this.vertexShader=J;this.fragmentShader=H;return this}}();THREE.WebGLShader=function(){var b=function(d){d=d.split("\n");for(var e=0;e<d.length;e++){d[e]=e+1+": "+d[e]}return d.join("\n")};return function(a,f,e){f=a.createShader(f);a.shaderSource(f,e);a.compileShader(f);!1===a.getShaderParameter(f,a.COMPILE_STATUS)&&THREE.error("THREE.WebGLShader: Shader couldn't compile.");""!==a.getShaderInfoLog(f)&&THREE.warn("THREE.WebGLShader: gl.getShaderInfoLog()",a.getShaderInfoLog(f),b(e));return f}}();THREE.WebGLState=function(R,Q){var P=new Uint8Array(16),O=new Uint8Array(16),N=null,M=null,L=null,K=null,J=null,I=null,G=null,F=null,H=null,A=null,E=null,C=null,o=null,m=null,i=null,B=null;this.initAttributes=function(){for(var d=0,c=P.length;d<c;d++){P[d]=0}};this.enableAttribute=function(a){P[a]=1;0===O[a]&&(R.enableVertexAttribArray(a),O[a]=1)};this.disableUnusedAttributes=function(){for(var a=0,c=O.length;a<c;a++){O[a]!==P[a]&&(R.disableVertexAttribArray(a),O[a]=0)}};this.setBlending=function(k,g,h,f,e,b,a){k!==N&&(k===THREE.NoBlending?R.disable(R.BLEND):k===THREE.AdditiveBlending?(R.enable(R.BLEND),R.blendEquation(R.FUNC_ADD),R.blendFunc(R.SRC_ALPHA,R.ONE)):k===THREE.SubtractiveBlending?(R.enable(R.BLEND),R.blendEquation(R.FUNC_ADD),R.blendFunc(R.ZERO,R.ONE_MINUS_SRC_COLOR)):k===THREE.MultiplyBlending?(R.enable(R.BLEND),R.blendEquation(R.FUNC_ADD),R.blendFunc(R.ZERO,R.SRC_COLOR)):k===THREE.CustomBlending?R.enable(R.BLEND):(R.enable(R.BLEND),R.blendEquationSeparate(R.FUNC_ADD,R.FUNC_ADD),R.blendFuncSeparate(R.SRC_ALPHA,R.ONE_MINUS_SRC_ALPHA,R.ONE,R.ONE_MINUS_SRC_ALPHA)),N=k);if(k===THREE.CustomBlending){e=e||g;b=b||h;a=a||f;if(g!==M||e!==J){R.blendEquationSeparate(Q(g),Q(e)),M=g,J=e}if(h!==L||f!==K||b!==I||a!==G){R.blendFuncSeparate(Q(h),Q(f),Q(b),Q(a)),L=h,K=f,I=b,G=a}}else{G=I=J=K=L=M=null}};this.setDepthTest=function(a){F!==a&&(a?R.enable(R.DEPTH_TEST):R.disable(R.DEPTH_TEST),F=a)};this.setDepthWrite=function(a){H!==a&&(R.depthMask(a),H=a)};this.setColorWrite=function(a){A!==a&&(R.colorMask(a,a,a,a),A=a)};this.setDoubleSided=function(a){E!==a&&(a?R.disable(R.CULL_FACE):R.enable(R.CULL_FACE),E=a)};this.setFlipSided=function(a){C!==a&&(a?R.frontFace(R.CW):R.frontFace(R.CCW),C=a)};this.setLineWidth=function(a){a!==o&&(R.lineWidth(a),o=a)};this.setPolygonOffset=function(a,f,e){m!==a&&(a?R.enable(R.POLYGON_OFFSET_FILL):R.disable(R.POLYGON_OFFSET_FILL),m=a);!a||i===f&&B===e||(R.polygonOffset(f,e),i=f,B=e)};this.reset=function(){for(var b=0;b<O.length;b++){O[b]=0}C=E=A=H=F=N=null}};THREE.LensFlarePlugin=function(P,O){var N,M,L,K,J,I,H,G,E,D,F=P.context,A,C,B,o,m,i;this.render=function(a,q,n,b){if(0!==O.length){a=new THREE.Vector3;var u=b/n,s=0.5*n,t=0.5*b,l=16/b,p=new THREE.Vector2(l*u,l),d=new THREE.Vector3(1,1,0),h=new THREE.Vector2(1,1);if(void 0===B){var l=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),r=new Uint16Array([0,1,2,0,2,3]);A=F.createBuffer();C=F.createBuffer();F.bindBuffer(F.ARRAY_BUFFER,A);F.bufferData(F.ARRAY_BUFFER,l,F.STATIC_DRAW);F.bindBuffer(F.ELEMENT_ARRAY_BUFFER,C);F.bufferData(F.ELEMENT_ARRAY_BUFFER,r,F.STATIC_DRAW);m=F.createTexture();i=F.createTexture();F.bindTexture(F.TEXTURE_2D,m);F.texImage2D(F.TEXTURE_2D,0,F.RGB,16,16,0,F.RGB,F.UNSIGNED_BYTE,null);F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE);F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE);F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.NEAREST);F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.NEAREST);F.bindTexture(F.TEXTURE_2D,i);F.texImage2D(F.TEXTURE_2D,0,F.RGBA,16,16,0,F.RGBA,F.UNSIGNED_BYTE,null);F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE);F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE);F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.NEAREST);F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.NEAREST);var l=(o=0<F.getParameter(F.MAX_VERTEX_TEXTURE_IMAGE_UNITS))?{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform lowp int renderType;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},r=F.createProgram(),k=F.createShader(F.FRAGMENT_SHADER),f=F.createShader(F.VERTEX_SHADER),g="precision "+P.getPrecision()+" float;\n";F.shaderSource(k,g+l.fragmentShader);F.shaderSource(f,g+l.vertexShader);F.compileShader(k);F.compileShader(f);F.attachShader(r,k);F.attachShader(r,f);F.linkProgram(r);B=r;E=F.getAttribLocation(B,"position");D=F.getAttribLocation(B,"uv");N=F.getUniformLocation(B,"renderType");M=F.getUniformLocation(B,"map");L=F.getUniformLocation(B,"occlusionMap");K=F.getUniformLocation(B,"opacity");J=F.getUniformLocation(B,"color");I=F.getUniformLocation(B,"scale");H=F.getUniformLocation(B,"rotation");G=F.getUniformLocation(B,"screenPosition")}F.useProgram(B);F.enableVertexAttribArray(E);F.enableVertexAttribArray(D);F.uniform1i(L,0);F.uniform1i(M,1);F.bindBuffer(F.ARRAY_BUFFER,A);F.vertexAttribPointer(E,2,F.FLOAT,!1,16,0);F.vertexAttribPointer(D,2,F.FLOAT,!1,16,8);F.bindBuffer(F.ELEMENT_ARRAY_BUFFER,C);F.disable(F.CULL_FACE);F.depthMask(!1);r=0;for(k=O.length;r<k;r++){if(l=16/b,p.set(l*u,l),f=O[r],a.set(f.matrixWorld.elements[12],f.matrixWorld.elements[13],f.matrixWorld.elements[14]),a.applyMatrix4(q.matrixWorldInverse),a.applyProjection(q.projectionMatrix),d.copy(a),h.x=d.x*s+s,h.y=d.y*t+t,o||0<h.x&&h.x<n&&0<h.y&&h.y<b){F.activeTexture(F.TEXTURE1);F.bindTexture(F.TEXTURE_2D,m);F.copyTexImage2D(F.TEXTURE_2D,0,F.RGB,h.x-8,h.y-8,16,16,0);F.uniform1i(N,0);F.uniform2f(I,p.x,p.y);F.uniform3f(G,d.x,d.y,d.z);F.disable(F.BLEND);F.enable(F.DEPTH_TEST);F.drawElements(F.TRIANGLES,6,F.UNSIGNED_SHORT,0);F.activeTexture(F.TEXTURE0);F.bindTexture(F.TEXTURE_2D,i);F.copyTexImage2D(F.TEXTURE_2D,0,F.RGBA,h.x-8,h.y-8,16,16,0);F.uniform1i(N,1);F.disable(F.DEPTH_TEST);F.activeTexture(F.TEXTURE1);F.bindTexture(F.TEXTURE_2D,m);F.drawElements(F.TRIANGLES,6,F.UNSIGNED_SHORT,0);f.positionScreen.copy(d);f.customUpdateCallback?f.customUpdateCallback(f):f.updateLensFlares();F.uniform1i(N,2);F.enable(F.BLEND);for(var g=0,e=f.lensFlares.length;g<e;g++){var c=f.lensFlares[g];0.001<c.opacity&&0.001<c.scale&&(d.x=c.x,d.y=c.y,d.z=c.z,l=c.size*c.scale/b,p.x=l*u,p.y=l,F.uniform3f(G,d.x,d.y,d.z),F.uniform2f(I,p.x,p.y),F.uniform1f(H,c.rotation),F.uniform1f(K,c.opacity),F.uniform3f(J,c.color.r,c.color.g,c.color.b),P.state.setBlending(c.blending,c.blendEquation,c.blendSrc,c.blendDst),P.setTexture(c.texture,1),F.drawElements(F.TRIANGLES,6,F.UNSIGNED_SHORT,0))}}}F.enable(F.CULL_FACE);F.enable(F.DEPTH_TEST);F.depthMask(!0);P.resetGLState()}}};THREE.ShadowMapPlugin=function(O,N,M,L){function K(e,c,r){if(c.visible){var q=M[c.id];if(q&&c.castShadow&&(!1===c.frustumCulled||!0===D.intersectsObject(c))){for(var p=0,n=q.length;p<n;p++){var l=q[p];c._modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,c.matrixWorld);A.push(l)}}p=0;for(n=c.children.length;p<n;p++){K(e,c.children[p],r)}}}var J=O.context,I,H,G,F,D=new THREE.Frustum,C=new THREE.Matrix4,E=new THREE.Vector3,o=new THREE.Vector3,B=new THREE.Vector3,A=[],m=THREE.ShaderLib.depthRGBA,i=THREE.UniformsUtils.clone(m.uniforms);I=new THREE.ShaderMaterial({uniforms:i,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader});H=new THREE.ShaderMaterial({uniforms:i,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,morphTargets:!0});G=new THREE.ShaderMaterial({uniforms:i,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,skinning:!0});F=new THREE.ShaderMaterial({uniforms:i,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,morphTargets:!0,skinning:!0});I._shadowPass=!0;H._shadowPass=!0;G._shadowPass=!0;F._shadowPass=!0;this.render=function(g,n){if(!1!==O.shadowMapEnabled){var q,h,a,s,p,r,f,k,b=[];s=0;J.clearColor(1,1,1,1);J.disable(J.BLEND);J.enable(J.CULL_FACE);J.frontFace(J.CCW);O.shadowMapCullFace===THREE.CullFaceFront?J.cullFace(J.FRONT):J.cullFace(J.BACK);O.state.setDepthTest(!0);q=0;for(h=N.length;q<h;q++){if(a=N[q],a.castShadow){if(a instanceof THREE.DirectionalLight&&a.shadowCascade){for(p=0;p<a.shadowCascadeCount;p++){var d;if(a.shadowCascadeArray[p]){d=a.shadowCascadeArray[p]}else{f=a;var l=p;d=new THREE.DirectionalLight;d.isVirtual=!0;d.onlyShadow=!0;d.castShadow=!0;d.shadowCameraNear=f.shadowCameraNear;d.shadowCameraFar=f.shadowCameraFar;d.shadowCameraLeft=f.shadowCameraLeft;d.shadowCameraRight=f.shadowCameraRight;d.shadowCameraBottom=f.shadowCameraBottom;d.shadowCameraTop=f.shadowCameraTop;d.shadowCameraVisible=f.shadowCameraVisible;d.shadowDarkness=f.shadowDarkness;d.shadowBias=f.shadowCascadeBias[l];d.shadowMapWidth=f.shadowCascadeWidth[l];d.shadowMapHeight=f.shadowCascadeHeight[l];d.pointsWorld=[];d.pointsFrustum=[];k=d.pointsWorld;r=d.pointsFrustum;for(var e=0;8>e;e++){k[e]=new THREE.Vector3,r[e]=new THREE.Vector3}k=f.shadowCascadeNearZ[l];f=f.shadowCascadeFarZ[l];r[0].set(-1,-1,k);r[1].set(1,-1,k);r[2].set(-1,1,k);r[3].set(1,1,k);r[4].set(-1,-1,f);r[5].set(1,-1,f);r[6].set(-1,1,f);r[7].set(1,1,f);d.originalCamera=n;r=new THREE.Gyroscope;r.position.copy(a.shadowCascadeOffset);r.add(d);r.add(d.target);n.add(r);a.shadowCascadeArray[p]=d}l=a;k=p;f=l.shadowCascadeArray[k];f.position.copy(l.position);f.target.position.copy(l.target.position);f.lookAt(f.target);f.shadowCameraVisible=l.shadowCameraVisible;f.shadowDarkness=l.shadowDarkness;f.shadowBias=l.shadowCascadeBias[k];r=l.shadowCascadeNearZ[k];l=l.shadowCascadeFarZ[k];f=f.pointsFrustum;f[0].z=r;f[1].z=r;f[2].z=r;f[3].z=r;f[4].z=l;f[5].z=l;f[6].z=l;f[7].z=l;b[s]=d;s++}}else{b[s]=a,s++}}}q=0;for(h=b.length;q<h;q++){a=b[q];a.shadowMap||(p=THREE.LinearFilter,O.shadowMapType===THREE.PCFSoftShadowMap&&(p=THREE.NearestFilter),a.shadowMap=new THREE.WebGLRenderTarget(a.shadowMapWidth,a.shadowMapHeight,{minFilter:p,magFilter:p,format:THREE.RGBAFormat}),a.shadowMapSize=new THREE.Vector2(a.shadowMapWidth,a.shadowMapHeight),a.shadowMatrix=new THREE.Matrix4);if(!a.shadowCamera){if(a instanceof THREE.SpotLight){a.shadowCamera=new THREE.PerspectiveCamera(a.shadowCameraFov,a.shadowMapWidth/a.shadowMapHeight,a.shadowCameraNear,a.shadowCameraFar)}else{if(a instanceof THREE.DirectionalLight){a.shadowCamera=new THREE.OrthographicCamera(a.shadowCameraLeft,a.shadowCameraRight,a.shadowCameraTop,a.shadowCameraBottom,a.shadowCameraNear,a.shadowCameraFar)}else{THREE.error("THREE.ShadowMapPlugin: Unsupported light type for shadow",a);continue}}g.add(a.shadowCamera);!0===g.autoUpdate&&g.updateMatrixWorld()}a.shadowCameraVisible&&!a.cameraHelper&&(a.cameraHelper=new THREE.CameraHelper(a.shadowCamera),g.add(a.cameraHelper));if(a.isVirtual&&d.originalCamera==n){p=n;s=a.shadowCamera;r=a.pointsFrustum;f=a.pointsWorld;E.set(Infinity,Infinity,Infinity);o.set(-Infinity,-Infinity,-Infinity);for(l=0;8>l;l++){k=f[l],k.copy(r[l]),k.unproject(p),k.applyMatrix4(s.matrixWorldInverse),k.x<E.x&&(E.x=k.x),k.x>o.x&&(o.x=k.x),k.y<E.y&&(E.y=k.y),k.y>o.y&&(o.y=k.y),k.z<E.z&&(E.z=k.z),k.z>o.z&&(o.z=k.z)}s.left=E.x;s.right=o.x;s.top=o.y;s.bottom=E.y;s.updateProjectionMatrix()}s=a.shadowMap;r=a.shadowMatrix;p=a.shadowCamera;p.position.setFromMatrixPosition(a.matrixWorld);B.setFromMatrixPosition(a.target.matrixWorld);p.lookAt(B);p.updateMatrixWorld();p.matrixWorldInverse.getInverse(p.matrixWorld);a.cameraHelper&&(a.cameraHelper.visible=a.shadowCameraVisible);a.shadowCameraVisible&&a.cameraHelper.update();r.set(0.5,0,0,0.5,0,0.5,0,0.5,0,0,0.5,0.5,0,0,0,1);r.multiply(p.projectionMatrix);r.multiply(p.matrixWorldInverse);C.multiplyMatrices(p.projectionMatrix,p.matrixWorldInverse);D.setFromMatrix(C);O.setRenderTarget(s);O.clear();A.length=0;K(g,g,p);a=0;for(s=A.length;a<s;a++){f=A[a],r=f.object,f=f.buffer,l=r.material instanceof THREE.MeshFaceMaterial?r.material.materials[0]:r.material,k=void 0!==r.geometry.morphTargets&&0<r.geometry.morphTargets.length&&l.morphTargets,e=r instanceof THREE.SkinnedMesh&&l.skinning,k=r.customDepthMaterial?r.customDepthMaterial:e?k?F:G:k?H:I,O.setMaterialFaces(l),f instanceof THREE.BufferGeometry?O.renderBufferDirect(p,N,null,k,f,r):O.renderBuffer(p,N,null,k,f,r)}a=0;for(s=L.length;a<s;a++){f=L[a],r=f.object,r.visible&&r.castShadow&&(r._modelViewMatrix.multiplyMatrices(p.matrixWorldInverse,r.matrixWorld),O.renderImmediateObject(p,N,null,I,r))}}q=O.getClearColor();h=O.getClearAlpha();J.clearColor(q.r,q.g,q.b,h);J.enable(J.BLEND);O.shadowMapCullFace===THREE.CullFaceFront&&J.cullFace(J.BACK);O.resetGLState()}}};THREE.SpritePlugin=function(ae,ad){var ac,ab,aa,Z,Y,X,W,V,T,R,U,N,Q,P,L,J,B;function O(d,c){return d.z!==c.z?c.z-d.z:c.id-d.id}var C=ae.context,m,S,M,H,K=new THREE.Vector3,i=new THREE.Quaternion,o=new THREE.Vector3;this.render=function(b,f){if(0!==ad.length){if(void 0===M){var k=new Float32Array([-0.5,-0.5,0,0,0.5,-0.5,1,0,0.5,0.5,1,1,-0.5,0.5,0,1]),g=new Uint16Array([0,1,2,0,2,3]);m=C.createBuffer();S=C.createBuffer();C.bindBuffer(C.ARRAY_BUFFER,m);C.bufferData(C.ARRAY_BUFFER,k,C.STATIC_DRAW);C.bindBuffer(C.ELEMENT_ARRAY_BUFFER,S);C.bufferData(C.ELEMENT_ARRAY_BUFFER,g,C.STATIC_DRAW);var k=C.createProgram(),g=C.createShader(C.VERTEX_SHADER),d=C.createShader(C.FRAGMENT_SHADER);C.shaderSource(g,["precision "+ae.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n"));C.shaderSource(d,["precision "+ae.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n"));C.compileShader(g);C.compileShader(d);C.attachShader(k,g);C.attachShader(k,d);C.linkProgram(k);M=k;J=C.getAttribLocation(M,"position");B=C.getAttribLocation(M,"uv");ac=C.getUniformLocation(M,"uvOffset");ab=C.getUniformLocation(M,"uvScale");aa=C.getUniformLocation(M,"rotation");Z=C.getUniformLocation(M,"scale");Y=C.getUniformLocation(M,"color");X=C.getUniformLocation(M,"map");W=C.getUniformLocation(M,"opacity");V=C.getUniformLocation(M,"modelViewMatrix");T=C.getUniformLocation(M,"projectionMatrix");R=C.getUniformLocation(M,"fogType");U=C.getUniformLocation(M,"fogDensity");N=C.getUniformLocation(M,"fogNear");Q=C.getUniformLocation(M,"fogFar");P=C.getUniformLocation(M,"fogColor");L=C.getUniformLocation(M,"alphaTest");k=document.createElement("canvas");k.width=8;k.height=8;g=k.getContext("2d");g.fillStyle="white";g.fillRect(0,0,8,8);H=new THREE.Texture(k);H.needsUpdate=!0}C.useProgram(M);C.enableVertexAttribArray(J);C.enableVertexAttribArray(B);C.disable(C.CULL_FACE);C.enable(C.BLEND);C.bindBuffer(C.ARRAY_BUFFER,m);C.vertexAttribPointer(J,2,C.FLOAT,!1,16,0);C.vertexAttribPointer(B,2,C.FLOAT,!1,16,8);C.bindBuffer(C.ELEMENT_ARRAY_BUFFER,S);C.uniformMatrix4fv(T,!1,f.projectionMatrix.elements);C.activeTexture(C.TEXTURE0);C.uniform1i(X,0);g=k=0;(d=b.fog)?(C.uniform3f(P,d.color.r,d.color.g,d.color.b),d instanceof THREE.Fog?(C.uniform1f(N,d.near),C.uniform1f(Q,d.far),C.uniform1i(R,1),g=k=1):d instanceof THREE.FogExp2&&(C.uniform1f(U,d.density),C.uniform1i(R,2),g=k=2)):(C.uniform1i(R,0),g=k=0);for(var d=0,e=ad.length;d<e;d++){var c=ad[d];c._modelViewMatrix.multiplyMatrices(f.matrixWorldInverse,c.matrixWorld);c.z=-c._modelViewMatrix.elements[14]}ad.sort(O);for(var a=[],d=0,e=ad.length;d<e;d++){var c=ad[d],h=c.material;C.uniform1f(L,h.alphaTest);C.uniformMatrix4fv(V,!1,c._modelViewMatrix.elements);c.matrixWorld.decompose(K,i,o);a[0]=o.x;a[1]=o.y;c=0;b.fog&&h.fog&&(c=g);k!==c&&(C.uniform1i(R,c),k=c);null!==h.map?(C.uniform2f(ac,h.map.offset.x,h.map.offset.y),C.uniform2f(ab,h.map.repeat.x,h.map.repeat.y)):(C.uniform2f(ac,0,0),C.uniform2f(ab,1,1));C.uniform1f(W,h.opacity);C.uniform3f(Y,h.color.r,h.color.g,h.color.b);C.uniform1f(aa,h.rotation);C.uniform2fv(Z,a);ae.state.setBlending(h.blending,h.blendEquation,h.blendSrc,h.blendDst);ae.state.setDepthTest(h.depthTest);ae.state.setDepthWrite(h.depthWrite);h.map&&h.map.image&&h.map.image.width?ae.setTexture(h.map,0):ae.setTexture(H,0);C.drawElements(C.TRIANGLES,6,C.UNSIGNED_SHORT,0)}C.enable(C.CULL_FACE);ae.resetGLState()}}};THREE.GeometryUtils={merge:function(f,e,h){THREE.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var g;e instanceof THREE.Mesh&&(e.matrixAutoUpdate&&e.updateMatrix(),g=e.matrix,e=e.geometry);f.merge(e,g,h)},center:function(b){THREE.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return b.center()}};THREE.ImageUtils={crossOrigin:void 0,loadTexture:function(h,g,m,l){var k=new THREE.ImageLoader;k.crossOrigin=this.crossOrigin;var i=new THREE.Texture(void 0,g);k.load(h,function(b){i.image=b;i.needsUpdate=!0;m&&m(i)},void 0,function(b){l&&l(b)});i.sourceFile=h;return i},loadTextureCube:function(s,r,q,p){var o=new THREE.ImageLoader;o.crossOrigin=this.crossOrigin;var n=new THREE.CubeTexture([],r);n.flipY=!1;var m=0;r=function(a){o.load(s[a],function(b){n.images[a]=b;m+=1;6===m&&(n.needsUpdate=!0,q&&q(n))},void 0,p)};for(var l=0,i=s.length;l<i;++l){r(l)}return n},loadCompressedTexture:function(){THREE.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){THREE.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(P,O){var N=function(d){var c=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);return[d[0]/c,d[1]/c,d[2]/c]};O|=1;var M=P.width,L=P.height,K=document.createElement("canvas");K.width=M;K.height=L;var J=K.getContext("2d");J.drawImage(P,0,0);for(var I=J.getImageData(0,0,M,L).data,H=J.createImageData(M,L),G=H.data,E=0;E<M;E++){for(var D=0;D<L;D++){var F=0>D-1?0:D-1,A=D+1>L-1?L-1:D+1,C=0>E-1?0:E-1,B=E+1>M-1?M-1:E+1,o=[],m=[0,0,I[4*(D*M+E)]/255*O];o.push([-1,0,I[4*(D*M+C)]/255*O]);o.push([-1,-1,I[4*(F*M+C)]/255*O]);o.push([0,-1,I[4*(F*M+E)]/255*O]);o.push([1,-1,I[4*(F*M+B)]/255*O]);o.push([1,0,I[4*(D*M+B)]/255*O]);o.push([1,1,I[4*(A*M+B)]/255*O]);o.push([0,1,I[4*(A*M+E)]/255*O]);o.push([-1,1,I[4*(A*M+C)]/255*O]);F=[];C=o.length;for(A=0;A<C;A++){var B=o[A],i=o[(A+1)%C],B=[B[0]-m[0],B[1]-m[1],B[2]-m[2]],i=[i[0]-m[0],i[1]-m[1],i[2]-m[2]];F.push(N([B[1]*i[2]-B[2]*i[1],B[2]*i[0]-B[0]*i[2],B[0]*i[1]-B[1]*i[0]]))}o=[0,0,0];for(A=0;A<F.length;A++){o[0]+=F[A][0],o[1]+=F[A][1],o[2]+=F[A][2]}o[0]/=F.length;o[1]/=F.length;o[2]/=F.length;m=4*(D*M+E);G[m]=(o[0]+1)/2*255|0;G[m+1]=(o[1]+1)/2*255|0;G[m+2]=255*o[2]|0;G[m+3]=255}}J.putImageData(H,0,0);return K},generateDataTexture:function(k,i,q){var p=k*i,o=new Uint8Array(3*p),n=Math.floor(255*q.r),m=Math.floor(255*q.g);q=Math.floor(255*q.b);for(var l=0;l<p;l++){o[3*l]=n,o[3*l+1]=m,o[3*l+2]=q}k=new THREE.DataTexture(o,k,i,THREE.RGBFormat);k.needsUpdate=!0;return k}};THREE.SceneUtils={createMultiMaterialObject:function(g,f){for(var k=new THREE.Object3D,i=0,h=f.length;i<h;i++){k.add(new THREE.Mesh(g,f[i]))}return k},detach:function(e,d,f){e.applyMatrix(d.matrixWorld);d.remove(e);f.add(e)},attach:function(f,e,h){var g=new THREE.Matrix4;g.getInverse(h.matrixWorld);f.applyMatrix(g);e.remove(f);h.add(f)}};THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(b){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(d){var c=d.familyName.toLowerCase();this.faces[c]=this.faces[c]||{};this.faces[c][d.cssFontWeight]=this.faces[c][d.cssFontWeight]||{};this.faces[c][d.cssFontWeight][d.cssFontStyle]=d;return this.faces[c][d.cssFontWeight][d.cssFontStyle]=d},drawText:function(k){var i=this.getFace(),q=this.size/i.resolution,p=0,o=String(k).split(""),n=o.length,m=[];for(k=0;k<n;k++){var l=new THREE.Path,l=this.extractGlyphPoints(o[k],i,q,p,l),p=p+l.offset;m.push(l.path)}return{paths:m,offset:p/2}},extractGlyphPoints:function(P,O,N,M,L){var K=[],J,I,H,G,E,D,F,A,C,B,o,m=O.glyphs[P]||O.glyphs["?"];if(m){if(m.o){for(O=m._cachedOutline||(m._cachedOutline=m.o.split(" ")),G=O.length,P=0;P<G;){switch(H=O[P++],H){case"m":H=O[P++]*N+M;E=O[P++]*N;L.moveTo(H,E);break;case"l":H=O[P++]*N+M;E=O[P++]*N;L.lineTo(H,E);break;case"q":H=O[P++]*N+M;E=O[P++]*N;A=O[P++]*N+M;C=O[P++]*N;L.quadraticCurveTo(A,C,H,E);if(J=K[K.length-1]){for(D=J.x,F=J.y,J=1,I=this.divisions;J<=I;J++){var i=J/I;THREE.Shape.Utils.b2(i,D,A,H);THREE.Shape.Utils.b2(i,F,C,E)}}break;case"b":if(H=O[P++]*N+M,E=O[P++]*N,A=O[P++]*N+M,C=O[P++]*N,B=O[P++]*N+M,o=O[P++]*N,L.bezierCurveTo(A,C,B,o,H,E),J=K[K.length-1]){for(D=J.x,F=J.y,J=1,I=this.divisions;J<=I;J++){i=J/I,THREE.Shape.Utils.b3(i,D,A,B,H),THREE.Shape.Utils.b3(i,F,C,o,E)}}}}}return{offset:m.ha*N,path:L}}}};THREE.FontUtils.generateShapes=function(h,g){g=g||{};var m=void 0!==g.curveSegments?g.curveSegments:4,l=void 0!==g.font?g.font:"helvetiker",k=void 0!==g.weight?g.weight:"normal",i=void 0!==g.style?g.style:"normal";THREE.FontUtils.size=void 0!==g.size?g.size:100;THREE.FontUtils.divisions=m;THREE.FontUtils.face=l;THREE.FontUtils.weight=k;THREE.FontUtils.style=i;m=THREE.FontUtils.drawText(h).paths;l=[];k=0;for(i=m.length;k<i;k++){Array.prototype.push.apply(l,m[k].toShapes())}return l};(function(d){var c=function(i){for(var h=i.length,m=0,l=h-1,k=0;k<h;l=k++){m+=i[l].x*i[k].y-i[k].x*i[l].y}return 0.5*m};d.Triangulate=function(ah,ag){var af=ah.length;if(3>af){return null}var ae=[],ad=[],ac=[],ab,aa,Y;if(0<c(ah)){for(aa=0;aa<af;aa++){ad[aa]=aa}}else{for(aa=0;aa<af;aa++){ad[aa]=af-1-aa}}var W=2*af;for(aa=af-1;2<af;){if(0>=W--){THREE.warn("THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()");break}ab=aa;af<=ab&&(ab=0);aa=ab+1;af<=aa&&(aa=0);Y=aa+1;af<=Y&&(Y=0);var Z;ah:{var R=Z=void 0,V=void 0,T=void 0,P=void 0,N=void 0,C=void 0,S=void 0,K=void 0,R=ah[ad[ab]].x,V=ah[ad[ab]].y,T=ah[ad[aa]].x,P=ah[ad[aa]].y,N=ah[ad[Y]].x,C=ah[ad[Y]].y;if(1e-10>(T-R)*(C-V)-(P-V)*(N-R)){Z=!1}else{var o=void 0,X=void 0,Q=void 0,L=void 0,O=void 0,m=void 0,B=void 0,b=void 0,i=void 0,J=void 0,i=b=B=K=S=void 0,o=N-T,X=C-P,Q=R-N,L=V-C,O=T-R,m=P-V;for(Z=0;Z<af;Z++){if(S=ah[ad[Z]].x,K=ah[ad[Z]].y,!(S===R&&K===V||S===T&&K===P||S===N&&K===C)&&(B=S-R,b=K-V,i=S-T,J=K-P,S-=N,K-=C,i=o*J-X*i,B=O*b-m*B,b=Q*K-L*S,-1e-10<=i&&-1e-10<=b&&-1e-10<=B)){Z=!1;break ah}}Z=!0}}if(Z){ae.push([ah[ad[ab]],ah[ad[aa]],ah[ad[Y]]]);ac.push([ad[ab],ad[aa],ad[Y]]);ab=aa;for(Y=aa+1;Y<af;ab++,Y++){ad[ab]=ad[Y]}af--;W=2*af}}return ag?ac:ae};d.Triangulate.area=c;return d})(THREE.FontUtils);self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};THREE.typeface_js=self._typeface_js;THREE.Audio=function(b){THREE.Object3D.call(this);this.type="Audio";this.context=b.context;this.source=this.context.createBufferSource();this.source.onended=this.onEnded.bind(this);this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.panner=this.context.createPanner();this.panner.connect(this.gain);this.autoplay=!1;this.startTime=0;this.isPlaying=!1};THREE.Audio.prototype=Object.create(THREE.Object3D.prototype);THREE.Audio.prototype.constructor=THREE.Audio;THREE.Audio.prototype.load=function(e){var d=this,f=new XMLHttpRequest;f.open("GET",e,!0);f.responseType="arraybuffer";f.onload=function(b){d.context.decodeAudioData(this.response,function(c){d.source.buffer=c;d.autoplay&&d.play()})};f.send();return this};THREE.Audio.prototype.play=function(){if(!0===this.isPlaying){THREE.warn("THREE.Audio: Audio is already playing.")}else{var b=this.context.createBufferSource();b.buffer=this.source.buffer;b.loop=this.source.loop;b.onended=this.source.onended;b.connect(this.panner);b.start(0,this.startTime);this.isPlaying=!0;this.source=b}};THREE.Audio.prototype.pause=function(){this.source.stop();this.startTime=this.context.currentTime};THREE.Audio.prototype.stop=function(){this.source.stop();this.startTime=0};THREE.Audio.prototype.onEnded=function(){this.isPlaying=!1};THREE.Audio.prototype.setLoop=function(b){this.source.loop=b};THREE.Audio.prototype.setRefDistance=function(b){this.panner.refDistance=b};THREE.Audio.prototype.setRolloffFactor=function(b){this.panner.rolloffFactor=b};THREE.Audio.prototype.setVolume=function(b){this.gain.gain.value=b};THREE.Audio.prototype.updateMatrixWorld=function(){var b=new THREE.Vector3;return function(a){THREE.Object3D.prototype.updateMatrixWorld.call(this,a);b.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(b.x,b.y,b.z)}}();THREE.AudioListener=function(){THREE.Object3D.call(this);this.type="AudioListener";this.context=new (window.AudioContext||window.webkitAudioContext)};THREE.AudioListener.prototype=Object.create(THREE.Object3D.prototype);THREE.AudioListener.prototype.constructor=THREE.AudioListener;THREE.AudioListener.prototype.updateMatrixWorld=function(){var h=new THREE.Vector3,g=new THREE.Quaternion,m=new THREE.Vector3,l=new THREE.Vector3,k=new THREE.Vector3,i=new THREE.Vector3;return function(b){THREE.Object3D.prototype.updateMatrixWorld.call(this,b);b=this.context.listener;var a=this.up;this.matrixWorld.decompose(h,g,m);l.set(0,0,-1).applyQuaternion(g);k.subVectors(h,i);b.setPosition(h.x,h.y,h.z);b.setOrientation(l.x,l.y,l.z,a.x,a.y,a.z);b.setVelocity(k.x,k.y,k.z);i.copy(h)}}();THREE.Curve=function(){};THREE.Curve.prototype.getPoint=function(b){THREE.warn("THREE.Curve: Warning, getPoint() not implemented!");return null};THREE.Curve.prototype.getPointAt=function(b){b=this.getUtoTmapping(b);return this.getPoint(b)};THREE.Curve.prototype.getPoints=function(e){e||(e=5);var d,f=[];for(d=0;d<=e;d++){f.push(this.getPoint(d/e))}return f};THREE.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var d,f=[];for(d=0;d<=e;d++){f.push(this.getPointAt(d/e))}return f};THREE.Curve.prototype.getLength=function(){var b=this.getLengths();return b[b.length-1]};THREE.Curve.prototype.getLengths=function(h){h||(h=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length==h+1&&!this.needsUpdate){return this.cacheArcLengths}this.needsUpdate=!1;var g=[],m,l=this.getPoint(0),k,i=0;g.push(0);for(k=1;k<=h;k++){m=this.getPoint(k/h),i+=m.distanceTo(l),g.push(i),l=m}return this.cacheArcLengths=g};THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0;this.getLengths()};THREE.Curve.prototype.getUtoTmapping=function(s,r){var q=this.getLengths(),p=0,o=q.length,n;n=r?r:s*q[o-1];for(var m=0,l=o-1,i;m<=l;){if(p=Math.floor(m+(l-m)/2),i=q[p]-n,0>i){m=p+1}else{if(0<i){l=p-1}else{l=p;break}}}p=l;if(q[p]==n){return p/(o-1)}m=q[p];return q=(p+(n-m)/(q[p+1]-m))/(o-1)};THREE.Curve.prototype.getTangent=function(d){var c=d-0.0001;d+=0.0001;0>c&&(c=0);1<d&&(d=1);c=this.getPoint(c);return this.getPoint(d).clone().sub(c).normalize()};THREE.Curve.prototype.getTangentAt=function(b){b=this.getUtoTmapping(b);return this.getTangent(b)};THREE.Curve.Utils={tangentQuadraticBezier:function(f,e,h,g){return 2*(1-f)*(h-e)+2*f*(g-h)},tangentCubicBezier:function(g,f,k,i,h){return -3*f*(1-g)*(1-g)+3*k*(1-g)*(1-g)-6*g*k*(1-g)+6*g*i*(1-g)-3*g*g*i+3*g*g*h},tangentSpline:function(g,f,k,i,h){return 6*g*g-6*g+(3*g*g-4*g+1)+(-6*g*g+6*g)+(3*g*g-2*g)},interpolate:function(h,g,m,l,k){h=0.5*(m-h);l=0.5*(l-g);var i=k*k;return(2*g-2*m+h+l)*k*i+(-3*g+3*m-2*h-l)*i+h*k+g}};THREE.Curve.create=function(d,c){d.prototype=Object.create(THREE.Curve.prototype);d.prototype.constructor=d;d.prototype.getPoint=c;return d};THREE.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=!1};THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype);THREE.CurvePath.prototype.constructor=THREE.CurvePath;THREE.CurvePath.prototype.add=function(b){this.curves.push(b)};THREE.CurvePath.prototype.checkConnection=function(){};THREE.CurvePath.prototype.closePath=function(){var d=this.curves[0].getPoint(0),c=this.curves[this.curves.length-1].getPoint(1);d.equals(c)||this.curves.push(new THREE.LineCurve(c,d))};THREE.CurvePath.prototype.getPoint=function(e){var d=e*this.getLength(),f=this.getCurveLengths();for(e=0;e<f.length;){if(f[e]>=d){return d=f[e]-d,e=this.curves[e],d=1-d/e.getLength(),e.getPointAt(d)}e++}return null};THREE.CurvePath.prototype.getLength=function(){var b=this.getCurveLengths();return b[b.length-1]};THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length){return this.cacheLengths}var f=[],e=0,h,g=this.curves.length;for(h=0;h<g;h++){e+=this.curves[h].getLength(),f.push(e)}return this.cacheLengths=f};THREE.CurvePath.prototype.getBoundingBox=function(){var C=this.getPoints(),B,A,v,u,t,s;B=A=Number.NEGATIVE_INFINITY;u=t=Number.POSITIVE_INFINITY;var r,o,n,m,i=C[0] instanceof THREE.Vector3;m=i?new THREE.Vector3:new THREE.Vector2;o=0;for(n=C.length;o<n;o++){r=C[o],r.x>B?B=r.x:r.x<u&&(u=r.x),r.y>A?A=r.y:r.y<t&&(t=r.y),i&&(r.z>v?v=r.z:r.z<s&&(s=r.z)),m.add(r)}C={minX:u,minY:t,maxX:B,maxY:A};i&&(C.maxZ=v,C.minZ=s);return C};THREE.CurvePath.prototype.createPointsGeometry=function(b){b=this.getPoints(b,!0);return this.createGeometry(b)};THREE.CurvePath.prototype.createSpacedPointsGeometry=function(b){b=this.getSpacedPoints(b,!0);return this.createGeometry(b)};THREE.CurvePath.prototype.createGeometry=function(e){for(var d=new THREE.Geometry,f=0;f<e.length;f++){d.vertices.push(new THREE.Vector3(e[f].x,e[f].y,e[f].z||0))}return d};THREE.CurvePath.prototype.addWrapPath=function(b){this.bends.push(b)};THREE.CurvePath.prototype.getTransformedPoints=function(g,f){var k=this.getPoints(g),i,h;f||(f=this.bends);i=0;for(h=f.length;i<h;i++){k=this.getWrapPoints(k,f[i])}return k};THREE.CurvePath.prototype.getTransformedSpacedPoints=function(g,f){var k=this.getSpacedPoints(g),i,h;f||(f=this.bends);i=0;for(h=f.length;i<h;i++){k=this.getWrapPoints(k,f[i])}return k};THREE.CurvePath.prototype.getWrapPoints=function(s,r){var q=this.getBoundingBox(),p,o,n,m,l,i;p=0;for(o=s.length;p<o;p++){n=s[p],m=n.x,l=n.y,i=m/q.maxX,i=r.getUtoTmapping(i,m),m=r.getPoint(i),i=r.getTangent(i),i.set(-i.y,i.x).multiplyScalar(l),n.x=m.x+i.x,n.y=m.y+i.y}return s};THREE.Gyroscope=function(){THREE.Object3D.call(this)};THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype);THREE.Gyroscope.prototype.constructor=THREE.Gyroscope;THREE.Gyroscope.prototype.updateMatrixWorld=function(){var h=new THREE.Vector3,g=new THREE.Quaternion,m=new THREE.Vector3,l=new THREE.Vector3,k=new THREE.Quaternion,i=new THREE.Vector3;return function(c){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||c){this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(l,k,i),this.matrix.decompose(h,g,m),this.matrixWorld.compose(l,g,i)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,c=!0}for(var b=0,a=this.children.length;b<a;b++){this.children[b].updateMatrixWorld(c)}}}();THREE.Path=function(b){THREE.CurvePath.call(this);this.actions=[];b&&this.fromPoints(b)};THREE.Path.prototype=Object.create(THREE.CurvePath.prototype);THREE.Path.prototype.constructor=THREE.Path;THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"};THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var d=1,f=e.length;d<f;d++){this.lineTo(e[d].x,e[d].y)}};THREE.Path.prototype.moveTo=function(e,d){var f=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:f})};THREE.Path.prototype.lineTo=function(f,e){var h=Array.prototype.slice.call(arguments),g=this.actions[this.actions.length-1].args,g=new THREE.LineCurve(new THREE.Vector2(g[g.length-2],g[g.length-1]),new THREE.Vector2(f,e));this.curves.push(g);this.actions.push({action:THREE.PathActions.LINE_TO,args:h})};THREE.Path.prototype.quadraticCurveTo=function(h,g,m,l){var k=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,i=new THREE.QuadraticBezierCurve(new THREE.Vector2(i[i.length-2],i[i.length-1]),new THREE.Vector2(h,g),new THREE.Vector2(m,l));this.curves.push(i);this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:k})};THREE.Path.prototype.bezierCurveTo=function(k,i,q,p,o,n){var m=Array.prototype.slice.call(arguments),l=this.actions[this.actions.length-1].args,l=new THREE.CubicBezierCurve(new THREE.Vector2(l[l.length-2],l[l.length-1]),new THREE.Vector2(k,i),new THREE.Vector2(q,p),new THREE.Vector2(o,n));this.curves.push(l);this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:m})};THREE.Path.prototype.splineThru=function(e){var d=Array.prototype.slice.call(arguments),f=this.actions[this.actions.length-1].args,f=[new THREE.Vector2(f[f.length-2],f[f.length-1])];Array.prototype.push.apply(f,e);f=new THREE.SplineCurve(f);this.curves.push(f);this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:d})};THREE.Path.prototype.arc=function(i,h,o,n,m,l){var k=this.actions[this.actions.length-1].args;this.absarc(i+k[k.length-2],h+k[k.length-1],o,n,m,l)};THREE.Path.prototype.absarc=function(h,g,m,l,k,i){this.absellipse(h,g,m,m,l,k,i)};THREE.Path.prototype.ellipse=function(k,i,q,p,o,n,m){var l=this.actions[this.actions.length-1].args;this.absellipse(k+l[l.length-2],i+l[l.length-1],q,p,o,n,m)};THREE.Path.prototype.absellipse=function(s,r,q,p,o,n,m){var l=Array.prototype.slice.call(arguments),i=new THREE.EllipseCurve(s,r,q,p,o,n,m);this.curves.push(i);i=i.getPoint(1);l.push(i.x);l.push(i.y);this.actions.push({action:THREE.PathActions.ELLIPSE,args:l})};THREE.Path.prototype.getSpacedPoints=function(f,e){f||(f=40);for(var h=[],g=0;g<f;g++){h.push(this.getPoint(g/f))}return h};THREE.Path.prototype.getPoints=function(I,H){if(this.useSpacedPoints){return console.log("tata"),this.getSpacedPoints(I,H)}I=I||12;var G=[],F,E,D,C,B,A,v,o,m,u,J,i,K;F=0;for(E=this.actions.length;F<E;F++){switch(D=this.actions[F],C=D.action,D=D.args,C){case THREE.PathActions.MOVE_TO:G.push(new THREE.Vector2(D[0],D[1]));break;case THREE.PathActions.LINE_TO:G.push(new THREE.Vector2(D[0],D[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:B=D[2];A=D[3];m=D[0];u=D[1];0<G.length?(C=G[G.length-1],J=C.x,i=C.y):(C=this.actions[F-1].args,J=C[C.length-2],i=C[C.length-1]);for(D=1;D<=I;D++){K=D/I,C=THREE.Shape.Utils.b2(K,J,m,B),K=THREE.Shape.Utils.b2(K,i,u,A),G.push(new THREE.Vector2(C,K))}break;case THREE.PathActions.BEZIER_CURVE_TO:B=D[4];A=D[5];m=D[0];u=D[1];v=D[2];o=D[3];0<G.length?(C=G[G.length-1],J=C.x,i=C.y):(C=this.actions[F-1].args,J=C[C.length-2],i=C[C.length-1]);for(D=1;D<=I;D++){K=D/I,C=THREE.Shape.Utils.b3(K,J,m,v,B),K=THREE.Shape.Utils.b3(K,i,u,o,A),G.push(new THREE.Vector2(C,K))}break;case THREE.PathActions.CSPLINE_THRU:C=this.actions[F-1].args;K=[new THREE.Vector2(C[C.length-2],C[C.length-1])];C=I*D[0].length;K=K.concat(D[0]);K=new THREE.SplineCurve(K);for(D=1;D<=C;D++){G.push(K.getPointAt(D/C))}break;case THREE.PathActions.ARC:B=D[0];A=D[1];u=D[2];v=D[3];C=D[4];m=!!D[5];J=C-v;i=2*I;for(D=1;D<=i;D++){K=D/i,m||(K=1-K),K=v+K*J,C=B+u*Math.cos(K),K=A+u*Math.sin(K),G.push(new THREE.Vector2(C,K))}break;case THREE.PathActions.ELLIPSE:for(B=D[0],A=D[1],u=D[2],o=D[3],v=D[4],C=D[5],m=!!D[6],J=C-v,i=2*I,D=1;D<=i;D++){K=D/i,m||(K=1-K),K=v+K*J,C=B+u*Math.cos(K),K=A+o*Math.sin(K),G.push(new THREE.Vector2(C,K))}}}F=G[G.length-1];1e-10>Math.abs(F.x-G[0].x)&&1e-10>Math.abs(F.y-G[0].y)&&G.splice(G.length-1,1);H&&G.push(G[0]);return G};THREE.Path.prototype.toShapes=function(J,I){function H(h){for(var g=[],p=0,n=h.length;p<n;p++){var l=h[p],k=new THREE.Shape;k.actions=l.actions;k.curves=l.curves;g.push(k)}return g}function G(P,O){for(var N=O.length,u=!1,t=N-1,s=0;s<N;t=s++){var r=O[t],q=O[s],p=q.x-r.x,l=q.y-r.y;if(1e-10<Math.abs(l)){if(0>l&&(r=O[s],p=-p,q=O[t],l=-l),!(P.y<r.y||P.y>q.y)){if(P.y==r.y){if(P.x==r.x){return !0}}else{t=l*(P.x-r.x)-p*(P.y-r.y);if(0==t){return !0}0>t||(u=!u)}}}else{if(P.y==r.y&&(q.x<=P.x&&P.x<=r.x||r.x<=P.x&&P.x<=q.x)){return !0}}}return u}var F=function(k){var h,r,q,p,n=[],l=new THREE.Path;h=0;for(r=k.length;h<r;h++){q=k[h],p=q.args,q=q.action,q==THREE.PathActions.MOVE_TO&&0!=l.actions.length&&(n.push(l),l=new THREE.Path),l[q].apply(l,p)}0!=l.actions.length&&n.push(l);return n}(this.actions);if(0==F.length){return[]}if(!0===I){return H(F)}var E,D,C,B=[];if(1==F.length){return D=F[0],C=new THREE.Shape,C.actions=D.actions,C.curves=D.curves,B.push(C),B}var A=!THREE.Shape.Utils.isClockWise(F[0].getPoints()),A=J?!A:A;C=[];var o=[],m=[],v=0,L;o[v]=void 0;m[v]=[];var i,M;i=0;for(M=F.length;i<M;i++){D=F[i],L=D.getPoints(),E=THREE.Shape.Utils.isClockWise(L),(E=J?!E:E)?(!A&&o[v]&&v++,o[v]={s:new THREE.Shape,p:L},o[v].s.actions=D.actions,o[v].s.curves=D.curves,A&&v++,m[v]=[]):m[v].push({h:D,p:L[0]})}if(!o[0]){return H(F)}if(1<o.length){i=!1;M=[];D=0;for(F=o.length;D<F;D++){C[D]=[]}D=0;for(F=o.length;D<F;D++){for(E=m[D],A=0;A<E.length;A++){v=E[A];L=!0;for(var K=0;K<o.length;K++){G(v.p,o[K].p)&&(D!=K&&M.push({froms:D,tos:K,hole:A}),L?(L=!1,C[K].push(v)):i=!0)}L&&C[D].push(v)}}0<M.length&&(i||(m=C))}i=0;for(M=o.length;i<M;i++){for(C=o[i].s,B.push(C),D=m[i],F=0,E=D.length;F<E;F++){C.holes.push(D[F].h)}}return B};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};THREE.Shape.prototype=Object.create(THREE.Path.prototype);THREE.Shape.prototype.constructor=THREE.Shape;THREE.Shape.prototype.extrude=function(b){return new THREE.ExtrudeGeometry(this,b)};THREE.Shape.prototype.makeGeometry=function(b){return new THREE.ShapeGeometry(this,b)};THREE.Shape.prototype.getPointsHoles=function(f){var e,h=this.holes.length,g=[];for(e=0;e<h;e++){g[e]=this.holes[e].getTransformedPoints(f,this.bends)}return g};THREE.Shape.prototype.getSpacedPointsHoles=function(f){var e,h=this.holes.length,g=[];for(e=0;e<h;e++){g[e]=this.holes[e].getTransformedSpacedPoints(f,this.bends)}return g};THREE.Shape.prototype.extractAllPoints=function(b){return{shape:this.getTransformedPoints(b),holes:this.getPointsHoles(b)}};THREE.Shape.prototype.extractPoints=function(b){return this.useSpacedPoints?this.extractAllSpacedPoints(b):this.extractAllPoints(b)};THREE.Shape.prototype.extractAllSpacedPoints=function(b){return{shape:this.getTransformedSpacedPoints(b),holes:this.getSpacedPointsHoles(b)}};THREE.Shape.Utils={triangulateShape:function(C,B){function A(e,d,f){return e.x!=d.x?e.x<d.x?e.x<=f.x&&f.x<=d.x:d.x<=f.x&&f.x<=e.x:e.y<d.y?e.y<=f.y&&f.y<=d.y:d.y<=f.y&&f.y<=e.y}function v(O,N,M,L,K){var J=N.x-O.x,I=N.y-O.y,H=L.x-M.x,F=L.y-M.y,D=O.x-M.x,c=O.y-M.y,Q=I*H-J*F,P=I*D-J*c;if(1e-10<Math.abs(Q)){if(0<Q){if(0>P||P>Q){return[]}H=F*D-H*c;if(0>H||H>Q){return[]}}else{if(0<P||P<Q){return[]}H=F*D-H*c;if(0<H||H<Q){return[]}}if(0==H){return !K||0!=P&&P!=Q?[O]:[]}if(H==Q){return !K||0!=P&&P!=Q?[N]:[]}if(0==P){return[M]}if(P==Q){return[L]}K=H/Q;return[{x:O.x+K*J,y:O.y+K*I}]}if(0!=P||F*D!=H*c){return[]}I=0==J&&0==I;H=0==H&&0==F;if(I&&H){return O.x!=M.x||O.y!=M.y?[]:[O]}if(I){return A(M,L,O)?[O]:[]}if(H){return A(O,N,M)?[M]:[]}0!=J?(O.x<N.x?(J=O,H=O.x,I=N,O=N.x):(J=N,H=N.x,I=O,O=O.x),M.x<L.x?(N=M,Q=M.x,F=L,M=L.x):(N=L,Q=L.x,F=M,M=M.x)):(O.y<N.y?(J=O,H=O.y,I=N,O=N.y):(J=N,H=N.y,I=O,O=O.y),M.y<L.y?(N=M,Q=M.y,F=L,M=L.y):(N=L,Q=L.y,F=M,M=M.y));return H<=Q?O<Q?[]:O==Q?K?[]:[N]:O<=M?[N,I]:[N,F]:H>M?[]:H==M?K?[]:[J]:O<=M?[J,I]:[J,F]}function u(k,h,E,D){var q=h.x-k.x,p=h.y-k.y;h=E.x-k.x;E=E.y-k.y;var l=D.x-k.x;D=D.y-k.y;k=q*E-p*h;q=q*D-p*l;return 1e-10<Math.abs(k)?(h=l*E-D*h,0<k?0<=q&&0<=h:0<=q||0<=h):0<q}var t,s,r,o,n,m={};r=C.concat();t=0;for(s=B.length;t<s;t++){Array.prototype.push.apply(r,B[t])}t=0;for(s=r.length;t<s;t++){n=r[t].x+":"+r[t].y,void 0!==m[n]&&THREE.warn("THREE.Shape: Duplicate point",n),m[n]=t}t=function(aa,Z){function Y(h,c){var p=V.length-1,l=h-1;0>l&&(l=p);var k=h+1;k>p&&(k=0);p=u(V[h],V[l],V[k],T[c]);if(!p){return !1}p=T.length-1;l=c-1;0>l&&(l=p);k=c+1;k>p&&(k=0);return(p=u(T[c],T[l],T[k],V[h]))?!0:!1}function X(g,f){var k,h;for(k=0;k<V.length;k++){if(h=k+1,h%=V.length,h=v(g,f,V[k],V[h],!0),0<h.length){return !0}}return !1}function W(b,E){var q,p,l,g;for(q=0;q<S.length;q++){for(p=Z[S[q]],l=0;l<p.length;l++){if(g=l+1,g%=p.length,g=v(b,E,p[l],p[g],!0),0<g.length){return !0}}}return !1}var V=aa.concat(),T,S=[],R,P,Q,O,L,N=[],D,J,d,e=0;for(R=Z.length;e<R;e++){S.push(e)}D=0;for(var K=2*S.length;0<S.length;){K--;if(0>K){console.log("Infinite Loop! Holes left:"+S.length+", Probably Hole outside Shape!");break}for(P=D;P<V.length;P++){Q=V[P];R=-1;for(e=0;e<S.length;e++){if(O=S[e],L=Q.x+":"+Q.y+":"+O,void 0===N[L]){T=Z[O];for(J=0;J<T.length;J++){if(O=T[J],Y(P,J)&&!X(Q,O)&&!W(Q,O)){R=J;S.splice(e,1);D=V.slice(0,P+1);O=V.slice(P);J=T.slice(R);d=T.slice(0,R+1);V=D.concat(J).concat(d).concat(O);D=P;break}}if(0<=R){break}N[L]=!0}}if(0<=R){break}}}return V}(C,B);var i=THREE.FontUtils.Triangulate(t,!1);t=0;for(s=i.length;t<s;t++){for(o=i[t],r=0;3>r;r++){n=o[r].x+":"+o[r].y,n=m[n],void 0!==n&&(o[r]=n)}}return i.concat()},isClockWise:function(b){return 0>THREE.FontUtils.Triangulate.area(b)},b2p0:function(e,d){var f=1-e;return f*f*d},b2p1:function(d,c){return 2*(1-d)*d*c},b2p2:function(d,c){return d*d*c},b2:function(f,e,h,g){return this.b2p0(f,e)+this.b2p1(f,h)+this.b2p2(f,g)},b3p0:function(e,d){var f=1-e;return f*f*f*d},b3p1:function(e,d){var f=1-e;return 3*f*f*e*d},b3p2:function(d,c){return 3*(1-d)*d*d*c},b3p3:function(d,c){return d*d*d*c},b3:function(g,f,k,i,h){return this.b3p0(g,f)+this.b3p1(g,k)+this.b3p2(g,i)+this.b3p3(g,h)}};THREE.LineCurve=function(d,c){this.v1=d;this.v2=c};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.constructor=THREE.LineCurve;THREE.LineCurve.prototype.getPoint=function(d){var c=this.v2.clone().sub(this.v1);c.multiplyScalar(d).add(this.v1);return c};THREE.LineCurve.prototype.getPointAt=function(b){return this.getPoint(b)};THREE.LineCurve.prototype.getTangent=function(b){return this.v2.clone().sub(this.v1).normalize()};THREE.QuadraticBezierCurve=function(e,d,f){this.v0=e;this.v1=d;this.v2=f};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve;THREE.QuadraticBezierCurve.prototype.getPoint=function(d){var c=new THREE.Vector2;c.x=THREE.Shape.Utils.b2(d,this.v0.x,this.v1.x,this.v2.x);c.y=THREE.Shape.Utils.b2(d,this.v0.y,this.v1.y,this.v2.y);return c};THREE.QuadraticBezierCurve.prototype.getTangent=function(d){var c=new THREE.Vector2;c.x=THREE.Curve.Utils.tangentQuadraticBezier(d,this.v0.x,this.v1.x,this.v2.x);c.y=THREE.Curve.Utils.tangentQuadraticBezier(d,this.v0.y,this.v1.y,this.v2.y);return c.normalize()};THREE.CubicBezierCurve=function(f,e,h,g){this.v0=f;this.v1=e;this.v2=h;this.v3=g};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve;THREE.CubicBezierCurve.prototype.getPoint=function(d){var c;c=THREE.Shape.Utils.b3(d,this.v0.x,this.v1.x,this.v2.x,this.v3.x);d=THREE.Shape.Utils.b3(d,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new THREE.Vector2(c,d)};THREE.CubicBezierCurve.prototype.getTangent=function(d){var c;c=THREE.Curve.Utils.tangentCubicBezier(d,this.v0.x,this.v1.x,this.v2.x,this.v3.x);d=THREE.Curve.Utils.tangentCubicBezier(d,this.v0.y,this.v1.y,this.v2.y,this.v3.y);c=new THREE.Vector2(c,d);c.normalize();return c};THREE.SplineCurve=function(b){this.points=void 0==b?[]:b};THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.constructor=THREE.SplineCurve;THREE.SplineCurve.prototype.getPoint=function(h){var g=this.points;h*=g.length-1;var m=Math.floor(h);h-=m;var l=g[0==m?m:m-1],k=g[m],i=g[m>g.length-2?g.length-1:m+1],g=g[m>g.length-3?g.length-1:m+2],m=new THREE.Vector2;m.x=THREE.Curve.Utils.interpolate(l.x,k.x,i.x,g.x,h);m.y=THREE.Curve.Utils.interpolate(l.y,k.y,i.y,g.y,h);return m};THREE.EllipseCurve=function(i,h,o,n,m,l,k){this.aX=i;this.aY=h;this.xRadius=o;this.yRadius=n;this.aStartAngle=m;this.aEndAngle=l;this.aClockwise=k};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);THREE.EllipseCurve.prototype.constructor=THREE.EllipseCurve;THREE.EllipseCurve.prototype.getPoint=function(d){var c=this.aEndAngle-this.aStartAngle;0>c&&(c+=2*Math.PI);c>2*Math.PI&&(c-=2*Math.PI);d=!0===this.aClockwise?this.aEndAngle+(1-d)*(2*Math.PI-c):this.aStartAngle+d*c;c=new THREE.Vector2;c.x=this.aX+this.xRadius*Math.cos(d);c.y=this.aY+this.yRadius*Math.sin(d);return c};THREE.ArcCurve=function(h,g,m,l,k,i){THREE.EllipseCurve.call(this,h,g,m,m,l,k,i)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.ArcCurve.prototype.constructor=THREE.ArcCurve;THREE.LineCurve3=THREE.Curve.create(function(d,c){this.v1=d;this.v2=c},function(d){var c=new THREE.Vector3;c.subVectors(this.v2,this.v1);c.multiplyScalar(d);c.add(this.v1);return c});THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,d,f){this.v0=e;this.v1=d;this.v2=f},function(d){var c=new THREE.Vector3;c.x=THREE.Shape.Utils.b2(d,this.v0.x,this.v1.x,this.v2.x);c.y=THREE.Shape.Utils.b2(d,this.v0.y,this.v1.y,this.v2.y);c.z=THREE.Shape.Utils.b2(d,this.v0.z,this.v1.z,this.v2.z);return c});THREE.CubicBezierCurve3=THREE.Curve.create(function(f,e,h,g){this.v0=f;this.v1=e;this.v2=h;this.v3=g},function(d){var c=new THREE.Vector3;c.x=THREE.Shape.Utils.b3(d,this.v0.x,this.v1.x,this.v2.x,this.v3.x);c.y=THREE.Shape.Utils.b3(d,this.v0.y,this.v1.y,this.v2.y,this.v3.y);c.z=THREE.Shape.Utils.b3(d,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return c});THREE.SplineCurve3=THREE.Curve.create(function(b){this.points=void 0==b?[]:b},function(h){var g=this.points;h*=g.length-1;var m=Math.floor(h);h-=m;var l=g[0==m?m:m-1],k=g[m],i=g[m>g.length-2?g.length-1:m+1],g=g[m>g.length-3?g.length-1:m+2],m=new THREE.Vector3;m.x=THREE.Curve.Utils.interpolate(l.x,k.x,i.x,g.x,h);m.y=THREE.Curve.Utils.interpolate(l.y,k.y,i.y,g.y,h);m.z=THREE.Curve.Utils.interpolate(l.z,k.z,i.z,g.z,h);return m});THREE.ClosedSplineCurve3=THREE.Curve.create(function(b){this.points=void 0==b?[]:b},function(h){var g=this.points;h*=g.length-0;var m=Math.floor(h);h-=m;var m=m+(0<m?0:(Math.floor(Math.abs(m)/g.length)+1)*g.length),l=g[(m-1)%g.length],k=g[m%g.length],i=g[(m+1)%g.length],g=g[(m+2)%g.length],m=new THREE.Vector3;m.x=THREE.Curve.Utils.interpolate(l.x,k.x,i.x,g.x,h);m.y=THREE.Curve.Utils.interpolate(l.y,k.y,i.y,g.y,h);m.z=THREE.Curve.Utils.interpolate(l.z,k.z,i.z,g.z,h);return m});THREE.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){THREE.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){THREE.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){THREE.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(i){if(!0===i.initialized){return i}for(var h=0;h<i.hierarchy.length;h++){for(var o=0;o<i.hierarchy[h].keys.length;o++){if(0>i.hierarchy[h].keys[o].time&&(i.hierarchy[h].keys[o].time=0),void 0!==i.hierarchy[h].keys[o].rot&&!(i.hierarchy[h].keys[o].rot instanceof THREE.Quaternion)){var n=i.hierarchy[h].keys[o].rot;i.hierarchy[h].keys[o].rot=(new THREE.Quaternion).fromArray(n)}}if(i.hierarchy[h].keys.length&&void 0!==i.hierarchy[h].keys[0].morphTargets){n={};for(o=0;o<i.hierarchy[h].keys.length;o++){for(var m=0;m<i.hierarchy[h].keys[o].morphTargets.length;m++){var l=i.hierarchy[h].keys[o].morphTargets[m];n[l]=-1}}i.hierarchy[h].usedMorphTargets=n;for(o=0;o<i.hierarchy[h].keys.length;o++){var k={};for(l in n){for(m=0;m<i.hierarchy[h].keys[o].morphTargets.length;m++){if(i.hierarchy[h].keys[o].morphTargets[m]===l){k[l]=i.hierarchy[h].keys[o].morphTargetsInfluences[m];break}}m===i.hierarchy[h].keys[o].morphTargets.length&&(k[l]=0)}i.hierarchy[h].keys[o].morphTargetsInfluences=k}}for(o=1;o<i.hierarchy[h].keys.length;o++){i.hierarchy[h].keys[o].time===i.hierarchy[h].keys[o-1].time&&(i.hierarchy[h].keys.splice(o,1),o--)}for(o=0;o<i.hierarchy[h].keys.length;o++){i.hierarchy[h].keys[o].index=o}}i.initialized=!0;return i},parse:function(f){var e=function(b,k){k.push(b);for(var i=0;i<b.children.length;i++){e(b.children[i],k)}},h=[];if(f instanceof THREE.SkinnedMesh){for(var g=0;g<f.skeleton.bones.length;g++){h.push(f.skeleton.bones[g])}}else{e(f,h)}return h},play:function(b){-1===this.animations.indexOf(b)&&this.animations.push(b)},stop:function(b){b=this.animations.indexOf(b);-1!==b&&this.animations.splice(b,1)},update:function(d){for(var c=0;c<this.animations.length;c++){this.animations[c].resetBlendWeights()}for(c=0;c<this.animations.length;c++){this.animations[c].update(d)}}};THREE.Animation=function(d,c){this.root=d;this.data=THREE.AnimationHandler.init(c);this.hierarchy=THREE.AnimationHandler.parse(d);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.loop=!0;this.weight=0;this.interpolationType=THREE.AnimationHandler.LINEAR};THREE.Animation.prototype={constructor:THREE.Animation,keyTypes:["pos","rot","scl"],play:function(d,c){this.currentTime=void 0!==d?d:0;this.weight=void 0!==c?c:1;this.isPlaying=!0;this.reset();THREE.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1;THREE.AnimationHandler.stop(this)},reset:function(){for(var i=0,h=this.hierarchy.length;i<h;i++){var o=this.hierarchy[i];void 0===o.animationCache&&(o.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}});var n=this.data.name,m=o.animationCache.animations,l=m[n];void 0===l&&(l={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:o.matrix},m[n]=l);for(o=0;3>o;o++){for(var n=this.keyTypes[o],m=this.data.hierarchy[i].keys[0],k=this.getNextKeyWith(n,i,1);k.time<this.currentTime&&k.index>m.index;){m=k,k=this.getNextKeyWith(n,i,k.index+1)}l.prevKey[n]=m;l.nextKey[n]=k}}},resetBlendWeights:function(){for(var e=0,d=this.hierarchy.length;e<d;e++){var f=this.hierarchy[e].animationCache;void 0!==f&&(f=f.blending,f.positionWeight=0,f.quaternionWeight=0,f.scaleWeight=0)}},update:function(){var h=[],g=new THREE.Vector3,m=new THREE.Vector3,l=new THREE.Quaternion,k=function(C,B){var A=[],v=[],u,o,p,D,f,E;u=(C.length-1)*B;o=Math.floor(u);u-=o;A[0]=0===o?o:o-1;A[1]=o;A[2]=o>C.length-2?o:o+1;A[3]=o>C.length-3?o:o+2;o=C[A[0]];D=C[A[1]];f=C[A[2]];E=C[A[3]];A=u*u;p=u*A;v[0]=i(o[0],D[0],f[0],E[0],u,A,p);v[1]=i(o[1],D[1],f[1],E[1],u,A,p);v[2]=i(o[2],D[2],f[2],E[2],u,A,p);return v},i=function(p,o,u,s,r,q,t){p=0.5*(u-p);s=0.5*(s-o);return(2*(o-u)+p+s)*t+(-3*(o-u)-2*p-s)*q+p*r+o};return function(B){if(!1!==this.isPlaying&&(this.currentTime+=B*this.timeScale,0!==this.weight)){B=this.data.length;if(this.currentTime>B||0>this.currentTime){this.loop?(this.currentTime%=B,0>this.currentTime&&(this.currentTime+=B),this.reset()):this.stop()}B=0;for(var A=this.hierarchy.length;B<A;B++){for(var o=this.hierarchy[B],e=o.animationCache.animations[this.data.name],c=o.animationCache.blending,b=0;3>b;b++){var d=this.keyTypes[b],E=e.prevKey[d],a=e.nextKey[d];if(0<this.timeScale&&a.time<=this.currentTime||0>this.timeScale&&E.time>=this.currentTime){E=this.data.hierarchy[B].keys[0];for(a=this.getNextKeyWith(d,B,1);a.time<this.currentTime&&a.index>E.index;){E=a,a=this.getNextKeyWith(d,B,a.index+1)}e.prevKey[d]=E;e.nextKey[d]=a}var F=(this.currentTime-E.time)/(a.time-E.time),D=E[d],C=a[d];0>F&&(F=0);1<F&&(F=1);if("pos"===d){if(this.interpolationType===THREE.AnimationHandler.LINEAR){m.x=D[0]+(C[0]-D[0])*F,m.y=D[1]+(C[1]-D[1])*F,m.z=D[2]+(C[2]-D[2])*F,E=this.weight/(this.weight+c.positionWeight),o.position.lerp(m,E),c.positionWeight+=this.weight}else{if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){h[0]=this.getPrevKeyWith("pos",B,E.index-1).pos,h[1]=D,h[2]=C,h[3]=this.getNextKeyWith("pos",B,a.index+1).pos,F=0.33*F+0.33,a=k(h,F),E=this.weight/(this.weight+c.positionWeight),c.positionWeight+=this.weight,d=o.position,d.x+=(a[0]-d.x)*E,d.y+=(a[1]-d.y)*E,d.z+=(a[2]-d.z)*E,this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(F=k(h,1.01*F),g.set(F[0],F[1],F[2]),g.sub(d),g.y=0,g.normalize(),F=Math.atan2(g.x,g.z),o.rotation.set(0,F,0))}}}else{"rot"===d?(THREE.Quaternion.slerp(D,C,l,F),0===c.quaternionWeight?(o.quaternion.copy(l),c.quaternionWeight=this.weight):(E=this.weight/(this.weight+c.quaternionWeight),THREE.Quaternion.slerp(o.quaternion,l,o.quaternion,E),c.quaternionWeight+=this.weight)):"scl"===d&&(m.x=D[0]+(C[0]-D[0])*F,m.y=D[1]+(C[1]-D[1])*F,m.z=D[2]+(C[2]-D[2])*F,E=this.weight/(this.weight+c.scaleWeight),o.scale.lerp(m,E),c.scaleWeight+=this.weight)}}}return !0}}}(),getNextKeyWith:function(f,e,h){var g=this.data.hierarchy[e].keys;for(h=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?h<g.length-1?h:g.length-1:h%g.length;h<g.length;h++){if(void 0!==g[h][f]){return g[h]}}return this.data.hierarchy[e].keys[0]},getPrevKeyWith:function(f,e,h){var g=this.data.hierarchy[e].keys;for(h=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?0<h?h:0:0<=h?h:h+g.length;0<=h;h--){if(void 0!==g[h][f]){return g[h]}}return this.data.hierarchy[e].keys[g.length-1]}};THREE.KeyFrameAnimation=function(i){this.root=i.node;this.data=THREE.AnimationHandler.init(i);this.hierarchy=THREE.AnimationHandler.parse(this.root);this.currentTime=0;this.timeScale=0.001;this.isPlaying=!1;this.loop=this.isPaused=!0;i=0;for(var h=this.hierarchy.length;i<h;i++){var o=this.data.hierarchy[i].sids,n=this.hierarchy[i];if(this.data.hierarchy[i].keys.length&&o){for(var m=0;m<o.length;m++){var l=o[m],k=this.getNextKeyWith(l,i,0);k&&k.apply(l)}n.matrixAutoUpdate=!1;this.data.hierarchy[i].node.updateMatrix();n.matrixWorldNeedsUpdate=!0}}};THREE.KeyFrameAnimation.prototype={constructor:THREE.KeyFrameAnimation,play:function(f){this.currentTime=void 0!==f?f:0;if(!1===this.isPlaying){this.isPlaying=!0;var e=this.hierarchy.length,h,g;for(f=0;f<e;f++){h=this.hierarchy[f],g=this.data.hierarchy[f],void 0===g.animationCache&&(g.animationCache={},g.animationCache.prevKey=null,g.animationCache.nextKey=null,g.animationCache.originalMatrix=h.matrix),h=this.data.hierarchy[f].keys,h.length&&(g.animationCache.prevKey=h[0],g.animationCache.nextKey=h[1],this.startTime=Math.min(h[0].time,this.startTime),this.endTime=Math.max(h[h.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1;THREE.AnimationHandler.play(this)},stop:function(){this.isPaused=this.isPlaying=!1;THREE.AnimationHandler.stop(this);for(var f=0;f<this.data.hierarchy.length;f++){var e=this.hierarchy[f],h=this.data.hierarchy[f];if(void 0!==h.animationCache){var g=h.animationCache.originalMatrix;g.copy(e.matrix);e.matrix=g;delete h.animationCache}}},update:function(i){if(!1!==this.isPlaying){this.currentTime+=i*this.timeScale;i=this.data.length;!0===this.loop&&this.currentTime>i&&(this.currentTime%=i);this.currentTime=Math.min(this.currentTime,i);i=0;for(var h=this.hierarchy.length;i<h;i++){var o=this.hierarchy[i],n=this.data.hierarchy[i],m=n.keys,n=n.animationCache;if(m.length){var l=n.prevKey,k=n.nextKey;if(k.time<=this.currentTime){for(;k.time<this.currentTime&&k.index>l.index;){l=k,k=m[l.index+1]}n.prevKey=l;n.nextKey=k}k.time>=this.currentTime?l.interpolate(k,this.currentTime):l.interpolate(k,k.time);this.data.hierarchy[i].node.updateMatrix();o.matrixWorldNeedsUpdate=!0}}}},getNextKeyWith:function(e,d,f){d=this.data.hierarchy[d].keys;for(f%=d.length;f<d.length;f++){if(d[f].hasTarget(e)){return d[f]}}return d[0]},getPrevKeyWith:function(e,d,f){d=this.data.hierarchy[d].keys;for(f=0<=f?f:f+d.length;0<=f;f--){if(d[f].hasTarget(e)){return d[f]}}return d[d.length-1]}};THREE.MorphAnimation=function(b){this.mesh=b;this.frames=b.morphTargetInfluences.length;this.currentTime=0;this.duration=1000;this.loop=!0;this.currentFrame=this.lastFrame=0;this.isPlaying=!1};THREE.MorphAnimation.prototype={constructor:THREE.MorphAnimation,play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(e){if(!1!==this.isPlaying){this.currentTime+=e;!0===this.loop&&this.currentTime>this.duration&&(this.currentTime%=this.duration);this.currentTime=Math.min(this.currentTime,this.duration);e=this.duration/this.frames;var d=Math.floor(this.currentTime/e),f=this.mesh.morphTargetInfluences;d!=this.currentFrame&&(f[this.lastFrame]=0,f[this.currentFrame]=1,f[d]=0,this.lastFrame=this.currentFrame,this.currentFrame=d);f[d]=this.currentTime%e/e;f[this.lastFrame]=1-f[d]}}};THREE.BoxGeometry=function(k,i,q,p,o,n){function m(W,V,U,T,S,R,Q,N){var L,J=l.widthSegments,B=l.heightSegments,O=S/2,C=R/2,r=l.vertices.length;if("x"===W&&"y"===V||"y"===W&&"x"===V){L="z"}else{if("x"===W&&"z"===V||"z"===W&&"x"===V){L="y",B=l.depthSegments}else{if("z"===W&&"y"===V||"y"===W&&"z"===V){L="x",J=l.depthSegments}}}var P=J+1,M=B+1,H=S/J,K=R/B,h=new THREE.Vector3;h[L]=0<Q?1:-1;for(S=0;S<M;S++){for(R=0;R<P;R++){var t=new THREE.Vector3;t[W]=(R*H-O)*U;t[V]=(S*K-C)*T;t[L]=Q;l.vertices.push(t)}}for(S=0;S<B;S++){for(R=0;R<J;R++){C=R+P*S,W=R+P*(S+1),V=R+1+P*(S+1),U=R+1+P*S,T=new THREE.Vector2(R/J,1-S/B),Q=new THREE.Vector2(R/J,1-(S+1)/B),L=new THREE.Vector2((R+1)/J,1-(S+1)/B),O=new THREE.Vector2((R+1)/J,1-S/B),C=new THREE.Face3(C+r,W+r,U+r),C.normal.copy(h),C.vertexNormals.push(h.clone(),h.clone(),h.clone()),C.materialIndex=N,l.faces.push(C),l.faceVertexUvs[0].push([T,Q,O]),C=new THREE.Face3(W+r,V+r,U+r),C.normal.copy(h),C.vertexNormals.push(h.clone(),h.clone(),h.clone()),C.materialIndex=N,l.faces.push(C),l.faceVertexUvs[0].push([Q.clone(),L,O.clone()])}}}THREE.Geometry.call(this);this.type="BoxGeometry";this.parameters={width:k,height:i,depth:q,widthSegments:p,heightSegments:o,depthSegments:n};this.widthSegments=p||1;this.heightSegments=o||1;this.depthSegments=n||1;var l=this;p=k/2;o=i/2;n=q/2;m("z","y",-1,-1,q,i,p,0);m("z","y",1,-1,q,i,-p,1);m("x","z",1,1,k,q,o,2);m("x","z",1,-1,k,q,-o,3);m("x","y",1,-1,k,i,n,4);m("x","y",-1,-1,k,i,-n,5);this.mergeVertices()};THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.BoxGeometry.prototype.constructor=THREE.BoxGeometry;THREE.CircleGeometry=function(s,r,q,p){THREE.Geometry.call(this);this.type="CircleGeometry";this.parameters={radius:s,segments:r,thetaStart:q,thetaLength:p};s=s||50;r=void 0!==r?Math.max(3,r):8;q=void 0!==q?q:0;p=void 0!==p?p:2*Math.PI;var o,n=[];o=new THREE.Vector3;var m=new THREE.Vector2(0.5,0.5);this.vertices.push(o);n.push(m);for(o=0;o<=r;o++){var l=new THREE.Vector3,i=q+o/r*p;l.x=s*Math.cos(i);l.y=s*Math.sin(i);this.vertices.push(l);n.push(new THREE.Vector2((l.x/s+1)/2,(l.y/s+1)/2))}q=new THREE.Vector3(0,0,1);for(o=1;o<=r;o++){this.faces.push(new THREE.Face3(o,o+1,0,[q.clone(),q.clone(),q.clone()])),this.faceVertexUvs[0].push([n[o].clone(),n[o+1].clone(),m.clone()])}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,s)};THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CircleGeometry.prototype.constructor=THREE.CircleGeometry;THREE.CubeGeometry=function(h,g,m,l,k,i){THREE.warn("THREE.CubeGeometry has been renamed to THREE.BoxGeometry.");return new THREE.BoxGeometry(h,g,m,l,k,i)};THREE.CylinderGeometry=function(Z,Y,X,W,V,U,T,S){THREE.Geometry.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:Z,radiusBottom:Y,height:X,radialSegments:W,heightSegments:V,openEnded:U,thetaStart:T,thetaLength:S};Z=void 0!==Z?Z:20;Y=void 0!==Y?Y:20;X=void 0!==X?X:100;W=W||8;V=V||1;U=void 0!==U?U:!1;T=void 0!==T?T:0;S=void 0!==S?S:2*Math.PI;var R=X/2,Q,O,M=[],P=[];for(O=0;O<=V;O++){var I=[],L=[],K=O/V,F=K*(Y-Z)+Z;for(Q=0;Q<=W;Q++){var C=Q/W,m=new THREE.Vector3;m.x=F*Math.sin(C*S+T);m.y=-K*X+R;m.z=F*Math.cos(C*S+T);this.vertices.push(m);I.push(this.vertices.length-1);L.push(new THREE.Vector2(C,1-K))}M.push(I);P.push(L)}X=(Y-Z)/X;for(Q=0;Q<W;Q++){for(0!==Z?(T=this.vertices[M[0][Q]].clone(),S=this.vertices[M[0][Q+1]].clone()):(T=this.vertices[M[1][Q]].clone(),S=this.vertices[M[1][Q+1]].clone()),T.setY(Math.sqrt(T.x*T.x+T.z*T.z)*X).normalize(),S.setY(Math.sqrt(S.x*S.x+S.z*S.z)*X).normalize(),O=0;O<V;O++){var I=M[O][Q],L=M[O+1][Q],K=M[O+1][Q+1],F=M[O][Q+1],C=T.clone(),m=T.clone(),J=S.clone(),o=S.clone(),i=P[O][Q].clone(),N=P[O+1][Q].clone(),H=P[O+1][Q+1].clone(),B=P[O][Q+1].clone();this.faces.push(new THREE.Face3(I,L,F,[C,m,o]));this.faceVertexUvs[0].push([i,N,B]);this.faces.push(new THREE.Face3(L,K,F,[m.clone(),J,o.clone()]));this.faceVertexUvs[0].push([N.clone(),H,B.clone()])}}if(!1===U&&0<Z){for(this.vertices.push(new THREE.Vector3(0,R,0)),Q=0;Q<W;Q++){I=M[0][Q],L=M[0][Q+1],K=this.vertices.length-1,C=new THREE.Vector3(0,1,0),m=new THREE.Vector3(0,1,0),J=new THREE.Vector3(0,1,0),i=P[0][Q].clone(),N=P[0][Q+1].clone(),H=new THREE.Vector2(N.x,0),this.faces.push(new THREE.Face3(I,L,K,[C,m,J])),this.faceVertexUvs[0].push([i,N,H])}}if(!1===U&&0<Y){for(this.vertices.push(new THREE.Vector3(0,-R,0)),Q=0;Q<W;Q++){I=M[V][Q+1],L=M[V][Q],K=this.vertices.length-1,C=new THREE.Vector3(0,-1,0),m=new THREE.Vector3(0,-1,0),J=new THREE.Vector3(0,-1,0),i=P[V][Q+1].clone(),N=P[V][Q].clone(),H=new THREE.Vector2(N.x,1),this.faces.push(new THREE.Face3(I,L,K,[C,m,J])),this.faceVertexUvs[0].push([i,N,H])}}this.computeFaceNormals()};THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry;THREE.ExtrudeGeometry=function(d,c){"undefined"!==typeof d&&(THREE.Geometry.call(this),this.type="ExtrudeGeometry",d=d instanceof Array?d:[d],this.addShapeList(d,c),this.computeFaceNormals())};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry;THREE.ExtrudeGeometry.prototype.addShapeList=function(f,e){for(var h=f.length,g=0;g<h;g++){this.addShape(f[g],e)}};THREE.ExtrudeGeometry.prototype.addShape=function(aE,aD){function aC(e,d,f){d||THREE.error("THREE.ExtrudeGeometry: vec does not exist");return d.clone().multiplyScalar(f).add(e)}function aB(D,A,v){var u=1,u=D.x-A.x,t=D.y-A.y,s=v.x-D.x,r=v.y-D.y,q=u*u+t*t;if(1e-10<Math.abs(u*r-t*s)){var p=Math.sqrt(q),n=Math.sqrt(s*s+r*r),q=A.x-t/p;A=A.y+u/p;s=((v.x-r/n-q)*r-(v.y+s/n-A)*s)/(u*r-t*s);v=q+u*s-D.x;D=A+t*s-D.y;u=v*v+D*D;if(2>=u){return new THREE.Vector2(v,D)}u=Math.sqrt(u/2)}else{D=!1,1e-10<u?1e-10<s&&(D=!0):-1e-10>u?-1e-10>s&&(D=!0):Math.sign(t)==Math.sign(r)&&(D=!0),D?(v=-t,D=u,u=Math.sqrt(q)):(v=u,D=t,u=Math.sqrt(q/2))}return new THREE.Vector2(v/u,D/u)}function aA(D,A){var v,u;for(Q=D.length;0<=--Q;){v=Q;u=Q-1;0>u&&(u=D.length-1);for(var t=0,s=ao+2*at,t=0;t<s;t++){var r=al*t,q=al*(t+1),p=A+v+r,r=A+u+r,n=A+u+q,q=A+v+q,p=p+B,r=r+B,n=n+B,q=q+B;Y.faces.push(new THREE.Face3(p,r,q,null,null,aj));Y.faces.push(new THREE.Face3(r,n,q,null,null,aj));p=ad.generateSideWallUV(Y,p,r,n,q);Y.faceVertexUvs[0].push([p[0],p[1],p[3]]);Y.faceVertexUvs[0].push([p[1],p[2],p[3]])}}}function az(e,d,f){Y.vertices.push(new THREE.Vector3(e,d,f))}function ay(e,d,f){e+=B;d+=B;f+=B;Y.faces.push(new THREE.Face3(e,d,f,null,null,am));e=ad.generateTopUV(Y,e,d,f);Y.faceVertexUvs[0].push(e)}var ax=void 0!==aD.amount?aD.amount:100,aw=void 0!==aD.bevelThickness?aD.bevelThickness:6,av=void 0!==aD.bevelSize?aD.bevelSize:aw-2,at=void 0!==aD.bevelSegments?aD.bevelSegments:3,ar=void 0!==aD.bevelEnabled?aD.bevelEnabled:!0,au=void 0!==aD.curveSegments?aD.curveSegments:12,ao=void 0!==aD.steps?aD.steps:1,aq=aD.extrudePath,ap,an=!1,am=aD.material,aj=aD.extrudeMaterial,ad=void 0!==aD.UVGenerator?aD.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator,ak,ai,ae,ac;aq&&(ap=aq.getSpacedPoints(ao),an=!0,ar=!1,ak=void 0!==aD.frames?aD.frames:new THREE.TubeGeometry.FrenetFrames(aq,ao,!1),ai=new THREE.Vector3,ae=new THREE.Vector3,ac=new THREE.Vector3);ar||(av=aw=at=0);var aa,ab,ah,Y=this,B=this.vertices.length,aq=aE.extractPoints(au),au=aq.shape,T=aq.holes;if(aq=!THREE.Shape.Utils.isClockWise(au)){au=au.reverse();ab=0;for(ah=T.length;ab<ah;ab++){aa=T[ab],THREE.Shape.Utils.isClockWise(aa)&&(T[ab]=aa.reverse())}aq=!1}var Z=THREE.Shape.Utils.triangulateShape(au,T),W=au;ab=0;for(ah=T.length;ab<ah;ab++){aa=T[ab],au=au.concat(aa)}var K,S,C,m,X,al=au.length,af,i=Z.length,aq=[],Q=0;C=W.length;K=C-1;for(S=Q+1;Q<C;Q++,K++,S++){K===C&&(K=0),S===C&&(S=0),aq[Q]=aB(W[Q],W[K],W[S])}var ag=[],aF,o=aq.concat();ab=0;for(ah=T.length;ab<ah;ab++){aa=T[ab];aF=[];Q=0;C=aa.length;K=C-1;for(S=Q+1;Q<C;Q++,K++,S++){K===C&&(K=0),S===C&&(S=0),aF[Q]=aB(aa[Q],aa[K],aa[S])}ag.push(aF);o=o.concat(aF)}for(K=0;K<at;K++){C=K/at;m=aw*(1-C);S=av*Math.sin(C*Math.PI/2);Q=0;for(C=W.length;Q<C;Q++){X=aC(W[Q],aq[Q],S),az(X.x,X.y,-m)}ab=0;for(ah=T.length;ab<ah;ab++){for(aa=T[ab],aF=ag[ab],Q=0,C=aa.length;Q<C;Q++){X=aC(aa[Q],aF[Q],S),az(X.x,X.y,-m)}}}S=av;for(Q=0;Q<al;Q++){X=ar?aC(au[Q],o[Q],S):au[Q],an?(ae.copy(ak.normals[0]).multiplyScalar(X.x),ai.copy(ak.binormals[0]).multiplyScalar(X.y),ac.copy(ap[0]).add(ae).add(ai),az(ac.x,ac.y,ac.z)):az(X.x,X.y,0)}for(C=1;C<=ao;C++){for(Q=0;Q<al;Q++){X=ar?aC(au[Q],o[Q],S):au[Q],an?(ae.copy(ak.normals[C]).multiplyScalar(X.x),ai.copy(ak.binormals[C]).multiplyScalar(X.y),ac.copy(ap[C]).add(ae).add(ai),az(ac.x,ac.y,ac.z)):az(X.x,X.y,ax/ao*C)}}for(K=at-1;0<=K;K--){C=K/at;m=aw*(1-C);S=av*Math.sin(C*Math.PI/2);Q=0;for(C=W.length;Q<C;Q++){X=aC(W[Q],aq[Q],S),az(X.x,X.y,ax+m)}ab=0;for(ah=T.length;ab<ah;ab++){for(aa=T[ab],aF=ag[ab],Q=0,C=aa.length;Q<C;Q++){X=aC(aa[Q],aF[Q],S),an?az(X.x,X.y+ap[ao-1].y,ap[ao-1].x+m):az(X.x,X.y,ax+m)}}}(function(){if(ar){var b;b=0*al;for(Q=0;Q<i;Q++){af=Z[Q],ay(af[2]+b,af[1]+b,af[0]+b)}b=ao+2*at;b*=al;for(Q=0;Q<i;Q++){af=Z[Q],ay(af[0]+b,af[1]+b,af[2]+b)}}else{for(Q=0;Q<i;Q++){af=Z[Q],ay(af[2],af[1],af[0])}for(Q=0;Q<i;Q++){af=Z[Q],ay(af[0]+al*ao,af[1]+al*ao,af[2]+al*ao)}}})();(function(){var b=0;aA(W,b);b+=W.length;ab=0;for(ah=T.length;ab<ah;ab++){aa=T[ab],aA(aa,b),b+=aa.length}})()};THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(f,e,h,g){f=f.vertices;e=f[e];h=f[h];g=f[g];return[new THREE.Vector2(e.x,e.y),new THREE.Vector2(h.x,h.y),new THREE.Vector2(g.x,g.y)]},generateSideWallUV:function(g,f,k,i,h){g=g.vertices;f=g[f];k=g[k];i=g[i];h=g[h];return 0.01>Math.abs(f.y-k.y)?[new THREE.Vector2(f.x,1-f.z),new THREE.Vector2(k.x,1-k.z),new THREE.Vector2(i.x,1-i.z),new THREE.Vector2(h.x,1-h.z)]:[new THREE.Vector2(f.y,1-f.z),new THREE.Vector2(k.y,1-k.z),new THREE.Vector2(i.y,1-i.z),new THREE.Vector2(h.y,1-h.z)]}};THREE.ShapeGeometry=function(d,c){THREE.Geometry.call(this);this.type="ShapeGeometry";!1===d instanceof Array&&(d=[d]);this.addShapeList(d,c);this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.constructor=THREE.ShapeGeometry;THREE.ShapeGeometry.prototype.addShapeList=function(f,e){for(var h=0,g=f.length;h<g;h++){this.addShape(f[h],e)}return this};THREE.ShapeGeometry.prototype.addShape=function(A,v){void 0===v&&(v={});var u=v.material,t=void 0===v.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:v.UVGenerator,s,r,q,o=this.vertices.length;s=A.extractPoints(void 0!==v.curveSegments?v.curveSegments:12);var n=s.shape,m=s.holes;if(!THREE.Shape.Utils.isClockWise(n)){for(n=n.reverse(),s=0,r=m.length;s<r;s++){q=m[s],THREE.Shape.Utils.isClockWise(q)&&(m[s]=q.reverse())}}var i=THREE.Shape.Utils.triangulateShape(n,m);s=0;for(r=m.length;s<r;s++){q=m[s],n=n.concat(q)}m=n.length;r=i.length;for(s=0;s<m;s++){q=n[s],this.vertices.push(new THREE.Vector3(q.x,q.y,0))}for(s=0;s<r;s++){m=i[s],n=m[0]+o,q=m[1]+o,m=m[2]+o,this.faces.push(new THREE.Face3(n,q,m,null,null,u)),this.faceVertexUvs[0].push(t.generateTopUV(this,n,q,m))}};THREE.LatheGeometry=function(I,H,G,F){THREE.Geometry.call(this);this.type="LatheGeometry";this.parameters={points:I,segments:H,phiStart:G,phiLength:F};H=H||12;G=G||0;F=F||2*Math.PI;for(var E=1/(I.length-1),D=1/H,C=0,B=H;C<=B;C++){for(var A=G+C*D*F,v=Math.cos(A),o=Math.sin(A),A=0,m=I.length;A<m;A++){var u=I[A],J=new THREE.Vector3;J.x=v*u.x-o*u.y;J.y=o*u.x+v*u.y;J.z=u.z;this.vertices.push(J)}}G=I.length;C=0;for(B=H;C<B;C++){for(A=0,m=I.length-1;A<m;A++){H=o=A+G*C;F=o+G;var v=o+1+G,o=o+1,u=C*D,J=A*E,i=u+D,K=J+E;this.faces.push(new THREE.Face3(H,F,o));this.faceVertexUvs[0].push([new THREE.Vector2(u,J),new THREE.Vector2(i,J),new THREE.Vector2(u,K)]);this.faces.push(new THREE.Face3(F,v,o));this.faceVertexUvs[0].push([new THREE.Vector2(i,J),new THREE.Vector2(i,K),new THREE.Vector2(u,K)])}}this.mergeVertices();this.computeFaceNormals();this.computeVertexNormals()};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry;THREE.PlaneGeometry=function(f,e,h,g){console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint.");THREE.Geometry.call(this);this.type="PlaneGeometry";this.parameters={width:f,height:e,widthSegments:h,heightSegments:g};this.fromBufferGeometry(new THREE.PlaneBufferGeometry(f,e,h,g))};THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry;THREE.PlaneBufferGeometry=function(I,H,G,F){THREE.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:I,height:H,widthSegments:G,heightSegments:F};var E=I/2,D=H/2;G=G||1;F=F||1;var C=G+1,B=F+1,A=I/G,v=H/F;H=new Float32Array(C*B*3);I=new Float32Array(C*B*3);for(var o=new Float32Array(C*B*2),m=0,u=0,J=0;J<B;J++){for(var i=J*v-D,K=0;K<C;K++){H[m]=K*A-E,H[m+1]=-i,I[m+2]=1,o[u]=K/G,o[u+1]=1-J/F,m+=3,u+=2}}m=0;E=new (65535<H.length/3?Uint32Array:Uint16Array)(G*F*6);for(J=0;J<F;J++){for(K=0;K<G;K++){D=K+C*(J+1),B=K+1+C*(J+1),A=K+1+C*J,E[m]=K+C*J,E[m+1]=D,E[m+2]=A,E[m+3]=D,E[m+4]=B,E[m+5]=A,m+=6}}this.addAttribute("index",new THREE.BufferAttribute(E,1));this.addAttribute("position",new THREE.BufferAttribute(H,3));this.addAttribute("normal",new THREE.BufferAttribute(I,3));this.addAttribute("uv",new THREE.BufferAttribute(o,2))};THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry;THREE.RingGeometry=function(C,B,A,v,u,t){THREE.Geometry.call(this);this.type="RingGeometry";this.parameters={innerRadius:C,outerRadius:B,thetaSegments:A,phiSegments:v,thetaStart:u,thetaLength:t};C=C||0;B=B||50;u=void 0!==u?u:0;t=void 0!==t?t:2*Math.PI;A=void 0!==A?Math.max(3,A):8;v=void 0!==v?Math.max(1,v):8;var s,r=[],o=C,n=(B-C)/v;for(C=0;C<v+1;C++){for(s=0;s<A+1;s++){var m=new THREE.Vector3,i=u+s/A*t;m.x=o*Math.cos(i);m.y=o*Math.sin(i);this.vertices.push(m);r.push(new THREE.Vector2((m.x/B+1)/2,(m.y/B+1)/2))}o+=n}B=new THREE.Vector3(0,0,1);for(C=0;C<v;C++){for(u=C*(A+1),s=0;s<A;s++){t=i=s+u,n=i+A+1,m=i+A+2,this.faces.push(new THREE.Face3(t,n,m,[B.clone(),B.clone(),B.clone()])),this.faceVertexUvs[0].push([r[t].clone(),r[n].clone(),r[m].clone()]),t=i,n=i+A+2,m=i+1,this.faces.push(new THREE.Face3(t,n,m,[B.clone(),B.clone(),B.clone()])),this.faceVertexUvs[0].push([r[t].clone(),r[n].clone(),r[m].clone()])}}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,o)};THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.RingGeometry.prototype.constructor=THREE.RingGeometry;THREE.SphereGeometry=function(P,O,N,M,L,K,J){THREE.Geometry.call(this);this.type="SphereGeometry";this.parameters={radius:P,widthSegments:O,heightSegments:N,phiStart:M,phiLength:L,thetaStart:K,thetaLength:J};P=P||50;O=Math.max(3,Math.floor(O)||8);N=Math.max(2,Math.floor(N)||6);M=void 0!==M?M:0;L=void 0!==L?L:2*Math.PI;K=void 0!==K?K:0;J=void 0!==J?J:Math.PI;var I,H,G=[],E=[];for(H=0;H<=N;H++){var D=[],F=[];for(I=0;I<=O;I++){var A=I/O,C=H/N,B=new THREE.Vector3;B.x=-P*Math.cos(M+A*L)*Math.sin(K+C*J);B.y=P*Math.cos(K+C*J);B.z=P*Math.sin(M+A*L)*Math.sin(K+C*J);this.vertices.push(B);D.push(this.vertices.length-1);F.push(new THREE.Vector2(A,1-C))}G.push(D);E.push(F)}for(H=0;H<N;H++){for(I=0;I<O;I++){M=G[H][I+1];L=G[H][I];K=G[H+1][I];J=G[H+1][I+1];var D=this.vertices[M].clone().normalize(),F=this.vertices[L].clone().normalize(),A=this.vertices[K].clone().normalize(),C=this.vertices[J].clone().normalize(),B=E[H][I+1].clone(),o=E[H][I].clone(),m=E[H+1][I].clone(),i=E[H+1][I+1].clone();Math.abs(this.vertices[M].y)===P?(B.x=(B.x+o.x)/2,this.faces.push(new THREE.Face3(M,K,J,[D,A,C])),this.faceVertexUvs[0].push([B,m,i])):Math.abs(this.vertices[K].y)===P?(m.x=(m.x+i.x)/2,this.faces.push(new THREE.Face3(M,L,K,[D,F,A])),this.faceVertexUvs[0].push([B,o,m])):(this.faces.push(new THREE.Face3(M,L,J,[D,F,C])),this.faceVertexUvs[0].push([B,o,i]),this.faces.push(new THREE.Face3(L,K,J,[F.clone(),A,C.clone()])),this.faceVertexUvs[0].push([o.clone(),m,i.clone()]))}}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,P)};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry;THREE.TextGeometry=function(e,d){d=d||{};var f=THREE.FontUtils.generateShapes(e,d);d.amount=void 0!==d.height?d.height:50;void 0===d.bevelThickness&&(d.bevelThickness=10);void 0===d.bevelSize&&(d.bevelSize=8);void 0===d.bevelEnabled&&(d.bevelEnabled=!1);THREE.ExtrudeGeometry.call(this,f,d);this.type="TextGeometry"};THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);THREE.TextGeometry.prototype.constructor=THREE.TextGeometry;THREE.TorusGeometry=function(E,D,C,B,A){THREE.Geometry.call(this);this.type="TorusGeometry";this.parameters={radius:E,tube:D,radialSegments:C,tubularSegments:B,arc:A};E=E||100;D=D||40;C=C||8;B=B||6;A=A||2*Math.PI;for(var v=new THREE.Vector3,u=[],t=[],s=0;s<=C;s++){for(var r=0;r<=B;r++){var m=r/B*A,i=s/C*Math.PI*2;v.x=E*Math.cos(m);v.y=E*Math.sin(m);var o=new THREE.Vector3;o.x=(E+D*Math.cos(i))*Math.cos(m);o.y=(E+D*Math.cos(i))*Math.sin(m);o.z=D*Math.sin(i);this.vertices.push(o);u.push(new THREE.Vector2(r/B,s/C));t.push(o.clone().sub(v).normalize())}}for(s=1;s<=C;s++){for(r=1;r<=B;r++){E=(B+1)*s+r-1,D=(B+1)*(s-1)+r-1,A=(B+1)*(s-1)+r,v=(B+1)*s+r,m=new THREE.Face3(E,D,v,[t[E].clone(),t[D].clone(),t[v].clone()]),this.faces.push(m),this.faceVertexUvs[0].push([u[E].clone(),u[D].clone(),u[v].clone()]),m=new THREE.Face3(D,A,v,[t[D].clone(),t[A].clone(),t[v].clone()]),this.faces.push(m),this.faceVertexUvs[0].push([u[D].clone(),u[A].clone(),u[v].clone()])}}this.computeFaceNormals()};THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry;THREE.TorusKnotGeometry=function(O,N,M,L,K,J,I){function H(k,h,r,q,p){var n=Math.cos(k),l=Math.sin(k);k*=h/r;h=Math.cos(k);n*=q*(2+h)*0.5;l=q*(2+h)*l*0.5;q=p*q*Math.sin(k)*0.5;return new THREE.Vector3(n,l,q)}THREE.Geometry.call(this);this.type="TorusKnotGeometry";this.parameters={radius:O,tube:N,radialSegments:M,tubularSegments:L,p:K,q:J,heightScale:I};O=O||100;N=N||40;M=M||64;L=L||8;K=K||2;J=J||3;I=I||1;for(var G=Array(M),F=new THREE.Vector3,D=new THREE.Vector3,C=new THREE.Vector3,E=0;E<M;++E){G[E]=Array(L);var o=E/M*2*K*Math.PI,B=H(o,J,K,O,I),o=H(o+0.01,J,K,O,I);F.subVectors(o,B);D.addVectors(o,B);C.crossVectors(F,D);D.crossVectors(C,F);C.normalize();D.normalize();for(o=0;o<L;++o){var A=o/L*2*Math.PI,m=-N*Math.cos(A),A=N*Math.sin(A),i=new THREE.Vector3;i.x=B.x+m*D.x+A*C.x;i.y=B.y+m*D.y+A*C.y;i.z=B.z+m*D.z+A*C.z;G[E][o]=this.vertices.push(i)-1}}for(E=0;E<M;++E){for(o=0;o<L;++o){K=(E+1)%M,J=(o+1)%L,O=G[E][o],N=G[K][o],K=G[K][J],J=G[E][J],I=new THREE.Vector2(E/M,o/L),F=new THREE.Vector2((E+1)/M,o/L),D=new THREE.Vector2((E+1)/M,(o+1)/L),C=new THREE.Vector2(E/M,(o+1)/L),this.faces.push(new THREE.Face3(O,N,J)),this.faceVertexUvs[0].push([I,F,C]),this.faces.push(new THREE.Face3(N,K,J)),this.faceVertexUvs[0].push([F.clone(),D,C.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry;THREE.TubeGeometry=function(P,O,N,M,L,K){THREE.Geometry.call(this);this.type="TubeGeometry";this.parameters={path:P,segments:O,radius:N,radialSegments:M,closed:L};O=O||64;N=N||1;M=M||8;L=L||!1;K=K||THREE.TubeGeometry.NoTaper;var J=[],I,H,G=O+1,E,D,F,A,C,B=new THREE.Vector3,o,m,i;o=new THREE.TubeGeometry.FrenetFrames(P,O,L);m=o.normals;i=o.binormals;this.tangents=o.tangents;this.normals=m;this.binormals=i;for(o=0;o<G;o++){for(J[o]=[],E=o/(G-1),C=P.getPointAt(E),I=m[o],H=i[o],F=N*K(E),E=0;E<M;E++){D=E/M*2*Math.PI,A=-F*Math.cos(D),D=F*Math.sin(D),B.copy(C),B.x+=A*I.x+D*H.x,B.y+=A*I.y+D*H.y,B.z+=A*I.z+D*H.z,J[o][E]=this.vertices.push(new THREE.Vector3(B.x,B.y,B.z))-1}}for(o=0;o<O;o++){for(E=0;E<M;E++){K=L?(o+1)%O:o+1,G=(E+1)%M,P=J[o][E],N=J[K][E],K=J[K][G],G=J[o][G],B=new THREE.Vector2(o/O,E/M),m=new THREE.Vector2((o+1)/O,E/M),i=new THREE.Vector2((o+1)/O,(E+1)/M),I=new THREE.Vector2(o/O,(E+1)/M),this.faces.push(new THREE.Face3(P,N,G)),this.faceVertexUvs[0].push([B,m,I]),this.faces.push(new THREE.Face3(N,K,G)),this.faceVertexUvs[0].push([m.clone(),i,I.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry;THREE.TubeGeometry.NoTaper=function(b){return 1};THREE.TubeGeometry.SinusoidalTaper=function(b){return Math.sin(Math.PI*b)};THREE.TubeGeometry.FrenetFrames=function(C,B,A){var v=new THREE.Vector3,u=[],t=[],s=[],r=new THREE.Vector3,o=new THREE.Matrix4;B+=1;var n,m,i;this.tangents=u;this.normals=t;this.binormals=s;for(n=0;n<B;n++){m=n/(B-1),u[n]=C.getTangentAt(m),u[n].normalize()}t[0]=new THREE.Vector3;s[0]=new THREE.Vector3;C=Number.MAX_VALUE;n=Math.abs(u[0].x);m=Math.abs(u[0].y);i=Math.abs(u[0].z);n<=C&&(C=n,v.set(1,0,0));m<=C&&(C=m,v.set(0,1,0));i<=C&&v.set(0,0,1);r.crossVectors(u[0],v).normalize();t[0].crossVectors(u[0],r);s[0].crossVectors(u[0],t[0]);for(n=1;n<B;n++){t[n]=t[n-1].clone(),s[n]=s[n-1].clone(),r.crossVectors(u[n-1],u[n]),0.0001<r.length()&&(r.normalize(),v=Math.acos(THREE.Math.clamp(u[n-1].dot(u[n]),-1,1)),t[n].applyMatrix4(o.makeRotationAxis(r,v))),s[n].crossVectors(u[n],t[n])}if(A){for(v=Math.acos(THREE.Math.clamp(t[0].dot(t[B-1]),-1,1)),v/=B-1,0<u[0].dot(r.crossVectors(t[0],t[B-1]))&&(v=-v),n=1;n<B;n++){t[n].applyMatrix4(o.makeRotationAxis(u[n],v*n)),s[n].crossVectors(u[n],t[n])}}};THREE.PolyhedronGeometry=function(J,I,H,G){function F(e){var d=e.normalize().clone();d.index=B.vertices.push(d)-1;var f=Math.atan2(e.z,-e.x)/2/Math.PI+0.5;e=Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+0.5;d.uv=new THREE.Vector2(f,1-e);return d}function E(f,e,h){var g=new THREE.Face3(f.index,e.index,h.index,[f.clone(),e.clone(),h.clone()]);B.faces.push(g);K.copy(f).add(e).add(h).divideScalar(3);g=Math.atan2(K.z,-K.x);B.faceVertexUvs[0].push([C(f.uv,f,g),C(e.uv,e,g),C(h.uv,h,g)])}function D(S,R){for(var Q=Math.pow(2,R),P=F(B.vertices[S.a]),O=F(B.vertices[S.b]),N=F(B.vertices[S.c]),u=[],t=0;t<=Q;t++){u[t]=[];for(var k=F(P.clone().lerp(N,t/Q)),f=F(O.clone().lerp(N,t/Q)),T=Q-t,e=0;e<=T;e++){u[t][e]=0==e&&t==Q?k:F(k.clone().lerp(f,e/T))}}for(t=0;t<Q;t++){for(e=0;e<2*(Q-t)-1;e++){P=Math.floor(e/2),0==e%2?E(u[t][P+1],u[t+1][P],u[t][P]):E(u[t][P+1],u[t+1][P+1],u[t+1][P])}}}function C(e,d,f){0>f&&1===e.x&&(e=new THREE.Vector2(e.x-1,e.y));0===d.x&&0===d.z&&(e=new THREE.Vector2(f/2/Math.PI+0.5,e.y));return e.clone()}THREE.Geometry.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:J,indices:I,radius:H,detail:G};H=H||1;G=G||0;for(var B=this,A=0,o=J.length;A<o;A+=3){F(new THREE.Vector3(J[A],J[A+1],J[A+2]))}J=this.vertices;for(var m=[],v=A=0,o=I.length;A<o;A+=3,v++){var L=J[I[A]],i=J[I[A+1]],M=J[I[A+2]];m[v]=new THREE.Face3(L.index,i.index,M.index,[L.clone(),i.clone(),M.clone()])}for(var K=new THREE.Vector3,A=0,o=m.length;A<o;A++){D(m[A],G)}A=0;for(o=this.faceVertexUvs[0].length;A<o;A++){I=this.faceVertexUvs[0][A],G=I[0].x,J=I[1].x,m=I[2].x,v=Math.max(G,Math.max(J,m)),L=Math.min(G,Math.min(J,m)),0.9<v&&0.1>L&&(0.2>G&&(I[0].x+=1),0.2>J&&(I[1].x+=1),0.2>m&&(I[2].x+=1))}A=0;for(o=this.vertices.length;A<o;A++){this.vertices[A].multiplyScalar(H)}this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,H)};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry;THREE.DodecahedronGeometry=function(f,e){this.parameters={radius:f,detail:e};var h=(1+Math.sqrt(5))/2,g=1/h;THREE.PolyhedronGeometry.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-g,-h,0,-g,h,0,g,-h,0,g,h,-g,-h,0,-g,h,0,g,-h,0,g,h,0,-h,0,-g,h,0,-g,-h,0,g,h,0,g],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],f,e)};THREE.DodecahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.DodecahedronGeometry.prototype.constructor=THREE.DodecahedronGeometry;THREE.IcosahedronGeometry=function(e,d){var f=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[-1,f,0,1,f,0,-1,-f,0,1,-f,0,0,-1,f,0,1,f,0,-1,-f,0,1,-f,f,0,-1,f,0,1,-f,0,-1,-f,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,d);this.type="IcosahedronGeometry";this.parameters={radius:e,detail:d}};THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry;THREE.OctahedronGeometry=function(d,c){this.parameters={radius:d,detail:c};THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],d,c);this.type="OctahedronGeometry";this.parameters={radius:d,detail:c}};THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry;THREE.TetrahedronGeometry=function(d,c){THREE.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],d,c);this.type="TetrahedronGeometry";this.parameters={radius:d,detail:c}};THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry;THREE.ParametricGeometry=function(H,G,F){THREE.Geometry.call(this);this.type="ParametricGeometry";this.parameters={func:H,slices:G,stacks:F};var E=this.vertices,D=this.faces,C=this.faceVertexUvs[0],B,A,v,u,o=G+1;for(B=0;B<=F;B++){for(u=B/F,A=0;A<=G;A++){v=A/G,v=H(v,u),E.push(v)}}var m,s,I,i;for(B=0;B<F;B++){for(A=0;A<G;A++){H=B*o+A,E=B*o+A+1,u=(B+1)*o+A+1,v=(B+1)*o+A,m=new THREE.Vector2(A/G,B/F),s=new THREE.Vector2((A+1)/G,B/F),I=new THREE.Vector2((A+1)/G,(B+1)/F),i=new THREE.Vector2(A/G,(B+1)/F),D.push(new THREE.Face3(H,E,v)),C.push([m,s,i]),D.push(new THREE.Face3(E,u,v)),C.push([s.clone(),I,i.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry;THREE.AxisHelper=function(e){e=e||1;var d=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]),f=new Float32Array([1,0,0,1,0.6,0,0,1,0,0.6,1,0,0,0,1,0,0.6,1]);e=new THREE.BufferGeometry;e.addAttribute("position",new THREE.BufferAttribute(d,3));e.addAttribute("color",new THREE.BufferAttribute(f,3));d=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,e,d,THREE.LinePieces)};THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype);THREE.AxisHelper.prototype.constructor=THREE.AxisHelper;THREE.ArrowHelper=function(){var d=new THREE.Geometry;d.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var c=new THREE.CylinderGeometry(0,0.5,1,5,1);c.applyMatrix((new THREE.Matrix4).makeTranslation(0,-0.5,0));return function(m,l,k,i,b,a){THREE.Object3D.call(this);void 0===i&&(i=16776960);void 0===k&&(k=1);void 0===b&&(b=0.2*k);void 0===a&&(a=0.2*b);this.position.copy(l);this.line=new THREE.Line(d,new THREE.LineBasicMaterial({color:i}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new THREE.Mesh(c,new THREE.MeshBasicMaterial({color:i}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(m);this.setLength(k,b,a)}}();THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper;THREE.ArrowHelper.prototype.setDirection=function(){var d=new THREE.Vector3,c;return function(a){0.99999<a.y?this.quaternion.set(0,0,0,1):-0.99999>a.y?this.quaternion.set(1,0,0,0):(d.set(a.z,0,-a.x).normalize(),c=Math.acos(a.y),this.quaternion.setFromAxisAngle(d,c))}}();THREE.ArrowHelper.prototype.setLength=function(e,d,f){void 0===d&&(d=0.2*e);void 0===f&&(f=0.2*d);this.line.scale.set(1,e-d,1);this.line.updateMatrix();this.cone.scale.set(f,d,f);this.cone.position.y=e;this.cone.updateMatrix()};THREE.ArrowHelper.prototype.setColor=function(b){this.line.material.color.set(b);this.cone.material.color.set(b)};THREE.BoxHelper=function(d){var c=new THREE.BufferGeometry;c.addAttribute("position",new THREE.BufferAttribute(new Float32Array(72),3));THREE.Line.call(this,c,new THREE.LineBasicMaterial({color:16776960}),THREE.LinePieces);void 0!==d&&this.update(d)};THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype);THREE.BoxHelper.prototype.constructor=THREE.BoxHelper;THREE.BoxHelper.prototype.update=function(f){var e=f.geometry;null===e.boundingBox&&e.computeBoundingBox();var h=e.boundingBox.min,e=e.boundingBox.max,g=this.geometry.attributes.position.array;g[0]=e.x;g[1]=e.y;g[2]=e.z;g[3]=h.x;g[4]=e.y;g[5]=e.z;g[6]=h.x;g[7]=e.y;g[8]=e.z;g[9]=h.x;g[10]=h.y;g[11]=e.z;g[12]=h.x;g[13]=h.y;g[14]=e.z;g[15]=e.x;g[16]=h.y;g[17]=e.z;g[18]=e.x;g[19]=h.y;g[20]=e.z;g[21]=e.x;g[22]=e.y;g[23]=e.z;g[24]=e.x;g[25]=e.y;g[26]=h.z;g[27]=h.x;g[28]=e.y;g[29]=h.z;g[30]=h.x;g[31]=e.y;g[32]=h.z;g[33]=h.x;g[34]=h.y;g[35]=h.z;g[36]=h.x;g[37]=h.y;g[38]=h.z;g[39]=e.x;g[40]=h.y;g[41]=h.z;g[42]=e.x;g[43]=h.y;g[44]=h.z;g[45]=e.x;g[46]=e.y;g[47]=h.z;g[48]=e.x;g[49]=e.y;g[50]=e.z;g[51]=e.x;g[52]=e.y;g[53]=h.z;g[54]=h.x;g[55]=e.y;g[56]=e.z;g[57]=h.x;g[58]=e.y;g[59]=h.z;g[60]=h.x;g[61]=h.y;g[62]=e.z;g[63]=h.x;g[64]=h.y;g[65]=h.z;g[66]=e.x;g[67]=h.y;g[68]=e.z;g[69]=e.x;g[70]=h.y;g[71]=h.z;this.geometry.attributes.position.needsUpdate=!0;this.geometry.computeBoundingSphere();this.matrix=f.matrixWorld;this.matrixAutoUpdate=!1};THREE.BoundingBoxHelper=function(e,d){var f=void 0!==d?d:8947848;this.object=e;this.box=new THREE.Box3;THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:f,wireframe:!0}))};THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.BoundingBoxHelper.prototype.constructor=THREE.BoundingBoxHelper;THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};THREE.CameraHelper=function(h){function g(e,c,f){m(e,f);m(c,f)}function m(d,c){l.vertices.push(new THREE.Vector3);l.colors.push(new THREE.Color(c));void 0===i[d]&&(i[d]=[]);i[d].push(l.vertices.length-1)}var l=new THREE.Geometry,k=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),i={};g("n1","n2",16755200);g("n2","n4",16755200);g("n4","n3",16755200);g("n3","n1",16755200);g("f1","f2",16755200);g("f2","f4",16755200);g("f4","f3",16755200);g("f3","f1",16755200);g("n1","f1",16755200);g("n2","f2",16755200);g("n3","f3",16755200);g("n4","f4",16755200);g("p","n1",16711680);g("p","n2",16711680);g("p","n3",16711680);g("p","n4",16711680);g("u1","u2",43775);g("u2","u3",43775);g("u3","u1",43775);g("c","t",16777215);g("p","c",3355443);g("cn1","cn2",3355443);g("cn3","cn4",3355443);g("cf1","cf2",3355443);g("cf3","cf4",3355443);THREE.Line.call(this,l,k,THREE.LinePieces);this.camera=h;this.matrix=h.matrixWorld;this.matrixAutoUpdate=!1;this.pointMap=i;this.update()};THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype);THREE.CameraHelper.prototype.constructor=THREE.CameraHelper;THREE.CameraHelper.prototype.update=function(){var g,f,k=new THREE.Vector3,i=new THREE.Camera,h=function(d,c,b,a){k.set(c,b,a).unproject(i);d=f[d];if(void 0!==d){for(c=0,b=d.length;c<b;c++){g.vertices[d[c]].copy(k)}}};return function(){g=this.geometry;f=this.pointMap;i.projectionMatrix.copy(this.camera.projectionMatrix);h("c",0,0,-1);h("t",0,0,1);h("n1",-1,-1,-1);h("n2",1,-1,-1);h("n3",-1,1,-1);h("n4",1,1,-1);h("f1",-1,-1,1);h("f2",1,-1,1);h("f3",-1,1,1);h("f4",1,1,1);h("u1",0.7,1.1,-1);h("u2",-0.7,1.1,-1);h("u3",0,2,-1);h("cf1",-1,0,1);h("cf2",1,0,1);h("cf3",0,-1,1);h("cf4",0,1,1);h("cn1",-1,0,-1);h("cn2",1,0,-1);h("cn3",0,-1,-1);h("cn4",0,1,-1);g.verticesNeedUpdate=!0}}();THREE.DirectionalLightHelper=function(f,e){THREE.Object3D.call(this);this.light=f;this.light.updateMatrixWorld();this.matrix=f.matrixWorld;this.matrixAutoUpdate=!1;e=e||1;var h=new THREE.Geometry;h.vertices.push(new THREE.Vector3(-e,e,0),new THREE.Vector3(e,e,0),new THREE.Vector3(e,-e,0),new THREE.Vector3(-e,-e,0),new THREE.Vector3(-e,e,0));var g=new THREE.LineBasicMaterial({fog:!1});g.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightPlane=new THREE.Line(h,g);this.add(this.lightPlane);h=new THREE.Geometry;h.vertices.push(new THREE.Vector3,new THREE.Vector3);g=new THREE.LineBasicMaterial({fog:!1});g.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine=new THREE.Line(h,g);this.add(this.targetLine);this.update()};THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.DirectionalLightHelper.prototype.constructor=THREE.DirectionalLightHelper;THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};THREE.DirectionalLightHelper.prototype.update=function(){var e=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld);d.setFromMatrixPosition(this.light.target.matrixWorld);f.subVectors(d,e);this.lightPlane.lookAt(f);this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine.geometry.vertices[1].copy(f);this.targetLine.geometry.verticesNeedUpdate=!0;this.targetLine.material.color.copy(this.lightPlane.material.color)}}();THREE.EdgesHelper=function(I,H,G){H=void 0!==H?H:16777215;G=Math.cos(THREE.Math.degToRad(void 0!==G?G:1));var F=[0,0],E={},D=function(d,c){return d-c},C=["a","b","c"],B=new THREE.BufferGeometry,A;I.geometry instanceof THREE.BufferGeometry?(A=new THREE.Geometry,A.fromBufferGeometry(I.geometry)):A=I.geometry.clone();A.mergeVertices();A.computeFaceNormals();var v=A.vertices;A=A.faces;for(var o=0,m=0,u=A.length;m<u;m++){for(var J=A[m],i=0;3>i;i++){F[0]=J[C[i]];F[1]=J[C[(i+1)%3]];F.sort(D);var K=F.toString();void 0===E[K]?(E[K]={vert1:F[0],vert2:F[1],face1:m,face2:void 0},o++):E[K].face2=m}}F=new Float32Array(6*o);D=0;for(K in E){if(C=E[K],void 0===C.face2||A[C.face1].normal.dot(A[C.face2].normal)<=G){o=v[C.vert1],F[D++]=o.x,F[D++]=o.y,F[D++]=o.z,o=v[C.vert2],F[D++]=o.x,F[D++]=o.y,F[D++]=o.z}}B.addAttribute("position",new THREE.BufferAttribute(F,3));THREE.Line.call(this,B,new THREE.LineBasicMaterial({color:H}),THREE.LinePieces);this.matrix=I.matrixWorld;this.matrixAutoUpdate=!1};THREE.EdgesHelper.prototype=Object.create(THREE.Line.prototype);THREE.EdgesHelper.prototype.constructor=THREE.EdgesHelper;THREE.FaceNormalsHelper=function(g,f,k,i){this.object=g;this.size=void 0!==f?f:1;g=void 0!==k?k:16776960;i=void 0!==i?i:1;f=new THREE.Geometry;k=0;for(var h=this.object.geometry.faces.length;k<h;k++){f.vertices.push(new THREE.Vector3,new THREE.Vector3)}THREE.Line.call(this,f,new THREE.LineBasicMaterial({color:g,linewidth:i}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.normalMatrix=new THREE.Matrix3;this.update()};THREE.FaceNormalsHelper.prototype=Object.create(THREE.Line.prototype);THREE.FaceNormalsHelper.prototype.constructor=THREE.FaceNormalsHelper;THREE.FaceNormalsHelper.prototype.update=function(){var k=this.geometry.vertices,i=this.object,q=i.geometry.vertices,p=i.geometry.faces,o=i.matrixWorld;i.updateMatrixWorld(!0);this.normalMatrix.getNormalMatrix(o);for(var n=i=0,m=p.length;i<m;i++,n+=2){var l=p[i];k[n].copy(q[l.a]).add(q[l.b]).add(q[l.c]).divideScalar(3).applyMatrix4(o);k[n+1].copy(l.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(k[n])}this.geometry.verticesNeedUpdate=!0;return this};THREE.GridHelper=function(h,g){var m=new THREE.Geometry,l=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924);this.color2=new THREE.Color(8947848);for(var k=-h;k<=h;k+=g){m.vertices.push(new THREE.Vector3(-h,0,k),new THREE.Vector3(h,0,k),new THREE.Vector3(k,0,-h),new THREE.Vector3(k,0,h));var i=0===k?this.color1:this.color2;m.colors.push(i,i,i,i)}THREE.Line.call(this,m,l,THREE.LinePieces)};THREE.GridHelper.prototype=Object.create(THREE.Line.prototype);THREE.GridHelper.prototype.constructor=THREE.GridHelper;THREE.GridHelper.prototype.setColors=function(d,c){this.color1.set(d);this.color2.set(c);this.geometry.colorsNeedUpdate=!0};THREE.HemisphereLightHelper=function(f,e){THREE.Object3D.call(this);this.light=f;this.light.updateMatrixWorld();this.matrix=f.matrixWorld;this.matrixAutoUpdate=!1;this.colors=[new THREE.Color,new THREE.Color];var h=new THREE.SphereGeometry(e,4,2);h.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));for(var g=0;8>g;g++){h.faces[g].color=this.colors[4>g?0:1]}g=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0});this.lightSphere=new THREE.Mesh(h,g);this.add(this.lightSphere);this.update()};THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.HemisphereLightHelper.prototype.constructor=THREE.HemisphereLightHelper;THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};THREE.HemisphereLightHelper.prototype.update=function(){var b=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(b.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=!0}}();THREE.PointLightHelper=function(f,e){this.light=f;this.light.updateMatrixWorld();var h=new THREE.SphereGeometry(e,4,2),g=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});g.color.copy(this.light.color).multiplyScalar(this.light.intensity);THREE.Mesh.call(this,h,g);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1};THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.PointLightHelper.prototype.constructor=THREE.PointLightHelper;THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};THREE.SkeletonHelper=function(e){this.bones=this.getBoneList(e);for(var d=new THREE.Geometry,f=0;f<this.bones.length;f++){this.bones[f].parent instanceof THREE.Bone&&(d.vertices.push(new THREE.Vector3),d.vertices.push(new THREE.Vector3),d.colors.push(new THREE.Color(0,0,1)),d.colors.push(new THREE.Color(0,1,0)))}f=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});THREE.Line.call(this,d,f,THREE.LinePieces);this.root=e;this.matrix=e.matrixWorld;this.matrixAutoUpdate=!1;this.update()};THREE.SkeletonHelper.prototype=Object.create(THREE.Line.prototype);THREE.SkeletonHelper.prototype.constructor=THREE.SkeletonHelper;THREE.SkeletonHelper.prototype.getBoneList=function(e){var d=[];e instanceof THREE.Bone&&d.push(e);for(var f=0;f<e.children.length;f++){d.push.apply(d,this.getBoneList(e.children[f]))}return d};THREE.SkeletonHelper.prototype.update=function(){for(var h=this.geometry,g=(new THREE.Matrix4).getInverse(this.root.matrixWorld),m=new THREE.Matrix4,l=0,k=0;k<this.bones.length;k++){var i=this.bones[k];i.parent instanceof THREE.Bone&&(m.multiplyMatrices(g,i.matrixWorld),h.vertices[l].setFromMatrixPosition(m),m.multiplyMatrices(g,i.parent.matrixWorld),h.vertices[l+1].setFromMatrixPosition(m),l+=2)}h.verticesNeedUpdate=!0;h.computeBoundingSphere()};THREE.SpotLightHelper=function(d){THREE.Object3D.call(this);this.light=d;this.light.updateMatrixWorld();this.matrix=d.matrixWorld;this.matrixAutoUpdate=!1;d=new THREE.CylinderGeometry(0,1,1,8,1,!0);d.applyMatrix((new THREE.Matrix4).makeTranslation(0,-0.5,0));d.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));var c=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new THREE.Mesh(d,c);this.add(this.cone);this.update()};THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.SpotLightHelper.prototype.constructor=THREE.SpotLightHelper;THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};THREE.SpotLightHelper.prototype.update=function(){var d=new THREE.Vector3,c=new THREE.Vector3;return function(){var b=this.light.distance?this.light.distance:10000,a=b*Math.tan(this.light.angle);this.cone.scale.set(a,a,b);d.setFromMatrixPosition(this.light.matrixWorld);c.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(c.sub(d));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();THREE.VertexNormalsHelper=function(k,i,q,p){this.object=k;this.size=void 0!==i?i:1;i=void 0!==q?q:16711680;p=void 0!==p?p:1;q=new THREE.Geometry;k=k.geometry.faces;for(var o=0,n=k.length;o<n;o++){for(var m=0,l=k[o].vertexNormals.length;m<l;m++){q.vertices.push(new THREE.Vector3,new THREE.Vector3)}}THREE.Line.call(this,q,new THREE.LineBasicMaterial({color:i,linewidth:p}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.normalMatrix=new THREE.Matrix3;this.update()};THREE.VertexNormalsHelper.prototype=Object.create(THREE.Line.prototype);THREE.VertexNormalsHelper.prototype.constructor=THREE.VertexNormalsHelper;THREE.VertexNormalsHelper.prototype.update=function(d){var c=new THREE.Vector3;return function(C){C=["a","b","c","d"];this.object.updateMatrixWorld(!0);this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var B=this.geometry.vertices,A=this.object.geometry.vertices,v=this.object.geometry.faces,u=this.object.matrixWorld,s=0,r=0,o=v.length;r<o;r++){for(var i=v[r],b=0,m=i.vertexNormals.length;b<m;b++){var D=i.vertexNormals[b];B[s].copy(A[i[C[b]]]).applyMatrix4(u);c.copy(D).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);c.add(B[s]);s+=1;B[s].copy(c);s+=1}}this.geometry.verticesNeedUpdate=!0;return this}}();THREE.VertexTangentsHelper=function(k,i,q,p){this.object=k;this.size=void 0!==i?i:1;i=void 0!==q?q:255;p=void 0!==p?p:1;q=new THREE.Geometry;k=k.geometry.faces;for(var o=0,n=k.length;o<n;o++){for(var m=0,l=k[o].vertexTangents.length;m<l;m++){q.vertices.push(new THREE.Vector3),q.vertices.push(new THREE.Vector3)}}THREE.Line.call(this,q,new THREE.LineBasicMaterial({color:i,linewidth:p}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.update()};THREE.VertexTangentsHelper.prototype=Object.create(THREE.Line.prototype);THREE.VertexTangentsHelper.prototype.constructor=THREE.VertexTangentsHelper;THREE.VertexTangentsHelper.prototype.update=function(d){var c=new THREE.Vector3;return function(C){C=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var B=this.geometry.vertices,A=this.object.geometry.vertices,v=this.object.geometry.faces,u=this.object.matrixWorld,s=0,r=0,o=v.length;r<o;r++){for(var i=v[r],b=0,m=i.vertexTangents.length;b<m;b++){var D=i.vertexTangents[b];B[s].copy(A[i[C[b]]]).applyMatrix4(u);c.copy(D).transformDirection(u).multiplyScalar(this.size);c.add(B[s]);s+=1;B[s].copy(c);s+=1}}this.geometry.verticesNeedUpdate=!0;return this}}();THREE.WireframeHelper=function(P,O){var N=void 0!==O?O:16777215,M=[0,0],L={},K=function(d,c){return d-c},J=["a","b","c"],I=new THREE.BufferGeometry;if(P.geometry instanceof THREE.Geometry){for(var H=P.geometry.vertices,G=P.geometry.faces,E=0,D=new Uint32Array(6*G.length),F=0,A=G.length;F<A;F++){for(var C=G[F],B=0;3>B;B++){M[0]=C[J[B]];M[1]=C[J[(B+1)%3]];M.sort(K);var o=M.toString();void 0===L[o]&&(D[2*E]=M[0],D[2*E+1]=M[1],L[o]=!0,E++)}}M=new Float32Array(6*E);F=0;for(A=E;F<A;F++){for(B=0;2>B;B++){E=H[D[2*F+B]],J=6*F+3*B,M[J+0]=E.x,M[J+1]=E.y,M[J+2]=E.z}}I.addAttribute("position",new THREE.BufferAttribute(M,3))}else{if(P.geometry instanceof THREE.BufferGeometry){if(void 0!==P.geometry.attributes.index){H=P.geometry.attributes.position.array;A=P.geometry.attributes.index.array;G=P.geometry.drawcalls;E=0;0===G.length&&(G=[{count:A.length,index:0,start:0}]);for(var D=new Uint32Array(2*A.length),C=0,m=G.length;C<m;++C){for(var B=G[C].start,o=G[C].count,J=G[C].index,F=B,i=B+o;F<i;F+=3){for(B=0;3>B;B++){M[0]=J+A[F+B],M[1]=J+A[F+(B+1)%3],M.sort(K),o=M.toString(),void 0===L[o]&&(D[2*E]=M[0],D[2*E+1]=M[1],L[o]=!0,E++)}}}M=new Float32Array(6*E);F=0;for(A=E;F<A;F++){for(B=0;2>B;B++){J=6*F+3*B,E=3*D[2*F+B],M[J+0]=H[E],M[J+1]=H[E+1],M[J+2]=H[E+2]}}}else{for(H=P.geometry.attributes.position.array,E=H.length/3,D=E/3,M=new Float32Array(6*E),F=0,A=D;F<A;F++){for(B=0;3>B;B++){J=18*F+6*B,D=9*F+3*B,M[J+0]=H[D],M[J+1]=H[D+1],M[J+2]=H[D+2],E=9*F+(B+1)%3*3,M[J+3]=H[E],M[J+4]=H[E+1],M[J+5]=H[E+2]}}}I.addAttribute("position",new THREE.BufferAttribute(M,3))}}THREE.Line.call(this,I,new THREE.LineBasicMaterial({color:N}),THREE.LinePieces);this.matrix=P.matrixWorld;this.matrixAutoUpdate=!1};THREE.WireframeHelper.prototype=Object.create(THREE.Line.prototype);THREE.WireframeHelper.prototype.constructor=THREE.WireframeHelper;THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this);this.render=function(b){}};THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject;THREE.MorphBlendMesh=function(e,d){THREE.Mesh.call(this,e,d);this.animationsMap={};this.animationsList=[];var f=this.geometry.morphTargets.length;this.createAnimation("__default",0,f-1,f/1);this.setAnimationWeight("__default",1)};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphBlendMesh.prototype.constructor=THREE.MorphBlendMesh;THREE.MorphBlendMesh.prototype.createAnimation=function(f,e,h,g){e={startFrame:e,endFrame:h,length:h-e+1,fps:g,duration:(h-e)/g,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[f]=e;this.animationsList.push(e)};THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(s){for(var r=/([a-z]+)_?(\d+)/,q,p={},o=this.geometry,n=0,m=o.morphTargets.length;n<m;n++){var l=o.morphTargets[n].name.match(r);if(l&&1<l.length){var i=l[1];p[i]||(p[i]={start:Infinity,end:-Infinity});l=p[i];n<l.start&&(l.start=n);n>l.end&&(l.end=n);q||(q=i)}}for(i in p){l=p[i],this.createAnimation(i,l.start,l.end,s)}this.firstAnimation=q};THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(b){if(b=this.animationsMap[b]){b.direction=1,b.directionBackwards=!1}};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(b){if(b=this.animationsMap[b]){b.direction=-1,b.directionBackwards=!0}};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,d){var f=this.animationsMap[e];f&&(f.fps=d,f.duration=(f.end-f.start)/f.fps)};THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,d){var f=this.animationsMap[e];f&&(f.duration=d,f.fps=(f.end-f.start)/f.duration)};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,d){var f=this.animationsMap[e];f&&(f.weight=d)};THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,d){var f=this.animationsMap[e];f&&(f.time=d)};THREE.MorphBlendMesh.prototype.getAnimationTime=function(d){var c=0;if(d=this.animationsMap[d]){c=d.time}return c};THREE.MorphBlendMesh.prototype.getAnimationDuration=function(d){var c=-1;if(d=this.animationsMap[d]){c=d.duration}return c};THREE.MorphBlendMesh.prototype.playAnimation=function(d){var c=this.animationsMap[d];c?(c.time=0,c.active=!0):THREE.warn("THREE.MorphBlendMesh: animation["+d+"] undefined in .playAnimation()")};THREE.MorphBlendMesh.prototype.stopAnimation=function(b){if(b=this.animationsMap[b]){b.active=!1}};THREE.MorphBlendMesh.prototype.update=function(i){for(var h=0,o=this.animationsList.length;h<o;h++){var n=this.animationsList[h];if(n.active){var m=n.duration/n.length;n.time+=n.direction*i;if(n.mirroredLoop){if(n.time>n.duration||0>n.time){n.direction*=-1,n.time>n.duration&&(n.time=n.duration,n.directionBackwards=!0),0>n.time&&(n.time=0,n.directionBackwards=!1)}}else{n.time%=n.duration,0>n.time&&(n.time+=n.duration)}var l=n.startFrame+THREE.Math.clamp(Math.floor(n.time/m),0,n.length-1),k=n.weight;l!==n.currentFrame&&(this.morphTargetInfluences[n.lastFrame]=0,this.morphTargetInfluences[n.currentFrame]=1*k,this.morphTargetInfluences[l]=0,n.lastFrame=n.currentFrame,n.currentFrame=l);m=n.time%m/m;n.directionBackwards&&(m=1-m);this.morphTargetInfluences[n.currentFrame]=m*k;this.morphTargetInfluences[n.lastFrame]=(1-m)*k}}};var aseMaterials=function(){var a=this;this.materials={};this.get=function(b){var b;switch(b){case"box":b=new THREE.LineDashedMaterial({color:54015,dashSize:2,gapSize:1});break;case"object":b=new THREE.MeshPhongMaterial({color:16744448,ambient:11556864,emissive:10440704,specular:8195855,shininess:30,blending:0,side:2,shading:THREE.FlatShading});break}return b}};var aseMaterial=new aseMaterials();"use strict";var System={browser:function(){var b=navigator.userAgent;return/Arora/i.test(b)?"Arora":/Chrome/i.test(b)?"Chrome":/Epiphany/i.test(b)?"Epiphany":/Firefox/i.test(b)?"Firefox":/Mobile(\/.*)? Safari/i.test(b)?"Mobile Safari":/MSIE/i.test(b)?"Internet Explorer":/Midori/i.test(b)?"Midori":/Opera/.test(b)?"Opera":/Safari/i.test(b)?"Safari":!1}(),os:function(){var b=navigator.userAgent;return/Android/i.test(b)?"Android":/CrOS/i.test(b)?"Chrome OS":/iP[ao]d|iPhone/i.test(b)?"iOS":/Linux/i.test(b)?"Linux":/Mac OS/i.test(b)?"Mac OS":/windows/i.test(b)?"Windows":!1}(),support:{canvas:!!window.CanvasRenderingContext2D,localStorage:function(){try{return !!window.localStorage.getItem}catch(b){return !1}}(),file:!!window.File&&!!window.FileReader&&!!window.FileList&&!!window.Blob,fileSystem:!!window.requestFileSystem||!!window.webkitRequestFileSystem,getUserMedia:!!window.navigator.getUserMedia||!!window.navigator.webkitGetUserMedia||!!window.navigator.mozGetUserMedia||!!window.navigator.msGetUserMedia,requestAnimationFrame:!!window.mozRequestAnimationFrame||!!window.webkitRequestAnimationFrame||!!window.oRequestAnimationFrame||!!window.msRequestAnimationFrame,sessionStorage:function(){try{return !!window.sessionStorage.getItem}catch(b){return !1}}(),webgl:function(){try{return !!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(b){return !1}}(),worker:!!window.Worker}};THREE.EditorControls=function(v,t){t=(t!==undefined)?t:document;this.enabled=true;this.center=new THREE.Vector3();var b=this;var c=new THREE.Vector3();var p={NONE:-1,ROTATE:0,ZOOM:1,PAN:2};var f=p.NONE;var s=this.center;var i=new THREE.Matrix3();var n=new THREE.Vector2();var u=new THREE.Vector2();var r={type:"change"};this.focus=function(B,D){var C=new THREE.Vector3();B.matrixWorld.decompose(s,new THREE.Quaternion(),C);if(D&&B.geometry){C=(C.x+C.y+C.z)/3;s.add(B.geometry.boundingSphere.center.clone().multiplyScalar(C));var A=B.geometry.boundingSphere.radius*(C);var E=v.position.clone().sub(s).normalize().multiplyScalar(A*2);v.position.copy(s).add(E)}v.lookAt(s);b.dispatchEvent(r)};this.pan=function(B){var A=v.position.distanceTo(s);B.multiplyScalar(A*0.001);B.applyMatrix3(i.getNormalMatrix(v.matrix));v.position.add(B);s.add(B);b.dispatchEvent(r)};this.zoom=function(B){var A=v.position.distanceTo(s);B.multiplyScalar(A*0.001);if(B.length()>A){return}B.applyMatrix3(i.getNormalMatrix(v.matrix));v.position.add(B);b.dispatchEvent(r)};this.rotate=function(E){c.copy(v.position).sub(s);var B=Math.atan2(c.x,c.z);var C=Math.atan2(Math.sqrt(c.x*c.x+c.z*c.z),c.y);B+=E.x;C+=E.y;var D=0.000001;C=Math.max(D,Math.min(Math.PI-D,C));var A=c.length();c.x=A*Math.sin(C)*Math.sin(B);c.y=A*Math.cos(C);c.z=A*Math.sin(C)*Math.cos(B);v.position.copy(s).add(c);v.lookAt(s);b.dispatchEvent(r)};function h(A){if(b.enabled===false){return}A.preventDefault();if(A.button===0){f=p.ROTATE}else{if(A.button===1){f=p.ZOOM}else{if(A.button===2){f=p.PAN}}}u.set(A.clientX,A.clientY);t.addEventListener("mousemove",m,false);t.addEventListener("mouseup",d,false);t.addEventListener("mouseout",d,false);t.addEventListener("dblclick",d,false)}function m(B){if(b.enabled===false){return}B.preventDefault();n.set(B.clientX,B.clientY);var C=n.x-u.x;var A=n.y-u.y;if(f===p.ROTATE){b.rotate(new THREE.Vector3(-C*0.005,-A*0.005,0))}else{if(f===p.ZOOM){b.zoom(new THREE.Vector3(0,0,A))}else{if(f===p.PAN){b.pan(new THREE.Vector3(-C,A,0))}}}u.set(B.clientX,B.clientY)}function d(A){t.removeEventListener("mousemove",m,false);t.removeEventListener("mouseup",d,false);t.removeEventListener("mouseout",d,false);t.removeEventListener("dblclick",d,false);f=p.NONE}function k(A){A.preventDefault();var B=0;if(A.wheelDelta){B=-A.wheelDelta}else{if(A.detail){B=A.detail*10}}b.zoom(new THREE.Vector3(0,0,B))}t.addEventListener("contextmenu",function(A){A.preventDefault()},false);t.addEventListener("mousedown",h,false);t.addEventListener("mousewheel",k,false);t.addEventListener("DOMMouseScroll",k,false);var g=new THREE.Vector3();var l=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()];var e=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()];var q=null;function a(A){if(b.enabled===false){return}switch(A.touches.length){case 1:l[0].set(A.touches[0].pageX,A.touches[0].pageY,0);l[1].set(A.touches[0].pageX,A.touches[0].pageY,0);break;case 2:l[0].set(A.touches[0].pageX,A.touches[0].pageY,0);l[1].set(A.touches[1].pageX,A.touches[1].pageY,0);q=l[0].distanceTo(l[1]);break}e[0].copy(l[0]);e[1].copy(l[1])}function o(B){if(b.enabled===false){return}B.preventDefault();B.stopPropagation();var D=function(H,G){var F=G[0];for(var E in G){if(F.distanceTo(H)>G[E].distanceTo(H)){F=G[E]}}return F};switch(B.touches.length){case 1:l[0].set(B.touches[0].pageX,B.touches[0].pageY,0);l[1].set(B.touches[0].pageX,B.touches[0].pageY,0);b.rotate(l[0].sub(D(l[0],e)).multiplyScalar(-0.005));break;case 2:l[0].set(B.touches[0].pageX,B.touches[0].pageY,0);l[1].set(B.touches[1].pageX,B.touches[1].pageY,0);distance=l[0].distanceTo(l[1]);b.zoom(new THREE.Vector3(0,0,q-distance));q=distance;var C=l[0].clone().sub(D(l[0],e));var A=l[1].clone().sub(D(l[1],e));C.x=-C.x;A.x=-A.x;b.pan(C.add(A).multiplyScalar(0.5));break}e[0].copy(l[0]);e[1].copy(l[1])}t.addEventListener("touchstart",a,false);t.addEventListener("touchmove",o,false)};THREE.EditorControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.EditorControls.prototype.constructor=THREE.EditorControls;(function(){function f(i){var k=15*(Math.PI/180);return Math.floor((i+k/2)/k)*k;console.log()}"use strict";var e=function(i){THREE.MeshBasicMaterial.call(this);this.depthTest=false;this.depthWrite=false;this.side=THREE.FrontSide;this.transparent=true;this.setValues(i);this.oldColor=this.color.clone();this.oldOpacity=this.opacity;this.highlight=function(k){if(k){this.color.setRGB(0,0,0);this.opacity=1}else{this.color.copy(this.oldColor);this.opacity=this.oldOpacity}}};e.prototype=Object.create(THREE.MeshBasicMaterial.prototype);e.prototype.constructor=e;var h=function(i){THREE.LineBasicMaterial.call(this);this.depthTest=false;this.depthWrite=false;this.transparent=true;this.linewidth=1;this.setValues(i);this.oldColor=this.color.clone();this.oldOpacity=this.opacity;this.highlight=function(k){if(k){this.color.setRGB(0,0,0);this.opacity=1}else{this.color.copy(this.oldColor);this.opacity=this.oldOpacity}}};h.prototype=Object.create(THREE.LineBasicMaterial.prototype);h.prototype.constructor=h;var d=15076169;var c=6938231;var a=3578863;var b=0;var g=0;THREE.TransformGizmo=function(){var i=this;var l=false;var k=false;this.init=function(){THREE.Object3D.call(this);this.handles=new THREE.Object3D();this.pickers=new THREE.Object3D();this.planes=new THREE.Object3D();this.add(this.handles);this.add(this.pickers);this.add(this.planes);var m=new THREE.PlaneGeometry(50,50,2,2);var q=new THREE.MeshBasicMaterial({wireframe:true});q.side=THREE.DoubleSide;var n={XY:new THREE.Mesh(m,q),YZ:new THREE.Mesh(m,q),XZ:new THREE.Mesh(m,q),XYZE:new THREE.Mesh(m,q)};this.activePlane=n.XYZE;n.YZ.rotation.set(0,Math.PI/2,0);n.XZ.rotation.set(-Math.PI/2,0,0);for(var o in n){n[o].name=o;this.planes.add(n[o]);this.planes[o]=n[o];n[o].visible=false}var p=function(s,A){for(var u in s){for(o=s[u].length;o--;){var t=s[u][o][0];var r=s[u][o][1];var v=s[u][o][2];t.name=u;if(r){t.position.set(r[0],r[1],r[2])}if(v){t.rotation.set(v[0],v[1],v[2])}A.add(t)}}};p(this.handleGizmos,this.handles);p(this.pickerGizmos,this.pickers);this.traverse(function(s){if(s instanceof THREE.Mesh){s.updateMatrix();var r=new THREE.Geometry();r.merge(s.geometry,s.matrix);s.geometry=r;s.position.set(0,0,0);s.rotation.set(0,0,0);s.scale.set(1,1,1)}})};this.hide=function(){this.traverse(function(m){m.visible=false})};this.show=function(){this.traverse(function(m){m.visible=true;if(m.parent==i.pickers){m.visible=l}if(m.parent==i.planes){m.visible=false}});this.activePlane.visible=k};this.highlight=function(m){this.traverse(function(n){if(n.material&&n.material.highlight){if(n.name==m){n.material.highlight(true)}else{n.material.highlight(false)}}})}};THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype);THREE.TransformGizmo.prototype.constructor=THREE.TransformGizmo;THREE.TransformGizmo.prototype.update=function(l,i){var n=new THREE.Vector3(0,0,0);var m=new THREE.Vector3(0,1,0);var k=new THREE.Matrix4();this.traverse(function(o){if(o.name.search("E")!=-1){o.quaternion.setFromRotationMatrix(k.lookAt(i,n,m))}else{if(o.name.search("X")!=-1||o.name.search("Y")!=-1||o.name.search("Z")!=-1){o.quaternion.setFromEuler(l)}}})};THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this);var i=new THREE.Geometry();var n=new THREE.Mesh(new THREE.CylinderGeometry(0,0.05,0.2,12,1,false));n.position.y=0.5;n.updateMatrix();i.merge(n.geometry,n.matrix);var m=new THREE.Geometry();m.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0));var l=new THREE.Geometry();l.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var k=new THREE.Geometry();k.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));this.handleGizmos={X:[[new THREE.Mesh(i,new e({color:d})),[0.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(m,new h({color:d}))]],Y:[[new THREE.Mesh(i,new e({color:c})),[0,0.5,0]],[new THREE.Line(l,new h({color:c}))]],Z:[[new THREE.Mesh(i,new e({color:a})),[0,0,0.5],[Math.PI/2,0,0]],[new THREE.Line(k,new h({color:a}))]],XYZ:[],XY:[[new THREE.Mesh(new THREE.PlaneGeometry(0.29,0.29),new e({color:b,opacity:0.25})),[0.15,0.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneGeometry(0.29,0.29),new e({color:b,opacity:0.25})),[0,0.15,0.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneGeometry(0.29,0.29),new e({color:b,opacity:0.25})),[0.15,0,0.15],[-Math.PI/2,0,0]]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(0.2,0,1,4,1,false),new e({color:d,opacity:0.25})),[0.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(0.2,0,1,4,1,false),new e({color:c,opacity:0.25})),[0,0.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(0.2,0,1,4,1,false),new e({color:a,opacity:0.25})),[0,0,0.6],[Math.PI/2,0,0]]],XYZ:[],XY:[[new THREE.Mesh(new THREE.PlaneGeometry(0.4,0.4),new e({color:b,opacity:0.25})),[0.2,0.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneGeometry(0.4,0.4),new e({color:b,opacity:0.25})),[0,0.2,0.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneGeometry(0.4,0.4),new e({color:b,opacity:0.25})),[0.2,0,0.2],[-Math.PI/2,0,0]]]};this.setActivePlane=function(q,o){var p=new THREE.Matrix4();o.applyMatrix4(p.getInverse(p.extractRotation(this.planes.XY.matrixWorld)));if(q=="X"){this.activePlane=this.planes.XY;if(Math.abs(o.y)>Math.abs(o.z)){this.activePlane=this.planes.XZ}}if(q=="Y"){this.activePlane=this.planes.XY;if(Math.abs(o.x)>Math.abs(o.z)){this.activePlane=this.planes.YZ}}if(q=="Z"){this.activePlane=this.planes.XZ;if(Math.abs(o.x)>Math.abs(o.y)){this.activePlane=this.planes.YZ}}if(q=="XYZ"){this.activePlane=this.planes.XYZE}if(q=="XY"){this.activePlane=this.planes.XY}if(q=="YZ"){this.activePlane=this.planes.YZ}if(q=="XZ"){this.activePlane=this.planes.XZ}this.hide();this.show()};this.init()};THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoTranslate.prototype.constructor=THREE.TransformGizmoTranslate;THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this);var k=function(l,m,o){var p=new THREE.Geometry();o=o?o:1;for(var n=0;n<=64*o;++n){if(m=="x"){p.vertices.push(new THREE.Vector3(0,Math.cos(n/32*Math.PI),Math.sin(n/32*Math.PI)).multiplyScalar(l))}if(m=="y"){p.vertices.push(new THREE.Vector3(Math.cos(n/32*Math.PI),0,Math.sin(n/32*Math.PI)).multiplyScalar(l))}if(m=="z"){p.vertices.push(new THREE.Vector3(Math.sin(n/32*Math.PI),Math.cos(n/32*Math.PI),0).multiplyScalar(l))}}return p};var i=1.2;this.handleGizmos={X:[[new THREE.Line(new k(i,"x",0.5),new h({color:d}))]],Y:[[new THREE.Line(new k(i,"y",0.5),new h({color:c}))]],Z:[[new THREE.Line(new k(i,"z",0.5),new h({color:a}))]],E:[],XYZE:[[new THREE.Line(new k(i,"z",1),new h({color:16777215,opacity:0.5,transparent:true}))]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.TorusGeometry(i,0.5,4,12,Math.PI),new e({color:d,opacity:0.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusGeometry(i,0.5,4,12,Math.PI),new e({color:c,opacity:0.25})),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusGeometry(i,0.5,4,12,Math.PI),new e({color:a,opacity:0.25})),[0,0,0],[0,0,-Math.PI/2]]],E:[],XYZE:[]};this.setActivePlane=function(l){if(l=="E"){this.activePlane=this.planes.XYZE}if(l=="X"){this.activePlane=this.planes.YZ}if(l=="Y"){this.activePlane=this.planes.XZ}if(l=="Z"){this.activePlane=this.planes.XY}this.hide();this.show()};this.update=function(B,s){THREE.TransformGizmo.prototype.update.apply(this,arguments);var A={handles:this["handles"],pickers:this["pickers"]};var q=new THREE.Matrix4();var n=new THREE.Euler(0,0,1);var r=new THREE.Quaternion();var v=new THREE.Vector3(1,0,0);var u=new THREE.Vector3(0,1,0);var t=new THREE.Vector3(0,0,1);var p=new THREE.Quaternion();var m=new THREE.Quaternion();var l=new THREE.Quaternion();var o=s.clone();n.copy(this.planes.XY.rotation);r.setFromEuler(n);q.makeRotationFromQuaternion(r).getInverse(q);o.applyMatrix4(q);this.traverse(function(C){r.setFromEuler(n);if(C.name=="X"){p.setFromAxisAngle(v,Math.atan2(-o.y,o.z));r.multiplyQuaternions(r,p);C.quaternion.copy(r)}if(C.name=="Y"){m.setFromAxisAngle(u,Math.atan2(o.x,o.z));r.multiplyQuaternions(r,m);C.quaternion.copy(r)}if(C.name=="Z"){l.setFromAxisAngle(t,Math.atan2(o.y,o.x));r.multiplyQuaternions(r,l);C.quaternion.copy(r)}})};this.init()};THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoRotate.prototype.constructor=THREE.TransformGizmoRotate;THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this);var i=new THREE.Geometry();var n=new THREE.Mesh(new THREE.BoxGeometry(0.125,0.125,0.125));n.position.y=0.5;n.updateMatrix();i.merge(n.geometry,n.matrix);var m=new THREE.Geometry();m.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0));var l=new THREE.Geometry();l.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var k=new THREE.Geometry();k.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));this.handleGizmos={X:[[new THREE.Mesh(i,new e({color:d})),[0.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(m,new h({color:d}))]],Y:[[new THREE.Mesh(i,new e({color:c})),[0,0.5,0]],[new THREE.Line(l,new h({color:c}))]],Z:[[new THREE.Mesh(i,new e({color:a})),[0,0,0.5],[Math.PI/2,0,0]],[new THREE.Line(k,new h({color:a}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(0.125,0.125,0.125),new e({color:16777215,opacity:0.25}))]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(0.2,0,1,4,1,false),new e({color:d,opacity:0.25})),[0.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(0.2,0,1,4,1,false),new e({color:c,opacity:0.25})),[0,0.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(0.2,0,1,4,1,false),new e({color:a,opacity:0.25})),[0,0,0.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(0.4,0.4,0.4),new e({color:16777215,opacity:0.25}))]]};this.setActivePlane=function(q,o){var p=new THREE.Matrix4();o.applyMatrix4(p.getInverse(p.extractRotation(this.planes.XY.matrixWorld)));if(q=="X"){this.activePlane=this.planes.XY;if(Math.abs(o.y)>Math.abs(o.z)){this.activePlane=this.planes.XZ}}if(q=="Y"){this.activePlane=this.planes.XY;if(Math.abs(o.x)>Math.abs(o.z)){this.activePlane=this.planes.YZ}}if(q=="Z"){this.activePlane=this.planes.XZ;if(Math.abs(o.x)>Math.abs(o.y)){this.activePlane=this.planes.YZ}}if(q=="XYZ"){this.activePlane=this.planes.XYZE}this.hide();this.show()};this.init()};THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoScale.prototype.constructor=THREE.TransformGizmoScale;THREE.TransformControls=function(D,Y){THREE.Object3D.call(this);Y=(Y!==undefined)?Y:document;this.gizmo={};this.gizmo.translate=new THREE.TransformGizmoTranslate();this.gizmo.rotate=new THREE.TransformGizmoRotate();this.gizmo.scale=new THREE.TransformGizmoScale();this.add(this.gizmo.translate);this.add(this.gizmo.rotate);this.add(this.gizmo.scale);this.gizmo.translate.hide();this.gizmo.rotate.hide();this.gizmo.scale.hide();this.object=undefined;this.snap=null;this.space="world";this.size=1;this.axis=null;var R=this;var M=false;var B="translate";var J="XY";var ac={type:"change"};var i={type:"mouseDown"};var r={type:"mouseUp",mode:B};var af={type:"objectChange"};var ab=new THREE.Raycaster();var t=new THREE.Vector3();var O=new THREE.Vector3();var V=new THREE.Vector3();var L=new THREE.Vector3();var p=new THREE.Vector3();var N=1;var X=new THREE.Matrix4();var W=new THREE.Vector3();var k=new THREE.Matrix4();var H=new THREE.Vector3();var q=new THREE.Quaternion();var A=new THREE.Vector3(1,0,0);var v=new THREE.Vector3(0,1,0);var u=new THREE.Vector3(0,0,1);var T=new THREE.Quaternion();var I=new THREE.Quaternion();var G=new THREE.Quaternion();var F=new THREE.Quaternion();var P=new THREE.Quaternion();var U=new THREE.Vector3();var ae=new THREE.Vector3();var Z=new THREE.Matrix4();var m=new THREE.Matrix4();var n=new THREE.Vector3();var C=new THREE.Vector3();var o=new THREE.Euler();var E=new THREE.Matrix4();var l=new THREE.Vector3();var ad=new THREE.Euler();Y.addEventListener("mousedown",Q,false);Y.addEventListener("touchstart",Q,false);Y.addEventListener("mousemove",K,false);Y.addEventListener("touchmove",K,false);Y.addEventListener("mousemove",aa,false);Y.addEventListener("touchmove",aa,false);Y.addEventListener("mouseup",S,false);Y.addEventListener("mouseout",S,false);Y.addEventListener("touchend",S,false);Y.addEventListener("touchcancel",S,false);Y.addEventListener("touchleave",S,false);this.attach=function(ag){R.object=ag;this.gizmo.translate.hide();this.gizmo.rotate.hide();this.gizmo.scale.hide();this.gizmo[B].show();R.update()};this.detach=function(ag){R.object=undefined;this.axis=null;this.gizmo.translate.hide();this.gizmo.rotate.hide();this.gizmo.scale.hide()};this.setMode=function(ag){B=ag?ag:B;if(B=="scale"){R.space="local"}this.gizmo.translate.hide();this.gizmo.rotate.hide();this.gizmo.scale.hide();this.gizmo[B].show();this.update();R.dispatchEvent(ac)};this.setSnap=function(ag){R.snap=ag};this.setSize=function(ag){R.size=ag;this.update();R.dispatchEvent(ac)};this.setSpace=function(ag){R.space=ag;this.update();R.dispatchEvent(ac)};this.update=function(){if(R.object===undefined){return}R.object.updateMatrixWorld();C.setFromMatrixPosition(R.object.matrixWorld);o.setFromRotationMatrix(k.extractRotation(R.object.matrixWorld));D.updateMatrixWorld();l.setFromMatrixPosition(D.matrixWorld);ad.setFromRotationMatrix(k.extractRotation(D.matrixWorld));N=C.distanceTo(l)/6*R.size;this.position.copy(C);this.scale.set(N,N,N);W.copy(l).sub(C).normalize();if(R.space=="local"){this.gizmo[B].update(o,W)}else{if(R.space=="world"){this.gizmo[B].update(new THREE.Euler(),W)}}this.gizmo[B].highlight(R.axis)};function K(ai){if(R.object===undefined||M===true){return}ai.preventDefault();var aj=ai.changedTouches?ai.changedTouches[0]:ai;var ag=s(aj,R.gizmo[B].pickers.children);var ah=null;if(ag){ah=ag.object.name}if(R.axis!==ah){R.axis=ah;R.update();R.dispatchEvent(ac)}}function Q(ai){if(R.object===undefined||M===true){return}ai.preventDefault();ai.stopPropagation();var aj=ai.changedTouches?ai.changedTouches[0]:ai;if(aj.button===0||aj.button===undefined){var ag=s(aj,R.gizmo[B].pickers.children);if(ag){R.dispatchEvent(i);R.axis=ag.object.name;R.update();W.copy(l).sub(C).normalize();R.gizmo[B].setActivePlane(R.axis,W);var ah=s(aj,[R.gizmo[B].activePlane]);U.copy(R.object.position);ae.copy(R.object.scale);Z.extractRotation(R.object.matrix);E.extractRotation(R.object.matrixWorld);m.extractRotation(R.object.parent.matrixWorld);n.setFromMatrixScale(k.getInverse(R.object.parent.matrixWorld));V.copy(ah.point)}}M=true}function aa(ah){if(R.object===undefined||R.axis===null||M===false){return}ah.preventDefault();ah.stopPropagation();var ai=ah.changedTouches?ah.changedTouches[0]:ah;var ag=s(ai,[R.gizmo[B].activePlane]);O.copy(ag.point);if(B=="translate"){O.sub(V);O.multiply(n);if(R.space=="local"){O.applyMatrix4(k.getInverse(E));if(R.axis.search("X")==-1){O.x=0}if(R.axis.search("Y")==-1){O.y=0}if(R.axis.search("Z")==-1){O.z=0}O.applyMatrix4(Z);R.object.position.copy(U);R.object.position.add(O)}if(R.space=="world"||R.axis.search("XYZ")!=-1){if(R.axis.search("X")==-1){O.x=0}if(R.axis.search("Y")==-1){O.y=0}if(R.axis.search("Z")==-1){O.z=0}O.applyMatrix4(k.getInverse(m));R.object.position.copy(U);R.object.position.add(O)}if(R.snap!==null){if(R.axis.search("X")!=-1){R.object.position.x=Math.round(R.object.position.x/R.snap)*R.snap}if(R.axis.search("Y")!=-1){R.object.position.y=Math.round(R.object.position.y/R.snap)*R.snap}if(R.axis.search("Z")!=-1){R.object.position.z=Math.round(R.object.position.z/R.snap)*R.snap}}}else{if(B=="scale"){O.sub(V);O.multiply(n);if(R.space=="local"){if(R.axis=="XYZ"){N=1+((O.y)/50);R.object.scale.x=ae.x*N;R.object.scale.y=ae.y*N;R.object.scale.z=ae.z*N}else{O.applyMatrix4(k.getInverse(E));if(R.axis=="X"){R.object.scale.x=ae.x*(1+O.x/50)}if(R.axis=="Y"){R.object.scale.y=ae.y*(1+O.y/50)}if(R.axis=="Z"){R.object.scale.z=ae.z*(1+O.z/50)}}}}else{if(B=="rotate"){O.sub(C);O.multiply(n);H.copy(V).sub(C);H.multiply(n);if(R.axis=="E"){O.applyMatrix4(k.getInverse(X));H.applyMatrix4(k.getInverse(X));L.set(Math.atan2(O.z,O.y),Math.atan2(O.x,O.z),Math.atan2(O.y,O.x));p.set(Math.atan2(H.z,H.y),Math.atan2(H.x,H.z),Math.atan2(H.y,H.x));q.setFromRotationMatrix(k.getInverse(m));P.setFromAxisAngle(W,L.z-p.z);T.setFromRotationMatrix(E);q.multiplyQuaternions(q,P);q.multiplyQuaternions(q,T);R.object.quaternion.copy(q)}else{if(R.axis=="XYZE"){P.setFromEuler(O.clone().cross(H).normalize());q.setFromRotationMatrix(k.getInverse(m));I.setFromAxisAngle(P,-O.clone().angleTo(H));T.setFromRotationMatrix(E);q.multiplyQuaternions(q,I);q.multiplyQuaternions(q,T);R.object.quaternion.copy(q)}else{if(R.space=="local"){O.applyMatrix4(k.getInverse(E));H.applyMatrix4(k.getInverse(E));L.set(f(Math.atan2(O.z,O.y)),f(Math.atan2(O.x,O.z)),f(Math.atan2(O.y,O.x)));p.set(f(Math.atan2(H.z,H.y)),f(Math.atan2(H.x,H.z)),f(Math.atan2(H.y,H.x)));T.setFromRotationMatrix(Z);I.setFromAxisAngle(A,L.x-p.x);G.setFromAxisAngle(v,L.y-p.y);F.setFromAxisAngle(u,L.z-p.z);if(R.axis=="X"){T.multiplyQuaternions(T,I)}if(R.axis=="Y"){T.multiplyQuaternions(T,G)}if(R.axis=="Z"){T.multiplyQuaternions(T,F)}R.object.quaternion.copy(T)}else{if(R.space=="world"){L.set(f(Math.atan2(O.z,O.y)),f(Math.atan2(O.x,O.z)),f(Math.atan2(O.y,O.x)));p.set(f(Math.atan2(H.z,H.y)),f(Math.atan2(H.x,H.z)),f(Math.atan2(H.y,H.x)));q.setFromRotationMatrix(k.getInverse(m));I.setFromAxisAngle(A,L.x-p.x);G.setFromAxisAngle(v,L.y-p.y);F.setFromAxisAngle(u,L.z-p.z);T.setFromRotationMatrix(E);if(R.axis=="X"){q.multiplyQuaternions(q,I)}if(R.axis=="Y"){q.multiplyQuaternions(q,G)}if(R.axis=="Z"){q.multiplyQuaternions(q,F)}q.multiplyQuaternions(q,T);R.object.quaternion.copy(q)}}}}}}}R.update();R.dispatchEvent(ac);R.dispatchEvent(af)}function S(ag){if(M&&(R.axis!==null)){r.mode=B;R.dispatchEvent(r)}M=false;K(ag)}function s(ak,ai){var ah=Y.getBoundingClientRect();var ag=(ak.clientX-ah.left)/ah.width;var al=(ak.clientY-ah.top)/ah.height;t.set((ag*2)-1,-(al*2)+1,0.5);t.unproject(D);ab.set(l,t.sub(l).normalize());var aj=ab.intersectObjects(ai,true);return aj[0]?aj[0]:false}};THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype);THREE.TransformControls.prototype.constructor=THREE.TransformControls}());THREE.BabylonLoader=function(a){this.manager=(a!==undefined)?a:THREE.DefaultLoadingManager};THREE.BabylonLoader.prototype={constructor:THREE.ObjectLoader,load:function(b,d,f,e){var c=this;var a=new THREE.XHRLoader(c.manager);a.setCrossOrigin(this.crossOrigin);a.load(b,function(g){d(c.parse(JSON.parse(g)))},f,e)},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(b){var a=this.parseMaterials(b);var c=this.parseObjects(b,a);return c},parseMaterials:function(d){var b={};for(var c=0,a=d.materials.length;c<a;c++){var f=d.materials[c];var e=new THREE.MeshPhongMaterial();e.name=f.name;e.ambient.fromArray(f.ambient);e.color.fromArray(f.diffuse);e.emissive.fromArray(f.emissive);e.specular.fromArray(f.specular);e.shininess=f.specularPower;e.opacity=f.alpha;b[f.id]=e}if(d.multiMaterials){for(var c=0,a=d.multiMaterials.length;c<a;c++){var f=d.multiMaterials[c];console.warn("THREE.BabylonLoader: Multi materials not yet supported.");b[f.id]=new THREE.MeshPhongMaterial()}}return b},parseGeometry:function(k){var g=new THREE.BufferGeometry();var i=new Uint16Array(k.indices);g.addAttribute("index",new THREE.BufferAttribute(i,1));var f=new Float32Array(k.positions);for(var d=2,e=f.length;d<e;d+=3){f[d]=-f[d]}g.addAttribute("position",new THREE.BufferAttribute(f,3));if(k.normals){var h=new Float32Array(k.normals);for(var d=2,e=h.length;d<e;d+=3){h[d]=-h[d]}g.addAttribute("normal",new THREE.BufferAttribute(h,3))}if(k.uvs){var c=new Float32Array(k.uvs);g.addAttribute("uv",new THREE.BufferAttribute(c,2))}var a=k.subMeshes;if(a){for(var d=0,e=a.length;d<e;d++){var b=a[d];g.addDrawCall(b.indexStart,b.indexCount)}}else{g.addDrawCall(0,k.indices.length)}return g},parseObjects:function(q,o){var p={};var h=new THREE.Scene();var n=q.cameras;for(var g=0,b=n.length;g<b;g++){var f=n[g];var k=new THREE.PerspectiveCamera((f.fov/Math.PI)*180,1.33,f.minZ,f.maxZ);k.name=f.name;k.position.fromArray(f.position);if(f.rotation){k.rotation.fromArray(f.rotation)}p[f.id]=k}var e=q.lights;for(var g=0,b=e.length;g<b;g++){var f=e[g];var d;switch(f.type){case 0:d=new THREE.PointLight();break;case 1:d=new THREE.DirectionalLight();break;case 2:d=new THREE.SpotLight();break;case 3:d=new THREE.HemisphereLight();break}d.name=f.name;d.position.set(f.position[0],f.position[1],-f.position[2]);d.color.fromArray(f.diffuse);if(f.intensity){d.intensity=f.intensity}p[f.id]=d;h.add(d)}var a=q.meshes;for(var g=0,b=a.length;g<b;g++){var f=a[g];var c;if(f.indices){var m=this.parseGeometry(f);c=new THREE.Mesh(m,o[f.materialId])}else{c=new THREE.Group()}c.name=f.name;c.position.set(f.position[0],f.position[1],-f.position[2]);c.rotation.fromArray(f.rotation);if(f.rotationQuaternion){c.quaternion.fromArray(f.rotationQuaternion)}c.scale.fromArray(f.scaling);if(f.parentId){p[f.parentId].add(c)}else{h.add(c)}p[f.id]=c}return h}};THREE.OBJLoader=function(a){this.manager=(a!==undefined)?a:THREE.DefaultLoadingManager};THREE.OBJLoader.prototype={constructor:THREE.OBJLoader,load:function(b,d,f,e){var c=this;var a=new THREE.XHRLoader(c.manager);a.setCrossOrigin(this.crossOrigin);a.load(b,function(g){d(c.parse(g))},f,e)},parse:function(t){console.time("OBJLoader");var K,b=[];var f,s;function c(l){var i=parseInt(l);return(i>=0?i-1:i+h.length/3)*3}function m(l){var i=parseInt(l);return(i>=0?i-1:i+v.length/3)*3}function k(l){var i=parseInt(l);return(i>=0?i-1:i+n.length/2)*2}function F(l,i,L){f.vertices.push(h[l],h[l+1],h[l+2],h[i],h[i+1],h[i+2],h[L],h[L+1],h[L+2])}function u(l,i,L){f.normals.push(v[l],v[l+1],v[l+2],v[i],v[i+1],v[i+2],v[L],v[L+1],v[L+2])}function e(l,i,L){f.uvs.push(n[l],n[l+1],n[i],n[i+1],n[L],n[L+1])}function g(W,V,U,T,l,i,Y,X,S,R,Q,P){var O=c(W);var N=c(V);var M=c(U);if(T===undefined){F(O,N,M)}else{var L=c(T);F(O,N,L);F(N,M,L)}if(l!==undefined){var O=k(l);var N=k(i);var M=k(Y);if(T===undefined){e(O,N,M)}else{var L=k(X);e(O,N,L);e(N,M,L)}}if(S!==undefined){var O=m(S);var N=m(R);var M=m(Q);if(T===undefined){u(O,N,M)}else{var L=m(P);u(O,N,L);u(N,M,L)}}}if(/^o /gm.test(t)===false){f={vertices:[],normals:[],uvs:[]};s={name:""};K={name:"",geometry:f,material:s};b.push(K)}var h=[];var v=[];var n=[];var A=/v( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/;var C=/vn( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/;var H=/vt( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/;var J=/f( +-?\d+)( +-?\d+)( +-?\d+)( +-?\d+)?/;var I=/f( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))?/;var G=/f( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))?/;var E=/f( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))?/;var d=t.split("\n");for(var D=0;D<d.length;D++){var p=d[D];p=p.trim();var o;if(p.length===0||p.charAt(0)==="#"){continue}else{if((o=A.exec(p))!==null){h.push(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]))}else{if((o=C.exec(p))!==null){v.push(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]))}else{if((o=H.exec(p))!==null){n.push(parseFloat(o[1]),parseFloat(o[2]))}else{if((o=J.exec(p))!==null){g(o[1],o[2],o[3],o[4])}else{if((o=I.exec(p))!==null){g(o[2],o[5],o[8],o[11],o[3],o[6],o[9],o[12])}else{if((o=G.exec(p))!==null){g(o[2],o[6],o[10],o[14],o[3],o[7],o[11],o[15],o[4],o[8],o[12],o[16])}else{if((o=E.exec(p))!==null){g(o[2],o[5],o[8],o[11],undefined,undefined,undefined,undefined,o[3],o[6],o[9],o[12])}else{if(/^o /.test(p)){f={vertices:[],normals:[],uvs:[]};s={name:""};K={name:p.substring(2).trim(),geometry:f,material:s};b.push(K)}else{if(/^g /.test(p)){}else{if(/^usemtl /.test(p)){s.name=p.substring(7).trim()}else{if(/^mtllib /.test(p)){}else{if(/^s /.test(p)){}else{}}}}}}}}}}}}}}var r=new THREE.Object3D();for(var D=0,B=b.length;D<B;D++){var K=b[D];var f=K.geometry;var q=new THREE.BufferGeometry();q.addAttribute("position",new THREE.BufferAttribute(new Float32Array(f.vertices),3));if(f.normals.length>0){q.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(f.normals),3))}if(f.uvs.length>0){q.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(f.uvs),2))}var s=new THREE.MeshLambertMaterial();s.name=K.material.name;var a=new THREE.Mesh(q,s);a.name=K.name;r.add(a)}console.timeEnd("OBJLoader");return r}};THREE.PLYLoader=function(){this.propertyNameMapping={}};THREE.PLYLoader.prototype={constructor:THREE.PLYLoader,setPropertyNameMapping:function(a){this.propertyNameMapping=a},load:function(a,d){var b=this;var c=new XMLHttpRequest();c.addEventListener("load",function(e){var f=b.parse(e.target.response);b.dispatchEvent({type:"load",content:f});if(d){d(f)}},false);c.addEventListener("progress",function(e){b.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})},false);c.addEventListener("error",function(){b.dispatchEvent({type:"error",message:"Couldn't load URL ["+a+"]"})},false);c.open("GET",a,true);c.responseType="arraybuffer";c.send(null)},bin2str:function(a){var c=new Uint8Array(a);var d="";for(var b=0;b<a.byteLength;b++){d+=String.fromCharCode(c[b])}return d},isASCII:function(a){var b=this.parseHeader(this.bin2str(a));return b.format==="ascii"},parse:function(a){if(a instanceof ArrayBuffer){return this.isASCII(a)?this.parseASCII(this.bin2str(a)):this.parseBinary(a)}else{return this.parseASCII(a)}},parseHeader:function(d){var b=/ply([\s\S]*)end_header\s/;var f="";if((result=b.exec(d))!==null){f=result[1]}var e={comments:[],elements:[],headerLength:result[0].length};var m=f.split("\n");var g=undefined;var h,k;function a(o,n){var i={type:o[0]};if(i.type==="list"){i.name=o[3];i.countType=o[1];i.itemType=o[2]}else{i.name=o[1]}if(i.name in n){i.name=n[i.name]}return i}for(var c=0;c<m.length;c++){var l=m[c];l=l.trim();if(l===""){continue}k=l.split(/\s+/);h=k.shift();l=k.join(" ");switch(h){case"format":e.format=k[0];e.version=k[1];break;case"comment":e.comments.push(l);break;case"element":if(!(g===undefined)){e.elements.push(g)}g=Object();g.name=k[0];g.count=parseInt(k[1]);g.properties=[];break;case"property":g.properties.push(a(k,this.propertyNameMapping));break;default:console.log("unhandled",h,k)}}if(!(g===undefined)){e.elements.push(g)}return e},parseASCIINumber:function(b,a){switch(a){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(b);case"float":case"double":case"float32":case"float64":return parseFloat(b)}},parseASCIIElement:function(d,a){values=a.split(/\s+/);var c=Object();for(var b=0;b<d.length;b++){if(d[b].type==="list"){var e=[];var f=this.parseASCIINumber(values.shift(),d[b].countType);for(j=0;j<f;j++){e.push(this.parseASCIINumber(values.shift(),d[b].itemType))}c[d[b].name]=e}else{c[d[b].name]=this.parseASCIINumber(values.shift(),d[b].type)}}return c},parseASCII:function(d){var h=new THREE.Geometry();var n;var e=this.parseHeader(d);var a=/end_header\s([\s\S]*)$/;var g="";if((n=a.exec(d))!==null){g=n[1]}var m=g.split("\n");var f=0;var k=0;h.useColor=false;for(var c=0;c<m.length;c++){var l=m[c];l=l.trim();if(l===""){continue}if(k>=e.elements[f].count){f++;k=0}var b=this.parseASCIIElement(e.elements[f].properties,l);this.handleElement(h,e.elements[f].name,b);k++}return this.postProcess(h)},postProcess:function(b){if(b.useColor){for(var a=0;a<b.faces.length;a++){b.faces[a].vertexColors=[b.colors[b.faces[a].a],b.colors[b.faces[a].b],b.colors[b.faces[a].c]]}b.elementsNeedUpdate=true}b.computeBoundingSphere();return b},handleElement:function(d,a,c){if(a==="vertex"){d.vertices.push(new THREE.Vector3(c.x,c.y,c.z));if("red" in c&&"green" in c&&"blue" in c){d.useColor=true;color=new THREE.Color();color.setRGB(c.red/255,c.green/255,c.blue/255);d.colors.push(color)}}else{if(a==="face"){var b=c.vertex_indices;if(b.length===3){d.faces.push(new THREE.Face3(b[0],b[1],b[2]))}else{if(b.length===4){d.faces.push(new THREE.Face3(b[0],b[1],b[3]),new THREE.Face3(b[1],b[2],b[3]))}}}}},binaryRead:function(b,a,d,c){switch(d){case"int8":case"char":return[b.getInt8(a),1];case"uint8":case"uchar":return[b.getUint8(a),1];case"int16":case"short":return[b.getInt16(a,c),2];case"uint16":case"ushort":return[b.getUint16(a,c),2];case"int32":case"int":return[b.getInt32(a,c),4];case"uint32":case"uint":return[b.getUint32(a,c),4];case"float32":case"float":return[b.getFloat32(a,c),4];case"float64":case"double":return[b.getFloat64(a,c),8]}},binaryReadElement:function(f,c,h,k){var d=Object();var l,a=0;for(var e=0;e<h.length;e++){if(h[e].type==="list"){var g=[];l=this.binaryRead(f,c+a,h[e].countType,k);var b=l[0];a+=l[1];for(j=0;j<b;j++){l=this.binaryRead(f,c+a,h[e].itemType,k);g.push(l[0]);a+=l[1]}d[h[e].name]=g}else{l=this.binaryRead(f,c+a,h[e].type,k);d[h[e].name]=l[0];a+=l[1]}}return[d,a]},parseBinary:function(b){var g=new THREE.Geometry();var c=this.parseHeader(this.bin2str(b));var h=(c.format==="binary_little_endian");var e=new DataView(b,c.headerLength);var k,f=0;for(var d=0;d<c.elements.length;d++){for(var i=0;i<c.elements[d].count;i++){k=this.binaryReadElement(e,f,c.elements[d].properties,h);f+=k[1];var a=k[0];this.handleElement(g,c.elements[d].name,a)}}return this.postProcess(g)}};THREE.EventDispatcher.prototype.apply(THREE.PLYLoader.prototype);THREE.SceneLoader=function(a){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){};this.geometryHandlers={};this.hierarchyHandlers={};this.addGeometryHandler("ascii",THREE.JSONLoader);this.manager=(a!==undefined)?a:THREE.DefaultLoadingManager};THREE.SceneLoader.prototype={constructor:THREE.SceneLoader,load:function(b,d,f,e){var c=this;var a=new THREE.XHRLoader(c.manager);a.setCrossOrigin(this.crossOrigin);a.load(b,function(g){c.parse(JSON.parse(g),d,b)},f,e)},setCrossOrigin:function(a){this.crossOrigin=a},addGeometryHandler:function(a,b){this.geometryHandlers[a]={loaderClass:b}},addHierarchyHandler:function(a,b){this.hierarchyHandlers[a]={loaderClass:b}},parse:function(af,o,h){var V=this;var ah=THREE.Loader.prototype.extractUrlBase(h);var A,ak,D,am,E,f,Q,K,X,S,m,G,aj,C,F;var Z=[];var aq=af;for(var O in this.geometryHandlers){var N=this.geometryHandlers[O]["loaderClass"];this.geometryHandlers[O]["loaderObject"]=new N()}for(var O in this.hierarchyHandlers){var N=this.hierarchyHandlers[O]["loaderClass"];this.hierarchyHandlers[O]["loaderObject"]=new N()}m=0;G=0;F={scene:new THREE.Scene(),geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}};if(aq.transform){var Y=aq.transform.position,R=aq.transform.rotation,T=aq.transform.scale;if(Y){F.scene.position.fromArray(Y)}if(R){F.scene.rotation.fromArray(R)}if(T){F.scene.scale.fromArray(T)}if(Y||R||T){F.scene.updateMatrix();F.scene.updateMatrixWorld()}}function W(i,n){if(n=="relativeToHTML"){return i}else{return ah+i}}function J(){B(F.scene,aq.objects)}function B(aG,aA){var aM,aQ,aD,aF,n,ax;for(var ay in aA){var aO=F.objects[ay];var aE=aA[ay];if(aO===undefined){if(aE.type&&(aE.type in V.hierarchyHandlers)){if(aE.loading===undefined){ak=F.materials[aE.material];aE.loading=true;var aH=V.hierarchyHandlers[aE.type]["loaderObject"];if(aH.options){aH.load(W(aE.url,aq.urlBaseType),g(ay,aG,ak,aE))}else{aH.load(W(aE.url,aq.urlBaseType),g(ay,aG,ak,aE))}}}else{if(aE.geometry!==undefined){A=F.geometries[aE.geometry];if(A){var aB=false;ak=F.materials[aE.material];aB=ak instanceof THREE.ShaderMaterial;aD=aE.position;aF=aE.rotation;n=aE.scale;aM=aE.matrix;ax=aE.quaternion;if(!aE.material){ak=new THREE.MeshFaceMaterial(F.face_materials[aE.geometry])}if((ak instanceof THREE.MeshFaceMaterial)&&ak.materials.length===0){ak=new THREE.MeshFaceMaterial(F.face_materials[aE.geometry])}if(ak instanceof THREE.MeshFaceMaterial){for(var aL=0;aL<ak.materials.length;aL++){aB=aB||(ak.materials[aL] instanceof THREE.ShaderMaterial)}}if(aB){A.computeTangents()}if(aE.skin){aO=new THREE.SkinnedMesh(A,ak)}else{if(aE.morph){aO=new THREE.MorphAnimMesh(A,ak);if(aE.duration!==undefined){aO.duration=aE.duration}if(aE.time!==undefined){aO.time=aE.time}if(aE.mirroredLoop!==undefined){aO.mirroredLoop=aE.mirroredLoop}if(ak.morphNormals){A.computeMorphNormals()}}else{aO=new THREE.Mesh(A,ak)}}aO.name=ay;if(aM){aO.matrixAutoUpdate=false;aO.matrix.set(aM[0],aM[1],aM[2],aM[3],aM[4],aM[5],aM[6],aM[7],aM[8],aM[9],aM[10],aM[11],aM[12],aM[13],aM[14],aM[15])}else{aO.position.fromArray(aD);if(ax){aO.quaternion.fromArray(ax)}else{aO.rotation.fromArray(aF)}aO.scale.fromArray(n)}aO.visible=aE.visible;aO.castShadow=aE.castShadow;aO.receiveShadow=aE.receiveShadow;aG.add(aO);F.objects[ay]=aO}}else{if(aE.type==="AmbientLight"||aE.type==="PointLight"||aE.type==="DirectionalLight"||aE.type==="SpotLight"||aE.type==="HemisphereLight"||aE.type==="AreaLight"){var aK=aE.color;var aC=aE.intensity;var az=aE.distance;var aN=aE.position;var aJ=aE.rotation;switch(aE.type){case"AmbientLight":K=new THREE.AmbientLight(aK);break;case"PointLight":K=new THREE.PointLight(aK,aC,az);K.position.fromArray(aN);break;case"DirectionalLight":K=new THREE.DirectionalLight(aK,aC);K.position.fromArray(aE.direction);break;case"SpotLight":K=new THREE.SpotLight(aK,aC,az,1);K.angle=aE.angle;K.position.fromArray(aN);K.target.set(aN[0],aN[1]-az,aN[2]);K.target.applyEuler(new THREE.Euler(aJ[0],aJ[1],aJ[2],"XYZ"));break;case"HemisphereLight":K=new THREE.DirectionalLight(aK,aC,az);K.target.set(aN[0],aN[1]-az,aN[2]);K.target.applyEuler(new THREE.Euler(aJ[0],aJ[1],aJ[2],"XYZ"));break;case"AreaLight":K=new THREE.AreaLight(aK,aC);K.position.fromArray(aN);K.width=aE.size;K.height=aE.size_y;break}aG.add(K);K.name=ay;F.lights[ay]=K;F.objects[ay]=K}else{if(aE.type==="PerspectiveCamera"||aE.type==="OrthographicCamera"){aD=aE.position;aF=aE.rotation;ax=aE.quaternion;if(aE.type==="PerspectiveCamera"){D=new THREE.PerspectiveCamera(aE.fov,aE.aspect,aE.near,aE.far)}else{if(aE.type==="OrthographicCamera"){D=new THREE.OrthographicCamera(aE.left,aE.right,aE.top,aE.bottom,aE.near,aE.far)}}D.name=ay;D.position.fromArray(aD);if(ax!==undefined){D.quaternion.fromArray(ax)}else{if(aF!==undefined){D.rotation.fromArray(aF)}else{if(aE.target){D.lookAt(new THREE.Vector3().fromArray(aE.target))}}}aG.add(D);F.cameras[ay]=D;F.objects[ay]=D}else{aD=aE.position;aF=aE.rotation;n=aE.scale;ax=aE.quaternion;aO=new THREE.Object3D();aO.name=ay;aO.position.fromArray(aD);if(ax){aO.quaternion.fromArray(ax)}else{aO.rotation.fromArray(aF)}aO.scale.fromArray(n);aO.visible=(aE.visible!==undefined)?aE.visible:false;aG.add(aO);F.objects[ay]=aO;F.empties[ay]=aO}}}}if(aO){if(aE.userData!==undefined){for(var aP in aE.userData){var aI=aE.userData[aP];aO.userData[aP]=aI}}if(aE.groups!==undefined){for(var aL=0;aL<aE.groups.length;aL++){var aw=aE.groups[aL];if(F.groups[aw]===undefined){F.groups[aw]=[]}F.groups[aw].push(ay)}}}}if(aO!==undefined&&aE.children!==undefined){B(aO,aE.children)}}}function e(n,i,aw){F.geometries[aw]=n;F.face_materials[aw]=i;J()}function ag(az,aw,aC,aB,aA){var ax=aA.position;var i=aA.rotation;var n=aA.quaternion;var aD=aA.scale;az.position.fromArray(ax);if(n){az.quaternion.fromArray(n)}else{az.rotation.fromArray(i)}az.scale.fromArray(aD);if(aB){az.traverse(function(aE){aE.material=aB})}var ay=(aA.visible!==undefined)?aA.visible:true;az.traverse(function(aE){aE.visible=ay});aC.add(az);az.name=aw;F.objects[aw]=az;J()}function au(i){return function(aw,n){aw.name=i;e(aw,n,i);m-=1;V.onLoadComplete();L()}}function g(ax,n,i,aw){return function(az){var ay;if(az.content){ay=az.content}else{if(az.dae){ay=az.scene}else{ay=az}}ag(ay,ax,n,i,aw);m-=1;V.onLoadComplete();L()}}function r(i){return function(aw,n){aw.name=i;F.geometries[i]=aw;F.face_materials[i]=n}}function L(){var i={totalModels:aj,totalTextures:C,loadedModels:aj-m,loadedTextures:C-G};V.callbackProgress(i,F);V.onLoadProgress();if(m===0&&G===0){ab();o(F)}}function ab(){for(var aw=0;aw<Z.length;aw++){var n=Z[aw];var ax=F.objects[n.targetName];if(ax){n.object.target=ax}else{n.object.target=new THREE.Object3D();F.scene.add(n.object.target)}n.object.target.userData.targetInverse=n.object}}var av=function(i){G-=i;L();V.onLoadComplete()};var k=function(i){return function(){av(i)}};function u(i,aw){aw(i);if(i.children!==undefined){for(var n in i.children){u(i.children[n],aw)}}}var q,P;for(q in aq.fogs){P=aq.fogs[q];if(P.type==="linear"){am=new THREE.Fog(0,P.near,P.far)}else{if(P.type==="exp2"){am=new THREE.FogExp2(0,P.density)}}Q=P.color;am.color.setRGB(Q[0],Q[1],Q[2]);F.fogs[q]=am}var al,l;for(al in aq.geometries){l=aq.geometries[al];if(l.type in this.geometryHandlers){m+=1;V.onLoadStart()}}for(var c in aq.objects){u(aq.objects[c],function(i){if(i.type&&(i.type in V.hierarchyHandlers)){m+=1;V.onLoadStart()}})}aj=m;for(al in aq.geometries){l=aq.geometries[al];if(l.type==="cube"){A=new THREE.BoxGeometry(l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments);A.name=al;F.geometries[al]=A}else{if(l.type==="plane"){A=new THREE.PlaneGeometry(l.width,l.height,l.widthSegments,l.heightSegments);A.name=al;F.geometries[al]=A}else{if(l.type==="sphere"){A=new THREE.SphereGeometry(l.radius,l.widthSegments,l.heightSegments);A.name=al;F.geometries[al]=A}else{if(l.type==="cylinder"){A=new THREE.CylinderGeometry(l.topRad,l.botRad,l.height,l.radSegs,l.heightSegs);A.name=al;F.geometries[al]=A}else{if(l.type==="torus"){A=new THREE.TorusGeometry(l.radius,l.tube,l.segmentsR,l.segmentsT);A.name=al;F.geometries[al]=A}else{if(l.type==="icosahedron"){A=new THREE.IcosahedronGeometry(l.radius,l.subdivisions);A.name=al;F.geometries[al]=A}else{if(l.type in this.geometryHandlers){var I=this.geometryHandlers[l.type]["loaderObject"];I.load(W(l.url,aq.urlBaseType),au(al))}else{if(l.type==="embedded"){var U=aq.embeds[l.id],v="";U.metadata=aq.metadata;if(U){var ao=this.geometryHandlers.ascii["loaderObject"];var d=ao.parse(U,v);r(al)(d.geometry,d.materials)}}}}}}}}}}var b,M;for(b in aq.textures){M=aq.textures[b];if(M.url instanceof Array){G+=M.url.length;for(var ai=0;ai<M.url.length;ai++){V.onLoadStart()}}else{G+=1;V.onLoadStart()}}C=G;for(b in aq.textures){M=aq.textures[b];if(M.mapping!==undefined&&THREE[M.mapping]!==undefined){M.mapping=THREE[M.mapping]}var E;if(M.url instanceof Array){var ad=M.url.length;var p=[];for(var an=0;an<ad;an++){p[an]=W(M.url[an],aq.urlBaseType)}var I=THREE.Loader.Handlers.get(p[0]);if(I!==null){E=I.load(p,k(ad));if(M.mapping!==undefined){E.mapping=M.mapping}}else{E=THREE.ImageUtils.loadTextureCube(p,M.mapping,k(ad))}}else{var s=W(M.url,aq.urlBaseType);var t=k(1);var I=THREE.Loader.Handlers.get(s);if(I!==null){E=I.load(s,t)}else{E=new THREE.Texture();I=new THREE.ImageLoader();(function(i){I.load(s,function(n){i.image=n;i.needsUpdate=true;t()})})(E)}if(M.mapping!==undefined){E.mapping=M.mapping}if(THREE[M.minFilter]!==undefined){E.minFilter=THREE[M.minFilter]}if(THREE[M.magFilter]!==undefined){E.magFilter=THREE[M.magFilter]}if(M.anisotropy){E.anisotropy=M.anisotropy}if(M.repeat){E.repeat.set(M.repeat[0],M.repeat[1]);if(M.repeat[0]!==1){E.wrapS=THREE.RepeatWrapping}if(M.repeat[1]!==1){E.wrapT=THREE.RepeatWrapping}}if(M.offset){E.offset.set(M.offset[0],M.offset[1])}if(M.wrap){var ac={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(ac[M.wrap[0]]!==undefined){E.wrapS=ac[M.wrap[0]]}if(ac[M.wrap[1]]!==undefined){E.wrapT=ac[M.wrap[1]]}}}F.textures[b]=E}var a,aa;var H;for(a in aq.materials){aa=aq.materials[a];for(H in aa.parameters){if(H==="envMap"||H==="map"||H==="lightMap"||H==="bumpMap"||H==="normalMap"||H==="alphaMap"){aa.parameters[H]=F.textures[aa.parameters[H]]}else{if(H==="shading"){aa.parameters[H]=(aa.parameters[H]==="flat")?THREE.FlatShading:THREE.SmoothShading}else{if(H==="side"){if(aa.parameters[H]=="double"){aa.parameters[H]=THREE.DoubleSide}else{if(aa.parameters[H]=="back"){aa.parameters[H]=THREE.BackSide}else{aa.parameters[H]=THREE.FrontSide}}}else{if(H==="blending"){aa.parameters[H]=aa.parameters[H] in THREE?THREE[aa.parameters[H]]:THREE.NormalBlending}else{if(H==="combine"){aa.parameters[H]=aa.parameters[H] in THREE?THREE[aa.parameters[H]]:THREE.MultiplyOperation}else{if(H==="vertexColors"){if(aa.parameters[H]=="face"){aa.parameters[H]=THREE.FaceColors}else{if(aa.parameters[H]){aa.parameters[H]=THREE.VertexColors}}}else{if(H==="wrapRGB"){var ar=aa.parameters[H];aa.parameters[H]=new THREE.Vector3(ar[0],ar[1],ar[2])}else{if(H==="normalScale"){var at=aa.parameters[H];aa.parameters[H]=new THREE.Vector2(at[0],at[1])}}}}}}}}}if(aa.parameters.opacity!==undefined&&aa.parameters.opacity<1){aa.parameters.transparent=true}ak=new THREE[aa.type](aa.parameters);ak.name=a;F.materials[a]=ak}for(a in aq.materials){aa=aq.materials[a];if(aa.parameters.materials){var ap=[];for(var an=0;an<aa.parameters.materials.length;an++){var ae=aa.parameters.materials[an];ap.push(F.materials[ae])}F.materials[a].materials=ap}}J();if(F.cameras&&aq.defaults.camera){F.currentCamera=F.cameras[aq.defaults.camera]}if(F.fogs&&aq.defaults.fog){F.scene.fog=F.fogs[aq.defaults.fog]}V.callbackSync(F);L()}};THREE.STLLoader=function(a){this.manager=(a!==undefined)?a:THREE.DefaultLoadingManager};THREE.STLLoader.prototype={constructor:THREE.STLLoader,load:function(b,d,f,e){var c=this;var a=new THREE.XHRLoader(c.manager);a.setCrossOrigin(this.crossOrigin);a.setResponseType("arraybuffer");a.load(b,function(g){d(c.parse(g))},f,e)},parse:function(c){var b=function(){var g,e,i,d;d=new DataView(a);e=(32/8*3)+((32/8*3)*3)+(16/8);i=d.getUint32(80,true);g=80+(32/8)+(i*e);if(g===d.byteLength){return true}var h=d.byteLength;for(var f=0;f<h;f++){if(d.getUint8(f,false)>127){return true}}return false};var a=this.ensureBinary(c);return b()?this.parseBinary(a):this.parseASCII(this.ensureString(c))},parseBinary:function(J){var a=new DataView(J);var c=a.getUint32(80,true);var C,F,G,I=false,v;var h,t,B,m;for(var q=0;q<80-10;q++){if((a.getUint32(q,false)==1129270351)&&(a.getUint8(q+4)==82)&&(a.getUint8(q+5)==61)){I=true;v=new Float32Array(c*3*3);h=a.getUint8(q+6)/255;t=a.getUint8(q+7)/255;B=a.getUint8(q+8)/255;m=a.getUint8(q+9)/255}}var A=84;var H=12*4+2;var o=0;var n=new THREE.BufferGeometry();var p=new Float32Array(c*3*3);var D=new Float32Array(c*3*3);for(var u=0;u<c;u++){var l=A+u*H;var k=a.getFloat32(l,true);var f=a.getFloat32(l+4,true);var e=a.getFloat32(l+8,true);if(I){var s=a.getUint16(l+48,true);if((s&32768)===0){C=(s&31)/31;F=((s>>5)&31)/31;G=((s>>10)&31)/31}else{C=h;F=t;G=B}}for(var E=1;E<=3;E++){var d=l+E*12;p[o]=a.getFloat32(d,true);p[o+1]=a.getFloat32(d+4,true);p[o+2]=a.getFloat32(d+8,true);D[o]=k;D[o+1]=f;D[o+2]=e;if(I){v[o]=C;v[o+1]=F;v[o+2]=G}o+=3}}n.addAttribute("position",new THREE.BufferAttribute(p,3));n.addAttribute("normal",new THREE.BufferAttribute(D,3));if(I){n.addAttribute("color",new THREE.BufferAttribute(v,3));n.hasColors=true;n.alpha=m}return n},parseASCII:function(d){var g,a,f,b,c,e,i,h;g=new THREE.Geometry();b=/facet([\s\S]*?)endfacet/g;while((i=b.exec(d))!==null){h=i[0];c=/normal[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g;while((i=c.exec(h))!==null){f=new THREE.Vector3(parseFloat(i[1]),parseFloat(i[3]),parseFloat(i[5]))}e=/vertex[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g;while((i=e.exec(h))!==null){g.vertices.push(new THREE.Vector3(parseFloat(i[1]),parseFloat(i[3]),parseFloat(i[5])))}a=g.vertices.length;g.faces.push(new THREE.Face3(a-3,a-2,a-1,f))}g.computeBoundingBox();g.computeBoundingSphere();return g},ensureString:function(a){if(typeof a!=="string"){var c=new Uint8Array(a);var d="";for(var b=0;b<a.byteLength;b++){d+=String.fromCharCode(c[b])}return d}else{return a}},ensureBinary:function(a){if(typeof a==="string"){var c=new Uint8Array(a.length);for(var b=0;b<a.length;b++){c[b]=a.charCodeAt(b)&255}return c.buffer||c}else{return a}}};if(typeof DataView==="undefined"){DataView=function(a,c,b){this.buffer=a;this.byteOffset=c||0;this.byteLength=b||a.byteLength||a.length;this._isString=typeof a==="string"};DataView.prototype={_getCharCodes:function(b,f,e){f=f||0;e=e||b.length;var a=f+e;var c=[];for(var d=f;d<a;d++){c.push(b.charCodeAt(d)&255)}return c},_getBytes:function(c,b,d){var a;if(d===undefined){d=this._littleEndian}if(b===undefined){b=this.byteOffset}else{b=this.byteOffset+b}if(c===undefined){c=this.byteLength-b}if(typeof b!=="number"){throw new TypeError("DataView byteOffset is not a number")}if(c<0||b+c>this.byteLength){throw new Error("DataView length or (byteOffset+length) value is out of bounds")}if(this.isString){a=this._getCharCodes(this.buffer,b,b+c)}else{a=this.buffer.slice(b,b+c)}if(!d&&c>1){if(!(a instanceof Array)){a=Array.prototype.slice.call(a)}a.reverse()}return a},getFloat64:function(e,g){var a=this._getBytes(8,e,g),c=1-(2*(a[7]>>7)),f=((((a[7]<<1)&255)<<3)|(a[6]>>4))-((1<<10)-1),d=((a[6]&15)*Math.pow(2,48))+(a[5]*Math.pow(2,40))+(a[4]*Math.pow(2,32))+(a[3]*Math.pow(2,24))+(a[2]*Math.pow(2,16))+(a[1]*Math.pow(2,8))+a[0];if(f===1024){if(d!==0){return NaN}else{return c*Infinity}}if(f===-1023){return c*d*Math.pow(2,-1022-52)}return c*(1+d*Math.pow(2,-52))*Math.pow(2,f)},getFloat32:function(e,g){var a=this._getBytes(4,e,g),c=1-(2*(a[3]>>7)),f=(((a[3]<<1)&255)|(a[2]>>7))-127,d=((a[2]&127)<<16)|(a[1]<<8)|a[0];if(f===128){if(d!==0){return NaN}else{return c*Infinity}}if(f===-127){return c*d*Math.pow(2,-126-23)}return c*(1+d*Math.pow(2,-23))*Math.pow(2,f)},getInt32:function(c,d){var a=this._getBytes(4,c,d);return(a[3]<<24)|(a[2]<<16)|(a[1]<<8)|a[0]},getUint32:function(a,b){return this.getInt32(a,b)>>>0},getInt16:function(a,b){return(this.getUint16(a,b)<<16)>>16},getUint16:function(c,d){var a=this._getBytes(2,c,d);return(a[1]<<8)|a[0]},getInt8:function(a){return(this.getUint8(a)<<24)>>24},getUint8:function(a){return this._getBytes(1,a)[0]}}}THREE.UTF8Loader=function(){};THREE.UTF8Loader.prototype.load=function(b,c,a){this.downloadModelJson(b,c,a)};THREE.UTF8Loader.BufferGeometryCreator=function(){};THREE.UTF8Loader.BufferGeometryCreator.prototype.create=function(b,s){var g=s.length/3;var n=new THREE.BufferGeometry();var k=new Float32Array(g*3*3);var p=new Float32Array(g*3*3);var f=new Float32Array(g*3*2);var h,e,d;var o,m,l;var r,q;var c=b.length;var a=8;e=0;d=0;for(h=d;h<c;h+=a){o=b[h];m=b[h+1];l=b[h+2];k[e++]=o;k[e++]=m;k[e++]=l}e=0;d=3;for(h=d;h<c;h+=a){r=b[h];q=b[h+1];f[e++]=r;f[e++]=q}e=0;d=5;for(h=d;h<c;h+=a){o=b[h];m=b[h+1];l=b[h+2];p[e++]=o;p[e++]=m;p[e++]=l}n.addAttribute("index",new THREE.BufferAttribute(s,1));n.addAttribute("position",new THREE.BufferAttribute(k,3));n.addAttribute("normal",new THREE.BufferAttribute(p,3));n.addAttribute("uv",new THREE.BufferAttribute(f,2));n.offsets.push({start:0,count:s.length,index:0});n.computeBoundingSphere();return n};var DEFAULT_DECODE_PARAMS={decodeOffsets:[-4095,-4095,-4095,0,0,-511,-511,-511],decodeScales:[1/8191,1/8191,1/8191,1/1023,1/1023,1/1023,1/1023,1/1023]};THREE.UTF8Loader.prototype.decompressAttribsInner_=function(l,k,d,e,a,b,g,i){var f=0;for(var h=k;h<d;h++){var c=l.charCodeAt(h);f+=(c>>1)^(-(c&1));e[a]=i*(f+g);a+=b}};THREE.UTF8Loader.prototype.decompressIndices_=function(h,b,g,a,d){var f=0;for(var c=0;c<g;c++){var e=h.charCodeAt(b++);a[d++]=f-e;if(e===0){f++}}};THREE.UTF8Loader.prototype.decompressAABBs_=function(q,o,m,l,p){var n=6*m;var f=o+n;var b=0;var r=new Float32Array(n);for(var k=o;k<f;k+=6){var h=q.charCodeAt(k+0)+l[0];var g=q.charCodeAt(k+1)+l[1];var e=q.charCodeAt(k+2)+l[2];var d=(q.charCodeAt(k+3)+1)>>1;var c=(q.charCodeAt(k+4)+1)>>1;var a=(q.charCodeAt(k+5)+1)>>1;r[b++]=p[0]*(h+d);r[b++]=p[1]*(g+c);r[b++]=p[2]*(e+a);r[b++]=p[0]*d;r[b++]=p[1]*c;r[b++]=p[2]*a}return r};THREE.UTF8Loader.prototype.decompressMesh=function(q,e,i,v,m,g){var p=i.decodeScales.length;var u=i.decodeOffsets;var r=i.decodeScales;var c=e.attribRange[0];var t=e.attribRange[1];var f=c;var b=new Float32Array(p*t);for(var s=0;s<p;s++){var d=f+t;var h=r[s];if(h){this.decompressAttribsInner_(q,f,d,b,s,p,u[s],h)}f=d}var a=e.indexRange[0];var l=3*e.indexRange[1];var o=new Uint16Array(l);this.decompressIndices_(q,f,l,o,0);var k=undefined;var n=e.bboxes;if(n){k=this.decompressAABBs_(q,n,e.names.length,u,r)}g(v,m,b,o,k,e)};THREE.UTF8Loader.prototype.copyAttrib=function(e,a,d,c){for(var b=0;b<e;b++){d[b]=a[e*c+b]}};THREE.UTF8Loader.prototype.decodeAttrib2=function(k,a,g,i,n,m,e,d,c,h){for(var f=0;f<5;f++){var b=k.charCodeAt(n+m*f+h);var l=(b>>1)^(-(b&1));c[f]+=l;d[a*h+f]=c[f];e[a*h+f]=i[f]*(c[f]+g[f])}};THREE.UTF8Loader.prototype.accumulateNormal=function(h,f,d,c,n){var i=c[8*h];var g=c[8*h+1];var e=c[8*h+2];var b=c[8*f];var a=c[8*f+1];var o=c[8*f+2];var m=c[8*d];var l=c[8*d+1];var k=c[8*d+2];b-=i;a-=g;o-=e;m-=i;l-=g;k-=e;i=a*k-o*l;g=o*m-b*k;e=b*l-a*m;n[3*h]+=i;n[3*h+1]+=g;n[3*h+2]+=e;n[3*f]+=i;n[3*f+1]+=g;n[3*f+2]+=e;n[3*d]+=i;n[3*d+1]+=g;n[3*d+2]+=e};THREE.UTF8Loader.prototype.decompressMesh2=function(D,u,t,l,U,F){var s=96;var B=t.decodeScales.length;var E=t.decodeOffsets;var K=t.decodeScales;var P=u.attribRange[0];var N=u.attribRange[1];var v=u.codeRange[0];var J=u.codeRange[1];var k=3*u.codeRange[2];var Q=new Uint16Array(k);var r=new Int32Array(3*N);var W=new Uint16Array(B);var h=new Uint16Array(B*N);var X=new Float32Array(B*N);var A=0;var n=0;for(var T=0;T<k;T+=3){var b=D.charCodeAt(v++);var d=Math.min(T,s);if(b<d){var m=b%3;var S=T-(b-m);var g,f,e;switch(m){case 0:g=Q[S+2];f=Q[S+1];e=Q[S+0];break;case 1:g=Q[S+0];f=Q[S+2];e=Q[S+1];break;case 2:g=Q[S+1];f=Q[S+0];e=Q[S+2];break}Q[n++]=g;Q[n++]=f;b=D.charCodeAt(v++);var C=A-b;Q[n++]=C;if(b===0){for(var R=0;R<5;R++){var a=D.charCodeAt(P+N*R+A);var c=((a>>1)^(-(a&1)))+h[B*g+R]+h[B*f+R]-h[B*e+R];W[R]=c;h[B*A+R]=c;X[B*A+R]=K[R]*(c+E[R])}A++}else{this.copyAttrib(B,h,W,C)}this.accumulateNormal(g,f,C,h,r)}else{var I=A-(b-d);Q[n++]=I;if(b===d){this.decodeAttrib2(D,B,E,K,P,N,X,h,W,A++)}else{this.copyAttrib(B,h,W,I)}b=D.charCodeAt(v++);var H=A-b;Q[n++]=H;if(b===0){this.decodeAttrib2(D,B,E,K,P,N,X,h,W,A++)}else{this.copyAttrib(B,h,W,H)}b=D.charCodeAt(v++);var G=A-b;Q[n++]=G;if(b===0){for(var R=0;R<5;R++){W[R]=(h[B*I+R]+h[B*H+R])/2}this.decodeAttrib2(D,B,E,K,P,N,X,h,W,A++)}else{this.copyAttrib(B,h,W,G)}this.accumulateNormal(I,H,G,h,r)}}for(var T=0;T<N;T++){var O=r[3*T];var M=r[3*T+1];var L=r[3*T+2];var V=511/Math.sqrt(O*O+M*M+L*L);var q=D.charCodeAt(P+5*N+T);var p=D.charCodeAt(P+6*N+T);var o=D.charCodeAt(P+7*N+T);X[B*T+5]=V*O+((q>>1)^(-(q&1)));X[B*T+6]=V*M+((p>>1)^(-(p&1)));X[B*T+7]=V*L+((o>>1)^(-(o&1)))}F(l,U,X,Q,undefined,u)};THREE.UTF8Loader.prototype.downloadMesh=function(g,d,c,f,h){var b=this;var a=0;function e(n,o){while(a<c.length){var k=c[a];var m=k.indexRange;if(m){var i=m[0]+3*m[1];if(n.responseText.length<i){break}b.decompressMesh(n.responseText,k,f,d,a,h)}else{var l=k.codeRange;var i=l[0]+l[1];if(n.responseText.length<i){break}b.decompressMesh2(n.responseText,k,f,d,a,h)}++a}}getHttpRequest(g,function(i,k){if(i.status===200||i.status===0){e(i,k)}},e)};THREE.UTF8Loader.prototype.downloadMeshes=function(e,a,d,f){for(var c in a){var b=a[c];this.downloadMesh(e+c,c,b,d,f)}};THREE.UTF8Loader.prototype.createMeshCallback=function(l,f,o){var g=0;var i=0;var k={};var h={};var m={};var c=f.urls;for(var b in c){k[b]=c[b].length;h[b]=0;i++;m[b]=new THREE.Object3D()}var e=new THREE.Object3D();var d=new THREE.MTLLoader.MaterialCreator(l,f.options);d.setMaterials(f.materials);d.preload();var a=new THREE.UTF8Loader.BufferGeometryCreator();var n=function(p,A,q,v,u,t){var s=a.create(q,v);var r=d.create(t.material);var B=new THREE.Mesh(s,r);m[p].add(B);h[p]++;if(h[p]===k[p]){g++;e.add(m[p]);if(g===i){o(e)}}};return n};THREE.UTF8Loader.prototype.downloadModel=function(a,c,b,e){var d=this.createMeshCallback(c,b,e);this.downloadMeshes(a,b.urls,b.decodeParams,d)};THREE.UTF8Loader.prototype.downloadModelJson=function(b,c,a){getJsonRequest(b,function(f){if(!f.decodeParams){if(a&&a.decodeParams){f.decodeParams=a.decodeParams}else{f.decodeParams=DEFAULT_DECODE_PARAMS}}f.options=a;var d=b.substr(0,b.lastIndexOf("/")+1);var e=d;if(a&&a.geometryBase){d=a.geometryBase;if(d.charAt(d.length-1)!=="/"){d=d+"/"}}if(a&&a.materialBase){e=a.materialBase;if(e.charAt(e.length-1)!=="/"){e=e+"/"}}this.downloadModel(d,e,f,c)}.bind(this))};function getHttpRequest(b,e,d){var a={load:function(f){e(c,f)},progress:function(f){d(c,f)}};var c=new XMLHttpRequest();addListeners(c,a);c.open("GET",b,true);c.send(null)}function getJsonRequest(a,b){getHttpRequest(a,function(c){b(JSON.parse(c.responseText))},function(){})}function addListeners(c,b){for(var a in b){c.addEventListener(a,b[a])}}THREE.VRMLLoader=function(){};THREE.VRMLLoader.prototype={constructor:THREE.VRMLLoader,isRecordingPoints:false,isRecordingFaces:false,points:[],indexes:[],isRecordingAngles:false,isRecordingColors:false,angles:[],colors:[],recordingFieldname:null,load:function(a,d){var b=this;var c=new XMLHttpRequest();c.addEventListener("load",function(f){var e=b.parse(f.target.responseText);b.dispatchEvent({type:"load",content:e});if(d){d(e)}},false);c.addEventListener("progress",function(e){b.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})},false);c.addEventListener("error",function(){b.dispatchEvent({type:"error",message:"Couldn't load URL ["+a+"]"})},false);c.open("GET",a,true);c.send(null)},parse:function(d){var c=function(g,h){console.warn("VRML V1.0 not supported yet")};var b=function(q,l){var o={};var h=/(\b|\-|\+)([\d\.e]+)/;var m=/([\d\.\+\-e]+)\s+([\d\.\+\-e]+)\s+([\d\.\+\-e]+)/g;var n=function(u,r,v){var B=u.r-r.r;var A=u.g-r.g;var s=u.b-r.b;var C=new THREE.Color();C.r=u.r-v*B;C.g=u.g-v*A;C.b=u.b-v*s;return C};var k=function(u,r,O,C,E){var T,K,J,D,P;var V=E?1:-1;var L=["a","b","c","d"];var M=[],S,W,F=1,I={},H={},U=false,s;for(var N=0;N<O.length;N++){var G={};G.y=V*(Math.cos(O[N])*r);G.x=V*(Math.sin(O[N])*r);M.push(G)}for(var R=0;R<u.faces.length;R++){T=u.faces[R];K=(T instanceof THREE.Face3)?3:4;for(var Q=0;Q<K;Q++){D=T[L[Q]];J=u.vertices[D];for(var v=0;v<C.length;v++){if(v===0){I.x=0;I.y=E?r:-1*r}else{I.x=M[v-1].x;I.y=M[v-1].y}H=M[v];if(undefined!==H){U=E?J.y<=I.y&&J.y>H.y:J.y>=I.y&&J.y<H.y;if(U){W=C[v+1];S=C[v];F=Math.abs(J.y-I.y)/(I.y-H.y);P=n(S,W,F);T.vertexColors[Q]=P}}else{if(undefined===T.vertexColors[Q]){s=E?C.length-1:0;T.vertexColors[Q]=C[s]}}}}}};var i=function(u,G){var v=[],s,E={},F;var C=/[^\s,\[\]]+/g;var D,A,B,r;while(null!=(s=C.exec(G))){v.push(s[0])}F=v[0];switch(F){case"skyAngle":case"groundAngle":this.recordingFieldname=F;this.isRecordingAngles=true;this.angles=[];break;case"skyColor":case"groundColor":this.recordingFieldname=F;this.isRecordingColors=true;this.colors=[];break;case"point":this.recordingFieldname=F;this.isRecordingPoints=true;this.points=[];break;case"coordIndex":this.recordingFieldname=F;this.isRecordingFaces=true;this.indexes=[];break}if(this.isRecordingFaces){if(v.length>0){A=[];for(var t=0;t<v.length;t++){if(!/(-?\d+)/.test(v[t])){continue}if(v[t]==="-1"){if(A.length>0){this.indexes.push(A)}A=[]}else{A.push(parseInt(v[t]))}}}if(/]/.exec(G)){this.isRecordingFaces=false;u.coordIndex=this.indexes}}else{if(this.isRecordingPoints){while(null!==(v=m.exec(G))){D={x:parseFloat(v[1]),y:parseFloat(v[2]),z:parseFloat(v[3])};this.points.push(D)}if(/]/.exec(G)){this.isRecordingPoints=false;u.points=this.points}}else{if(this.isRecordingAngles){if(v.length>0){for(var t=0;t<v.length;t++){if(!h.test(v[t])){continue}this.angles.push(parseFloat(v[t]))}}if(/]/.exec(G)){this.isRecordingAngles=false;u[this.recordingFieldname]=this.angles}}else{if(this.isRecordingColors){while(null!==(v=m.exec(G))){color={r:parseFloat(v[1]),g:parseFloat(v[2]),b:parseFloat(v[3])};this.colors.push(color)}if(/]/.exec(G)){this.isRecordingColors=false;u[this.recordingFieldname]=this.colors}}else{if(v[v.length-1]!=="NULL"&&F!=="children"){switch(F){case"diffuseColor":case"emissiveColor":case"specularColor":case"color":if(v.length!=4){console.warn("Invalid color format detected for "+F);break}E={r:parseFloat(v[1]),g:parseFloat(v[2]),b:parseFloat(v[3])};break;case"translation":case"scale":case"size":if(v.length!=4){console.warn("Invalid vector format detected for "+F);break}E={x:parseFloat(v[1]),y:parseFloat(v[2]),z:parseFloat(v[3])};break;case"radius":case"topRadius":case"bottomRadius":case"height":case"transparency":case"shininess":case"ambientIntensity":if(v.length!=2){console.warn("Invalid single float value specification detected for "+F);break}E=parseFloat(v[1]);break;case"rotation":if(v.length!=5){console.warn("Invalid quaternion format detected for "+F);break}E={x:parseFloat(v[1]),y:parseFloat(v[2]),z:parseFloat(v[3]),w:parseFloat(v[4])};break;case"ccw":case"solid":case"colorPerVertex":case"convex":if(v.length!=2){console.warn("Invalid format detected for "+F);break}E=v[1]==="TRUE"?true:false;break}u[F]=E}}}}}return E};var p=function(C){var E={string:"Scene",children:[]};var B=E;var v;var t;for(var u=0;u<C.length;u++){var A="";var D=C[u];if(null!==(result=/^\s+?$/g.exec(D))){continue}D=D.trim();if(D===""){continue}if(/#/.exec(D)){var s=D.split("#");D=s[0];A=s[1]}if(v=/([^\s]*){1}\s?{/.exec(D)){var r={nodeType:v[1],string:D,parent:B,children:[],comment:A};B.children.push(r);B=r;if(/}/.exec(D)){t=/{(.*)}/.exec(D)[1];r.children.push(t);i(B,t);B=B.parent}}else{if(/}/.exec(D)){B=B.parent}else{if(D!==""){i(B,D);B.children.push(D)}}}}return E};var g=function(Y,F){if(typeof Y==="string"){if(/USE/.exec(Y)){var H=/USE\s+?(\w+)/.exec(Y)[1];if(undefined==o[H]){console.warn(H+" is not defined.")}else{if(/appearance/.exec(Y)&&H){F.material=o[H].clone()}else{if(/geometry/.exec(Y)&&H){F.geometry=o[H].clone();if(undefined!==o[H].solid&&o[H].solid===false){F.geometry.solid=false;F.material.side=THREE.DoubleSide}}else{if(H){var Z=o[H].clone();F.add(Z)}}}}}return}var Z=F;if("Transform"===Y.nodeType||"Group"===Y.nodeType){Z=new THREE.Object3D();if(/DEF/.exec(Y.string)){Z.name=/DEF\s+(\w+)/.exec(Y.string)[1];o[Z.name]=Z}if(undefined!==Y.translation){var I=Y.translation;Z.position.set(I.x,I.y,I.z)}if(undefined!==Y.rotation){var M=Y.rotation;Z.quaternion.setFromAxisAngle(new THREE.Vector3(M.x,M.y,M.z),M.w)}if(undefined!==Y.scale){var L=Y.scale;Z.scale.set(L.x,L.y,L.z)}F.add(Z)}else{if("Shape"===Y.nodeType){Z=new THREE.Mesh();if(/DEF/.exec(Y.string)){Z.name=/DEF (\w+)/.exec(Y.string)[1];o[Z.name]=Z}F.add(Z)}else{if("Background"===Y.nodeType){var Q=20;var v=20000;var S=new THREE.SphereGeometry(v,Q,Q);var J=new THREE.MeshBasicMaterial({fog:false,side:THREE.BackSide});if(Y.skyColor.length>1){k(S,v,Y.skyAngle,Y.skyColor,true);J.vertexColors=THREE.VertexColors}else{var T=Y.skyColor[0];J.color.setRGB(T.r,T.b,T.g)}l.add(new THREE.Mesh(S,J));if(Y.groundColor!==undefined){v=12000;var A=new THREE.SphereGeometry(v,Q,Q,0,2*Math.PI,0.5*Math.PI,1.5*Math.PI);var u=new THREE.MeshBasicMaterial({fog:false,side:THREE.BackSide,vertexColors:THREE.VertexColors});k(A,v,Y.groundAngle,Y.groundColor,false);l.add(new THREE.Mesh(A,u))}}else{if(/geometry/.exec(Y.string)){if("Box"===Y.nodeType){var L=Y.size;F.geometry=new THREE.BoxGeometry(L.x,L.y,L.z)}else{if("Cylinder"===Y.nodeType){F.geometry=new THREE.CylinderGeometry(Y.radius,Y.radius,Y.height)}else{if("Cone"===Y.nodeType){F.geometry=new THREE.CylinderGeometry(Y.topRadius,Y.bottomRadius,Y.height)}else{if("Sphere"===Y.nodeType){F.geometry=new THREE.SphereGeometry(Y.radius)}else{if("IndexedFaceSet"===Y.nodeType){var B=new THREE.Geometry();var D;for(var V=0,U=Y.children.length;V<U;V++){var C=Y.children[V];var K;if("Coordinate"===C.nodeType){for(var R=0,P=C.points.length;R<P;R++){var O=C.points[R];K=new THREE.Vector3(O.x,O.y,O.z);B.vertices.push(K)}break}}var N=0;for(var V=0,U=Y.coordIndex.length;V<U;V++){D=Y.coordIndex[V];N=0;while(D.length>=3&&N<(D.length-2)){var E=new THREE.Face3(D[0],D[N+1],D[N+2],null);N++;B.faces.push(E)}}if(false===Y.solid){F.material.side=THREE.DoubleSide}B.solid=Y.solid;B.computeFaceNormals();B.computeBoundingSphere();if(/DEF/.exec(Y.string)){B.name=/DEF (\w+)/.exec(Y.string)[1];o[B.name]=B}F.geometry=B}}}}}return}else{if(/appearance/.exec(Y.string)){for(var V=0;V<Y.children.length;V++){var C=Y.children[V];if("Material"===C.nodeType){var G=new THREE.MeshPhongMaterial();if(undefined!==C.diffuseColor){var X=C.diffuseColor;G.color.setRGB(X.r,X.g,X.b)}if(undefined!==C.emissiveColor){var W=C.emissiveColor;G.emissive.setRGB(W.r,W.g,W.b)}if(undefined!==C.specularColor){var L=C.specularColor;G.specular.setRGB(L.r,L.g,L.b)}if(undefined!==C.transparency){var I=C.transparency;G.opacity=Math.abs(1-I);G.transparent=true}if(/DEF/.exec(Y.string)){G.name=/DEF (\w+)/.exec(Y.string)[1];o[G.name]=G}F.material=G;break}}return}}}}}for(var V=0,P=Y.children.length;V<P;V++){var C=Y.children[V];g(Y.children[V],Z)}};g(p(q),l)};var e=new THREE.Scene();var a=d.split("\n");var f=a.shift();if(/V1.0/.exec(f)){c(a,e)}else{if(/V2.0/.exec(f)){b(a,e)}}return e}};THREE.EventDispatcher.prototype.apply(THREE.VRMLLoader.prototype);THREE.VTKLoader=function(a){this.manager=(a!==undefined)?a:THREE.DefaultLoadingManager};THREE.VTKLoader.prototype={constructor:THREE.VTKLoader,load:function(b,d,f,e){var c=this;var a=new THREE.XHRLoader(c.manager);a.setCrossOrigin(this.crossOrigin);a.load(b,function(g){d(c.parse(g))},f,e)},parse:function(d){var f=[];var b=[];var c,a;c=/([\+|\-]?[\d]+[\.][\d|\-|e]+)[ ]+([\+|\-]?[\d]+[\.][\d|\-|e]+)[ ]+([\+|\-]?[\d]+[\.][\d|\-|e]+)/g;while((a=c.exec(d))!==null){b.push(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]))}c=/3[ ]+([\d]+)[ ]+([\d]+)[ ]+([\d]+)/g;while((a=c.exec(d))!==null){f.push(parseInt(a[1]),parseInt(a[2]),parseInt(a[3]))}c=/4[ ]+([\d]+)[ ]+([\d]+)[ ]+([\d]+)[ ]+([\d]+)/g;while((a=c.exec(d))!==null){f.push(parseInt(a[1]),parseInt(a[2]),parseInt(a[4]));f.push(parseInt(a[2]),parseInt(a[3]),parseInt(a[4]))}var e=new THREE.BufferGeometry();e.addAttribute("index",new THREE.BufferAttribute(new (f.length>65535?Uint32Array:Uint16Array)(f),1));e.addAttribute("position",new THREE.BufferAttribute(new Float32Array(b),3));return e}};THREE.EventDispatcher.prototype.apply(THREE.VTKLoader.prototype);var LZMA=LZMA||{};if(typeof module==="object"){module.exports=LZMA}LZMA.OutWindow=function(){this._windowSize=0};LZMA.OutWindow.prototype.create=function(a){if((!this._buffer)||(this._windowSize!==a)){this._buffer=[]}this._windowSize=a;this._pos=0;this._streamPos=0};LZMA.OutWindow.prototype.flush=function(){var a=this._pos-this._streamPos;if(a!==0){while(a--){this._stream.writeByte(this._buffer[this._streamPos++])}if(this._pos>=this._windowSize){this._pos=0}this._streamPos=this._pos}};LZMA.OutWindow.prototype.releaseStream=function(){this.flush();this._stream=null};LZMA.OutWindow.prototype.setStream=function(a){this.releaseStream();this._stream=a};LZMA.OutWindow.prototype.init=function(a){if(!a){this._streamPos=0;this._pos=0}};LZMA.OutWindow.prototype.copyBlock=function(c,a){var b=this._pos-c-1;if(b<0){b+=this._windowSize}while(a--){if(b>=this._windowSize){b=0}this._buffer[this._pos++]=this._buffer[b++];if(this._pos>=this._windowSize){this.flush()}}};LZMA.OutWindow.prototype.putByte=function(a){this._buffer[this._pos++]=a;if(this._pos>=this._windowSize){this.flush()}};LZMA.OutWindow.prototype.getByte=function(b){var a=this._pos-b-1;if(a<0){a+=this._windowSize}return this._buffer[a]};LZMA.RangeDecoder=function(){};LZMA.RangeDecoder.prototype.setStream=function(a){this._stream=a};LZMA.RangeDecoder.prototype.releaseStream=function(){this._stream=null};LZMA.RangeDecoder.prototype.init=function(){var a=5;this._code=0;this._range=-1;while(a--){this._code=(this._code<<8)|this._stream.readByte()}};LZMA.RangeDecoder.prototype.decodeDirectBits=function(b){var a=0,d=b,c;while(d--){this._range>>>=1;c=(this._code-this._range)>>>31;this._code-=this._range&(c-1);a=(a<<1)|(1-c);if((this._range&4278190080)===0){this._code=(this._code<<8)|this._stream.readByte();this._range<<=8}}return a};LZMA.RangeDecoder.prototype.decodeBit=function(d,b){var a=d[b],c=(this._range>>>11)*a;if((this._code^2147483648)<(c^2147483648)){this._range=c;d[b]+=(2048-a)>>>5;if((this._range&4278190080)===0){this._code=(this._code<<8)|this._stream.readByte();this._range<<=8}return 0}this._range-=c;this._code-=c;d[b]-=a>>>5;if((this._range&4278190080)===0){this._code=(this._code<<8)|this._stream.readByte();this._range<<=8}return 1};LZMA.initBitModels=function(b,a){while(a--){b[a]=1024}};LZMA.BitTreeDecoder=function(a){this._models=[];this._numBitLevels=a};LZMA.BitTreeDecoder.prototype.init=function(){LZMA.initBitModels(this._models,1<<this._numBitLevels)};LZMA.BitTreeDecoder.prototype.decode=function(b){var a=1,c=this._numBitLevels;while(c--){a=(a<<1)|b.decodeBit(this._models,a)}return a-(1<<this._numBitLevels)};LZMA.BitTreeDecoder.prototype.reverseDecode=function(b){var a=1,d=0,c=0,e;for(;c<this._numBitLevels;++c){e=b.decodeBit(this._models,a);a=(a<<1)|e;d|=e<<c}return d};LZMA.reverseDecode2=function(h,g,b,c){var a=1,e=0,d=0,f;for(;d<c;++d){f=b.decodeBit(h,g+a);a=(a<<1)|f;e|=f<<d}return e};LZMA.LenDecoder=function(){this._choice=[];this._lowCoder=[];this._midCoder=[];this._highCoder=new LZMA.BitTreeDecoder(8);this._numPosStates=0};LZMA.LenDecoder.prototype.create=function(a){for(;this._numPosStates<a;++this._numPosStates){this._lowCoder[this._numPosStates]=new LZMA.BitTreeDecoder(3);this._midCoder[this._numPosStates]=new LZMA.BitTreeDecoder(3)}};LZMA.LenDecoder.prototype.init=function(){var a=this._numPosStates;LZMA.initBitModels(this._choice,2);while(a--){this._lowCoder[a].init();this._midCoder[a].init()}this._highCoder.init()};LZMA.LenDecoder.prototype.decode=function(a,b){if(a.decodeBit(this._choice,0)===0){return this._lowCoder[b].decode(a)}if(a.decodeBit(this._choice,1)===0){return 8+this._midCoder[b].decode(a)}return 16+this._highCoder.decode(a)};LZMA.Decoder2=function(){this._decoders=[]};LZMA.Decoder2.prototype.init=function(){LZMA.initBitModels(this._decoders,768)};LZMA.Decoder2.prototype.decodeNormal=function(a){var b=1;do{b=(b<<1)|a.decodeBit(this._decoders,b)}while(b<256);return b&255};LZMA.Decoder2.prototype.decodeWithMatchByte=function(b,c){var d=1,a,e;do{a=(c>>7)&1;c<<=1;e=b.decodeBit(this._decoders,((1+a)<<8)+d);d=(d<<1)|e;if(a!==e){while(d<256){d=(d<<1)|b.decodeBit(this._decoders,d)}break}}while(d<256);return d&255};LZMA.LiteralDecoder=function(){};LZMA.LiteralDecoder.prototype.create=function(c,b){var a;if(this._coders&&(this._numPrevBits===b)&&(this._numPosBits===c)){return}this._numPosBits=c;this._posMask=(1<<c)-1;this._numPrevBits=b;this._coders=[];a=1<<(this._numPrevBits+this._numPosBits);while(a--){this._coders[a]=new LZMA.Decoder2()}};LZMA.LiteralDecoder.prototype.init=function(){var a=1<<(this._numPrevBits+this._numPosBits);while(a--){this._coders[a].init()}};LZMA.LiteralDecoder.prototype.getDecoder=function(b,a){return this._coders[((b&this._posMask)<<this._numPrevBits)+((a&255)>>>(8-this._numPrevBits))]};LZMA.Decoder=function(){this._outWindow=new LZMA.OutWindow();this._rangeDecoder=new LZMA.RangeDecoder();this._isMatchDecoders=[];this._isRepDecoders=[];this._isRepG0Decoders=[];this._isRepG1Decoders=[];this._isRepG2Decoders=[];this._isRep0LongDecoders=[];this._posSlotDecoder=[];this._posDecoders=[];this._posAlignDecoder=new LZMA.BitTreeDecoder(4);this._lenDecoder=new LZMA.LenDecoder();this._repLenDecoder=new LZMA.LenDecoder();this._literalDecoder=new LZMA.LiteralDecoder();this._dictionarySize=-1;this._dictionarySizeCheck=-1;this._posSlotDecoder[0]=new LZMA.BitTreeDecoder(6);this._posSlotDecoder[1]=new LZMA.BitTreeDecoder(6);this._posSlotDecoder[2]=new LZMA.BitTreeDecoder(6);this._posSlotDecoder[3]=new LZMA.BitTreeDecoder(6)};LZMA.Decoder.prototype.setDictionarySize=function(a){if(a<0){return false}if(this._dictionarySize!==a){this._dictionarySize=a;this._dictionarySizeCheck=Math.max(this._dictionarySize,1);this._outWindow.create(Math.max(this._dictionarySizeCheck,4096))}return true};LZMA.Decoder.prototype.setLcLpPb=function(d,b,a){var c=1<<a;if(d>8||b>4||a>4){return false}this._literalDecoder.create(b,d);this._lenDecoder.create(c);this._repLenDecoder.create(c);this._posStateMask=c-1;return true};LZMA.Decoder.prototype.init=function(){var a=4;this._outWindow.init(false);LZMA.initBitModels(this._isMatchDecoders,192);LZMA.initBitModels(this._isRep0LongDecoders,192);LZMA.initBitModels(this._isRepDecoders,12);LZMA.initBitModels(this._isRepG0Decoders,12);LZMA.initBitModels(this._isRepG1Decoders,12);LZMA.initBitModels(this._isRepG2Decoders,12);LZMA.initBitModels(this._posDecoders,114);this._literalDecoder.init();while(a--){this._posSlotDecoder[a].init()}this._lenDecoder.init();this._repLenDecoder.init();this._posAlignDecoder.init();this._rangeDecoder.init()};LZMA.Decoder.prototype.decode=function(m,q,h){var d=0,f=0,e=0,c=0,a=0,p=0,l=0,g,k,i,b,o,n;this._rangeDecoder.setStream(m);this._outWindow.setStream(q);this.init();while(h<0||p<h){g=p&this._posStateMask;if(this._rangeDecoder.decodeBit(this._isMatchDecoders,(d<<4)+g)===0){k=this._literalDecoder.getDecoder(p++,l);if(d>=7){l=k.decodeWithMatchByte(this._rangeDecoder,this._outWindow.getByte(f))}else{l=k.decodeNormal(this._rangeDecoder)}this._outWindow.putByte(l);d=d<4?0:d-(d<10?3:6)}else{if(this._rangeDecoder.decodeBit(this._isRepDecoders,d)===1){i=0;if(this._rangeDecoder.decodeBit(this._isRepG0Decoders,d)===0){if(this._rangeDecoder.decodeBit(this._isRep0LongDecoders,(d<<4)+g)===0){d=d<7?9:11;i=1}}else{if(this._rangeDecoder.decodeBit(this._isRepG1Decoders,d)===0){b=e}else{if(this._rangeDecoder.decodeBit(this._isRepG2Decoders,d)===0){b=c}else{b=a;a=c}c=e}e=f;f=b}if(i===0){i=2+this._repLenDecoder.decode(this._rangeDecoder,g);d=d<7?8:11}}else{a=c;c=e;e=f;i=2+this._lenDecoder.decode(this._rangeDecoder,g);d=d<7?7:10;o=this._posSlotDecoder[i<=5?i-2:3].decode(this._rangeDecoder);if(o>=4){n=(o>>1)-1;f=(2|(o&1))<<n;if(o<14){f+=LZMA.reverseDecode2(this._posDecoders,f-o-1,this._rangeDecoder,n)}else{f+=this._rangeDecoder.decodeDirectBits(n-4)<<4;f+=this._posAlignDecoder.reverseDecode(this._rangeDecoder);if(f<0){if(f===-1){break}return false}}}else{f=o}}if(f>=p||f>=this._dictionarySizeCheck){return false}this._outWindow.copyBlock(f,i);p+=i;l=this._outWindow.getByte(0)}}this._outWindow.flush();this._outWindow.releaseStream();this._rangeDecoder.releaseStream();return true};LZMA.Decoder.prototype.setDecoderProperties=function(d){var f,e,c,b,a;if(d.size<5){return false}f=d.readByte();e=f%9;f=~~(f/9);c=f%5;b=~~(f/5);if(!this.setLcLpPb(e,c,b)){return false}a=d.readByte();a|=d.readByte()<<8;a|=d.readByte()<<16;a+=d.readByte()*16777216;return this.setDictionarySize(a)};LZMA.decompress=function(b,a,d,c){var e=new LZMA.Decoder();if(!e.setDecoderProperties(b)){throw"Incorrect stream properties"}if(!e.decode(a,d,c)){throw"Error in data stream"}return true};var CLOUDFMT=CLOUDFMT||{};if(typeof module==="object"){module.exports=CLOUDFMT}CLOUDFMT.CompressionMethod={RAW:5718354,MG1:3229517,MG2:3295053};CLOUDFMT.Flags={NORMALS:1};CLOUDFMT.File=function(a){this.load(a)};CLOUDFMT.File.prototype.load=function(a){this.header=new CLOUDFMT.FileHeader(a);this.body=new CLOUDFMT.FileBody(this.header);this.getReader().read(a,this.body)};CLOUDFMT.File.prototype.getReader=function(){var a;switch(this.header.compressionMethod){case CLOUDFMT.CompressionMethod.RAW:a=new CLOUDFMT.ReaderRAW();break;case CLOUDFMT.CompressionMethod.MG1:a=new CLOUDFMT.ReaderMG1();break;case CLOUDFMT.CompressionMethod.MG2:a=new CLOUDFMT.ReaderMG2();break}return a};CLOUDFMT.FileHeader=function(a){a.readInt32();this.fileFormat=a.readInt32();this.compressionMethod=a.readInt32();this.vertexCount=a.readInt32();this.triangleCount=a.readInt32();this.uvMapCount=a.readInt32();this.attrMapCount=a.readInt32();this.flags=a.readInt32();this.comment=a.readString()};CLOUDFMT.FileHeader.prototype.hasNormals=function(){return this.flags&CLOUDFMT.Flags.NORMALS};CLOUDFMT.FileBody=function(k){var f=k.triangleCount*3,c=k.vertexCount*3,h=k.hasNormals()?k.vertexCount*3:0,e=k.vertexCount*2,b=k.vertexCount*4,d=0;var g=new ArrayBuffer((f+c+h+(e*k.uvMapCount)+(b*k.attrMapCount))*4);this.indices=new Uint32Array(g,0,f);this.vertices=new Float32Array(g,f*4,c);if(k.hasNormals()){this.normals=new Float32Array(g,(f+c)*4,h)}if(k.uvMapCount){this.uvMaps=[];for(d=0;d<k.uvMapCount;++d){this.uvMaps[d]={uv:new Float32Array(g,(f+c+h+(d*e))*4,e)}}}if(k.attrMapCount){this.attrMaps=[];for(d=0;d<k.attrMapCount;++d){this.attrMaps[d]={attr:new Float32Array(g,(f+c+h+(e*k.uvMapCount)+(d*b))*4,b)}}}};CLOUDFMT.FileMG2Header=function(a){a.readInt32();this.vertexPrecision=a.readFloat32();this.normalPrecision=a.readFloat32();this.lowerBoundx=a.readFloat32();this.lowerBoundy=a.readFloat32();this.lowerBoundz=a.readFloat32();this.higherBoundx=a.readFloat32();this.higherBoundy=a.readFloat32();this.higherBoundz=a.readFloat32();this.divx=a.readInt32();this.divy=a.readInt32();this.divz=a.readInt32();this.sizex=(this.higherBoundx-this.lowerBoundx)/this.divx;this.sizey=(this.higherBoundy-this.lowerBoundy)/this.divy;this.sizez=(this.higherBoundz-this.lowerBoundz)/this.divz};CLOUDFMT.ReaderRAW=function(){};CLOUDFMT.ReaderRAW.prototype.read=function(b,a){this.readIndices(b,a.indices);this.readVertices(b,a.vertices);if(a.normals){this.readNormals(b,a.normals)}if(a.uvMaps){this.readUVMaps(b,a.uvMaps)}if(a.attrMaps){this.readAttrMaps(b,a.attrMaps)}};CLOUDFMT.ReaderRAW.prototype.readIndices=function(b,a){b.readInt32();b.readArrayInt32(a)};CLOUDFMT.ReaderRAW.prototype.readVertices=function(b,a){b.readInt32();b.readArrayFloat32(a)};CLOUDFMT.ReaderRAW.prototype.readNormals=function(b,a){b.readInt32();b.readArrayFloat32(a)};CLOUDFMT.ReaderRAW.prototype.readUVMaps=function(c,b){var a=0;for(;a<b.length;++a){c.readInt32();b[a].name=c.readString();b[a].filename=c.readString();c.readArrayFloat32(b[a].uv)}};CLOUDFMT.ReaderRAW.prototype.readAttrMaps=function(b,c){var a=0;for(;a<c.length;++a){b.readInt32();c[a].name=b.readString();b.readArrayFloat32(c[a].attr)}};CLOUDFMT.ReaderMG1=function(){};CLOUDFMT.ReaderMG1.prototype.read=function(b,a){this.readIndices(b,a.indices);this.readVertices(b,a.vertices);if(a.normals){this.readNormals(b,a.normals)}if(a.uvMaps){this.readUVMaps(b,a.uvMaps)}if(a.attrMaps){this.readAttrMaps(b,a.attrMaps)}};CLOUDFMT.ReaderMG1.prototype.readIndices=function(b,a){b.readInt32();b.readInt32();var c=new CLOUDFMT.InterleavedStream(a,3);LZMA.decompress(b,b,c,c.data.length);CLOUDFMT.restoreIndices(a,a.length)};CLOUDFMT.ReaderMG1.prototype.readVertices=function(b,a){b.readInt32();b.readInt32();var c=new CLOUDFMT.InterleavedStream(a,1);LZMA.decompress(b,b,c,c.data.length)};CLOUDFMT.ReaderMG1.prototype.readNormals=function(b,a){b.readInt32();b.readInt32();var c=new CLOUDFMT.InterleavedStream(a,3);LZMA.decompress(b,b,c,c.data.length)};CLOUDFMT.ReaderMG1.prototype.readUVMaps=function(c,b){var a=0;for(;a<b.length;++a){c.readInt32();b[a].name=c.readString();b[a].filename=c.readString();c.readInt32();var d=new CLOUDFMT.InterleavedStream(b[a].uv,2);LZMA.decompress(c,c,d,d.data.length)}};CLOUDFMT.ReaderMG1.prototype.readAttrMaps=function(b,d){var a=0;for(;a<d.length;++a){b.readInt32();d[a].name=b.readString();b.readInt32();var c=new CLOUDFMT.InterleavedStream(d[a].attr,4);LZMA.decompress(b,b,c,c.data.length)}};CLOUDFMT.ReaderMG2=function(){};CLOUDFMT.ReaderMG2.prototype.read=function(b,a){this.MG2Header=new CLOUDFMT.FileMG2Header(b);this.readVertices(b,a.vertices);this.readIndices(b,a.indices);if(a.normals){this.readNormals(b,a)}if(a.uvMaps){this.readUVMaps(b,a.uvMaps)}if(a.attrMaps){this.readAttrMaps(b,a.attrMaps)}};CLOUDFMT.ReaderMG2.prototype.readVertices=function(c,b){c.readInt32();c.readInt32();var d=new CLOUDFMT.InterleavedStream(b,3);LZMA.decompress(c,c,d,d.data.length);var a=this.readGridIndices(c,b);CLOUDFMT.restoreVertices(b,this.MG2Header,a,this.MG2Header.vertexPrecision)};CLOUDFMT.ReaderMG2.prototype.readGridIndices=function(c,b){c.readInt32();c.readInt32();var a=new Uint32Array(b.length/3);var d=new CLOUDFMT.InterleavedStream(a,1);LZMA.decompress(c,c,d,d.data.length);CLOUDFMT.restoreGridIndices(a,a.length);return a};CLOUDFMT.ReaderMG2.prototype.readIndices=function(b,a){b.readInt32();b.readInt32();var c=new CLOUDFMT.InterleavedStream(a,3);LZMA.decompress(b,b,c,c.data.length);CLOUDFMT.restoreIndices(a,a.length)};CLOUDFMT.ReaderMG2.prototype.readNormals=function(c,a){c.readInt32();c.readInt32();var d=new CLOUDFMT.InterleavedStream(a.normals,3);LZMA.decompress(c,c,d,d.data.length);var b=CLOUDFMT.calcSmoothNormals(a.indices,a.vertices);CLOUDFMT.restoreNormals(a.normals,b,this.MG2Header.normalPrecision)};CLOUDFMT.ReaderMG2.prototype.readUVMaps=function(d,c){var b=0;for(;b<c.length;++b){d.readInt32();c[b].name=d.readString();c[b].filename=d.readString();var a=d.readFloat32();d.readInt32();var e=new CLOUDFMT.InterleavedStream(c[b].uv,2);LZMA.decompress(d,d,e,e.data.length);CLOUDFMT.restoreMap(c[b].uv,2,a)}};CLOUDFMT.ReaderMG2.prototype.readAttrMaps=function(c,e){var b=0;for(;b<e.length;++b){c.readInt32();e[b].name=c.readString();var a=c.readFloat32();c.readInt32();var d=new CLOUDFMT.InterleavedStream(e[b].attr,4);LZMA.decompress(c,c,d,d.data.length);CLOUDFMT.restoreMap(e[b].attr,4,a)}};CLOUDFMT.restoreIndices=function(c,a){var b=3;if(a>0){c[2]+=c[0];c[1]+=c[0]}for(;b<a;b+=3){c[b]+=c[b-3];if(c[b]===c[b-3]){c[b+1]+=c[b-2]}else{c[b+1]+=c[b]}c[b+2]+=c[b]}};CLOUDFMT.restoreGridIndices=function(b,a){var c=1;for(;c<a;++c){b[c]+=b[c-1]}};CLOUDFMT.restoreVertices=function(m,a,s,g){var n,r,q,p,o,b=new Uint32Array(m.buffer,m.byteOffset,m.length),h=a.divx,d=h*a.divy,c=2147483647,l=0,f=0,e=0,k=s.length;for(;f<k;e+=3){q=n=s[f++];o=~~(q/d);q-=~~(o*d);p=~~(q/h);q-=~~(p*h);r=b[e];if(n===c){r+=l}m[e]=a.lowerBoundx+q*a.sizex+g*r;m[e+1]=a.lowerBoundy+p*a.sizey+g*b[e+1];m[e+2]=a.lowerBoundz+o*a.sizez+g*b[e+2];c=n;l=r}};CLOUDFMT.restoreNormals=function(s,b,l){var m,q,c,a,n,h,g,r,p,o,e=new Uint32Array(s.buffer,s.byteOffset,s.length),f=0,d=s.length,t=3.141592653589793*0.5;for(;f<d;f+=3){m=e[f]*l;q=e[f+1];if(q===0){s[f]=b[f]*m;s[f+1]=b[f+1]*m;s[f+2]=b[f+2]*m}else{if(q<=4){c=(e[f+2]-2)*t}else{c=((e[f+2]*4/q)-2)*t}q*=l*t;a=m*Math.sin(q);n=a*Math.cos(c);h=a*Math.sin(c);g=m*Math.cos(q);p=b[f+1];r=b[f]-b[f+2];o=Math.sqrt(2*p*p+r*r);if(o>1e-20){r/=o;p/=o}s[f]=b[f]*g+(b[f+1]*p-b[f+2]*r)*h-p*n;s[f+1]=b[f+1]*g-(b[f+2]+b[f])*p*h+r*n;s[f+2]=b[f+2]*g+(b[f]*r+b[f+1]*p)*h+p*n}}};CLOUDFMT.restoreMap=function(a,g,d){var k,h,e=new Uint32Array(a.buffer,a.byteOffset,a.length),c=0,b,f=a.length;for(;c<g;++c){k=0;for(b=c;b<f;b+=g){h=e[b];k+=h&1?-((h+1)>>1):h>>1;a[b]=k*d}}};CLOUDFMT.calcSmoothNormals=function(a,b){var f=new Float32Array(b.length),u,t,s,r,q,p,e,d,c,m,l,g,o,n,h;for(n=0,h=a.length;n<h;){u=a[n++]*3;t=a[n++]*3;s=a[n++]*3;e=b[t]-b[u];m=b[s]-b[u];d=b[t+1]-b[u+1];l=b[s+1]-b[u+1];c=b[t+2]-b[u+2];g=b[s+2]-b[u+2];r=d*g-c*l;q=c*m-e*g;p=e*l-d*m;o=Math.sqrt(r*r+q*q+p*p);if(o>1e-10){r/=o;q/=o;p/=o}f[u]+=r;f[u+1]+=q;f[u+2]+=p;f[t]+=r;f[t+1]+=q;f[t+2]+=p;f[s]+=r;f[s+1]+=q;f[s+2]+=p}for(n=0,h=f.length;n<h;n+=3){o=Math.sqrt(f[n]*f[n]+f[n+1]*f[n+1]+f[n+2]*f[n+2]);if(o>1e-10){f[n]/=o;f[n+1]/=o;f[n+2]/=o}}return f};CLOUDFMT.isLittleEndian=(function(){var b=new ArrayBuffer(2),a=new Uint8Array(b),c=new Uint16Array(b);a[0]=1;return c[0]===1}());CLOUDFMT.InterleavedStream=function(b,a){this.data=new Uint8Array(b.buffer,b.byteOffset,b.byteLength);this.offset=CLOUDFMT.isLittleEndian?3:0;this.count=a*4;this.len=this.data.length};CLOUDFMT.InterleavedStream.prototype.writeByte=function(a){this.data[this.offset]=a;this.offset+=this.count;if(this.offset>=this.len){this.offset-=this.len-4;if(this.offset>=this.count){this.offset-=this.count+(CLOUDFMT.isLittleEndian?1:-1)}}};CLOUDFMT.Stream=function(a){this.data=a;this.offset=0};CLOUDFMT.Stream.prototype.TWO_POW_MINUS23=Math.pow(2,-23);CLOUDFMT.Stream.prototype.TWO_POW_MINUS126=Math.pow(2,-126);CLOUDFMT.Stream.prototype.readByte=function(){return this.data[this.offset++]&255};CLOUDFMT.Stream.prototype.readInt32=function(){var a=this.readByte();a|=this.readByte()<<8;a|=this.readByte()<<16;return a|(this.readByte()<<24)};CLOUDFMT.Stream.prototype.readFloat32=function(){var a=this.readByte();a+=this.readByte()<<8;var c=this.readByte();var b=this.readByte();a+=(c&127)<<16;var f=((b&127)<<1)|((c&128)>>>7);var d=b&128?-1:1;if(f===255){return a!==0?NaN:d*Infinity}if(f>0){return d*(1+(a*this.TWO_POW_MINUS23))*Math.pow(2,f-127)}if(a!==0){return d*a*this.TWO_POW_MINUS126}return d*0};CLOUDFMT.Stream.prototype.readString=function(){var a=this.readInt32();this.offset+=a;return String.fromCharCode.apply(null,this.data.subarray(this.offset-a,this.offset))};CLOUDFMT.Stream.prototype.readArrayInt32=function(c){var b=0,a=c.length;while(b<a){c[b++]=this.readInt32()}return c};CLOUDFMT.Stream.prototype.readArrayFloat32=function(c){var b=0,a=c.length;while(b<a){c[b++]=this.readFloat32()}return c};THREE.CLOUDFMTLoader=function(a){THREE.Loader.call(this,a)};THREE.CLOUDFMTLoader.prototype=Object.create(THREE.Loader.prototype);THREE.CLOUDFMTLoader.prototype.constructor=THREE.CLOUDFMTLoader;THREE.CLOUDFMTLoader.prototype.createModel=function(a,d){var c=function(){THREE.BufferGeometry.call(this);this.materials=[];var k=a.body.indices,f=a.body.vertices,i=a.body.normals;var g,e;var h=a.body.uvMaps;if(h!==undefined&&h.length>0){g=h[0].uv}var l=a.body.attrMaps;if(l!==undefined&&l.length>0&&l[0].name==="Color"){e=l[0].attr}this.addAttribute("index",new THREE.BufferAttribute(k,1));this.addAttribute("position",new THREE.BufferAttribute(f,3));if(i!==undefined){this.addAttribute("normal",new THREE.BufferAttribute(i,3))}if(g!==undefined){this.addAttribute("uv",new THREE.BufferAttribute(g,2))}if(e!==undefined){this.addAttribute("color",new THREE.BufferAttribute(e,4))}};c.prototype=Object.create(THREE.BufferGeometry.prototype);c.prototype.constructor=c;var b=new c();b.computeOffsets();if(b.attributes.normal===undefined){b.computeVertexNormals()}d(b)};THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0};THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex();this.v2=new THREE.RenderableVertex();this.v3=new THREE.RenderableVertex();this.normalModel=new THREE.Vector3();this.vertexNormalsModel=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()];this.vertexNormalsLength=0;this.color=new THREE.Color();this.material=null;this.uvs=[new THREE.Vector2(),new THREE.Vector2(),new THREE.Vector2()];this.z=0};THREE.RenderableVertex=function(){this.position=new THREE.Vector3();this.positionWorld=new THREE.Vector3();this.positionScreen=new THREE.Vector4();this.visible=true};THREE.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld);this.positionScreen.copy(a.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex();this.v2=new THREE.RenderableVertex();this.vertexColors=[new THREE.Color(),new THREE.Color()];this.material=null;this.z=0};THREE.RenderableSprite=function(){this.id=0;this.object=null;this.x=0;this.y=0;this.z=0;this.rotation=0;this.scale=new THREE.Vector2();this.material=null};THREE.Projector=function(){var Y,H,R=[],o=0,A,c,f=[],b=0,m,F,K=[],C=0,i,U,W=[],u=0,D,r,e=[],X=0,N={objects:[],lights:[],elements:[]},Q=new THREE.Vector3(),O=new THREE.Vector3(),L=new THREE.Vector3(),P=new THREE.Vector3(),M=new THREE.Vector4(),s=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),Z=new THREE.Box3(),T=new Array(3),S=new Array(4),a=new THREE.Matrix4(),g=new THREE.Matrix4(),E,G=new THREE.Matrix4(),p=new THREE.Matrix3(),V=new THREE.Frustum(),t=new THREE.Vector4(),h=new THREE.Vector4();this.projectVector=function(aa,ab){console.warn("THREE.Projector: .projectVector() is now vector.project().");aa.project(ab)};this.unprojectVector=function(aa,ab){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");aa.unproject(ab)};this.pickingRay=function(aa,ab){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var d=function(){var am=[];var ai=[];var ah=null;var ak=null;var ag=new THREE.Matrix3();var ae=function(ao){ah=ao;ak=ah.material;ag.getNormalMatrix(ah.matrixWorld);am.length=0;ai.length=0};var aj=function(aq){var ao=aq.position;var ar=aq.positionWorld;var ap=aq.positionScreen;ar.copy(ao).applyMatrix4(E);ap.copy(ar).applyMatrix4(g);var at=1/ap.w;ap.x*=at;ap.y*=at;ap.z*=at;aq.visible=ap.x>=-1&&ap.x<=1&&ap.y>=-1&&ap.y<=1&&ap.z>=-1&&ap.z<=1};var ab=function(ao,aq,ap){A=v();A.position.set(ao,aq,ap);aj(A)};var ad=function(ao,aq,ap){am.push(ao,aq,ap)};var ac=function(ao,ap){ai.push(ao,ap)};var af=function(aq,ap,ao){if(aq.visible===true||ap.visible===true||ao.visible===true){return true}T[0]=aq.positionScreen;T[1]=ap.positionScreen;T[2]=ao.positionScreen;return s.isIntersectionBox(Z.setFromPoints(T))};var al=function(aq,ap,ao){return((ao.positionScreen.x-aq.positionScreen.x)*(ap.positionScreen.y-aq.positionScreen.y)-(ao.positionScreen.y-aq.positionScreen.y)*(ap.positionScreen.x-aq.positionScreen.x))<0};var an=function(ap,ao){var ar=f[ap];var aq=f[ao];i=J();i.id=ah.id;i.v1.copy(ar);i.v2.copy(aq);i.z=(ar.positionScreen.z+aq.positionScreen.z)/2;i.material=ah.material;N.elements.push(i)};var aa=function(ay,aw,au){var az=f[ay];var ax=f[aw];var av=f[au];if(af(az,ax,av)===false){return}if(ak.side===THREE.DoubleSide||al(az,ax,av)===true){m=l();m.id=ah.id;m.v1.copy(az);m.v2.copy(ax);m.v3.copy(av);m.z=(az.positionScreen.z+ax.positionScreen.z+av.positionScreen.z)/3;for(var ar=0;ar<3;ar++){var aq=arguments[ar]*3;var at=m.vertexNormalsModel[ar];at.set(am[aq],am[aq+1],am[aq+2]);at.applyMatrix3(ag).normalize();var ao=arguments[ar]*2;var ap=m.uvs[ar];ap.set(ai[ao],ai[ao+1])}m.vertexNormalsLength=3;m.material=ah.material;N.elements.push(m)}};return{setObject:ae,projectVertex:aj,checkTriangleVisibility:af,checkBackfaceCulling:al,pushVertex:ab,pushNormal:ad,pushUv:ac,pushLine:an,pushTriangle:aa}};var I=new d();this.projectScene=function(ax,ao,az,ad){F=0;U=0;r=0;N.elements.length=0;if(ax.autoUpdate===true){ax.updateMatrixWorld()}if(ao.parent===undefined){ao.updateMatrixWorld()}a.copy(ao.matrixWorldInverse.getInverse(ao.matrixWorld));g.multiplyMatrices(ao.projectionMatrix,a);V.setFromMatrix(g);H=0;N.objects.length=0;N.lights.length=0;ax.traverseVisible(function(a1){if(a1 instanceof THREE.Light){N.lights.push(a1)}else{if(a1 instanceof THREE.Mesh||a1 instanceof THREE.Line||a1 instanceof THREE.Sprite){if(a1.material.visible===false){return}if(a1.frustumCulled===false||V.intersectsObject(a1)===true){Y=n();Y.id=a1.id;Y.object=a1;P.setFromMatrixPosition(a1.matrixWorld);P.applyProjection(g);Y.z=P.z;N.objects.push(Y)}}}});if(az===true){N.objects.sort(q)}for(var aN=0,aC=N.objects.length;aN<aC;aN++){var aJ=N.objects[aN].object;var ak=aJ.geometry;I.setObject(aJ);E=aJ.matrixWorld;c=0;if(aJ instanceof THREE.Mesh){if(ak instanceof THREE.BufferGeometry){var aH=ak.attributes;var au=ak.offsets;if(aH.position===undefined){continue}var ai=aH.position.array;for(var aT=0,aR=ai.length;aT<aR;aT+=3){I.pushVertex(ai[aT],ai[aT+1],ai[aT+2])}if(aH.normal!==undefined){var ar=aH.normal.array;for(var aT=0,aR=ar.length;aT<aR;aT+=3){I.pushNormal(ar[aT],ar[aT+1],ar[aT+2])}}if(aH.uv!==undefined){var aG=aH.uv.array;for(var aT=0,aR=aG.length;aT<aR;aT+=2){I.pushUv(aG[aT],aG[aT+1])}}if(aH.index!==undefined){var ac=aH.index.array;if(au.length>0){for(var aN=0;aN<au.length;aN++){var aI=au[aN];var aA=aI.index;for(var aT=aI.start,aR=aI.start+aI.count;aT<aR;aT+=3){I.pushTriangle(ac[aT]+aA,ac[aT+1]+aA,ac[aT+2]+aA)}}}else{for(var aT=0,aR=ac.length;aT<aR;aT+=3){I.pushTriangle(ac[aT],ac[aT+1],ac[aT+2])}}}else{for(var aT=0,aR=ai.length/3;aT<aR;aT+=3){I.pushTriangle(aT,aT+1,aT+2)}}}else{if(ak instanceof THREE.Geometry){var ab=ak.vertices;var aj=ak.faces;var aF=ak.faceVertexUvs[0];p.getNormalMatrix(E);var ag=aJ.material instanceof THREE.MeshFaceMaterial;var at=ag===true?aJ.material:null;for(var aK=0,am=ab.length;aK<am;aK++){var aq=ab[aK];I.pushVertex(aq.x,aq.y,aq.z)}for(var aU=0,ay=aj.length;aU<ay;aU++){var ah=aj[aU];var aS=ag===true?at.materials[ah.materialIndex]:aJ.material;if(aS===undefined){continue}var an=aS.side;var a0=f[ah.a];var aY=f[ah.b];var aW=f[ah.c];if(aS.morphTargets===true){var al=ak.morphTargets;var aQ=aJ.morphTargetInfluences;var ae=a0.position;var aP=aY.position;var aw=aW.position;Q.set(0,0,0);O.set(0,0,0);L.set(0,0,0);for(var aM=0,aa=al.length;aM<aa;aM++){var aD=aQ[aM];if(aD===0){continue}var aE=al[aM].vertices;Q.x+=(aE[ah.a].x-ae.x)*aD;Q.y+=(aE[ah.a].y-ae.y)*aD;Q.z+=(aE[ah.a].z-ae.z)*aD;O.x+=(aE[ah.b].x-aP.x)*aD;O.y+=(aE[ah.b].y-aP.y)*aD;O.z+=(aE[ah.b].z-aP.z)*aD;L.x+=(aE[ah.c].x-aw.x)*aD;L.y+=(aE[ah.c].y-aw.y)*aD;L.z+=(aE[ah.c].z-aw.z)*aD}a0.position.add(Q);aY.position.add(O);aW.position.add(L);I.projectVertex(a0);I.projectVertex(aY);I.projectVertex(aW)}if(I.checkTriangleVisibility(a0,aY,aW)===false){continue}var av=I.checkBackfaceCulling(a0,aY,aW);if(an!==THREE.DoubleSide){if(an===THREE.FrontSide&&av===false){continue}if(an===THREE.BackSide&&av===true){continue}}m=l();m.id=aJ.id;m.v1.copy(a0);m.v2.copy(aY);m.v3.copy(aW);m.normalModel.copy(ah.normal);if(av===false&&(an===THREE.BackSide||an===THREE.DoubleSide)){m.normalModel.negate()}m.normalModel.applyMatrix3(p).normalize();var af=ah.vertexNormals;for(var aO=0,aX=Math.min(af.length,3);aO<aX;aO++){var aZ=m.vertexNormalsModel[aO];aZ.copy(af[aO]);if(av===false&&(an===THREE.BackSide||an===THREE.DoubleSide)){aZ.negate()}aZ.applyMatrix3(p).normalize()}m.vertexNormalsLength=af.length;var ap=aF[aU];if(ap!==undefined){for(var aL=0;aL<3;aL++){m.uvs[aL].copy(ap[aL])}}m.color=ah.color;m.material=aS;m.z=(a0.positionScreen.z+aY.positionScreen.z+aW.positionScreen.z)/3;N.elements.push(m)}}}}else{if(aJ instanceof THREE.Line){if(ak instanceof THREE.BufferGeometry){var aH=ak.attributes;if(aH.position!==undefined){var ai=aH.position.array;for(var aT=0,aR=ai.length;aT<aR;aT+=3){I.pushVertex(ai[aT],ai[aT+1],ai[aT+2])}if(aH.index!==undefined){var ac=aH.index.array;for(var aT=0,aR=ac.length;aT<aR;aT+=2){I.pushLine(ac[aT],ac[aT+1])}}else{var aB=aJ.mode===THREE.LinePieces?2:1;for(var aT=0,aR=(ai.length/3)-1;aT<aR;aT+=aB){I.pushLine(aT,aT+1)}}}}else{if(ak instanceof THREE.Geometry){G.multiplyMatrices(g,E);var ab=aJ.geometry.vertices;if(ab.length===0){continue}a0=v();a0.positionScreen.copy(ab[0]).applyMatrix4(G);var aB=aJ.mode===THREE.LinePieces?2:1;for(var aK=1,am=ab.length;aK<am;aK++){a0=v();a0.positionScreen.copy(ab[aK]).applyMatrix4(G);if((aK+1)%aB>0){continue}aY=f[c-2];t.copy(a0.positionScreen);h.copy(aY.positionScreen);if(B(t,h)===true){t.multiplyScalar(1/t.w);h.multiplyScalar(1/h.w);i=J();i.id=aJ.id;i.v1.positionScreen.copy(t);i.v2.positionScreen.copy(h);i.z=Math.max(t.z,h.z);i.material=aJ.material;if(aJ.material.vertexColors===THREE.VertexColors){i.vertexColors[0].copy(aJ.geometry.colors[aK]);i.vertexColors[1].copy(aJ.geometry.colors[aK-1])}N.elements.push(i)}}}}}else{if(aJ instanceof THREE.Sprite){M.set(E.elements[12],E.elements[13],E.elements[14],1);M.applyMatrix4(g);var aV=1/M.w;M.z*=aV;if(M.z>=-1&&M.z<=1){D=k();D.id=aJ.id;D.x=M.x*aV;D.y=M.y*aV;D.z=M.z;D.object=aJ;D.rotation=aJ.rotation;D.scale.x=aJ.scale.x*Math.abs(D.x-(M.x+ao.projectionMatrix.elements[0])/(M.w+ao.projectionMatrix.elements[12]));D.scale.y=aJ.scale.y*Math.abs(D.y-(M.y+ao.projectionMatrix.elements[5])/(M.w+ao.projectionMatrix.elements[13]));D.material=aJ.material;N.elements.push(D)}}}}}if(ad===true){N.elements.sort(q)}return N};function n(){if(H===o){var aa=new THREE.RenderableObject();R.push(aa);o++;H++;return aa}return R[H++]}function v(){if(c===b){var aa=new THREE.RenderableVertex();f.push(aa);b++;c++;return aa}return f[c++]}function l(){if(F===C){var aa=new THREE.RenderableFace();K.push(aa);C++;F++;return aa}return K[F++]}function J(){if(U===u){var aa=new THREE.RenderableLine();W.push(aa);u++;U++;return aa}return W[U++]}function k(){if(r===X){var aa=new THREE.RenderableSprite();e.push(aa);X++;r++;return aa}return e[r++]}function q(ab,aa){if(ab.z!==aa.z){return aa.z-ab.z}else{if(ab.id!==aa.id){return ab.id-aa.id}else{return 0}}}function B(ae,ad){var ac=0,ah=1,af=ae.z+ae.w,ab=ad.z+ad.w,aa=-ae.z+ae.w,ag=-ad.z+ad.w;if(af>=0&&ab>=0&&aa>=0&&ag>=0){return true}else{if((af<0&&ab<0)||(aa<0&&ag<0)){return false}else{if(af<0){ac=Math.max(ac,af/(af-ab))}else{if(ab<0){ah=Math.min(ah,af/(af-ab))}}if(aa<0){ac=Math.max(ac,aa/(aa-ag))}else{if(ag<0){ah=Math.min(ah,aa/(aa-ag))}}if(ah<ac){return false}else{ae.lerp(ad,ac);ad.lerp(ae,1-ah);return true}}}}};THREE.RaytracingRenderer=function(k){console.log("THREE.RaytracingRenderer",THREE.REVISION);k=k||{};var g=document.createElement("canvas");var f=g.getContext("2d",{alpha:k.alpha===true});var i=3;var u,c;var t,v;var e=new THREE.Color(0);var C=new THREE.Vector3();var A=new THREE.Vector3();var l=new THREE.Vector3();var r=new THREE.Raycaster(C,A);var b=new THREE.Raycaster();var q;var o=new THREE.Matrix4();var h=new THREE.Matrix3();var a;var B=[];var n={};var m=null;this.domElement=g;this.autoClear=true;this.setClearColor=function(D,E){e.set(D)};this.setSize=function(E,D){g.width=E;g.height=D;u=g.width;c=g.height;t=Math.floor(u/2);v=Math.floor(c/2);f.fillStyle="white"};this.setSize(g.width,g.height);this.clear=function(){};var s=(function(){var K=new THREE.Color();var H=new THREE.Color();var I=new THREE.Color();var F=new THREE.Color();var L=new THREE.Color();var G=new THREE.Vector3();var Q=new THREE.Vector3();var P=new THREE.Vector3();var O=new THREE.Vector3();var N=new THREE.Vector3();var D=new THREE.Vector3();var E=new THREE.Vector3();var M=[];for(var J=0;J<i;J++){M[J]=new THREE.Color()}return function(av,X,S,R){var ak=r.ray;ak.origin=av;ak.direction=X;var ai=b.ray;S.setRGB(0,0,0);var ay=r.intersectObjects(a,true);if(ay.length===0){return}var ah=ay[0];var ao=ah.point;var ax=ah.object;var al=ax.material;var ag=ah.face;var Z=ax.geometry.vertices;var ad=n[ax.id];N.copy(ao).applyMatrix4(ad.inverseMatrix);G.subVectors(r.ray.origin,ao).normalize();if(al instanceof THREE.MeshLambertMaterial||al instanceof THREE.MeshPhongMaterial||al instanceof THREE.MeshBasicMaterial){K.copyGammaToLinear(al.color)}else{K.setRGB(1,1,1)}if(al.vertexColors===THREE.FaceColors){K.multiply(ag.color)}ai.origin.copy(ao);if(al instanceof THREE.MeshBasicMaterial){for(var at=0,ap=B.length;at<ap;at++){var U=B[at];Q.setFromMatrixPosition(U.matrixWorld);Q.sub(ao);ai.direction.copy(Q).normalize();var ay=b.intersectObjects(a,true);if(ay.length>0){continue}S.add(K)}}else{if(al instanceof THREE.MeshLambertMaterial||al instanceof THREE.MeshPhongMaterial){var am=false;for(var at=0,ap=B.length;at<ap;at++){var U=B[at];I.copyGammaToLinear(U.color);Q.setFromMatrixPosition(U.matrixWorld);Q.sub(ao);ai.direction.copy(Q).normalize();var ay=b.intersectObjects(a,true);if(ay.length>0){continue}if(am===false){p(P,N,al.shading,ag,Z);P.applyMatrix3(ad.normalMatrix).normalize();am=true}var ac=1;if(U.physicalAttenuation===true){ac=Q.length();ac=1/(ac*ac)}Q.normalize();var an=Math.max(P.dot(Q),0);var W=an*U.intensity;L.copy(K);L.multiply(I);L.multiplyScalar(W*ac);S.add(L);if(al instanceof THREE.MeshPhongMaterial){O.addVectors(Q,G).normalize();var T=Math.max(P.dot(O),0);var aw=Math.max(Math.pow(T,al.shininess),0)*W;var af=(al.shininess+2)/8;H.copyGammaToLinear(al.specular);var V=Math.pow(Math.max(1-Q.dot(O),0),5);F.r=H.r+(1-H.r)*V;F.g=H.g+(1-H.g)*V;F.b=H.b+(1-H.b)*V;L.copy(F);L.multiply(I);L.multiplyScalar(af*aw*ac);S.add(L)}}}}var aa=al.reflectivity;if((al.mirror||al.glass)&&aa>0&&R<i){if(al.mirror){D.copy(X);D.reflect(P)}else{if(al.glass){var Y=al.refractionRatio;var ae=X.dot(P);var aq=1-Y*Y*(1-ae*ae);if(aq<0){D.set(0,0,0)}else{D.copy(X);D.multiplyScalar(Y);var V=Y*ae+Math.sqrt(aq);E.copy(P);E.multiplyScalar(V);D.sub(E)}}}var ab=Math.max(G.dot(P),0);var ar=aa;var au=ar+(1-ar)*Math.pow((1-ab),5);var aj=au;var az=M[R];s(ao,D,az,R+1);if(al.specular!==undefined){az.multiply(al.specular)}az.multiplyScalar(aj);S.multiplyScalar(1-aj);S.add(az)}}}());var p=(function(){var F=new THREE.Vector3();var E=new THREE.Vector3();var D=new THREE.Vector3();return function(U,T,R,L,K){var Q=L.normal;var J=L.vertexNormals;if(R===THREE.FlatShading){U.copy(Q)}else{if(R===THREE.SmoothShading){var I=K[L.a];var H=K[L.b];var G=K[L.c];D.crossVectors(F.subVectors(H,I),E.subVectors(G,I));var P=Q.dot(D);D.crossVectors(F.subVectors(H,T),E.subVectors(G,T));var V=Q.dot(D);var S=V/P;D.crossVectors(F.subVectors(G,T),E.subVectors(I,T));var O=Q.dot(D);var N=O/P;var M=1-S-N;F.copy(J[0]);F.multiplyScalar(S);E.copy(J[1]);E.multiplyScalar(N);D.copy(J[2]);D.multiplyScalar(M);U.addVectors(F,E);U.add(D)}}}}());var d=(function(){var G=64;var F=document.createElement("canvas");F.width=G;F.height=G;var D=F.getContext("2d",{alpha:k.alpha===true});var E=D.getImageData(0,0,G,G);var I=E.data;var H=new THREE.Color();return function(M,K){var L=0;for(var N=0;N<G;N++){for(var J=0;J<G;J++,L+=4){C.copy(l);A.set(J+M-t,-(N+K-v),-q);A.applyMatrix3(h).normalize();s(C,A,H,0);I[L]=Math.sqrt(H.r)*255;I[L+1]=Math.sqrt(H.g)*255;I[L+2]=Math.sqrt(H.b)*255}}f.putImageData(E,M,K);M+=G;if(M>=u){M=0;K+=G;if(K>=c){return}}f.fillRect(M,K,G,G);m=requestAnimationFrame(function(){d(M,K)})}}());this.render=function(E,D){if(this.autoClear===true){this.clear()}cancelAnimationFrame(m);if(E.autoUpdate===true){E.updateMatrixWorld()}if(D.parent===undefined){D.updateMatrixWorld()}D.matrixWorldInverse.getInverse(D.matrixWorld);l.setFromMatrixPosition(D.matrixWorld);h.getNormalMatrix(D.matrixWorld);C.copy(l);q=0.5/Math.tan(THREE.Math.degToRad(D.fov*0.5))*c;a=E.children;B.length=0;E.traverse(function(F){if(F instanceof THREE.Light){B.push(F)}if(n[F.id]===undefined){n[F.id]={normalMatrix:new THREE.Matrix3(),inverseMatrix:new THREE.Matrix4()}}o.multiplyMatrices(D.matrixWorldInverse,F.matrixWorld);var G=n[F.id];G.normalMatrix.getNormalMatrix(o);G.inverseMatrix.getInverse(F.matrixWorld)});d(0,0)}};
/*!

 JSZip - A Javascript class for generating and reading zip files
 <http://stuartk.com/jszip>

 (c) 2009-2014 Stuart Knightley <stuart [at] stuartk.com>
 Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.

 JSZip uses the library pako released under the MIT license :
 https://github.com/nodeca/pako/blob/master/LICENSE
 */
;!function(d){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=d()}else{if("function"==typeof define&&define.amd){define([],d)}else{var c;"undefined"!=typeof window?c=window:"undefined"!=typeof global?c=global:"undefined"!=typeof self&&(c=self),c.JSZip=d()}}}(function(){return function b(a,m,l){function k(f,e){if(!m[f]){if(!a[f]){var d="function"==typeof require&&require;if(!e&&d){return d(f,!0)}if(i){return i(f,!0)}throw new Error("Cannot find module '"+f+"'")}var c=m[f]={exports:{}};a[f][0].call(c.exports,function(g){var n=a[f][1][g];return k(n?n:g)},c,c.exports,b,a,m,l)}return m[f].exports}for(var i="function"==typeof require&&require,h=0;h<l.length;h++){k(l[h])}return k}({1:[function(f,e,h){var g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";h.encode=function(t){for(var s,r,q,p,o,n,m,l="",d=0;d<t.length;){s=t.charCodeAt(d++),r=t.charCodeAt(d++),q=t.charCodeAt(d++),p=s>>2,o=(3&s)<<4|r>>4,n=(15&r)<<2|q>>6,m=63&q,isNaN(r)?n=m=64:isNaN(q)&&(m=64),l=l+g.charAt(p)+g.charAt(o)+g.charAt(n)+g.charAt(m)}return l},h.decode=function(t){var s,r,q,p,o,n,m,l="",d=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");d<t.length;){p=g.indexOf(t.charAt(d++)),o=g.indexOf(t.charAt(d++)),n=g.indexOf(t.charAt(d++)),m=g.indexOf(t.charAt(d++)),s=p<<2|o>>4,r=(15&o)<<4|n>>2,q=(3&n)<<6|m,l+=String.fromCharCode(s),64!=n&&(l+=String.fromCharCode(r)),64!=m&&(l+=String.fromCharCode(q))}return l}},{}],2:[function(e,d){function f(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}f.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},d.exports=f},{}],3:[function(e,d,f){f.STORE={magic:"\x00\x00",compress:function(c){return c},uncompress:function(c){return c},compressInputType:null,uncompressInputType:null},f.DEFLATE=e("./flate")},{"./flate":8}],4:[function(f,e){var h=f("./utils"),g=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918000,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];e.exports=function(d,c){if("undefined"==typeof d||!d.length){return 0}var p="string"!==h.getTypeOf(d);"undefined"==typeof c&&(c=0);var o=0,n=0,m=0;c=-1^c;for(var l=0,k=d.length;k>l;l++){m=p?d[l]:d.charCodeAt(l),n=255&(c^m),o=g[n],c=c>>>8^o}return -1^c}},{"./utils":21}],5:[function(f,e){function h(){this.data=null,this.length=0,this.index=0}var g=f("./utils");h.prototype={checkOffset:function(c){this.checkIndex(this.index+c)},checkIndex:function(c){if(this.length<c||0>c){throw new Error("End of data reached (data length = "+this.length+", asked index = "+c+"). Corrupted zip ?")}},setIndex:function(c){this.checkIndex(c),this.index=c},skip:function(c){this.setIndex(this.index+c)},byteAt:function(){},readInt:function(i){var d,k=0;for(this.checkOffset(i),d=this.index+i-1;d>=this.index;d--){k=(k<<8)+this.byteAt(d)}return this.index+=i,k},readString:function(c){return g.transformTo("string",this.readData(c))},readData:function(){},lastIndexOfSignature:function(){},readDate:function(){var c=this.readInt(4);return new Date((c>>25&127)+1980,(c>>21&15)-1,c>>16&31,c>>11&31,c>>5&63,(31&c)<<1)}},e.exports=h},{"./utils":21}],6:[function(e,d,f){f.base64=!1,f.binary=!1,f.dir=!1,f.createFolders=!1,f.date=null,f.compression=null,f.comment=null},{}],7:[function(f,e,h){var g=f("./utils");h.string2binary=function(c){return g.string2binary(c)},h.string2Uint8Array=function(c){return g.transformTo("uint8array",c)},h.uint8Array2String=function(c){return g.transformTo("string",c)},h.string2Blob=function(d){var c=g.transformTo("arraybuffer",d);return g.arrayBuffer2Blob(c)},h.arrayBuffer2Blob=function(c){return g.arrayBuffer2Blob(c)},h.transformTo=function(d,c){return g.transformTo(d,c)},h.getTypeOf=function(c){return g.getTypeOf(c)},h.checkSupport=function(c){return g.checkSupport(c)},h.MAX_VALUE_16BITS=g.MAX_VALUE_16BITS,h.MAX_VALUE_32BITS=g.MAX_VALUE_32BITS,h.pretty=function(c){return g.pretty(c)},h.findCompression=function(c){return g.findCompression(c)},h.isRegExp=function(c){return g.isRegExp(c)}},{"./utils":21}],8:[function(g,f,k){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,h=g("pako");k.uncompressInputType=i?"uint8array":"array",k.compressInputType=i?"uint8array":"array",k.magic="\b\x00",k.compress=function(c){return h.deflateRaw(c)},k.uncompress=function(c){return h.inflateRaw(c)}},{pako:24}],9:[function(f,e){function h(d,c){return this instanceof h?(this.files={},this.comment=null,this.root="",d&&this.load(d,c),void (this.clone=function(){var k=new h;for(var i in this){"function"!=typeof this[i]&&(k[i]=this[i])}return k})):new h(d,c)}var g=f("./base64");h.prototype=f("./object"),h.prototype.load=f("./load"),h.support=f("./support"),h.defaults=f("./defaults"),h.utils=f("./deprecatedPublicUtils"),h.base64={encode:function(c){return g.encode(c)},decode:function(c){return g.decode(c)}},h.compressions=f("./compressions"),e.exports=h},{"./base64":1,"./compressions":3,"./defaults":6,"./deprecatedPublicUtils":7,"./load":10,"./object":13,"./support":17}],10:[function(f,e){var h=f("./base64"),g=f("./zipEntries");e.exports=function(d,c){var m,l,k,i;for(c=c||{},c.base64&&(d=h.decode(d)),l=new g(d,c),m=l.files,k=0;k<m.length;k++){i=m[k],this.file(i.fileName,i.decompressed,{binary:!0,optimizedBinaryString:!0,date:i.date,dir:i.dir,comment:i.fileComment.length?i.fileComment:null,createFolders:c.createFolders})}return l.zipComment.length&&(this.comment=l.zipComment),this}},{"./base64":1,"./zipEntries":22}],11:[function(d,c){(function(e){c.exports=function(a,f){return new e(a,f)},c.exports.test=function(a){return e.isBuffer(a)}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],12:[function(f,e){function h(c){this.data=c,this.length=this.data.length,this.index=0}var g=f("./uint8ArrayReader");h.prototype=new g,h.prototype.readData=function(d){this.checkOffset(d);var c=this.data.slice(this.index,this.index+d);return this.index+=d,c},e.exports=h},{"./uint8ArrayReader":18}],13:[function(ab,aa){var Z=ab("./support"),Y=ab("./utils"),X=ab("./crc32"),W=ab("./signature"),V=ab("./defaults"),U=ab("./base64"),T=ab("./compressions"),S=ab("./compressedObject"),R=ab("./nodeBuffer"),Q=ab("./utf8"),P=ab("./stringWriter"),O=ab("./uint8ArrayWriter"),N=function(d){if(d._data instanceof S&&(d._data=d._data.getContent(),d.options.binary=!0,d.options.base64=!1,"uint8array"===Y.getTypeOf(d._data))){var c=d._data;d._data=new Uint8Array(c.length),0!==c.length&&d._data.set(c,0)}return d._data},M=function(d){var c=N(d),f=Y.getTypeOf(c);return"string"===f?!d.options.binary&&Z.nodebuffer?R(c,"utf-8"):d.asBinary():c},K=function(d){var c=N(this);return null===c||"undefined"==typeof c?"":(this.options.base64&&(c=U.decode(c)),c=d&&this.options.binary?L.utf8decode(c):Y.transformTo("string",c),d||this.options.binary||(c=Y.transformTo("string",L.utf8encode(c))),c)},J=function(e,d,f){this.name=e,this.dir=f.dir,this.date=f.date,this.comment=f.comment,this._data=d,this.options=f,this._initialMetadata={dir:f.dir,date:f.date}};J.prototype={asText:function(){return K.call(this,!0)},asBinary:function(){return K.call(this,!1)},asNodeBuffer:function(){var c=M(this);return Y.transformTo("nodebuffer",c)},asUint8Array:function(){var c=M(this);return Y.transformTo("uint8array",c)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var I=function(f,e){var h,g="";for(h=0;e>h;h++){g+=String.fromCharCode(255&f),f>>>=8}return g},H=function(){var e,d,f={};for(e=0;e<arguments.length;e++){for(d in arguments[e]){arguments[e].hasOwnProperty(d)&&"undefined"==typeof f[d]&&(f[d]=arguments[e][d])}}return f},G=function(c){return c=c||{},c.base64!==!0||null!==c.binary&&void 0!==c.binary||(c.binary=!0),c=H(c,V),c.date=c.date||new Date,null!==c.compression&&(c.compression=c.compression.toUpperCase()),c},F=function(h,d,m){var l,k=Y.getTypeOf(d);if(m=G(m),m.createFolders&&(l=E(h))&&D.call(this,l,!0),m.dir||null===d||"undefined"==typeof d){m.base64=!1,m.binary=!1,d=null}else{if("string"===k){m.binary&&!m.base64&&m.optimizedBinaryString!==!0&&(d=Y.string2binary(d))}else{if(m.base64=!1,m.binary=!0,!(k||d instanceof S)){throw new Error("The data of '"+h+"' is in an unsupported format !")}"arraybuffer"===k&&(d=Y.transformTo("uint8array",d))}}var i=new J(h,d,m);return this.files[h]=i,i},E=function(d){"/"==d.slice(-1)&&(d=d.substring(0,d.length-1));var c=d.lastIndexOf("/");return c>0?d.substring(0,c):""},D=function(d,c){return"/"!=d.slice(-1)&&(d+="/"),c="undefined"!=typeof c?c:!1,this.files[d]||F.call(this,d,null,{dir:!0,createFolders:c}),this.files[d]},C=function(e,d){var h,g=new S;return e._data instanceof S?(g.uncompressedSize=e._data.uncompressedSize,g.crc32=e._data.crc32,0===g.uncompressedSize||e.dir?(d=T.STORE,g.compressedContent="",g.crc32=0):e._data.compressionMethod===d.magic?g.compressedContent=e._data.getCompressedContent():(h=e._data.getContent(),g.compressedContent=d.compress(Y.transformTo(d.compressInputType,h)))):(h=M(e),(!h||0===h.length||e.dir)&&(d=T.STORE,h=""),g.uncompressedSize=h.length,g.crc32=X(h),g.compressedContent=d.compress(Y.transformTo(d.compressInputType,h))),g.compressedSize=g.compressedContent.length,g.compressionMethod=d.magic,g},B=function(ap,ao,an,am){var al,ak,aj,ai,ah=(an.compressedContent,Y.transformTo("string",Q.utf8encode(ao.name))),ag=ao.comment||"",af=Y.transformTo("string",Q.utf8encode(ag)),ae=ah.length!==ao.name.length,ad=af.length!==ag.length,ac=ao.options,A="",s="",l="";aj=ao._initialMetadata.dir!==ao.dir?ao.dir:ac.dir,ai=ao._initialMetadata.date!==ao.date?ao.date:ac.date,al=ai.getHours(),al<<=6,al|=ai.getMinutes(),al<<=5,al|=ai.getSeconds()/2,ak=ai.getFullYear()-1980,ak<<=4,ak|=ai.getMonth()+1,ak<<=5,ak|=ai.getDate(),ae&&(s=I(1,1)+I(X(ah),4)+ah,A+="up"+I(s.length,2)+s),ad&&(l=I(1,1)+I(this.crc32(af),4)+af,A+="uc"+I(l.length,2)+l);var f="";f+="\n\x00",f+=ae||ad?"\x00\b":"\x00\x00",f+=an.compressionMethod,f+=I(al,2),f+=I(ak,2),f+=I(an.crc32,4),f+=I(an.compressedSize,4),f+=I(an.uncompressedSize,4),f+=I(ah.length,2),f+=I(A.length,2);var e=W.LOCAL_FILE_HEADER+f+ah+A,d=W.CENTRAL_FILE_HEADER+"\x00"+f+I(af.length,2)+"\x00\x00\x00\x00"+(aj===!0?"\x00\x00\x00":"\x00\x00\x00\x00")+I(am,4)+ah+A+af;return{fileRecord:e,dirRecord:d,compressedObject:an}},L={load:function(){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(h){var g,m,l,k,i=[];for(g in this.files){this.files.hasOwnProperty(g)&&(l=this.files[g],k=new J(l.name,l._data,H(l.options)),m=g.slice(this.root.length,g.length),g.slice(0,this.root.length)===this.root&&h(m,k)&&i.push(k))}return i},file:function(f,d,h){if(1===arguments.length){if(Y.isRegExp(f)){var g=f;return this.filter(function(e,c){return !c.dir&&g.test(e)})}return this.filter(function(a,e){return !e.dir&&a===f})[0]||null}return f=this.root+f,F.call(this,f,d,h),this},folder:function(f){if(!f){return this}if(Y.isRegExp(f)){return this.filter(function(a,e){return e.dir&&f.test(a)})}var d=this.root+f,h=D.call(this,d),g=this.clone();return g.root=h.name,g},remove:function(f){f=this.root+f;var e=this.files[f];if(e||("/"!=f.slice(-1)&&(f+="/"),e=this.files[f]),e&&!e.dir){delete this.files[f]}else{for(var h=this.filter(function(a,d){return d.name.slice(0,f.length)===f}),g=0;g<h.length;g++){delete this.files[h[g].name]}}return this},generate:function(af){af=H(af||{},{base64:!0,compression:"STORE",type:"base64",comment:null}),Y.checkSupport(af.type);var ad,ac,A=[],t=0,s=0,n=Y.transformTo("string",this.utf8encode(af.comment||this.comment||""));for(var m in this.files){if(this.files.hasOwnProperty(m)){var i=this.files[m],h=i.options.compression||af.compression.toUpperCase(),f=T[h];if(!f){throw new Error(h+" is not a valid compression method !")}var d=C.call(this,i,f),ai=B.call(this,m,i,d,t);t+=ai.fileRecord.length+d.compressedSize,s+=ai.dirRecord.length,A.push(ai)}}var ah="";ah=W.CENTRAL_DIRECTORY_END+"\x00\x00\x00\x00"+I(A.length,2)+I(A.length,2)+I(s,4)+I(t,4)+I(n.length,2)+n;var ag=af.type.toLowerCase();for(ad="uint8array"===ag||"arraybuffer"===ag||"blob"===ag||"nodebuffer"===ag?new O(t+s+ah.length):new P(t+s+ah.length),ac=0;ac<A.length;ac++){ad.append(A[ac].fileRecord),ad.append(A[ac].compressedObject.compressedContent)}for(ac=0;ac<A.length;ac++){ad.append(A[ac].dirRecord)}ad.append(ah);var ae=ad.finalize();switch(af.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return Y.transformTo(af.type.toLowerCase(),ae);case"blob":return Y.arrayBuffer2Blob(Y.transformTo("arraybuffer",ae));case"base64":return af.base64?U.encode(ae):ae;default:return ae}},crc32:function(d,c){return X(d,c)},utf8encode:function(c){return Y.transformTo("string",Q.utf8encode(c))},utf8decode:function(c){return Q.utf8decode(c)}};aa.exports=L},{"./base64":1,"./compressedObject":2,"./compressions":3,"./crc32":4,"./defaults":6,"./nodeBuffer":11,"./signature":14,"./stringWriter":16,"./support":17,"./uint8ArrayWriter":19,"./utf8":20,"./utils":21}],14:[function(e,d,f){f.LOCAL_FILE_HEADER="PK",f.CENTRAL_FILE_HEADER="PK",f.CENTRAL_DIRECTORY_END="PK",f.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",f.ZIP64_CENTRAL_DIRECTORY_END="PK",f.DATA_DESCRIPTOR="PK\b"},{}],15:[function(g,f){function k(d,c){this.data=d,c||(this.data=h.string2binary(this.data)),this.length=this.data.length,this.index=0}var i=g("./dataReader"),h=g("./utils");k.prototype=new i,k.prototype.byteAt=function(c){return this.data.charCodeAt(c)},k.prototype.lastIndexOfSignature=function(c){return this.data.lastIndexOf(c)},k.prototype.readData=function(d){this.checkOffset(d);var c=this.data.slice(this.index,this.index+d);return this.index+=d,c},f.exports=k},{"./dataReader":5,"./utils":21}],16:[function(f,e){var h=f("./utils"),g=function(){this.data=[]};g.prototype={append:function(c){c=h.transformTo("string",c),this.data.push(c)},finalize:function(){return this.data.join("")}},e.exports=g},{"./utils":21}],17:[function(e,d,f){(function(g){if(f.base64=!0,f.array=!0,f.string=!0,f.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,f.nodebuffer="undefined"!=typeof g,f.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer){f.blob=!1}else{var c=new ArrayBuffer(0);try{f.blob=0===new Blob([c],{type:"application/zip"}).size}catch(k){try{var i=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,h=new i;h.append(c),f.blob=0===h.getBlob("application/zip").size}catch(k){f.blob=!1}}}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],18:[function(f,e){function h(c){c&&(this.data=c,this.length=this.data.length,this.index=0)}var g=f("./dataReader");h.prototype=new g,h.prototype.byteAt=function(c){return this.data[c]},h.prototype.lastIndexOfSignature=function(k){for(var i=k.charCodeAt(0),o=k.charCodeAt(1),n=k.charCodeAt(2),m=k.charCodeAt(3),l=this.length-4;l>=0;--l){if(this.data[l]===i&&this.data[l+1]===o&&this.data[l+2]===n&&this.data[l+3]===m){return l}}return -1},h.prototype.readData=function(d){if(this.checkOffset(d),0===d){return new Uint8Array(0)}var c=this.data.subarray(this.index,this.index+d);return this.index+=d,c},e.exports=h},{"./dataReader":5}],19:[function(f,e){var h=f("./utils"),g=function(c){this.data=new Uint8Array(c),this.index=0};g.prototype={append:function(c){0!==c.length&&(c=h.transformTo("uint8array",c),this.data.set(c,this.index),this.index+=c.length)},finalize:function(){return this.data}},e.exports=g},{"./utils":21}],20:[function(v,u,t){for(var s=v("./utils"),r=v("./support"),q=v("./nodeBuffer"),p=new Array(256),o=0;256>o;o++){p[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1}p[254]=p[254]=1;var n=function(k){var e,F,E,D,C,B=k.length,A=0;for(D=0;B>D;D++){F=k.charCodeAt(D),55296===(64512&F)&&B>D+1&&(E=k.charCodeAt(D+1),56320===(64512&E)&&(F=65536+(F-55296<<10)+(E-56320),D++)),A+=128>F?1:2048>F?2:65536>F?3:4}for(e=r.uint8array?new Uint8Array(A):new Array(A),C=0,D=0;A>C;D++){F=k.charCodeAt(D),55296===(64512&F)&&B>D+1&&(E=k.charCodeAt(D+1),56320===(64512&E)&&(F=65536+(F-55296<<10)+(E-56320),D++)),128>F?e[C++]=F:2048>F?(e[C++]=192|F>>>6,e[C++]=128|63&F):65536>F?(e[C++]=224|F>>>12,e[C++]=128|F>>>6&63,e[C++]=128|63&F):(e[C++]=240|F>>>18,e[C++]=128|F>>>12&63,e[C++]=128|F>>>6&63,e[C++]=128|63&F)}return e},m=function(e,d){var f;for(d=d||e.length,d>e.length&&(d=e.length),f=d-1;f>=0&&128===(192&e[f]);){f--}return 0>f?d:0===f?d:f+p[e[f]]>d?f:d},l=function(g){var d,D,C,B,A=g.length,k=new Array(2*A);for(D=0,d=0;A>d;){if(C=g[d++],128>C){k[D++]=C}else{if(B=p[C],B>4){k[D++]=65533,d+=B-1}else{for(C&=2===B?31:3===B?15:7;B>1&&A>d;){C=C<<6|63&g[d++],B--}B>1?k[D++]=65533:65536>C?k[D++]=C:(C-=65536,k[D++]=55296|C>>10&1023,k[D++]=56320|1023&C)}}}return k.length!==D&&(k.subarray?k=k.subarray(0,D):k.length=D),s.applyFromCharCode(k)};t.utf8encode=function(c){return r.nodebuffer?q(c,"utf-8"):n(c)},t.utf8decode=function(e){if(r.nodebuffer){return s.transformTo("nodebuffer",e).toString("utf-8")}e=s.transformTo(r.uint8array?"uint8array":"array",e);for(var d=[],B=0,A=e.length,k=65536;A>B;){var i=m(e,Math.min(B+k,A));d.push(r.uint8array?l(e.subarray(B,i)):l(e.slice(B,i))),B=i}return d.join("")}},{"./nodeBuffer":11,"./support":17,"./utils":21}],21:[function(v,u,t){function s(c){return c}function r(e,d){for(var f=0;f<e.length;++f){d[f]=255&e.charCodeAt(f)}return d}function q(I){var H=65536,G=[],F=I.length,E=t.getTypeOf(I),D=0,C=!0;try{switch(E){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,m(0))}}catch(B){C=!1}if(!C){for(var A="",c=0;c<I.length;c++){A+=String.fromCharCode(I[c])}return A}for(;F>D&&H>1;){try{G.push("array"===E||"nodebuffer"===E?String.fromCharCode.apply(null,I.slice(D,Math.min(D+H,F))):String.fromCharCode.apply(null,I.subarray(D,Math.min(D+H,F)))),D+=H}catch(B){H=Math.floor(H/2)}}return G.join("")}function p(e,d){for(var f=0;f<e.length;f++){d[f]=e[f]}return d}var o=v("./support"),n=v("./compressions"),m=v("./nodeBuffer");t.string2binary=function(e){for(var d="",f=0;f<e.length;f++){d+=String.fromCharCode(255&e.charCodeAt(f))}return d},t.arrayBuffer2Blob=function(f){t.checkSupport("blob");try{return new Blob([f],{type:"application/zip"})}catch(c){try{var h=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,g=new h;return g.append(f),g.getBlob("application/zip")}catch(c){throw new Error("Bug : can't construct the Blob.")}}},t.applyFromCharCode=q;var l={};l.string={string:s,array:function(c){return r(c,new Array(c.length))},arraybuffer:function(c){return l.string.uint8array(c).buffer},uint8array:function(c){return r(c,new Uint8Array(c.length))},nodebuffer:function(c){return r(c,m(c.length))}},l.array={string:q,array:s,arraybuffer:function(c){return new Uint8Array(c).buffer},uint8array:function(c){return new Uint8Array(c)},nodebuffer:function(c){return m(c)}},l.arraybuffer={string:function(c){return q(new Uint8Array(c))},array:function(c){return p(new Uint8Array(c),new Array(c.byteLength))},arraybuffer:s,uint8array:function(c){return new Uint8Array(c)},nodebuffer:function(c){return m(new Uint8Array(c))}},l.uint8array={string:q,array:function(c){return p(c,new Array(c.length))},arraybuffer:function(c){return c.buffer},uint8array:s,nodebuffer:function(c){return m(c)}},l.nodebuffer={string:q,array:function(c){return p(c,new Array(c.length))},arraybuffer:function(c){return l.nodebuffer.uint8array(c).buffer},uint8array:function(c){return p(c,new Uint8Array(c.length))},nodebuffer:s},t.transformTo=function(f,c){if(c||(c=""),!f){return c}t.checkSupport(f);var h=t.getTypeOf(c),g=l[h][f](c);return g},t.getTypeOf=function(c){return"string"==typeof c?"string":"[object Array]"===Object.prototype.toString.call(c)?"array":o.nodebuffer&&m.test(c)?"nodebuffer":o.uint8array&&c instanceof Uint8Array?"uint8array":o.arraybuffer&&c instanceof ArrayBuffer?"arraybuffer":void 0},t.checkSupport=function(d){var c=o[d.toLowerCase()];if(!c){throw new Error(d+" is not supported by this browser")}},t.MAX_VALUE_16BITS=65535,t.MAX_VALUE_32BITS=-1,t.pretty=function(f){var e,h,g="";for(h=0;h<(f||"").length;h++){e=f.charCodeAt(h),g+="\\x"+(16>e?"0":"")+e.toString(16).toUpperCase()}return g},t.findCompression=function(d){for(var c in n){if(n.hasOwnProperty(c)&&n[c].magic===d){return n[c]}}return null},t.isRegExp=function(c){return"[object RegExp]"===Object.prototype.toString.call(c)}},{"./compressions":3,"./nodeBuffer":11,"./support":17}],22:[function(v,u){function t(d,c){this.files=[],this.loadOptions=c,d&&this.load(d)}var s=v("./stringReader"),r=v("./nodeBufferReader"),q=v("./uint8ArrayReader"),p=v("./utils"),o=v("./signature"),n=v("./zipEntry"),m=v("./support"),l=v("./object");t.prototype={checkSignature:function(d){var c=this.reader.readString(4);if(c!==d){throw new Error("Corrupted zip or bug : unexpected signature ("+p.pretty(c)+", expected "+p.pretty(d)+")")}},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength),this.zipComment=l.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,f,k,i=this.zip64EndOfCentralSize-44,h=0;i>h;){g=this.reader.readInt(2),f=this.reader.readInt(4),k=this.reader.readString(f),this.zip64ExtensibleData[g]={id:g,length:f,value:k}}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1){throw new Error("Multi-volumes zip are not supported")}},readLocalFiles:function(){var d,c;for(d=0;d<this.files.length;d++){c=this.files[d],this.reader.setIndex(c.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),c.readLocalPart(this.reader),c.handleUTF8()}},readCentralDir:function(){var c;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===o.CENTRAL_FILE_HEADER;){c=new n({zip64:this.zip64},this.loadOptions),c.readCentralPart(this.reader),this.files.push(c)}},readEndOfCentral:function(){var c=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(-1===c){throw new Error("Corrupted zip : can't find end of central directory")}if(this.reader.setIndex(c),this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===p.MAX_VALUE_16BITS||this.diskWithCentralDirStart===p.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===p.MAX_VALUE_16BITS||this.centralDirRecords===p.MAX_VALUE_16BITS||this.centralDirSize===p.MAX_VALUE_32BITS||this.centralDirOffset===p.MAX_VALUE_32BITS){if(this.zip64=!0,c=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),-1===c){throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator")}this.reader.setIndex(c),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(d){var c=p.getTypeOf(d);this.reader="string"!==c||m.uint8array?"nodebuffer"===c?new r(d):new q(p.transformTo("uint8array",d)):new s(d,this.loadOptions.optimizedBinaryString)},load:function(c){this.prepareReader(c),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},u.exports=t},{"./nodeBufferReader":12,"./object":13,"./signature":14,"./stringReader":15,"./support":17,"./uint8ArrayReader":18,"./utils":21,"./zipEntry":23}],23:[function(i,h){function o(d,c){this.options=d,this.loadOptions=c}var n=i("./stringReader"),m=i("./utils"),l=i("./compressedObject"),k=i("./object");o.prototype={isEncrypted:function(){return 1===(1&this.bitFlag)},useUTF8:function(){return 2048===(2048&this.bitFlag)},prepareCompressedContent:function(e,d,f){return function(){var c=e.index;e.setIndex(d);var a=e.readData(f);return e.setIndex(c),a}},prepareContent:function(g,e,r,q,p){return function(){var d=m.transformTo(q.uncompressInputType,this.getCompressedContent()),c=q.uncompress(d);if(c.length!==p){throw new Error("Bug : uncompressed data size mismatch")}return c}},readLocalPart:function(e){var d,f;if(e.skip(22),this.fileNameLength=e.readInt(2),f=e.readInt(2),this.fileName=e.readString(this.fileNameLength),e.skip(f),-1==this.compressedSize||-1==this.uncompressedSize){throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)")}if(d=m.findCompression(this.compressionMethod),null===d){throw new Error("Corrupted zip : compression "+m.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")")}if(this.decompressed=new l,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(e,e.index,this.compressedSize,d),this.decompressed.getContent=this.prepareContent(e,e.index,this.compressedSize,d,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=m.transformTo("string",this.decompressed.getContent()),k.crc32(this.decompressed)!==this.crc32)){throw new Error("Corrupted zip : CRC32 mismatch")}},readCentralPart:function(c){if(this.versionMadeBy=c.readString(2),this.versionNeeded=c.readInt(2),this.bitFlag=c.readInt(2),this.compressionMethod=c.readString(2),this.date=c.readDate(),this.crc32=c.readInt(4),this.compressedSize=c.readInt(4),this.uncompressedSize=c.readInt(4),this.fileNameLength=c.readInt(2),this.extraFieldsLength=c.readInt(2),this.fileCommentLength=c.readInt(2),this.diskNumberStart=c.readInt(2),this.internalFileAttributes=c.readInt(2),this.externalFileAttributes=c.readInt(4),this.localHeaderOffset=c.readInt(4),this.isEncrypted()){throw new Error("Encrypted zip are not supported")}this.fileName=c.readString(this.fileNameLength),this.readExtraFields(c),this.parseZIP64ExtraField(c),this.fileComment=c.readString(this.fileCommentLength),this.dir=16&this.externalFileAttributes?!0:!1},parseZIP64ExtraField:function(){if(this.extraFields[1]){var c=new n(this.extraFields[1].value);this.uncompressedSize===m.MAX_VALUE_32BITS&&(this.uncompressedSize=c.readInt(8)),this.compressedSize===m.MAX_VALUE_32BITS&&(this.compressedSize=c.readInt(8)),this.localHeaderOffset===m.MAX_VALUE_32BITS&&(this.localHeaderOffset=c.readInt(8)),this.diskNumberStart===m.MAX_VALUE_32BITS&&(this.diskNumberStart=c.readInt(4))}},readExtraFields:function(g){var f,r,q,p=g.index;for(this.extraFields=this.extraFields||{};g.index<p+this.extraFieldsLength;){f=g.readInt(2),r=g.readInt(2),q=g.readString(r),this.extraFields[f]={id:f,length:r,value:q}}},handleUTF8:function(){if(this.useUTF8()){this.fileName=k.utf8decode(this.fileName),this.fileComment=k.utf8decode(this.fileComment)}else{var d=this.findExtraFieldUnicodePath();null!==d&&(this.fileName=d);var c=this.findExtraFieldUnicodeComment();null!==c&&(this.fileComment=c)}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var c=new n(d.value);return 1!==c.readInt(1)?null:k.crc32(this.fileName)!==c.readInt(4)?null:k.utf8decode(c.readString(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var c=new n(d.value);return 1!==c.readInt(1)?null:k.crc32(this.fileComment)!==c.readInt(4)?null:k.utf8decode(c.readString(d.length-5))}return null}},h.exports=o},{"./compressedObject":2,"./object":13,"./stringReader":15,"./utils":21}],24:[function(i,h){var o=i("./lib/utils/common").assign,n=i("./lib/deflate"),m=i("./lib/inflate"),l=i("./lib/zlib/constants"),k={};o(k,n,m,l),h.exports=k},{"./lib/deflate":25,"./lib/inflate":26,"./lib/utils/common":27,"./lib/zlib/constants":30}],25:[function(P,O,N){function M(e,d){var f=new t(d);if(f.push(e,!0),f.err){throw f.msg}return f.result}function L(d,c){return c=c||{},c.raw=!0,M(d,c)}function K(d,c){return c=c||{},c.gzip=!0,M(d,c)}var J=P("./zlib/deflate.js"),I=P("./utils/common"),H=P("./utils/strings"),G=P("./zlib/messages"),F=P("./zlib/zstream"),E=0,D=4,C=0,B=1,A=-1,v=0,u=8,t=function(e){this.options=I.assign({level:A,method:u,chunkSize:16384,windowBits:15,memLevel:8,strategy:v,to:""},e||{});var d=this.options;d.raw&&d.windowBits>0?d.windowBits=-d.windowBits:d.gzip&&d.windowBits>0&&d.windowBits<16&&(d.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new F,this.strm.avail_out=0;var f=J.deflateInit2(this.strm,d.level,d.method,d.windowBits,d.memLevel,d.strategy);if(f!==C){throw new Error(G[f])}d.header&&J.deflateSetHeader(this.strm,d.header)};t.prototype.push=function(h,g){var m,l,k=this.strm,i=this.options.chunkSize;if(this.ended){return !1}l=g===~~g?g:g===!0?D:E,k.input="string"==typeof h?H.string2buf(h):h,k.next_in=0,k.avail_in=k.input.length;do{if(0===k.avail_out&&(k.output=new I.Buf8(i),k.next_out=0,k.avail_out=i),m=J.deflate(k,l),m!==B&&m!==C){return this.onEnd(m),this.ended=!0,!1}(0===k.avail_out||0===k.avail_in&&l===D)&&this.onData("string"===this.options.to?H.buf2binstring(I.shrinkBuf(k.output,k.next_out)):I.shrinkBuf(k.output,k.next_out))}while((k.avail_in>0||0===k.avail_out)&&m!==B);return l===D?(m=J.deflateEnd(this.strm),this.onEnd(m),this.ended=!0,m===C):!0},t.prototype.onData=function(c){this.chunks.push(c)},t.prototype.onEnd=function(c){c===C&&(this.result="string"===this.options.to?this.chunks.join(""):I.flattenChunks(this.chunks)),this.chunks=[],this.err=c,this.msg=this.strm.msg},N.Deflate=t,N.deflate=M,N.deflateRaw=L,N.gzip=K},{"./utils/common":27,"./utils/strings":28,"./zlib/deflate.js":32,"./zlib/messages":37,"./zlib/zstream":39}],26:[function(D,C,B){function A(e,d){var f=new n(d);if(f.push(e,!0),f.err){throw f.msg}return f.result}function v(d,c){return c=c||{},c.raw=!0,A(d,c)}var u=D("./zlib/inflate.js"),t=D("./utils/common"),s=D("./utils/strings"),r=D("./zlib/constants"),q=D("./zlib/messages"),p=D("./zlib/zstream"),o=D("./zlib/gzheader"),n=function(e){this.options=t.assign({chunkSize:16384,windowBits:0,to:""},e||{});var d=this.options;d.raw&&d.windowBits>=0&&d.windowBits<16&&(d.windowBits=-d.windowBits,0===d.windowBits&&(d.windowBits=-15)),!(d.windowBits>=0&&d.windowBits<16)||e&&e.windowBits||(d.windowBits+=32),d.windowBits>15&&d.windowBits<48&&0===(15&d.windowBits)&&(d.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var f=u.inflateInit2(this.strm,d.windowBits);if(f!==r.Z_OK){throw new Error(q[f])}this.header=new o,u.inflateGetHeader(this.strm,this.header)};n.prototype.push=function(I,H){var G,F,E,i,h,g=this.strm,f=this.options.chunkSize;if(this.ended){return !1}F=H===~~H?H:H===!0?r.Z_FINISH:r.Z_NO_FLUSH,g.input="string"==typeof I?s.binstring2buf(I):I,g.next_in=0,g.avail_in=g.input.length;do{if(0===g.avail_out&&(g.output=new t.Buf8(f),g.next_out=0,g.avail_out=f),G=u.inflate(g,r.Z_NO_FLUSH),G!==r.Z_STREAM_END&&G!==r.Z_OK){return this.onEnd(G),this.ended=!0,!1}g.next_out&&(0===g.avail_out||G===r.Z_STREAM_END||0===g.avail_in&&F===r.Z_FINISH)&&("string"===this.options.to?(E=s.utf8border(g.output,g.next_out),i=g.next_out-E,h=s.buf2string(g.output,E),g.next_out=i,g.avail_out=f-i,i&&t.arraySet(g.output,g.output,E,i,0),this.onData(h)):this.onData(t.shrinkBuf(g.output,g.next_out)))}while(g.avail_in>0&&G!==r.Z_STREAM_END);return G===r.Z_STREAM_END&&(F=r.Z_FINISH),F===r.Z_FINISH?(G=u.inflateEnd(this.strm),this.onEnd(G),this.ended=!0,G===r.Z_OK):!0},n.prototype.onData=function(c){this.chunks.push(c)},n.prototype.onEnd=function(c){c===r.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):t.flattenChunks(this.chunks)),this.chunks=[],this.err=c,this.msg=this.strm.msg},B.Inflate=n,B.inflate=A,B.inflateRaw=v,B.ungzip=A},{"./utils/common":27,"./utils/strings":28,"./zlib/constants":30,"./zlib/gzheader":33,"./zlib/inflate.js":35,"./zlib/messages":37,"./zlib/zstream":39}],27:[function(h,g,m){var l="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;m.assign=function(f){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var o=e.shift();if(o){if("object"!=typeof o){throw new TypeError(o+"must be non-object")}for(var n in o){o.hasOwnProperty(n)&&(f[n]=o[n])}}}return f},m.shrinkBuf=function(d,c){return d.length===c?d:d.subarray?d.subarray(0,c):(d.length=c,d)};var k={arraySet:function(o,n,s,r,q){if(n.subarray&&o.subarray){return void o.set(n.subarray(s,s+r),q)}for(var p=0;r>p;p++){o[q+p]=n[s+p]}},flattenChunks:function(o){var n,t,s,r,q,p;for(s=0,n=0,t=o.length;t>n;n++){s+=o[n].length}for(p=new Uint8Array(s),r=0,n=0,t=o.length;t>n;n++){q=o[n],p.set(q,r),r+=q.length}return p}},i={arraySet:function(o,n,s,r,q){for(var p=0;r>p;p++){o[q+p]=n[s+p]}},flattenChunks:function(c){return[].concat.apply([],c)}};m.setTyped=function(c){c?(m.Buf8=Uint8Array,m.Buf16=Uint16Array,m.Buf32=Int32Array,m.assign(m,k)):(m.Buf8=Array,m.Buf16=Array,m.Buf32=Array,m.assign(m,i))},m.setTyped(l)},{}],28:[function(t,s,r){function q(f,e){if(65537>e&&(f.subarray&&n||!f.subarray&&o)){return String.fromCharCode.apply(null,p.shrinkBuf(f,e))}for(var h="",g=0;e>g;g++){h+=String.fromCharCode(f[g])}return h}var p=t("./common"),o=!0,n=!0;try{String.fromCharCode.apply(null,[0])}catch(m){o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(m){n=!1}for(var l=new p.Buf8(256),k=0;256>k;k++){l[k]=k>=252?6:k>=248?5:k>=240?4:k>=224?3:k>=192?2:1}l[254]=l[254]=1,r.string2buf=function(u){var e,E,D,C,B,A=u.length,v=0;for(C=0;A>C;C++){E=u.charCodeAt(C),55296===(64512&E)&&A>C+1&&(D=u.charCodeAt(C+1),56320===(64512&D)&&(E=65536+(E-55296<<10)+(D-56320),C++)),v+=128>E?1:2048>E?2:65536>E?3:4}for(e=new p.Buf8(v),B=0,C=0;v>B;C++){E=u.charCodeAt(C),55296===(64512&E)&&A>C+1&&(D=u.charCodeAt(C+1),56320===(64512&D)&&(E=65536+(E-55296<<10)+(D-56320),C++)),128>E?e[B++]=E:2048>E?(e[B++]=192|E>>>6,e[B++]=128|63&E):65536>E?(e[B++]=224|E>>>12,e[B++]=128|E>>>6&63,e[B++]=128|63&E):(e[B++]=240|E>>>18,e[B++]=128|E>>>12&63,e[B++]=128|E>>>6&63,e[B++]=128|63&E)}return e},r.buf2binstring=function(c){return q(c,c.length)},r.binstring2buf=function(f){for(var e=new p.Buf8(f.length),h=0,g=e.length;g>h;h++){e[h]=f.charCodeAt(h)}return e},r.buf2string=function(i,d){var D,C,B,A,v=d||i.length,u=new Array(2*v);for(C=0,D=0;v>D;){if(B=i[D++],128>B){u[C++]=B}else{if(A=l[B],A>4){u[C++]=65533,D+=A-1}else{for(B&=2===A?31:3===A?15:7;A>1&&v>D;){B=B<<6|63&i[D++],A--}A>1?u[C++]=65533:65536>B?u[C++]=B:(B-=65536,u[C++]=55296|B>>10&1023,u[C++]=56320|1023&B)}}}return q(u,C)},r.utf8border=function(e,d){var f;for(d=d||e.length,d>e.length&&(d=e.length),f=d-1;f>=0&&128===(192&e[f]);){f--}return 0>f?d:0===f?d:f+l[e[f]]>d?f:d}},{"./common":27}],29:[function(e,d){function f(i,h,o,n){for(var m=65535&i|0,l=i>>>16&65535|0,k=0;0!==o;){k=o>2000?2000:o,o-=k;do{m=m+h[n++]|0,l=l+m|0}while(--k);m%=65521,l%=65521}return m|l<<16|0}d.exports=f},{}],30:[function(d,c){c.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(g,f){function k(){for(var l,e=[],n=0;256>n;n++){l=n;for(var m=0;8>m;m++){l=1&l?3988292384^l>>>1:l>>>1}e[n]=l}return e}function i(l,e,q,p){var o=h,n=p+q;l=-1^l;for(var m=p;n>m;m++){l=l>>>8^o[255&(l^e[m])]}return -1^l}var h=k();f.exports=i},{}],32:[function(aN,aM,aL){function aK(d,c){return d.msg=bc[c],c}function aI(c){return(c<<1)-(c>4?9:0)}function aH(d){for(var c=d.length;--c>=0;){d[c]=0}}function aG(e){var d=e.state,f=d.pending;f>e.avail_out&&(f=e.avail_out),0!==f&&(bh.arraySet(e.output,d.pending_buf,d.pending_out,f,e.next_out),e.next_out+=f,d.pending_out+=f,e.total_out+=f,e.avail_out-=f,d.pending-=f,0===d.pending&&(d.pending_out=0))}function aF(d,c){bg._tr_flush_block(d,d.block_start>=0?d.block_start:-1,d.strstart-d.block_start,c),d.block_start=d.strstart,aG(d.strm)}function aE(d,c){d.pending_buf[d.pending++]=c}function aC(d,c){d.pending_buf[d.pending++]=c>>>8&255,d.pending_buf[d.pending++]=255&c}function aB(g,f,k,i){var h=g.avail_in;return h>i&&(h=i),0===h?0:(g.avail_in-=h,bh.arraySet(f,g.input,g.next_in,h,k),1===g.state.wrap?g.adler=bf(g.adler,f,h,k):2===g.state.wrap&&(g.adler=bd(g.adler,f,h,k)),g.next_in+=h,g.total_in+=h,h)}function aA(H,G){var F,E,D=H.max_chain_length,C=H.strstart,B=H.prev_length,A=H.nice_match,v=H.strstart>H.w_size-ah?H.strstart-(H.w_size-ah):0,u=H.window,t=H.w_mask,s=H.prev,r=H.strstart+aD,q=u[C+B-1],p=u[C+B];H.prev_length>=H.good_match&&(D>>=2),A>H.lookahead&&(A=H.lookahead);do{if(F=G,u[F+B]===p&&u[F+B-1]===q&&u[F]===u[C]&&u[++F]===u[C+1]){C+=2,F++;do{}while(u[++C]===u[++F]&&u[++C]===u[++F]&&u[++C]===u[++F]&&u[++C]===u[++F]&&u[++C]===u[++F]&&u[++C]===u[++F]&&u[++C]===u[++F]&&u[++C]===u[++F]&&r>C);if(E=aD-(r-C),C=r-aD,E>B){if(H.match_start=G,B=E,E>=A){break}q=u[C+B-1],p=u[C+B]}}}while((G=s[G&t])>v&&0!==--D);return B<=H.lookahead?B:H.lookahead}function az(i){var h,o,n,m,l,k=i.w_size;do{if(m=i.window_size-i.lookahead-i.strstart,i.strstart>=k+(k-ah)){bh.arraySet(i.window,i.window,k,k,0),i.match_start-=k,i.strstart-=k,i.block_start-=k,o=i.hash_size,h=o;do{n=i.head[--h],i.head[h]=n>=k?n-k:0}while(--o);o=k,h=o;do{n=i.prev[--h],i.prev[h]=n>=k?n-k:0}while(--o);m+=k}if(0===i.strm.avail_in){break}if(o=aB(i.strm,i.window,i.strstart+i.lookahead,m),i.lookahead+=o,i.lookahead+i.insert>=a7){for(l=i.strstart-i.insert,i.ins_h=i.window[l],i.ins_h=(i.ins_h<<i.hash_shift^i.window[l+1])&i.hash_mask;i.insert&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[l+a7-1])&i.hash_mask,i.prev[l&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=l,l++,i.insert--,!(i.lookahead+i.insert<a7));){}}}while(i.lookahead<ah&&0!==i.strm.avail_in)}function ay(f,e){var h=65535;for(h>f.pending_buf_size-5&&(h=f.pending_buf_size-5);;){if(f.lookahead<=1){if(az(f),0===f.lookahead&&e===ba){return bp}if(0===f.lookahead){break}}f.strstart+=f.lookahead,f.lookahead=0;var g=f.block_start+h;if((0===f.strstart||f.strstart>=g)&&(f.lookahead=f.strstart-g,f.strstart=g,aF(f,!1),0===f.strm.avail_out)){return bp}if(f.strstart-f.block_start>=f.w_size-ah&&(aF(f,!1),0===f.strm.avail_out)){return bp}}return f.insert=0,e===a6?(aF(f,!0),0===f.strm.avail_out?aO:aj):f.strstart>f.block_start&&(aF(f,!1),0===f.strm.avail_out)?bp:bp}function aw(f,e){for(var h,g;;){if(f.lookahead<ah){if(az(f),f.lookahead<ah&&e===ba){return bp}if(0===f.lookahead){break}}if(h=0,f.lookahead>=a7&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+a7-1])&f.hash_mask,h=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),0!==h&&f.strstart-h<=f.w_size-ah&&(f.match_length=aA(f,h)),f.match_length>=a7){if(g=bg._tr_tally(f,f.strstart-f.match_start,f.match_length-a7),f.lookahead-=f.match_length,f.match_length<=f.max_lazy_match&&f.lookahead>=a7){f.match_length--;do{f.strstart++,f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+a7-1])&f.hash_mask,h=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart}while(0!==--f.match_length);f.strstart++}else{f.strstart+=f.match_length,f.match_length=0,f.ins_h=f.window[f.strstart],f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+1])&f.hash_mask}}else{g=bg._tr_tally(f,0,f.window[f.strstart]),f.lookahead--,f.strstart++}if(g&&(aF(f,!1),0===f.strm.avail_out)){return bp}}return f.insert=f.strstart<a7-1?f.strstart:a7-1,e===a6?(aF(f,!0),0===f.strm.avail_out?aO:aj):f.last_lit&&(aF(f,!1),0===f.strm.avail_out)?bp:bj}function av(g,f){for(var k,i,h;;){if(g.lookahead<ah){if(az(g),g.lookahead<ah&&f===ba){return bp}if(0===g.lookahead){break}}if(k=0,g.lookahead>=a7&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+a7-1])&g.hash_mask,k=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),g.prev_length=g.match_length,g.prev_match=g.match_start,g.match_length=a7-1,0!==k&&g.prev_length<g.max_lazy_match&&g.strstart-k<=g.w_size-ah&&(g.match_length=aA(g,k),g.match_length<=5&&(g.strategy===aX||g.match_length===a7&&g.strstart-g.match_start>4096)&&(g.match_length=a7-1)),g.prev_length>=a7&&g.match_length<=g.prev_length){h=g.strstart+g.lookahead-a7,i=bg._tr_tally(g,g.strstart-1-g.prev_match,g.prev_length-a7),g.lookahead-=g.prev_length-1,g.prev_length-=2;do{++g.strstart<=h&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+a7-1])&g.hash_mask,k=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart)}while(0!==--g.prev_length);if(g.match_available=0,g.match_length=a7-1,g.strstart++,i&&(aF(g,!1),0===g.strm.avail_out)){return bp}}else{if(g.match_available){if(i=bg._tr_tally(g,0,g.window[g.strstart-1]),i&&aF(g,!1),g.strstart++,g.lookahead--,0===g.strm.avail_out){return bp}}else{g.match_available=1,g.strstart++,g.lookahead--}}}return g.match_available&&(i=bg._tr_tally(g,0,g.window[g.strstart-1]),g.match_available=0),g.insert=g.strstart<a7-1?g.strstart:a7-1,f===a6?(aF(g,!0),0===g.strm.avail_out?aO:aj):g.last_lit&&(aF(g,!1),0===g.strm.avail_out)?bp:bj}function au(i,h){for(var o,n,m,l,k=i.window;;){if(i.lookahead<=aD){if(az(i),i.lookahead<=aD&&h===ba){return bp}if(0===i.lookahead){break}}if(i.match_length=0,i.lookahead>=a7&&i.strstart>0&&(m=i.strstart-1,n=k[m],n===k[++m]&&n===k[++m]&&n===k[++m])){l=i.strstart+aD;do{}while(n===k[++m]&&n===k[++m]&&n===k[++m]&&n===k[++m]&&n===k[++m]&&n===k[++m]&&n===k[++m]&&n===k[++m]&&l>m);i.match_length=aD-(l-m),i.match_length>i.lookahead&&(i.match_length=i.lookahead)}if(i.match_length>=a7?(o=bg._tr_tally(i,1,i.match_length-a7),i.lookahead-=i.match_length,i.strstart+=i.match_length,i.match_length=0):(o=bg._tr_tally(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++),o&&(aF(i,!1),0===i.strm.avail_out)){return bp}}return i.insert=0,h===a6?(aF(i,!0),0===i.strm.avail_out?aO:aj):i.last_lit&&(aF(i,!1),0===i.strm.avail_out)?bp:bj}function at(e,d){for(var f;;){if(0===e.lookahead&&(az(e),0===e.lookahead)){if(d===ba){return bp}break}if(e.match_length=0,f=bg._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,f&&(aF(e,!1),0===e.strm.avail_out)){return bp}}return e.insert=0,d===a6?(aF(e,!0),0===e.strm.avail_out?aO:aj):e.last_lit&&(aF(e,!1),0===e.strm.avail_out)?bp:bj}function ar(c){c.window_size=2*c.w_size,aH(c.head),c.max_lazy_match=bi[c.level].max_lazy,c.good_match=bi[c.level].good_length,c.nice_match=bi[c.level].nice_length,c.max_chain_length=bi[c.level].max_chain,c.strstart=0,c.block_start=0,c.lookahead=0,c.insert=0,c.match_length=c.prev_length=a7-1,c.match_available=0,c.ins_h=0}function aq(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=aR,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new bh.Buf16(2*bq),this.dyn_dtree=new bh.Buf16(2*(2*ag+1)),this.bl_tree=new bh.Buf16(2*(2*ac+1)),aH(this.dyn_ltree),aH(this.dyn_dtree),aH(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new bh.Buf16(bm+1),this.heap=new bh.Buf16(2*ax+1),aH(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new bh.Buf16(2*ax+1),aH(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ap(d){var c;return d&&d.state?(d.total_in=d.total_out=0,d.data_type=aS,c=d.state,c.pending=0,c.pending_out=0,c.wrap<0&&(c.wrap=-c.wrap),c.status=c.wrap?br:ae,d.adler=2===c.wrap?0:1,c.last_flush=ba,bg._tr_init(c),a4):aK(d,a2)}function ao(d){var c=ap(d);return c===a4&&ar(d.state),c}function an(d,c){return d&&d.state?2!==d.state.wrap?a2:(d.state.gzhead=c,a4):a2}function am(k,d,q,p,o,n){if(!k){return a2}var m=1;if(d===aY&&(d=6),0>p?(m=0,p=-p):p>15&&(m=2,p-=16),1>o||o>aQ||q!==aR||8>p||p>15||0>d||d>9||0>n||n>aU){return aK(k,a2)}8===p&&(p=9);var l=new aq;return k.state=l,l.strm=k,l.wrap=m,l.gzhead=null,l.w_bits=p,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+a7-1)/a7),l.window=new bh.Buf8(2*l.w_size),l.head=new bh.Buf16(l.hash_size),l.prev=new bh.Buf16(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new bh.Buf8(l.pending_buf_size),l.d_buf=l.lit_bufsize>>1,l.l_buf=3*l.lit_bufsize,l.level=d,l.strategy=n,l.method=q,ao(k)}function al(d,c){return am(d,c,aR,bo,aP,aT)}function ak(s,r){var q,p,i,g;if(!s||!s.state||r>a5||0>r){return s?aK(s,a2):a2}if(p=s.state,!s.output||!s.input&&0!==s.avail_in||p.status===bs&&r!==a6){return aK(s,0===s.avail_out?aZ:a2)}if(p.strm=s,q=p.last_flush,p.last_flush=r,p.status===br){if(2===p.wrap){s.adler=0,aE(p,31),aE(p,139),aE(p,8),p.gzhead?(aE(p,(p.gzhead.text?1:0)+(p.gzhead.hcrc?2:0)+(p.gzhead.extra?4:0)+(p.gzhead.name?8:0)+(p.gzhead.comment?16:0)),aE(p,255&p.gzhead.time),aE(p,p.gzhead.time>>8&255),aE(p,p.gzhead.time>>16&255),aE(p,p.gzhead.time>>24&255),aE(p,9===p.level?2:p.strategy>=aW||p.level<2?4:0),aE(p,255&p.gzhead.os),p.gzhead.extra&&p.gzhead.extra.length&&(aE(p,255&p.gzhead.extra.length),aE(p,p.gzhead.extra.length>>8&255)),p.gzhead.hcrc&&(s.adler=bd(s.adler,p.pending_buf,p.pending,0)),p.gzindex=0,p.status=bn):(aE(p,0),aE(p,0),aE(p,0),aE(p,0),aE(p,0),aE(p,9===p.level?2:p.strategy>=aW||p.level<2?4:0),aE(p,af),p.status=ae)}else{var f=aR+(p.w_bits-8<<4)<<8,e=-1;e=p.strategy>=aW||p.level<2?0:p.level<6?1:6===p.level?2:3,f|=e<<6,0!==p.strstart&&(f|=ad),f+=31-f%31,p.status=ae,aC(p,f),0!==p.strstart&&(aC(p,s.adler>>>16),aC(p,65535&s.adler)),s.adler=1}}if(p.status===bn){if(p.gzhead.extra){for(i=p.pending;p.gzindex<(65535&p.gzhead.extra.length)&&(p.pending!==p.pending_buf_size||(p.gzhead.hcrc&&p.pending>i&&(s.adler=bd(s.adler,p.pending_buf,p.pending-i,i)),aG(s),i=p.pending,p.pending!==p.pending_buf_size));){aE(p,255&p.gzhead.extra[p.gzindex]),p.gzindex++}p.gzhead.hcrc&&p.pending>i&&(s.adler=bd(s.adler,p.pending_buf,p.pending-i,i)),p.gzindex===p.gzhead.extra.length&&(p.gzindex=0,p.status=be)}else{p.status=be}}if(p.status===be){if(p.gzhead.name){i=p.pending;do{if(p.pending===p.pending_buf_size&&(p.gzhead.hcrc&&p.pending>i&&(s.adler=bd(s.adler,p.pending_buf,p.pending-i,i)),aG(s),i=p.pending,p.pending===p.pending_buf_size)){g=1;break}g=p.gzindex<p.gzhead.name.length?255&p.gzhead.name.charCodeAt(p.gzindex++):0,aE(p,g)}while(0!==g);p.gzhead.hcrc&&p.pending>i&&(s.adler=bd(s.adler,p.pending_buf,p.pending-i,i)),0===g&&(p.gzindex=0,p.status=aJ)}else{p.status=aJ}}if(p.status===aJ){if(p.gzhead.comment){i=p.pending;do{if(p.pending===p.pending_buf_size&&(p.gzhead.hcrc&&p.pending>i&&(s.adler=bd(s.adler,p.pending_buf,p.pending-i,i)),aG(s),i=p.pending,p.pending===p.pending_buf_size)){g=1;break}g=p.gzindex<p.gzhead.comment.length?255&p.gzhead.comment.charCodeAt(p.gzindex++):0,aE(p,g)}while(0!==g);p.gzhead.hcrc&&p.pending>i&&(s.adler=bd(s.adler,p.pending_buf,p.pending-i,i)),0===g&&(p.status=ai)}else{p.status=ai}}if(p.status===ai&&(p.gzhead.hcrc?(p.pending+2>p.pending_buf_size&&aG(s),p.pending+2<=p.pending_buf_size&&(aE(p,255&s.adler),aE(p,s.adler>>8&255),s.adler=0,p.status=ae)):p.status=ae),0!==p.pending){if(aG(s),0===s.avail_out){return p.last_flush=-1,a4}}else{if(0===s.avail_in&&aI(r)<=aI(q)&&r!==a6){return aK(s,aZ)}}if(p.status===bs&&0!==s.avail_in){return aK(s,aZ)}if(0!==s.avail_in||0!==p.lookahead||r!==ba&&p.status!==bs){var d=p.strategy===aW?at(p,r):p.strategy===aV?au(p,r):bi[p.level].func(p,r);if((d===aO||d===aj)&&(p.status=bs),d===bp||d===aO){return 0===s.avail_out&&(p.last_flush=-1),a4}if(d===bj&&(r===a9?bg._tr_align(p):r!==a5&&(bg._tr_stored_block(p,0,0,!1),r===a8&&(aH(p.head),0===p.lookahead&&(p.strstart=0,p.block_start=0,p.insert=0))),aG(s),0===s.avail_out)){return p.last_flush=-1,a4}}return r!==a6?a4:p.wrap<=0?a3:(2===p.wrap?(aE(p,255&s.adler),aE(p,s.adler>>8&255),aE(p,s.adler>>16&255),aE(p,s.adler>>24&255),aE(p,255&s.total_in),aE(p,s.total_in>>8&255),aE(p,s.total_in>>16&255),aE(p,s.total_in>>24&255)):(aC(p,s.adler>>>16),aC(p,65535&s.adler)),aG(s),p.wrap>0&&(p.wrap=-p.wrap),0!==p.pending?a4:a3)}function bk(d){var c;return d&&d.state?(c=d.state.status,c!==br&&c!==bn&&c!==be&&c!==aJ&&c!==ai&&c!==ae&&c!==bs?aK(d,a2):(d.state=null,c===ae?aK(d,a1):a4)):a2}var bi,bh=aN("../utils/common"),bg=aN("./trees"),bf=aN("./adler32"),bd=aN("./crc32"),bc=aN("./messages"),ba=0,a9=1,a8=3,a6=4,a5=5,a4=0,a3=1,a2=-2,a1=-3,aZ=-5,aY=-1,aX=1,aW=2,aV=3,aU=4,aT=0,aS=2,aR=8,aQ=9,bo=15,aP=8,bl=29,a0=256,ax=a0+1+bl,ag=30,ac=19,bq=2*ax+1,bm=15,a7=3,aD=258,ah=aD+a7+1,ad=32,br=42,bn=69,be=73,aJ=91,ai=103,ae=113,bs=666,bp=1,bj=2,aO=3,aj=4,af=3,aa=function(g,f,k,i,h){this.good_length=g,this.max_lazy=f,this.nice_length=k,this.max_chain=i,this.func=h};bi=[new aa(0,0,0,0,ay),new aa(4,4,8,4,aw),new aa(4,5,16,8,aw),new aa(4,6,32,32,aw),new aa(4,4,16,16,av),new aa(8,16,32,32,av),new aa(8,16,128,128,av),new aa(8,32,128,256,av),new aa(32,128,258,1024,av),new aa(32,258,258,4096,av)],aL.deflateInit=al,aL.deflateInit2=am,aL.deflateReset=ao,aL.deflateResetKeep=ap,aL.deflateSetHeader=an,aL.deflate=ak,aL.deflateEnd=bk,aL.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./messages":37,"./trees":38}],33:[function(e,d){function f(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}d.exports=f},{}],34:[function(f,e){var h=30,g=12;e.exports=function(ab,aa){var Z,Y,X,W,V,U,T,S,R,Q,P,O,M,K,I,H,G,F,E,D,d,c,N,L,J;Z=ab.state,Y=ab.next_in,L=ab.input,X=Y+(ab.avail_in-5),W=ab.next_out,J=ab.output,V=W-(aa-ab.avail_out),U=W+(ab.avail_out-257),T=Z.dmax,S=Z.wsize,R=Z.whave,Q=Z.wnext,P=Z.window,O=Z.hold,M=Z.bits,K=Z.lencode,I=Z.distcode,H=(1<<Z.lenbits)-1,G=(1<<Z.distbits)-1;ab:do{15>M&&(O+=L[Y++]<<M,M+=8,O+=L[Y++]<<M,M+=8),F=K[O&H];aa:for(;;){if(E=F>>>24,O>>>=E,M-=E,E=F>>>16&255,0===E){J[W++]=65535&F}else{if(!(16&E)){if(0===(64&E)){F=K[(65535&F)+(O&(1<<E)-1)];continue aa}if(32&E){Z.mode=g;break ab}ab.msg="invalid literal/length code",Z.mode=h;break ab}D=65535&F,E&=15,E&&(E>M&&(O+=L[Y++]<<M,M+=8),D+=O&(1<<E)-1,O>>>=E,M-=E),15>M&&(O+=L[Y++]<<M,M+=8,O+=L[Y++]<<M,M+=8),F=I[O&G];h:for(;;){if(E=F>>>24,O>>>=E,M-=E,E=F>>>16&255,!(16&E)){if(0===(64&E)){F=I[(65535&F)+(O&(1<<E)-1)];continue h}ab.msg="invalid distance code",Z.mode=h;break ab}if(d=65535&F,E&=15,E>M&&(O+=L[Y++]<<M,M+=8,E>M&&(O+=L[Y++]<<M,M+=8)),d+=O&(1<<E)-1,d>T){ab.msg="invalid distance too far back",Z.mode=h;break ab}if(O>>>=E,M-=E,E=W-V,d>E){if(E=d-E,E>R&&Z.sane){ab.msg="invalid distance too far back",Z.mode=h;break ab}if(c=0,N=P,0===Q){if(c+=S-E,D>E){D-=E;do{J[W++]=P[c++]}while(--E);c=W-d,N=J}}else{if(E>Q){if(c+=S+Q-E,E-=Q,D>E){D-=E;do{J[W++]=P[c++]}while(--E);if(c=0,D>Q){E=Q,D-=E;do{J[W++]=P[c++]}while(--E);c=W-d,N=J}}}else{if(c+=Q-E,D>E){D-=E;do{J[W++]=P[c++]}while(--E);c=W-d,N=J}}}for(;D>2;){J[W++]=N[c++],J[W++]=N[c++],J[W++]=N[c++],D-=3}D&&(J[W++]=N[c++],D>1&&(J[W++]=N[c++]))}else{c=W-d;do{J[W++]=J[c++],J[W++]=J[c++],J[W++]=J[c++],D-=3}while(D>2);D&&(J[W++]=J[c++],D>1&&(J[W++]=J[c++]))}break}}break}}while(X>Y&&U>W);D=M>>3,Y-=D,M-=D<<3,O&=(1<<M)-1,ab.next_in=Y,ab.next_out=W,ab.avail_in=X>Y?5+(X-Y):5-(Y-X),ab.avail_out=U>W?257+(U-W):257-(W-U),Z.hold=O,Z.bits=M}},{}],35:[function(aK,aJ,aI){function aH(c){return(c>>>24&255)+(c>>>8&65280)+((65280&c)<<8)+((255&c)<<24)}function aF(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new ap.Buf16(320),this.work=new ap.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function aE(d){var c;return d&&d.state?(c=d.state,d.total_in=d.total_out=c.total=0,d.msg="",c.wrap&&(d.adler=1&c.wrap),c.mode=a2,c.last=0,c.havedict=0,c.dmax=32768,c.head=null,c.hold=0,c.bits=0,c.lencode=c.lendyn=new ap.Buf32(aG),c.distcode=c.distdyn=new ap.Buf32(ag),c.sane=1,c.back=-1,bd):a8}function aD(d){var c;return d&&d.state?(c=d.state,c.wsize=0,c.whave=0,c.wnext=0,aE(d)):a8}function aC(f,e){var h,g;return f&&f.state?(g=f.state,0>e?(h=0,e=-e):(h=(e>>4)+1,48>e&&(e&=15)),e&&(8>e||e>15)?a8:(null!==g.window&&g.wbits!==e&&(g.window=null),g.wrap=h,g.wbits=e,aD(f))):a8}function aB(f,e){var h,g;return f?(g=new aF,f.state=g,g.window=null,h=aC(f,e),h!==bd&&(f.state=null),h):a8}function az(c){return aB(c,bn)}function ay(d){if(bk){var c;for(ar=new ap.Buf32(512),aq=new ap.Buf32(32),c=0;144>c;){d.lens[c++]=8}for(;256>c;){d.lens[c++]=9}for(;280>c;){d.lens[c++]=7}for(;288>c;){d.lens[c++]=8}for(al(aj,d.lens,0,288,ar,0,d.work,{bits:9}),c=0;32>c;){d.lens[c++]=5}al(ai,d.lens,0,32,aq,0,d.work,{bits:5}),bk=!1}d.lencode=ar,d.lenbits=9,d.distcode=aq,d.distbits=5}function ax(h,g,m,l){var k,i=h.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new ap.Buf8(i.wsize)),l>=i.wsize?(ap.arraySet(i.window,g,m-i.wsize,i.wsize,0),i.wnext=0,i.whave=i.wsize):(k=i.wsize-i.wnext,k>l&&(k=l),ap.arraySet(i.window,g,m-l,k,i.wnext),l-=k,l?(ap.arraySet(i.window,g,m-l,l,0),i.wnext=l,i.whave=i.wsize):(i.wnext+=k,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=k))),0}function aw(U,T){var S,R,Q,P,O,N,L,G,F,E,D,C,H,k,u,J,l,v,K,r,A,M,s,B,d=0,t=new ap.Buf8(4),I=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!U||!U.state||!U.output||!U.input&&0!==U.avail_in){return a8}S=U.state,S.mode===aQ&&(S.mode=aP),O=U.next_out,Q=U.output,L=U.avail_out,P=U.next_in,R=U.input,N=U.avail_in,G=S.hold,F=S.bits,E=N,D=L,M=bd;U:for(;;){switch(S.mode){case a2:if(0===S.wrap){S.mode=aP;break}for(;16>F;){if(0===N){break U}N--,G+=R[P++]<<F,F+=8}if(2&S.wrap&&35615===G){S.check=0,t[0]=255&G,t[1]=G>>>8&255,S.check=an(S.check,t,2,0),G=0,F=0,S.mode=a1;break}if(S.flags=0,S.head&&(S.head.done=!1),!(1&S.wrap)||(((255&G)<<8)+(G>>8))%31){U.msg="incorrect header check",S.mode=bm;break}if((15&G)!==a4){U.msg="unknown compression method",S.mode=bm;break}if(G>>>=4,F-=4,A=(15&G)+8,0===S.wbits){S.wbits=A}else{if(A>S.wbits){U.msg="invalid window size",S.mode=bm;break}}S.dmax=1<<A,U.adler=S.check=1,S.mode=512&G?aS:aQ,G=0,F=0;break;case a1:for(;16>F;){if(0===N){break U}N--,G+=R[P++]<<F,F+=8}if(S.flags=G,(255&S.flags)!==a4){U.msg="unknown compression method",S.mode=bm;break}if(57344&S.flags){U.msg="unknown header flags set",S.mode=bm;break}S.head&&(S.head.text=G>>8&1),512&S.flags&&(t[0]=255&G,t[1]=G>>>8&255,S.check=an(S.check,t,2,0)),G=0,F=0,S.mode=a0;case a0:for(;32>F;){if(0===N){break U}N--,G+=R[P++]<<F,F+=8}S.head&&(S.head.time=G),512&S.flags&&(t[0]=255&G,t[1]=G>>>8&255,t[2]=G>>>16&255,t[3]=G>>>24&255,S.check=an(S.check,t,4,0)),G=0,F=0,S.mode=aZ;case aZ:for(;16>F;){if(0===N){break U}N--,G+=R[P++]<<F,F+=8}S.head&&(S.head.xflags=255&G,S.head.os=G>>8),512&S.flags&&(t[0]=255&G,t[1]=G>>>8&255,S.check=an(S.check,t,2,0)),G=0,F=0,S.mode=aY;case aY:if(1024&S.flags){for(;16>F;){if(0===N){break U}N--,G+=R[P++]<<F,F+=8}S.length=G,S.head&&(S.head.extra_len=G),512&S.flags&&(t[0]=255&G,t[1]=G>>>8&255,S.check=an(S.check,t,2,0)),G=0,F=0}else{S.head&&(S.head.extra=null)}S.mode=aX;case aX:if(1024&S.flags&&(C=S.length,C>N&&(C=N),C&&(S.head&&(A=S.head.extra_len-S.length,S.head.extra||(S.head.extra=new Array(S.head.extra_len)),ap.arraySet(S.head.extra,R,P,C,A)),512&S.flags&&(S.check=an(S.check,R,C,P)),N-=C,P+=C,S.length-=C),S.length)){break U}S.length=0,S.mode=aV;case aV:if(2048&S.flags){if(0===N){break U}C=0;do{A=R[P+C++],S.head&&A&&S.length<65536&&(S.head.name+=String.fromCharCode(A))}while(A&&N>C);if(512&S.flags&&(S.check=an(S.check,R,C,P)),N-=C,P+=C,A){break U}}else{S.head&&(S.head.name=null)}S.length=0,S.mode=aU;case aU:if(4096&S.flags){if(0===N){break U}C=0;do{A=R[P+C++],S.head&&A&&S.length<65536&&(S.head.comment+=String.fromCharCode(A))}while(A&&N>C);if(512&S.flags&&(S.check=an(S.check,R,C,P)),N-=C,P+=C,A){break U}}else{S.head&&(S.head.comment=null)}S.mode=aT;case aT:if(512&S.flags){for(;16>F;){if(0===N){break U}N--,G+=R[P++]<<F,F+=8}if(G!==(65535&S.check)){U.msg="header crc mismatch",S.mode=bm;break}G=0,F=0}S.head&&(S.head.hcrc=S.flags>>9&1,S.head.done=!0),U.adler=S.check=0,S.mode=aQ;break;case aS:for(;32>F;){if(0===N){break U}N--,G+=R[P++]<<F,F+=8}U.adler=S.check=aH(G),G=0,F=0,S.mode=aR;case aR:if(0===S.havedict){return U.next_out=O,U.avail_out=L,U.next_in=P,U.avail_in=N,S.hold=G,S.bits=F,ba}U.adler=S.check=1,S.mode=aQ;case aQ:if(T===bf||T===be){break U}case aP:if(S.last){G>>>=7&F,F-=7&F,S.mode=aA;break}for(;3>F;){if(0===N){break U}N--,G+=R[P++]<<F,F+=8}switch(S.last=1&G,G>>>=1,F-=1,3&G){case 0:S.mode=aO;break;case 1:if(ay(S),S.mode=aW,T===be){G>>>=2,F-=2;break U}break;case 2:S.mode=bj;break;case 3:U.msg="invalid block type",S.mode=bm}G>>>=2,F-=2;break;case aO:for(G>>>=7&F,F-=7&F;32>F;){if(0===N){break U}N--,G+=R[P++]<<F,F+=8}if((65535&G)!==(G>>>16^65535)){U.msg="invalid stored block lengths",S.mode=bm;break}if(S.length=65535&G,G=0,F=0,S.mode=aN,T===be){break U}case aN:S.mode=aM;case aM:if(C=S.length){if(C>N&&(C=N),C>L&&(C=L),0===C){break U}ap.arraySet(Q,R,P,C,O),N-=C,P+=C,L-=C,O+=C,S.length-=C;break}S.mode=aQ;break;case bj:for(;14>F;){if(0===N){break U}N--,G+=R[P++]<<F,F+=8}if(S.nlen=(31&G)+257,G>>>=5,F-=5,S.ndist=(31&G)+1,G>>>=5,F-=5,S.ncode=(15&G)+4,G>>>=4,F-=4,S.nlen>286||S.ndist>30){U.msg="too many length or distance symbols",S.mode=bm;break}S.have=0,S.mode=aL;case aL:for(;S.have<S.ncode;){for(;3>F;){if(0===N){break U}N--,G+=R[P++]<<F,F+=8}S.lens[I[S.have++]]=7&G,G>>>=3,F-=3}for(;S.have<19;){S.lens[I[S.have++]]=0}if(S.lencode=S.lendyn,S.lenbits=7,s={bits:S.lenbits},M=al(ak,S.lens,0,19,S.lencode,0,S.work,s),S.lenbits=s.bits,M){U.msg="invalid code lengths set",S.mode=bm;break}S.have=0,S.mode=bg;case bg:for(;S.have<S.nlen+S.ndist;){for(;d=S.lencode[G&(1<<S.lenbits)-1],u=d>>>24,J=d>>>16&255,l=65535&d,!(F>=u);){if(0===N){break U}N--,G+=R[P++]<<F,F+=8}if(16>l){G>>>=u,F-=u,S.lens[S.have++]=l}else{if(16===l){for(B=u+2;B>F;){if(0===N){break U}N--,G+=R[P++]<<F,F+=8}if(G>>>=u,F-=u,0===S.have){U.msg="invalid bit length repeat",S.mode=bm;break}A=S.lens[S.have-1],C=3+(3&G),G>>>=2,F-=2}else{if(17===l){for(B=u+3;B>F;){if(0===N){break U}N--,G+=R[P++]<<F,F+=8}G>>>=u,F-=u,A=0,C=3+(7&G),G>>>=3,F-=3}else{for(B=u+7;B>F;){if(0===N){break U}N--,G+=R[P++]<<F,F+=8}G>>>=u,F-=u,A=0,C=11+(127&G),G>>>=7,F-=7}}if(S.have+C>S.nlen+S.ndist){U.msg="invalid bit length repeat",S.mode=bm;break}for(;C--;){S.lens[S.have++]=A}}}if(S.mode===bm){break}if(0===S.lens[256]){U.msg="invalid code -- missing end-of-block",S.mode=bm;break}if(S.lenbits=9,s={bits:S.lenbits},M=al(aj,S.lens,0,S.nlen,S.lencode,0,S.work,s),S.lenbits=s.bits,M){U.msg="invalid literal/lengths set",S.mode=bm;break}if(S.distbits=6,S.distcode=S.distdyn,s={bits:S.distbits},M=al(ai,S.lens,S.nlen,S.ndist,S.distcode,0,S.work,s),S.distbits=s.bits,M){U.msg="invalid distances set",S.mode=bm;break}if(S.mode=aW,T===be){break U}case aW:S.mode=au;case au:if(N>=6&&L>=258){U.next_out=O,U.avail_out=L,U.next_in=P,U.avail_in=N,S.hold=G,S.bits=F,am(U,D),O=U.next_out,Q=U.output,L=U.avail_out,P=U.next_in,R=U.input,N=U.avail_in,G=S.hold,F=S.bits,S.mode===aQ&&(S.back=-1);break}for(S.back=0;d=S.lencode[G&(1<<S.lenbits)-1],u=d>>>24,J=d>>>16&255,l=65535&d,!(F>=u);){if(0===N){break U}N--,G+=R[P++]<<F,F+=8}if(J&&0===(240&J)){for(v=u,K=J,r=l;d=S.lencode[r+((G&(1<<v+K)-1)>>v)],u=d>>>24,J=d>>>16&255,l=65535&d,!(F>=v+u);){if(0===N){break U}N--,G+=R[P++]<<F,F+=8}G>>>=v,F-=v,S.back+=v}if(G>>>=u,F-=u,S.back+=u,S.length=l,0===J){S.mode=a3;break}if(32&J){S.back=-1,S.mode=aQ;break}if(64&J){U.msg="invalid literal/length code",S.mode=bm;break}S.extra=15&J,S.mode=ae;case ae:if(S.extra){for(B=S.extra;B>F;){if(0===N){break U}N--,G+=R[P++]<<F,F+=8}S.length+=G&(1<<S.extra)-1,G>>>=S.extra,F-=S.extra,S.back+=S.extra}S.was=S.length,S.mode=aa;case aa:for(;d=S.distcode[G&(1<<S.distbits)-1],u=d>>>24,J=d>>>16&255,l=65535&d,!(F>=u);){if(0===N){break U}N--,G+=R[P++]<<F,F+=8}if(0===(240&J)){for(v=u,K=J,r=l;d=S.distcode[r+((G&(1<<v+K)-1)>>v)],u=d>>>24,J=d>>>16&255,l=65535&d,!(F>=v+u);){if(0===N){break U}N--,G+=R[P++]<<F,F+=8}G>>>=v,F-=v,S.back+=v}if(G>>>=u,F-=u,S.back+=u,64&J){U.msg="invalid distance code",S.mode=bm;break}S.offset=l,S.extra=15&J,S.mode=bl;case bl:if(S.extra){for(B=S.extra;B>F;){if(0===N){break U}N--,G+=R[P++]<<F,F+=8}S.offset+=G&(1<<S.extra)-1,G>>>=S.extra,F-=S.extra,S.back+=S.extra}if(S.offset>S.dmax){U.msg="invalid distance too far back",S.mode=bm;break}S.mode=bh;case bh:if(0===L){break U}if(C=D-L,S.offset>C){if(C=S.offset-C,C>S.whave&&S.sane){U.msg="invalid distance too far back",S.mode=bm;break}C>S.wnext?(C-=S.wnext,H=S.wsize-C):H=S.wnext-C,C>S.length&&(C=S.length),k=S.window}else{k=Q,H=O-S.offset,C=S.length}C>L&&(C=L),L-=C,S.length-=C;do{Q[O++]=k[H++]}while(--C);0===S.length&&(S.mode=au);break;case a3:if(0===L){break U}Q[O++]=S.length,L--,S.mode=au;break;case aA:if(S.wrap){for(;32>F;){if(0===N){break U}N--,G|=R[P++]<<F,F+=8}if(D-=L,U.total_out+=D,S.total+=D,D&&(U.adler=S.check=S.flags?an(S.check,Q,D,O-D):ao(S.check,Q,D,O-D)),D=L,(S.flags?G:aH(G))!==S.check){U.msg="incorrect data check",S.mode=bm;break}G=0,F=0}S.mode=af;case af:if(S.wrap&&S.flags){for(;32>F;){if(0===N){break U}N--,G+=R[P++]<<F,F+=8}if(G!==(4294967295&S.total)){U.msg="incorrect length check",S.mode=bm;break}G=0,F=0}S.mode=ac;case ac:M=bc;break U;case bm:M=a7;break U;case bi:return a6;case a9:default:return a8}}return U.next_out=O,U.avail_out=L,U.next_in=P,U.avail_in=N,S.hold=G,S.bits=F,(S.wsize||D!==U.avail_out&&S.mode<bm&&(S.mode<aA||T!==ah))&&ax(U,U.output,U.next_out,D-U.avail_out)?(S.mode=bi,a6):(E-=U.avail_in,D-=U.avail_out,U.total_in+=E,U.total_out+=D,S.total+=D,S.wrap&&D&&(U.adler=S.check=S.flags?an(S.check,Q,D,U.next_out-D):ao(S.check,Q,D,U.next_out-D)),U.data_type=S.bits+(S.last?64:0)+(S.mode===aQ?128:0)+(S.mode===aW||S.mode===aN?256:0),(0===E&&0===D||T===ah)&&M===bd&&(M=a5),M)}function av(d){if(!d||!d.state){return a8}var c=d.state;return c.window&&(c.window=null),d.state=null,bd}function at(e,d){var f;return e&&e.state?(f=e.state,0===(2&f.wrap)?a8:(f.head=d,d.done=!1,bd)):a8}var ar,aq,ap=aK("../utils/common"),ao=aK("./adler32"),an=aK("./crc32"),am=aK("./inffast"),al=aK("./inftrees"),ak=0,aj=1,ai=2,ah=4,bf=5,be=6,bd=0,bc=1,ba=2,a8=-2,a7=-3,a6=-4,a5=-5,a4=8,a2=1,a1=2,a0=3,aZ=4,aY=5,aX=6,aV=7,aU=8,aT=9,aS=10,aR=11,aQ=12,aP=13,aO=14,aN=15,aM=16,bj=17,aL=18,bg=19,aW=20,au=21,ae=22,aa=23,bl=24,bh=25,a3=26,aA=27,af=28,ac=29,bm=30,bi=31,a9=32,aG=852,ag=592,ad=15,bn=ad,bk=!0;aI.inflateReset=aD,aI.inflateReset2=aC,aI.inflateResetKeep=aE,aI.inflateInit=az,aI.inflateInit2=aB,aI.inflate=aw,aI.inflateEnd=av,aI.inflateGetHeader=at,aI.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./inffast":34,"./inftrees":36}],36:[function(D,C){var B=D("../utils/common"),A=15,v=852,u=592,t=0,s=1,r=2,q=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],p=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],n=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];C.exports=function(at,ar,aq,ap,ao,am,ak,ai){var ag,ae,ac,aa,Y,W,U,an,al,aj=ai.bits,ah=0,af=0,ad=0,ab=0,Z=0,X=0,V=0,m=0,l=0,k=0,i=null,h=0,g=new B.Buf16(A+1),f=new B.Buf16(A+1),e=null,d=0;for(ah=0;A>=ah;ah++){g[ah]=0}for(af=0;ap>af;af++){g[ar[aq+af]]++}for(Z=aj,ab=A;ab>=1&&0===g[ab];ab--){}if(Z>ab&&(Z=ab),0===ab){return ao[am++]=20971520,ao[am++]=20971520,ai.bits=1,0}for(ad=1;ab>ad&&0===g[ad];ad++){}for(ad>Z&&(Z=ad),m=1,ah=1;A>=ah;ah++){if(m<<=1,m-=g[ah],0>m){return -1}}if(m>0&&(at===t||1!==ab)){return -1}for(f[1]=0,ah=1;A>ah;ah++){f[ah+1]=f[ah]+g[ah]}for(af=0;ap>af;af++){0!==ar[aq+af]&&(ak[f[ar[aq+af]]++]=af)}if(at===t?(i=e=ak,W=19):at===s?(i=q,h-=257,e=p,d-=257,W=256):(i=o,e=n,W=-1),k=0,af=0,ah=ad,Y=am,X=Z,V=0,ac=-1,l=1<<Z,aa=l-1,at===s&&l>v||at===r&&l>u){return 1}for(var c=0;;){c++,U=ah-V,ak[af]<W?(an=0,al=ak[af]):ak[af]>W?(an=e[d+ak[af]],al=i[h+ak[af]]):(an=96,al=0),ag=1<<ah-V,ae=1<<X,ad=ae;do{ae-=ag,ao[Y+(k>>V)+ae]=U<<24|an<<16|al|0}while(0!==ae);for(ag=1<<ah-1;k&ag;){ag>>=1}if(0!==ag?(k&=ag-1,k+=ag):k=0,af++,0===--g[ah]){if(ah===ab){break}ah=ar[aq+ak[af]]}if(ah>Z&&(k&aa)!==ac){for(0===V&&(V=Z),Y+=ad,X=ah-V,m=1<<X;ab>X+V&&(m-=g[X+V],!(0>=m));){X++,m<<=1}if(l+=1<<X,at===s&&l>v||at===r&&l>u){return 1}ac=k&aa,ao[ac]=Z<<24|X<<16|Y-am|0}}return 0!==k&&(ao[Y+k]=ah-V<<24|64<<16|0),ai.bits=Z,0}},{"../utils/common":27}],37:[function(d,c){c.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],38:[function(bi,bh,bg){function bf(d){for(var c=d.length;--c>=0;){d[c]=0}}function be(c){return 256>c?aI[c]:aI[256+(c>>>7)]}function bd(d,c){d.pending_buf[d.pending++]=255&c,d.pending_buf[d.pending++]=c>>>8&255}function bc(e,d,f){e.bi_valid>aj-f?(e.bi_buf|=d<<e.bi_valid&65535,bd(e,e.bi_buf),e.bi_buf=d>>aj-e.bi_valid,e.bi_valid+=f-aj):(e.bi_buf|=d<<e.bi_valid&65535,e.bi_valid+=f)}function ba(e,d,f){bc(e,f[2*d],f[2*d+1])}function a9(e,d){var f=0;do{f|=1&e,e>>>=1,f<<=1}while(--d>0);return f>>>1}function a8(c){16===c.bi_valid?(bd(c,c.bi_buf),c.bi_buf=0,c.bi_valid=0):c.bi_valid>=8&&(c.pending_buf[c.pending++]=255&c.bi_buf,c.bi_buf>>=8,c.bi_valid-=8)}function a7(J,I){var H,G,F,E,D,C,B=I.dyn_tree,A=I.max_code,v=I.stat_desc.static_tree,u=I.stat_desc.has_stree,t=I.stat_desc.extra_bits,s=I.stat_desc.extra_base,r=I.stat_desc.max_length,q=0;for(E=0;ak>=E;E++){J.bl_count[E]=0}for(B[2*J.heap[J.heap_max]+1]=0,H=J.heap_max+1;al>H;H++){G=J.heap[H],E=B[2*B[2*G+1]+1]+1,E>r&&(E=r,q++),B[2*G+1]=E,G>A||(J.bl_count[E]++,D=0,G>=s&&(D=t[G-s]),C=B[2*G],J.opt_len+=C*(E+D),u&&(J.static_len+=C*(v[2*G+1]+D)))}if(0!==q){do{for(E=r-1;0===J.bl_count[E];){E--}J.bl_count[E]--,J.bl_count[E+1]+=2,J.bl_count[r]--,q-=2}while(q>0);for(E=r;0!==E;E--){for(G=J.bl_count[E];0!==G;){F=J.heap[--H],F>A||(B[2*F+1]!==E&&(J.opt_len+=(E-B[2*F+1])*B[2*F],B[2*F+1]=E),G--)}}}}function a6(k,i,q){var p,o,n=new Array(ak+1),m=0;for(p=1;ak>=p;p++){n[p]=m=m+q[p-1]<<1}for(o=0;i>=o;o++){var l=k[2*o+1];0!==l&&(k[2*o]=a9(n[l]++,l))}}function a5(){var h,g,m,l,k,i=new Array(ak+1);for(m=0,l=0;aq-1>l;l++){for(aP[l]=m,h=0;h<1<<bk[l];h++){ac[m++]=l}}for(ac[m-1]=l,k=0,l=0;16>l;l++){for(aJ[l]=k,h=0;h<1<<aF[l];h++){aI[k++]=l}}for(k>>=7;an>l;l++){for(aJ[l]=k<<7,h=0;h<1<<aF[l]-7;h++){aI[256+k++]=l}}for(g=0;ak>=g;g++){i[g]=0}for(h=0;143>=h;){aa[2*h+1]=8,h++,i[8]++}for(;255>=h;){aa[2*h+1]=9,h++,i[9]++}for(;279>=h;){aa[2*h+1]=7,h++,i[7]++}for(;287>=h;){aa[2*h+1]=8,h++,i[8]++}for(a6(aa,ao+1,i),h=0;an>h;h++){aO[2*h+1]=5,aO[2*h]=a9(h,5)}ad=new ag(aa,bk,ap+1,ao,ak),aR=new ag(aO,aF,0,an,ak),aK=new ag(new Array(0),bj,0,am,ai)}function a4(d){var c;for(c=0;ao>c;c++){d.dyn_ltree[2*c]=0}for(c=0;an>c;c++){d.dyn_dtree[2*c]=0}for(c=0;am>c;c++){d.bl_tree[2*c]=0}d.dyn_ltree[2*ah]=1,d.opt_len=d.static_len=0,d.last_lit=d.matches=0}function a3(c){c.bi_valid>8?bd(c,c.bi_buf):c.bi_valid>0&&(c.pending_buf[c.pending++]=c.bi_buf),c.bi_buf=0,c.bi_valid=0}function a2(f,e,h,g){a3(f),g&&(bd(f,h),bd(f,~h)),aB.arraySet(f.pending_buf,f.window,e,h,f.pending),f.pending+=h}function a1(h,g,m,l){var k=2*g,i=2*m;return h[k]<h[i]||h[k]===h[i]&&l[g]<=l[m]}function a0(g,f,k){for(var i=g.heap[k],h=k<<1;h<=g.heap_len&&(h<g.heap_len&&a1(f,g.heap[h+1],g.heap[h],g.depth)&&h++,!a1(f,i,g.heap[h],g.depth));){g.heap[k]=g.heap[h],k=h,h<<=1}g.heap[k]=i}function aZ(g,e,p){var o,n,m,l,h=0;if(0!==g.last_lit){do{o=g.pending_buf[g.d_buf+2*h]<<8|g.pending_buf[g.d_buf+2*h+1],n=g.pending_buf[g.l_buf+h],h++,0===o?ba(g,n,e):(m=ac[n],ba(g,m+ap+1,e),l=bk[m],0!==l&&(n-=aP[m],bc(g,n,l)),o--,m=be(o),ba(g,m,p),l=aF[m],0!==l&&(o-=aJ[m],bc(g,o,l)))}while(h<g.last_lit)}ba(g,ah,e)}function aY(t,s){var r,q,p,o=s.dyn_tree,n=s.stat_desc.static_tree,m=s.stat_desc.has_stree,l=s.stat_desc.elems,k=-1;for(t.heap_len=0,t.heap_max=al,r=0;l>r;r++){0!==o[2*r]?(t.heap[++t.heap_len]=k=r,t.depth[r]=0):o[2*r+1]=0}for(;t.heap_len<2;){p=t.heap[++t.heap_len]=2>k?++k:0,o[2*p]=1,t.depth[p]=0,t.opt_len--,m&&(t.static_len-=n[2*p+1])}for(s.max_code=k,r=t.heap_len>>1;r>=1;r--){a0(t,o,r)}p=l;do{r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],a0(t,o,1),q=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=q,o[2*p]=o[2*r]+o[2*q],t.depth[p]=(t.depth[r]>=t.depth[q]?t.depth[r]:t.depth[q])+1,o[2*r+1]=o[2*q+1]=p,t.heap[1]=p++,a0(t,o,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],a7(t,s),a6(o,k,t.bl_count)}function aX(t,s,r){var q,p,o=-1,n=s[1],m=0,l=7,k=4;for(0===n&&(l=138,k=3),s[2*(r+1)+1]=65535,q=0;r>=q;q++){p=n,n=s[2*(q+1)+1],++m<l&&p===n||(k>m?t.bl_tree[2*p]+=m:0!==p?(p!==o&&t.bl_tree[2*p]++,t.bl_tree[2*af]++):10>=m?t.bl_tree[2*ae]++:t.bl_tree[2*aM]++,m=0,o=p,0===n?(l=138,k=3):p===n?(l=6,k=3):(l=7,k=4))}}function aW(t,s,r){var q,p,o=-1,n=s[1],m=0,h=7,g=4;for(0===n&&(h=138,g=3),q=0;r>=q;q++){if(p=n,n=s[2*(q+1)+1],!(++m<h&&p===n)){if(g>m){do{ba(t,p,t.bl_tree)}while(0!==--m)}else{0!==p?(p!==o&&(ba(t,p,t.bl_tree),m--),ba(t,af,t.bl_tree),bc(t,m-3,2)):10>=m?(ba(t,ae,t.bl_tree),bc(t,m-3,3)):(ba(t,aM,t.bl_tree),bc(t,m-11,7))}m=0,o=p,0===n?(h=138,g=3):p===n?(h=6,g=3):(h=7,g=4)}}}function aV(d){var c;for(aX(d,d.dyn_ltree,d.l_desc.max_code),aX(d,d.dyn_dtree,d.d_desc.max_code),aY(d,d.bl_desc),c=am-1;c>=3&&0===d.bl_tree[2*aN[c]+1];c--){}return d.opt_len+=3*(c+1)+5+5+4,c}function aT(g,f,k,i){var h;for(bc(g,f-257,5),bc(g,k-1,5),bc(g,i-4,4),h=0;i>h;h++){bc(g,g.bl_tree[2*aN[h]+1],3)}aW(g,g.dyn_ltree,f-1),aW(g,g.dyn_dtree,k-1)}function aS(e){var d,f=4093624447;for(d=0;31>=d;d++,f>>>=1){if(1&f&&0!==e.dyn_ltree[2*d]){return az}}if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26]){return ay}for(d=32;ap>d;d++){if(0!==e.dyn_ltree[2*d]){return ay}}return az}function aQ(c){aL||(a5(),aL=!0),c.l_desc=new aU(c.dyn_ltree,ad),c.d_desc=new aU(c.dyn_dtree,aR),c.bl_desc=new aU(c.bl_tree,aK),c.bi_buf=0,c.bi_valid=0,a4(c)}function aG(f,e,h,g){bc(f,(aw<<1)+(g?1:0),3),a2(f,e,h,!0)}function aE(c){bc(c,av<<1,3),ba(c,ah,aa),a8(c)}function aD(i,g,o,n){var m,l,k=0;i.level>0?(i.strm.data_type===ax&&(i.strm.data_type=aS(i)),aY(i,i.l_desc),aY(i,i.d_desc),k=aV(i),m=i.opt_len+3+7>>>3,l=i.static_len+3+7>>>3,m>=l&&(m=l)):m=l=o+5,m>=o+4&&-1!==g?aG(i,g,o,n):i.strategy===aA||l===m?(bc(i,(av<<1)+(n?1:0),3),aZ(i,aa,aO)):(bc(i,(au<<1)+(n?1:0),3),aT(i,i.l_desc.max_code+1,i.d_desc.max_code+1,k+1),aZ(i,i.dyn_ltree,i.dyn_dtree)),a4(i),n&&a3(i)}function aC(e,d,f){return e.pending_buf[e.d_buf+2*e.last_lit]=d>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&d,e.pending_buf[e.l_buf+e.last_lit]=255&f,e.last_lit++,0===d?e.dyn_ltree[2*f]++:(e.matches++,d--,e.dyn_ltree[2*(ac[f]+ap+1)]++,e.dyn_dtree[2*be(d)]++),e.last_lit===e.lit_bufsize-1}var aB=bi("../utils/common"),aA=4,az=0,ay=1,ax=2,aw=0,av=1,au=2,at=3,ar=258,aq=29,ap=256,ao=ap+1+aq,an=30,am=19,al=2*ao+1,ak=15,aj=16,ai=7,ah=256,af=16,ae=17,aM=18,bk=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],aF=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],bj=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],aN=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],aH=512,aa=new Array(2*(ao+2));bf(aa);var aO=new Array(2*an);bf(aO);var aI=new Array(aH);bf(aI);var ac=new Array(ar-at+1);bf(ac);var aP=new Array(aq);bf(aP);var aJ=new Array(an);bf(aJ);var ad,aR,aK,ag=function(g,f,k,i,h){this.static_tree=g,this.extra_bits=f,this.extra_base=k,this.elems=i,this.max_length=h,this.has_stree=g&&g.length},aU=function(d,c){this.dyn_tree=d,this.max_code=0,this.stat_desc=c},aL=!1;bg._tr_init=aQ,bg._tr_stored_block=aG,bg._tr_flush_block=aD,bg._tr_tally=aC,bg._tr_align=aE},{"../utils/common":27}],39:[function(e,d){function f(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}d.exports=f},{}]},{},[9])(9)});(function(a){function b(g,f,k,i,h){this._listener=f;this._isOnce=k;this.context=i;this._signal=g;this._priority=h||0}function c(f,e){if(typeof f!=="function"){throw Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))}}var d={VERSION:"0.7.4"};b.prototype={active:!0,params:null,execute:function(f){var e;this.active&&this._listener&&(f=this.params?this.params.concat(f):f,e=this._listener.apply(this.context,f),this._isOnce&&this.detach());return e},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return !!this._signal&&!!this._listener},getListener:function(){return this._listener},_destroy:function(){delete this._signal;delete this._listener;delete this.context},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};d.Signal=function(){this._bindings=[];this._prevParams=null};d.Signal.prototype={memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(g,f,k,i){var h=this._indexOfListener(g,k);if(h!==-1){if(g=this._bindings[h],g.isOnce()!==f){throw Error("You cannot add"+(f?"":"Once")+"() then add"+(!f?"":"Once")+"() the same listener without removing the relationship first.")}}else{g=new b(this,g,f,k,i),this._addBinding(g)}this.memorize&&this._prevParams&&g.execute(this._prevParams);return g},_addBinding:function(f){var e=this._bindings.length;do{--e}while(this._bindings[e]&&f._priority<=this._bindings[e]._priority);this._bindings.splice(e+1,0,f)},_indexOfListener:function(f,e){for(var h=this._bindings.length,g;h--;){if(g=this._bindings[h],g._listener===f&&g.context===e){return h}}return -1},has:function(f,e){return this._indexOfListener(f,e)!==-1},add:function(f,e,g){c(f,"add");return this._registerListener(f,!1,e,g)},addOnce:function(f,e,g){c(f,"addOnce");return this._registerListener(f,!0,e,g)},remove:function(f,e){c(f,"remove");var g=this._indexOfListener(f,e);g!==-1&&(this._bindings[g]._destroy(),this._bindings.splice(g,1));return f},removeAll:function(){for(var e=this._bindings.length;e--;){this._bindings[e]._destroy()}this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(f){if(this.active){var e=Array.prototype.slice.call(arguments),h=this._bindings.length,g;if(this.memorize){this._prevParams=e}if(h){g=this._bindings.slice();this._shouldPropagate=!0;do{h--}while(g[h]&&this._shouldPropagate&&g[h].execute(e)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};typeof define==="function"&&define.amd?define(d):typeof module!=="undefined"&&module.exports?module.exports=d:a.signals=d})(this);var UI={};UI.Element=function(a){this.dom=a};UI.Element.prototype={setId:function(a){this.dom.id=a;return this},setClass:function(a){this.dom.className=a;return this},setStyle:function(b,c){for(var a=0;a<c.length;a++){this.dom.style[b]=c[a]}},setDisabled:function(a){this.dom.disabled=a;return this},setTextContent:function(a){this.dom.textContent=a;return this}};var properties=["position","left","top","right","bottom","width","height","border","borderLeft","borderTop","borderRight","borderBottom","borderColor","display","overflow","margin","marginLeft","marginTop","marginRight","marginBottom","padding","paddingLeft","paddingTop","paddingRight","paddingBottom","color","backgroundColor","opacity","fontSize","fontWeight","textAlign","textDecoration","textTransform","cursor","zIndex"];properties.forEach(function(a){var b="set"+a.substr(0,1).toUpperCase()+a.substr(1,a.length);UI.Element.prototype[b]=function(){this.setStyle(a,arguments);return this}});var events=["KeyUp","KeyDown","MouseOver","MouseOut","Click","DblClick","Change"];events.forEach(function(a){var b="on"+a;UI.Element.prototype[b]=function(c){this.dom.addEventListener(a.toLowerCase(),c.bind(this),false);return this}});UI.Panel=function(){UI.Element.call(this);var a=document.createElement("div");a.className="Panel";this.dom=a;return this};UI.Panel.prototype=Object.create(UI.Element.prototype);UI.Panel.prototype.constructor=UI.Panel;UI.Panel.prototype.add=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if(b instanceof UI.Element){this.dom.appendChild(b.dom)}else{console.error("UI.Panel:",b,"is not an instance of UI.Element.")}}return this};UI.Panel.prototype.remove=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if(b instanceof UI.Element){this.dom.removeChild(b.dom)}else{console.error("UI.Panel:",b,"is not an instance of UI.Element.")}}return this};UI.Panel.prototype.clear=function(){while(this.dom.children.length){this.dom.removeChild(this.dom.lastChild)}};UI.CollapsiblePanel=function(){UI.Panel.call(this);this.setClass("Panel Collapsible");var b=this;this._static=new UI.Panel();this._static.setClass("Static");this._static.onClick(function(){b.toggle()});this.dom.appendChild(this._static.dom);this.contents=new UI.Panel();this.contents.setClass("Content");this.dom.appendChild(this.contents.dom);var a=new UI.Panel();a.setClass("Button");this._static.add(a);this.isCollapsed=false;return this};UI.CollapsiblePanel.prototype=Object.create(UI.Panel.prototype);UI.CollapsiblePanel.prototype.constructor=UI.CollapsiblePanel;UI.CollapsiblePanel.prototype.addStatic=function(){this._static.add.apply(this._static,arguments);return this};UI.CollapsiblePanel.prototype.removeStatic=function(){this._static.remove.apply(this._static,arguments);return this};UI.CollapsiblePanel.prototype.clearStatic=function(){this._static.clear();return this};UI.CollapsiblePanel.prototype.add=function(){this.contents.add.apply(this.contents,arguments);return this};UI.CollapsiblePanel.prototype.remove=function(){this.contents.remove.apply(this.contents,arguments);return this};UI.CollapsiblePanel.prototype.clear=function(){this.contents.clear();return this};UI.CollapsiblePanel.prototype.toggle=function(){this.setCollapsed(!this.isCollapsed)};UI.CollapsiblePanel.prototype.collapse=function(){this.setCollapsed(true)};UI.CollapsiblePanel.prototype.expand=function(){this.setCollapsed(false)};UI.CollapsiblePanel.prototype.setCollapsed=function(a){if(a){this.dom.classList.add("collapsed")}else{this.dom.classList.remove("collapsed")}this.isCollapsed=a;if(this.onCollapsedChangeCallback!==undefined){this.onCollapsedChangeCallback(a)}};UI.CollapsiblePanel.prototype.onCollapsedChange=function(a){this.onCollapsedChangeCallback=a};UI.Text=function(b){UI.Element.call(this);var a=document.createElement("span");a.className="Text";a.style.cursor="default";a.style.display="inline-block";a.style.verticalAlign="middle";this.dom=a;this.setValue(b);return this};UI.Text.prototype=Object.create(UI.Element.prototype);UI.Text.prototype.constructor=UI.Text;UI.Text.prototype.getValue=function(){return this.dom.textContent};UI.Text.prototype.setValue=function(a){if(a!==undefined){this.dom.textContent=a}return this};UI.Input=function(c){UI.Element.call(this);var a=this;var b=document.createElement("input");b.className="Input";b.style.padding="2px";b.style.border="1px solid #ccc";b.addEventListener("keydown",function(d){d.stopPropagation()},false);this.dom=b;this.setValue(c);return this};UI.Input.prototype=Object.create(UI.Element.prototype);UI.Input.prototype.constructor=UI.Input;UI.Input.prototype.getValue=function(){return this.dom.value};UI.Input.prototype.setValue=function(a){this.dom.value=a;return this};UI.TextArea=function(){UI.Element.call(this);var a=this;var b=document.createElement("textarea");b.className="TextArea";b.style.padding="2px";b.style.border="1px solid #ccc";b.spellcheck=false;b.addEventListener("keydown",function(c){c.stopPropagation();if(c.keyCode===9){c.preventDefault();var d=b.selectionStart;b.value=b.value.substring(0,d)+"\t"+b.value.substring(d);b.selectionStart=d+1;b.selectionEnd=b.selectionStart}},false);this.dom=b;return this};UI.TextArea.prototype=Object.create(UI.Element.prototype);UI.TextArea.prototype.constructor=UI.TextArea;UI.TextArea.prototype.getValue=function(){return this.dom.value};UI.TextArea.prototype.setValue=function(a){this.dom.value=a;return this};UI.Select=function(){UI.Element.call(this);var a=this;var b=document.createElement("select");b.className="Select";b.style.width="64px";b.style.height="16px";b.style.border="0px";b.style.padding="0px";this.dom=b;return this};UI.Select.prototype=Object.create(UI.Element.prototype);UI.Select.prototype.constructor=UI.Select;UI.Select.prototype.setMultiple=function(a){this.dom.multiple=a;return this};UI.Select.prototype.setOptions=function(a){var d=this.dom.value;while(this.dom.children.length>0){this.dom.removeChild(this.dom.firstChild)}for(var b in a){var c=document.createElement("option");c.value=b;c.innerHTML=a[b];this.dom.appendChild(c)}this.dom.value=d;return this};UI.Select.prototype.getValue=function(){return this.dom.value};UI.Select.prototype.setValue=function(a){a=String(a);if(this.dom.value!==a){this.dom.value=a}return this};UI.FancySelect=function(){UI.Element.call(this);var b=this;var c=document.createElement("div");c.className="FancySelect";c.tabIndex=0;var a=document.createEvent("HTMLEvents");a.initEvent("change",true,true);c.addEventListener("keydown",function(d){switch(d.keyCode){case 38:case 40:d.preventDefault();d.stopPropagation();break}},false);c.addEventListener("keyup",function(d){switch(d.keyCode){case 38:case 40:b.selectedIndex+=(d.keyCode==38)?-1:1;if(b.selectedIndex>=0&&b.selectedIndex<b.options.length){b.setValue(b.options[b.selectedIndex].value);b.dom.dispatchEvent(a)}break}},false);this.dom=c;this.options=[];this.selectedIndex=-1;this.selectedValue=null;return this};UI.FancySelect.prototype=Object.create(UI.Element.prototype);UI.FancySelect.prototype.constructor=UI.FancySelect;UI.FancySelect.prototype.setOptions=function(a){var e=this;var d=document.createEvent("HTMLEvents");d.initEvent("change",true,true);while(e.dom.children.length>0){e.dom.removeChild(e.dom.firstChild)}e.options=[];for(var b=0;b<a.length;b++){var c=a[b];var f=document.createElement("div");f.className="option";f.innerHTML=c.html;f.value=c.value;e.dom.appendChild(f);e.options.push(f);f.addEventListener("click",function(g){e.setValue(this.value);e.dom.dispatchEvent(d)},false)}return e};UI.FancySelect.prototype.getValue=function(){return this.selectedValue};UI.FancySelect.prototype.setValue=function(d){for(var c=0;c<this.options.length;c++){var b=this.options[c];if(b.value===d){b.classList.add("active");var f=b.offsetTop-this.dom.offsetTop;var a=f+b.offsetHeight;var e=a-this.dom.offsetHeight;if(this.dom.scrollTop>f){this.dom.scrollTop=f}else{if(this.dom.scrollTop<e){this.dom.scrollTop=e}}this.selectedIndex=c}else{b.classList.remove("active")}}this.selectedValue=d;return this};UI.Checkbox=function(a){UI.Element.call(this);var b=this;var c=document.createElement("input");c.className="Checkbox";c.type="checkbox";this.dom=c;this.setValue(a);return this};UI.Checkbox.prototype=Object.create(UI.Element.prototype);UI.Checkbox.prototype.constructor=UI.Checkbox;UI.Checkbox.prototype.getValue=function(){return this.dom.checked};UI.Checkbox.prototype.setValue=function(a){if(a!==undefined){this.dom.checked=a}return this};UI.Color=function(){UI.Element.call(this);var b=this;var c=document.createElement("input");c.className="Color";c.style.width="64px";c.style.height="16px";c.style.border="0px";c.style.padding="0px";c.style.backgroundColor="transparent";try{c.type="color";c.value="#ffffff"}catch(a){}this.dom=c;return this};UI.Color.prototype=Object.create(UI.Element.prototype);UI.Color.prototype.constructor=UI.Color;UI.Color.prototype.getValue=function(){return this.dom.value};UI.Color.prototype.getHexValue=function(){return parseInt(this.dom.value.substr(1),16)};UI.Color.prototype.setValue=function(a){this.dom.value=a;return this};UI.Color.prototype.setHexValue=function(a){this.dom.value="#"+("000000"+a.toString(16)).slice(-6);return this};UI.Number=function(number){UI.Element.call(this);var scope=this;var dom=document.createElement("input");dom.className="Number";dom.value="0.00";dom.addEventListener("keydown",function(event){event.stopPropagation();if(event.keyCode===13){dom.blur()}},false);this.min=-Infinity;this.max=Infinity;this.precision=2;this.step=1;this.dom=dom;this.setValue(number);var changeEvent=document.createEvent("HTMLEvents");changeEvent.initEvent("change",true,true);var distance=0;var onMouseDownValue=0;var pointer=new THREE.Vector2();var prevPointer=new THREE.Vector2();var onMouseDown=function(event){event.preventDefault();distance=0;onMouseDownValue=parseFloat(dom.value);prevPointer.set(event.clientX,event.clientY);document.addEventListener("mousemove",onMouseMove,false);document.addEventListener("mouseup",onMouseUp,false)};var onMouseMove=function(event){var currentValue=dom.value;pointer.set(event.clientX,event.clientY);distance+=(pointer.x-prevPointer.x)-(pointer.y-prevPointer.y);var number=onMouseDownValue+(distance/(event.shiftKey?5:50))*scope.step;dom.value=Math.min(scope.max,Math.max(scope.min,number)).toFixed(scope.precision);if(currentValue!==dom.value){dom.dispatchEvent(changeEvent)}prevPointer.set(event.clientX,event.clientY)};var onMouseUp=function(event){document.removeEventListener("mousemove",onMouseMove,false);document.removeEventListener("mouseup",onMouseUp,false);if(Math.abs(distance)<2){dom.focus();dom.select()}};var onChange=function(event){var value=0;try{value=eval(dom.value)}catch(error){console.error(error.message)}dom.value=parseFloat(value)};var onFocus=function(event){dom.style.backgroundColor="";dom.style.borderColor="#ccc";dom.style.cursor=""};var onBlur=function(event){dom.style.backgroundColor="transparent";dom.style.borderColor="transparent";dom.style.cursor="col-resize"};dom.addEventListener("mousedown",onMouseDown,false);dom.addEventListener("change",onChange,false);dom.addEventListener("focus",onFocus,false);dom.addEventListener("blur",onBlur,false);return this};UI.Number.prototype=Object.create(UI.Element.prototype);UI.Number.prototype.constructor=UI.Number;UI.Number.prototype.getValue=function(){return parseFloat(this.dom.value)};UI.Number.prototype.setValue=function(a){if(a!==undefined){this.dom.value=a.toFixed(this.precision)}return this};UI.Number.prototype.setRange=function(b,a){this.min=b;this.max=a;return this};UI.Number.prototype.setPrecision=function(a){this.precision=a;return this};UI.Integer=function(number){UI.Element.call(this);var scope=this;var dom=document.createElement("input");dom.className="Number";dom.value="0.00";dom.addEventListener("keydown",function(event){event.stopPropagation()},false);this.min=-Infinity;this.max=Infinity;this.step=1;this.dom=dom;this.setValue(number);var changeEvent=document.createEvent("HTMLEvents");changeEvent.initEvent("change",true,true);var distance=0;var onMouseDownValue=0;var pointer=new THREE.Vector2();var prevPointer=new THREE.Vector2();var onMouseDown=function(event){event.preventDefault();distance=0;onMouseDownValue=parseFloat(dom.value);prevPointer.set(event.clientX,event.clientY);document.addEventListener("mousemove",onMouseMove,false);document.addEventListener("mouseup",onMouseUp,false)};var onMouseMove=function(event){var currentValue=dom.value;pointer.set(event.clientX,event.clientY);distance+=(pointer.x-prevPointer.x)-(pointer.y-prevPointer.y);var number=onMouseDownValue+(distance/(event.shiftKey?5:50))*scope.step;dom.value=Math.min(scope.max,Math.max(scope.min,number))|0;if(currentValue!==dom.value){dom.dispatchEvent(changeEvent)}prevPointer.set(event.clientX,event.clientY)};var onMouseUp=function(event){document.removeEventListener("mousemove",onMouseMove,false);document.removeEventListener("mouseup",onMouseUp,false);if(Math.abs(distance)<2){dom.focus();dom.select()}};var onChange=function(event){var value=0;try{value=eval(dom.value)}catch(error){console.error(error.message)}dom.value=parseInt(value)};var onFocus=function(event){dom.style.backgroundColor="";dom.style.borderColor="#ccc";dom.style.cursor=""};var onBlur=function(event){dom.style.backgroundColor="transparent";dom.style.borderColor="transparent";dom.style.cursor="col-resize"};dom.addEventListener("mousedown",onMouseDown,false);dom.addEventListener("change",onChange,false);dom.addEventListener("focus",onFocus,false);dom.addEventListener("blur",onBlur,false);return this};UI.Integer.prototype=Object.create(UI.Element.prototype);UI.Integer.prototype.constructor=UI.Integer;UI.Integer.prototype.getValue=function(){return parseInt(this.dom.value)};UI.Integer.prototype.setValue=function(a){if(a!==undefined){this.dom.value=a|0}return this};UI.Integer.prototype.setRange=function(b,a){this.min=b;this.max=a;return this};UI.Break=function(){UI.Element.call(this);var a=document.createElement("br");a.className="Break";this.dom=a;return this};UI.Break.prototype=Object.create(UI.Element.prototype);UI.Break.prototype.constructor=UI.Break;UI.HorizontalRule=function(){UI.Element.call(this);var a=document.createElement("hr");a.className="HorizontalRule";this.dom=a;return this};UI.HorizontalRule.prototype=Object.create(UI.Element.prototype);UI.HorizontalRule.prototype.constructor=UI.HorizontalRule;UI.Button=function(b){UI.Element.call(this);var a=this;var c=document.createElement("button");c.className="Button";this.dom=c;this.dom.textContent=b;return this};UI.Button.prototype=Object.create(UI.Element.prototype);UI.Button.prototype.constructor=UI.Button;UI.Button.prototype.setLabel=function(a){this.dom.textContent=a;return this};UI.Dialog=function(b){var a=this;var c=document.createElement("dialog");if(c.showModal===undefined){c=document.createElement("div");c.style.display="none";c.showModal=function(){c.style.position="absolute";c.style.left="100px";c.style.top="100px";c.style.zIndex=1;c.style.display=""}}c.className="Dialog";this.dom=c;return this};UI.Dialog.prototype=Object.create(UI.Panel.prototype);UI.Dialog.prototype.constructor=UI.Dialog;UI.Dialog.prototype.showModal=function(){this.dom.showModal();return this};var APP={Player:function(){var m=new THREE.ObjectLoader();var g,e,i;var b={};this.dom=undefined;this.width=500;this.height=500;this.load=function(u){i=new THREE.WebGLRenderer({antialias:true});i.setPixelRatio(window.devicePixelRatio);g=m.parse(u.camera);e=m.parse(u.scene);b={keydown:[],keyup:[],mousedown:[],mouseup:[],mousemove:[],update:[]};for(var v in u.scripts){var r=e.getObjectByProperty("uuid",v,true);var q=u.scripts[v];for(var t=0;t<q.length;t++){var o=q[t];var s=(new Function("player","scene","keydown","keyup","mousedown","mouseup","mousemove","update",o.source+"\nreturn { keydown: keydown, keyup: keyup, mousedown: mousedown, mouseup: mouseup, mousemove: mousemove, update: update };").bind(r))(this,e);for(var p in s){if(s[p]===undefined){continue}if(b[p]===undefined){console.warn("APP.Player: event type not supported (",p,")");continue}b[p].push(s[p].bind(r))}}}this.dom=i.domElement};this.setCamera=function(o){g=o;g.aspect=this.width/this.height;g.updateProjectionMatrix()};this.setSize=function(p,o){this.width=p;this.height=o;g.aspect=this.width/this.height;g.updateProjectionMatrix();i.setSize(p,o)};var h=function(r,q){for(var p=0,o=r.length;p<o;p++){r[p](q)}};var d;var a=function(o){d=requestAnimationFrame(a);h(b.update,{time:o});i.render(e,g)};this.play=function(){document.addEventListener("keydown",l);document.addEventListener("keyup",n);document.addEventListener("mousedown",c);document.addEventListener("mouseup",f);document.addEventListener("mousemove",k);d=requestAnimationFrame(a)};this.stop=function(){document.removeEventListener("keydown",l);document.removeEventListener("keyup",n);document.removeEventListener("mousedown",c);document.removeEventListener("mouseup",f);document.removeEventListener("mousemove",k);cancelAnimationFrame(d)};var l=function(o){h(b.keydown,o)};var n=function(o){h(b.keyup,o)};var c=function(o){h(b.mousedown,o)};var f=function(o){h(b.mouseup,o)};var k=function(o){h(b.mousemove,o)}}};var Storage=function(){var b=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;if(b===undefined){console.warn("Storage: IndexedDB not available.");return{init:function(){},get:function(){},set:function(){},clear:function(){}}}var c="threejs-editor";var a=1;var d;return{init:function(f){var e=b.open(c,a);e.onupgradeneeded=function(h){var g=h.target.result;if(g.objectStoreNames.contains("states")===false){g.createObjectStore("states")}};e.onsuccess=function(g){d=g.target.result;f()};e.onerror=function(g){console.error("IndexedDB",g)}},get:function(h){var g=d.transaction(["states"],"readwrite");var f=g.objectStore("states");var e=f.get(0);e.onsuccess=function(i){h(i.target.result)}},set:function(g,k){var i=performance.now();var h=d.transaction(["states"],"readwrite");var f=h.objectStore("states");var e=f.put(g,0);e.onsuccess=function(l){console.log("["+/\d\d\:\d\d\:\d\d/.exec(new Date())[0]+"]","Saved state to IndexedDB. "+(performance.now()-i).toFixed(2)+"ms")}},clear:function(h){var g=d.transaction(["states"],"readwrite");var f=g.objectStore("states");var e=f.clear();e.onsuccess=function(i){h()}}}};var Editor=function(){var a=signals;this.signals={editScript:new a.Signal(),startPlayer:new a.Signal(),stopPlayer:new a.Signal(),playAnimation:new a.Signal(),stopAnimation:new a.Signal(),showDialog:new a.Signal(),editorCleared:new a.Signal(),savingStarted:new a.Signal(),savingFinished:new a.Signal(),themeChanged:new a.Signal(),transformModeChanged:new a.Signal(),snapChanged:new a.Signal(),spaceChanged:new a.Signal(),rendererChanged:new a.Signal(),sceneGraphChanged:new a.Signal(),cameraChanged:new a.Signal(),geometryChanged:new a.Signal(),objectSelected:new a.Signal(),objectFocused:new a.Signal(),objectAdded:new a.Signal(),objectChanged:new a.Signal(),objectRemoved:new a.Signal(),helperAdded:new a.Signal(),helperRemoved:new a.Signal(),materialChanged:new a.Signal(),scriptAdded:new a.Signal(),scriptChanged:new a.Signal(),scriptRemoved:new a.Signal(),fogTypeChanged:new a.Signal(),fogColorChanged:new a.Signal(),fogParametersChanged:new a.Signal(),windowResize:new a.Signal(),showGridChanged:new a.Signal(),saveObjects:new a.Signal(),onBed:new a.Signal(),objectMove:new a.Signal(),objectRotate:new a.Signal(),objectScale:new a.Signal(),objectCenter:new a.Signal(),objectReset:new a.Signal(),objectAdded3dviewer:new a.Signal()};this.config=new Config();this.config.clear();this.loader=new Loader(this);this.scene=new THREE.Scene();this.scene.name="Scene";this.rootMesh=new THREE.Mesh();this.rootMesh.rotation.x+=-90*(Math.PI/180);this.scene.add(this.rootMesh);this.camera=new THREE.PerspectiveCamera(50,1,1,5000);this.camera.name="Camera";this.sceneHelpers=new THREE.Scene();this.object={};this.geometries={};this.materials={};this.textures={};this.scripts={};this.selected=null;this.helpers={};this.only3dviewer=false};Editor.prototype={setTheme:function(a){document.getElementById("theme").href=a;this.signals.themeChanged.dispatch(a)},setScene:function(a){this.scene.uuid=a.uuid;this.scene.name=a.name;this.scene.userData=JSON.parse(JSON.stringify(a.userData));this.signals.sceneGraphChanged.active=false;while(a.children.length>0){this.addObject(a.children[0])}this.signals.sceneGraphChanged.active=true;this.signals.sceneGraphChanged.dispatch()},addObject:function(a){var b=this;a.traverse(function(c){if(c.geometry!==undefined){b.addGeometry(c.geometry)}if(c.material!==undefined){b.addMaterial(c.material)}b.addHelper(c)});this.rootMesh.add(a);this.signals.objectAdded.dispatch(a);if(this.only3dviewer==true){this.signals.objectAdded3dviewer.dispatch(a)}this.signals.sceneGraphChanged.dispatch()},setObjectName:function(b,a){b.name=a;this.signals.sceneGraphChanged.dispatch()},removeObject:function(a){if(a.parent===undefined){return}var b=this;a.traverse(function(c){b.removeHelper(c)});a.parent.remove(a);this.signals.objectRemoved.dispatch(a);this.signals.sceneGraphChanged.dispatch()},addGeometry:function(a){this.geometries[a.uuid]=a},setGeometryName:function(b,a){b.name=a;this.signals.sceneGraphChanged.dispatch()},addMaterial:function(a){this.materials[a.uuid]=a},setMaterialName:function(b,a){b.name=a;this.signals.sceneGraphChanged.dispatch()},addTexture:function(a){this.textures[a.uuid]=a},addHelper:function(){var b=new THREE.SphereGeometry(20,4,2);var a=new THREE.MeshBasicMaterial({color:16711680});return function(d){var e;if(d instanceof THREE.Camera){e=new THREE.CameraHelper(d,10)}else{if(d instanceof THREE.PointLight){e=new THREE.PointLightHelper(d,10)}else{if(d instanceof THREE.DirectionalLight){e=new THREE.DirectionalLightHelper(d,20)}else{if(d instanceof THREE.SpotLight){e=new THREE.SpotLightHelper(d,10)}else{if(d instanceof THREE.HemisphereLight){e=new THREE.HemisphereLightHelper(d,10)}else{if(d instanceof THREE.SkinnedMesh){e=new THREE.SkeletonHelper(d)}else{return}}}}}}var c=new THREE.Mesh(b,a);c.name="picker";c.userData.object=d;c.visible=false;e.add(c);this.sceneHelpers.add(e);this.helpers[d.id]=e;this.signals.helperAdded.dispatch(e)}}(),removeHelper:function(a){if(this.helpers[a.id]!==undefined){var b=this.helpers[a.id];b.parent.remove(b);delete this.helpers[a.id];this.signals.helperRemoved.dispatch(b)}},addScript:function(b,a){if(this.scripts[b.uuid]===undefined){this.scripts[b.uuid]=[]}this.scripts[b.uuid].push(a);this.signals.scriptAdded.dispatch(a)},removeScript:function(c,a){if(this.scripts[c.uuid]===undefined){return}var b=this.scripts[c.uuid].indexOf(a);if(b!==-1){this.scripts[c.uuid].splice(b,1)}this.signals.scriptRemoved.dispatch(a)},parent:function(a,b){if(b===undefined){b=this.scene}b.add(a);this.signals.sceneGraphChanged.dispatch()},select:function(a){if(this.only3dviewer==true){return}if(this.selected===a){return}var b=null;if(a!==null){b=a.uuid}this.selected=a;this.config.setKey("selected",b);this.signals.objectSelected.dispatch(a)},selectById:function(a){if(a===this.camera.id){this.select(this.camera);return}this.select(this.scene.getObjectById(a,true))},selectByUuid:function(b){var a=this;this.scene.traverse(function(c){if(c.uuid===b){a.select(c)}})},deselect:function(){this.select(null)},focus:function(a){this.signals.objectFocused.dispatch(a)},focusById:function(a){this.focus(this.scene.getObjectById(a,true))},clear:function(){this.camera.position.set(500,250,500);this.camera.lookAt(new THREE.Vector3());var a=this.scene.children;while(a.length>0){this.removeObject(a[0])}this.geometries={};this.materials={};this.textures={};this.scripts={};this.deselect();this.signals.editorCleared.dispatch()},fromJSON:function(b){var a=new THREE.ObjectLoader();if(b.scene===undefined){var d=a.parse(b);this.setScene(d);return}var c=a.parse(b.camera);this.camera.position.copy(c.position);this.camera.rotation.copy(c.rotation);this.camera.aspect=c.aspect;this.camera.near=c.near;this.camera.far=c.far;this.setScene(a.parse(b.scene));this.scripts=b.scripts},toJSON:function(){return{camera:this.camera.toJSON(),scene:this.scene.toJSON(),scripts:this.scripts}}};var Config=function(){var a="threejs-editor";var d={autosave:true,theme:"/assets/c/threejs/light.css",renderer:"WebGLRenderer","renderer/antialias":true,"camera/position":[500,250,500],"camera/target":[0,0,0],"ui/sidebar/animation/collapsed":true,"ui/sidebar/geometry/collapsed":true,"ui/sidebar/material/collapsed":true,"ui/sidebar/object3d/collapsed":false,"ui/sidebar/renderer/collapsed":true,"ui/sidebar/scene/collapsed":false,"ui/sidebar/script/collapsed":true};if(window.localStorage[a]===undefined){window.localStorage[a]=JSON.stringify(d)}else{var c=JSON.parse(window.localStorage[a]);for(var b in c){d[b]=c[b]}}return{getKey:function(e){return d[e]},setKey:function(){for(var f=0,e=arguments.length;f<e;f+=2){d[arguments[f]]=arguments[f+1]}window.localStorage[a]=JSON.stringify(d);console.log("["+/\d\d\:\d\d\:\d\d/.exec(new Date())[0]+"]","Saved config to LocalStorage.")},clear:function(){delete window.localStorage[a]}}};var Loader=function(c){var b=this;var a=c.signals;this.filename=null;this.fileId=null;this.afterLoading=function(n){var e=[];var o=[];for(var k in n.matrix.elements){e[k]=n.matrix.elements[k]}n.name=this.filename;n.fileId=this.fileId;var m=n.geometry;m.computeBoundingBox();m.computeBoundingSphere();var l=new THREE.BoundingBoxHelper(m);var h=(l.object.boundingBox.min.x+l.object.boundingBox.max.x)/2;var g=(l.object.boundingBox.min.y+l.object.boundingBox.max.y)/2;var f=(l.object.boundingBox.min.z+l.object.boundingBox.max.z)/2;n.realCenter={x:h,y:g,z:f};THREE.GeometryUtils.center(n.geometry);n.position.set(n.realCenter.x,n.realCenter.y,n.realCenter.z);n.updateMatrix();n.startOffset={"12":n.matrix.elements[12]-e[12],"13":n.matrix.elements[13]-e[13],"14":n.matrix.elements[14]-e[14]};return n};this.loadFile=function(f){this.filename=f.name;this.fileId=f.name;if(f.fileId!==undefined){this.fileId=f.fileId}var h=this.filename.split(".").pop().toLowerCase();var g=aseMaterial.get("object");switch(h){case"awd":var e=new FileReader();e.addEventListener("load",function(k){var i=new THREE.AWDLoader();var l=i.parse(k.target.result);c.setScene(l)},false);e.readAsArrayBuffer(f);break;case"babylon":var e=new FileReader();e.addEventListener("load",function(m){var l=m.target.result;var k=JSON.parse(l);var i=new THREE.BabylonLoader();var n=i.parse(k);c.setScene(n)},false);e.readAsText(f);break;case"babylonmeshdata":var e=new FileReader();e.addEventListener("load",function(m){var l=m.target.result;var k=JSON.parse(l);var i=new THREE.BabylonLoader();var n=i.parseGeometry(k);var o=new THREE.Mesh(n,g);o=b.afterLoading(o);c.addObject(o);c.select(o)},false);e.readAsText(f);break;case"cloudfmt":var e=new FileReader();e.addEventListener("load",function(k){var l=new Uint8Array(k.target.result);var m=new CLOUDFMT.Stream(l);m.offset=0;var i=new THREE.CLOUDFMTLoader();i.createModel(new CLOUDFMT.File(m),function(n){n.sourceType="cloudfmt";n.sourceFile=f.name;var o=new THREE.Mesh(n,g);o=b.afterLoading(o);c.addObject(o);c.select(o)})},false);e.readAsArrayBuffer(f);break;case"dae":var e=new FileReader();e.addEventListener("load",function(m){var l=m.target.result;var n=new DOMParser();var k=n.parseFromString(l,"text/xml");var i=new THREE.ColladaLoader();i.parse(k,function(o){o.scene.name=filename;c.addObject(o.scene);c.select(o.scene)})},false);e.readAsText(f);break;case"js":case"json":case"3geo":case"3mat":case"3obj":case"3scn":var e=new FileReader();e.addEventListener("load",function(n){var m=n.target.result;if(m.indexOf("postMessage")!==-1){var i=new Blob([m],{type:"text/javascript"});var l=URL.createObjectURL(i);var p=new Worker(l);p.onmessage=function(q){q.data.metadata={version:2};d(q.data,f,filename)};p.postMessage(Date.now());return}var o;try{o=JSON.parse(m)}catch(k){alert(k);return}d(o,f,filename)},false);e.readAsText(f);break;case"obj":var e=new FileReader();e.addEventListener("load",function(l){var k=l.target.result;var i=new THREE.OBJLoader().parse(k);i.name=filename;c.addObject(i);c.select(i)},false);e.readAsText(f);break;case"ply":var e=new FileReader();e.addEventListener("load",function(k){var i=k.target.result;var l=new THREE.PLYLoader().parse(i);l.sourceType="ply";l.sourceFile=f.name;var m=new THREE.Mesh(l,g);m=b.afterLoading(m);c.addObject(m);c.select(m)},false);e.readAsText(f);break;case"stl":var e=new FileReader();e.addEventListener("load",function(k){var i=k.target.result;var l=new THREE.STLLoader().parse(i);l.sourceType="stl";l.sourceFile=f.name;var m=new THREE.Mesh(l,g);m=b.afterLoading(m);c.addObject(m);c.select(m)},false);if(e.readAsBinaryString!==undefined){e.readAsBinaryString(f)}else{e.readAsArrayBuffer(f)}break;case"vtk":var e=new FileReader();e.addEventListener("load",function(k){var i=k.target.result;var l=new THREE.VTKLoader().parse(i);l.sourceType="vtk";l.sourceFile=f.name;var m=new THREE.Mesh(l,g);m=b.afterLoading(m);c.addObject(m);c.select(m)},false);e.readAsText(f);break;case"wrl":var e=new FileReader();e.addEventListener("load",function(l){var k=l.target.result;var i=new THREE.VRMLLoader().parse(k);c.setScene(i)},false);e.readAsText(f);break;case"gcode":var e=new FileReader();e.addEventListener("load",function(l){var k=l.target.result;var i=new GCodeParser();var n=i.parse(k);var m=new GCodeRenderer();var o=m.render(n);o.name=filename;c.addObject(o);c.select(o)},false);e.readAsText(f);break;default:alert("Unsupported file format ("+h+").");break}stopProgressBgAnimate()};var d=function(k,h,g){if(k.metadata===undefined){k.metadata={type:"Geometry"}}if(k.metadata.type===undefined){k.metadata.type="Geometry"}if(k.metadata.version===undefined){k.metadata.version=k.metadata.formatVersion}if(k.metadata.type==="BufferGeometry"){var f=new THREE.BufferGeometryLoader();var e=f.parse(k);var m=new THREE.Mesh(e);c.addObject(m);c.select(m)}else{if(k.metadata.type.toLowerCase()==="geometry"){var f=new THREE.JSONLoader();var e=f.parse(k);var l=e.geometry;var i;if(e.materials!==undefined){if(e.materials.length>1){i=new THREE.MeshFaceMaterial(e.materials)}else{i=e.materials[0]}}else{i=new THREE.MeshPhongMaterial()}l.sourceType="ascii";l.sourceFile=h.name;var m;if(l.animation&&l.animation.hierarchy){m=new THREE.SkinnedMesh(l,i)}else{m=new THREE.Mesh(l,i)}m=b.afterLoading(m);c.addObject(m);c.select(m)}else{if(k.metadata.type.toLowerCase()==="object"){var f=new THREE.ObjectLoader();var e=f.parse(k);if(e instanceof THREE.Scene){c.setScene(e)}else{c.addObject(e);c.select(e)}}else{if(k.metadata.type.toLowerCase()==="scene"){var f=new THREE.SceneLoader();f.parse(k,function(n){c.setScene(n.scene)},"")}}}}}};var asePlane=function(a,g,d,D,c,S){var ac=S;var P=a+0.1;var ab=g+0.1;var W=d+0.1;var G=a-10;var o=g-10;var B=d-10;var u=new THREE.LineBasicMaterial({color:16757299});var ad=new THREE.LineBasicMaterial({color:16777215,opacity:0.5,transparent:true});var K=new THREE.LineBasicMaterial({color:16777215});var l=new THREE.LineDashedMaterial({color:54015,dashSize:2,gapSize:1});var L=new THREE.Mesh();var H=new THREE.LineBasicMaterial({color:16016759});var F=new THREE.LineBasicMaterial({color:6938231});var E=new THREE.LineBasicMaterial({color:6535423});var t=new THREE.Geometry();t.vertices.push(new THREE.Vector3(-10,0.1,0));t.vertices.push(new THREE.Vector3(10,0.1,0));var X=new THREE.Line(t,H);var s=new THREE.Geometry();s.vertices.push(new THREE.Vector3(0,0.1,-10));s.vertices.push(new THREE.Vector3(0,0.1,10));var V=new THREE.Line(s,F);var r=new THREE.Geometry();r.vertices.push(new THREE.Vector3(0,-10,0));r.vertices.push(new THREE.Vector3(0,10,0));var U=new THREE.Line(r,E);L.add(X);L.add(V);L.add(U);if(ac==true){var h=new THREE.Geometry();var aa=new THREE.Geometry();for(var T=0;T<a/2;T+=D){var Z=Math.sqrt(a*a/4-T*T);h.vertices.push(new THREE.Vector3(-Z,0,T),new THREE.Vector3(Z,0,T));h.vertices.push(new THREE.Vector3(-Z,0,-T),new THREE.Vector3(Z,0,-T))}for(var T=0;T<a/2;T+=D){var Z=Math.sqrt(a*a/4-T*T);h.vertices.push(new THREE.Vector3(T,0,-Z),new THREE.Vector3(T,0,Z));h.vertices.push(new THREE.Vector3(-T,0,-Z),new THREE.Vector3(-T,0,Z))}for(var T=0;T<=a/2;T+=c){var Z=Math.sqrt(a*a/4-T*T);aa.vertices.push(new THREE.Vector3(-Z,0,T),new THREE.Vector3(Z,0,T));aa.vertices.push(new THREE.Vector3(-Z,0,-T),new THREE.Vector3(Z,0,-T))}for(var T=0;T<=g/2;T+=c){var Z=Math.sqrt(a*a/4-T*T);aa.vertices.push(new THREE.Vector3(T,0,-Z),new THREE.Vector3(T,0,Z));aa.vertices.push(new THREE.Vector3(-T,0,-Z),new THREE.Vector3(-T,0,Z))}var h=new THREE.Line(h,ad,THREE.LinePieces);var p=new THREE.Line(aa,K,THREE.LinePieces);var n=P/2,m=120,R=new THREE.CircleGeometry(n,m);var J=G/2,f=new THREE.CircleGeometry(J,m);f.vertices.shift();R.vertices.shift();var b=new THREE.Mesh();var O=new THREE.Line(f,l,THREE.LinePieces);var M=new THREE.Line(R,u);b.add(h);b.add(p);L.add(b);b.add(O);b.add(M);O.rotation.x+=90*(Math.PI/180);M.rotation.x+=90*(Math.PI/180)}else{var N=new THREE.Geometry();N.vertices.push(new THREE.Vector3(-ab/2,0,P/2));N.vertices.push(new THREE.Vector3(ab/2,0,P/2));N.vertices.push(new THREE.Vector3(ab/2,0,-P/2));N.vertices.push(new THREE.Vector3(-ab/2,0,-P/2));N.vertices.push(new THREE.Vector3(-ab/2,0,P/2));N.computeLineDistances();var k=new THREE.Line(N,u);var A=new THREE.Geometry();A.vertices.push(new THREE.Vector3(-o/2,0,G/2));A.vertices.push(new THREE.Vector3(o/2,0,G/2));A.vertices.push(new THREE.Vector3(o/2,0,-G/2));A.vertices.push(new THREE.Vector3(-o/2,0,-G/2));A.vertices.push(new THREE.Vector3(-o/2,0,G/2));A.computeLineDistances();var q=new THREE.Line(A,l);var I=new THREE.Geometry();I.vertices.push(new THREE.Vector3(-d/2,0,a/2));I.vertices.push(new THREE.Vector3(d/2,0,a/2));var C=new THREE.Geometry();var Y=new THREE.Geometry();for(var T=0;T<a/2;T+=D){C.vertices.push(new THREE.Vector3(-g/2,0,T),new THREE.Vector3(g/2,0,T));C.vertices.push(new THREE.Vector3(-g/2,0,-T),new THREE.Vector3(g/2,0,-T))}for(var T=0;T<g/2;T+=D){C.vertices.push(new THREE.Vector3(T,0,-a/2),new THREE.Vector3(T,0,a/2));C.vertices.push(new THREE.Vector3(-T,0,-a/2),new THREE.Vector3(-T,0,a/2))}for(var T=0;T<=a/2;T+=c){Y.vertices.push(new THREE.Vector3(-g/2,0,T),new THREE.Vector3(g/2,0,T));Y.vertices.push(new THREE.Vector3(-g/2,0,-T),new THREE.Vector3(g/2,0,-T))}for(var T=0;T<=g/2;T+=c){Y.vertices.push(new THREE.Vector3(T,0,-a/2),new THREE.Vector3(T,0,a/2));Y.vertices.push(new THREE.Vector3(-T,0,-a/2),new THREE.Vector3(-T,0,a/2))}var Q=new THREE.Line(C,ad,THREE.LinePieces);var e=new THREE.Line(Y,K,THREE.LinePieces);var v=new THREE.Mesh();L.add(v);v.add(Q);v.position.z=-a/2;v.position.y=-0.01;v.position.z=0;v.add(k);v.add(q);v.add(e);k.position.y=0.1}L.name="bed";return L};var aseLight=function(){var b=[];var a=new THREE.HemisphereLight(16777215,0);a.position.set(70,100,70);b.push(a);return b};THREE.ShaderExtras={screen:{uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},convolution:{uniforms:{tDiffuse:{type:"t",value:null},uImageIncrement:{type:"v2",value:new THREE.Vector2(0.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vUv = uv - ( ( KERNEL_SIZE - 1.0 ) / 2.0 ) * uImageIncrement;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vec2 imageCoord = vUv;","vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","for( int i = 0; i < KERNEL_SIZE; i ++ ) {","sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","imageCoord += uImageIncrement;","}","gl_FragColor = sum;","}"].join("\n")},film:{uniforms:{tDiffuse:{type:"t",value:null},time:{type:"f",value:0},nIntensity:{type:"f",value:0.5},sIntensity:{type:"f",value:0.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 cTextureScreen = texture2D( tDiffuse, vUv );","float x = vUv.x * vUv.y * time *  1000.0;","x = mod( x, 13.0 ) * mod( x, 123.0 );","float dx = mod( x, 0.01 );","vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );","vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","if( grayscale ) {","cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","}","gl_FragColor =  vec4( cResult, cTextureScreen.a );","}"].join("\n")},bokeh:{uniforms:{tColor:{type:"t",value:null},tDepth:{type:"t",value:null},focus:{type:"f",value:1},aspect:{type:"f",value:1},aperture:{type:"f",value:0.025},maxblur:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float maxblur;","uniform float aperture;","uniform float focus;","uniform float aspect;","void main() {","vec2 aspectcorrect = vec2( 1.0, aspect );","vec4 depth1 = texture2D( tDepth, vUv );","float factor = depth1.x - focus;","vec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );","vec2 dofblur9 = dofblur * 0.9;","vec2 dofblur7 = dofblur * 0.7;","vec2 dofblur4 = dofblur * 0.4;","vec4 col = vec4( 0.0 );","col += texture2D( tColor, vUv.xy );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );","gl_FragColor = col / 41.0;","gl_FragColor.a = 1.0;","}"].join("\n")},dofmipmap:{uniforms:{tColor:{type:"t",value:null},tDepth:{type:"t",value:null},focus:{type:"f",value:1},maxblur:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float focus;","uniform float maxblur;","uniform sampler2D tColor;","uniform sampler2D tDepth;","varying vec2 vUv;","void main() {","vec4 depth = texture2D( tDepth, vUv );","float factor = depth.x - focus;","vec4 col = texture2D( tColor, vUv, 2.0 * maxblur * abs( focus - depth.x ) );","gl_FragColor = col;","gl_FragColor.a = 1.0;","}"].join("\n")},sepia:{uniforms:{tDiffuse:{type:"t",value:null},amount:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float amount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color = texture2D( tDiffuse, vUv );","vec3 c = color.rgb;","color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );","color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );","color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );","gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );","}"].join("\n")},dotscreen:{uniforms:{tDiffuse:{type:"t",value:null},tSize:{type:"v2",value:new THREE.Vector2(256,256)},center:{type:"v2",value:new THREE.Vector2(0.5,0.5)},angle:{type:"f",value:1.57},scale:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","float s = sin( angle ), c = cos( angle );","vec2 tex = vUv * tSize - center;","vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","return ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","vec4 color = texture2D( tDiffuse, vUv );","float average = ( color.r + color.g + color.b ) / 3.0;","gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")},vignette:{uniforms:{tDiffuse:{type:"t",value:null},offset:{type:"f",value:1},darkness:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n")},bleachbypass:{uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 base = texture2D( tDiffuse, vUv );","vec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );","float lum = dot( lumCoeff, base.rgb );","vec3 blend = vec3( lum );","float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );","vec3 result1 = 2.0 * base.rgb * blend;","vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );","vec3 newColor = mix( result1, result2, L );","float A2 = opacity * base.a;","vec3 mixRGB = A2 * newColor.rgb;","mixRGB += ( ( 1.0 - A2 ) * base.rgb );","gl_FragColor = vec4( mixRGB, base.a );","}"].join("\n")},focus:{uniforms:{tDiffuse:{type:"t",value:null},screenWidth:{type:"f",value:1024},screenHeight:{type:"f",value:1024},sampleDistance:{type:"f",value:0.94},waveFactor:{type:"f",value:0.00125}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float screenWidth;","uniform float screenHeight;","uniform float sampleDistance;","uniform float waveFactor;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color, org, tmp, add;","float sample_dist, f;","vec2 vin;","vec2 uv = vUv;","add = color = org = texture2D( tDiffuse, uv );","vin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );","sample_dist = dot( vin, vin ) * 2.0;","f = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;","vec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );","add += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","color = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );","color = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );","gl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );","}"].join("\n")},triangleBlur:{uniforms:{texture:{type:"t",value:null},delta:{type:"v2",value:new THREE.Vector2(1,1)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define ITERATIONS 10.0","uniform sampler2D texture;","uniform vec2 delta;","varying vec2 vUv;","float random( vec3 scale, float seed ) {","return fract( sin( dot( gl_FragCoord.xyz + seed, scale ) ) * 43758.5453 + seed );","}","void main() {","vec4 color = vec4( 0.0 );","float total = 0.0;","float offset = random( vec3( 12.9898, 78.233, 151.7182 ), 0.0 );","for ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {","float percent = ( t + offset - 0.5 ) / ITERATIONS;","float weight = 1.0 - abs( percent );","color += texture2D( texture, vUv + delta * percent ) * weight;","total += weight;","}","gl_FragColor = color / total;","}"].join("\n")},basic:{uniforms:{},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["void main() {","gl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );","}"].join("\n")},horizontalBlur:{uniforms:{tDiffuse:{type:"t",value:null},h:{type:"f",value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, 		  	vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},verticalBlur:{uniforms:{tDiffuse:{type:"t",value:null},v:{type:"f",value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y			  ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},horizontalTiltShift:{uniforms:{tDiffuse:{type:"t",value:null},h:{type:"f",value:1/512},r:{type:"f",value:0.35}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float hh = h * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, 		  	 vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},verticalTiltShift:{uniforms:{tDiffuse:{type:"t",value:null},v:{type:"f",value:1/512},r:{type:"f",value:0.35}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float vv = v * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * vv ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * vv ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y			   ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * vv ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * vv ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},blend:{uniforms:{tDiffuse1:{type:"t",value:null},tDiffuse2:{type:"t",value:null},mixRatio:{type:"f",value:0.5},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform float mixRatio;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( tDiffuse1, vUv );","vec4 texel2 = texture2D( tDiffuse2, vUv );","gl_FragColor = opacity * mix( texel1, texel2, mixRatio );","}"].join("\n")},fxaa:{uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","#define FXAA_REDUCE_MIN   (1.0/128.0)","#define FXAA_REDUCE_MUL   (1.0/8.0)","#define FXAA_SPAN_MAX     8.0","void main() {","vec3 rgbNW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ).xyz;","vec3 rgbNE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ).xyz;","vec3 rgbSW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ).xyz;","vec3 rgbSE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ).xyz;","vec4 rgbaM  = texture2D( tDiffuse,  gl_FragCoord.xy  * resolution );","vec3 rgbM  = rgbaM.xyz;","float opacity  = rgbaM.w;","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float lumaNW = dot( rgbNW, luma );","float lumaNE = dot( rgbNE, luma );","float lumaSW = dot( rgbSW, luma );","float lumaSE = dot( rgbSE, luma );","float lumaM  = dot( rgbM,  luma );","float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );","float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );","vec2 dir;","dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));","dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));","float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );","float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );","dir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),","max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),","dir * rcpDirMin)) * resolution;","vec3 rgbA = 0.5 * (","texture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * ( 1.0 / 3.0 - 0.5 ) ).xyz +","texture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * ( 2.0 / 3.0 - 0.5 ) ).xyz );","vec3 rgbB = rgbA * 0.5 + 0.25 * (","texture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * -0.5 ).xyz +","texture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * 0.5 ).xyz );","float lumaB = dot( rgbB, luma );","if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {","gl_FragColor = vec4( rgbA, opacity );","} else {","gl_FragColor = vec4( rgbB, opacity );","}","}"].join("\n")},luminosity:{uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","gl_FragColor = vec4( v, v, v, texel.w );","}"].join("\n")},colorCorrection:{uniforms:{tDiffuse:{type:"t",value:null},powRGB:{type:"v3",value:new THREE.Vector3(2,2,2)},mulRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 powRGB;","uniform vec3 mulRGB;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","gl_FragColor.rgb = mulRGB * pow( gl_FragColor.rgb, powRGB );","}"].join("\n")},normalmap:{uniforms:{heightMap:{type:"t",value:null},resolution:{type:"v2",value:new THREE.Vector2(512,512)},scale:{type:"v2",value:new THREE.Vector2(1,1)},height:{type:"f",value:0.05}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float height;","uniform vec2 resolution;","uniform sampler2D heightMap;","varying vec2 vUv;","void main() {","float val = texture2D( heightMap, vUv ).x;","float valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;","float valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;","gl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );","}"].join("\n")},ssao:{uniforms:{tDiffuse:{type:"t",value:null},tDepth:{type:"t",value:null},size:{type:"v2",value:new THREE.Vector2(512,512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},fogNear:{type:"f",value:5},fogFar:{type:"f",value:100},fogEnabled:{type:"i",value:0},onlyAO:{type:"i",value:0},aoClamp:{type:"f",value:0.3},lumInfluence:{type:"f",value:0.9}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cameraNear;","uniform float cameraFar;","uniform float fogNear;","uniform float fogFar;","uniform bool fogEnabled;","uniform bool onlyAO;","uniform vec2 size;","uniform float aoClamp;","uniform float lumInfluence;","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","varying vec2 vUv;","#define DL 2.399963229728653","#define EULER 2.718281828459045","float width = size.x;","float height = size.y;","float cameraFarPlusNear = cameraFar + cameraNear;","float cameraFarMinusNear = cameraFar - cameraNear;","float cameraCoef = 2.0 * cameraNear;","const int samples = 8;","const float radius = 5.0;","const bool useNoise = false;","const float noiseAmount = 0.0003;","const float diffArea = 0.4;","const float gDisplace = 0.4;","const vec3 onlyAOColor = vec3( 1.0, 0.7, 0.5 );","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","vec2 rand( const vec2 coord ) {","vec2 noise;","if ( useNoise ) {","float nx = dot ( coord, vec2( 12.9898, 78.233 ) );","float ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );","noise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );","} else {","float ff = fract( 1.0 - coord.s * ( width / 2.0 ) );","float gg = fract( coord.t * ( height / 2.0 ) );","noise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;","}","return ( noise * 2.0  - 1.0 ) * noiseAmount;","}","float doFog() {","float zdepth = unpackDepth( texture2D( tDepth, vUv ) );","float depth = -cameraFar * cameraNear / ( zdepth * cameraFarMinusNear - cameraFar );","return smoothstep( fogNear, fogFar, depth );","}","float readDepth( const in vec2 coord ) {","return cameraCoef / ( cameraFarPlusNear - unpackDepth( texture2D( tDepth, coord ) ) * cameraFarMinusNear );","}","float compareDepths( const in float depth1, const in float depth2, inout int far ) {","float garea = 2.0;","float diff = ( depth1 - depth2 ) * 100.0;","if ( diff < gDisplace ) {","garea = diffArea;","} else {","far = 1;","}","float dd = diff - gDisplace;","float gauss = pow( EULER, -2.0 * dd * dd / ( garea * garea ) );","return gauss;","}","float calcAO( float depth, float dw, float dh ) {","float dd = radius - depth * radius;","vec2 vv = vec2( dw, dh );","vec2 coord1 = vUv + dd * vv;","vec2 coord2 = vUv - dd * vv;","float temp1 = 0.0;","float temp2 = 0.0;","int far = 0;","temp1 = compareDepths( depth, readDepth( coord1 ), far );","if ( far > 0 ) {","temp2 = compareDepths( readDepth( coord2 ), depth, far );","temp1 += ( 1.0 - temp1 ) * temp2;","}","return temp1;","}","void main() {","vec2 noise = rand( vUv );","float depth = readDepth( vUv );","float tt = clamp( depth, aoClamp, 1.0 );","float w = ( 1.0 / width )  / tt + ( noise.x * ( 1.0 - noise.x ) );","float h = ( 1.0 / height ) / tt + ( noise.y * ( 1.0 - noise.y ) );","float pw;","float ph;","float ao;","float dz = 1.0 / float( samples );","float z = 1.0 - dz / 2.0;","float l = 0.0;","for ( int i = 0; i <= samples; i ++ ) {","float r = sqrt( 1.0 - z );","pw = cos( l ) * r;","ph = sin( l ) * r;","ao += calcAO( depth, pw * w, ph * h );","z = z - dz;","l = l + DL;","}","ao /= float( samples );","ao = 1.0 - ao;","if ( fogEnabled ) {","ao = mix( ao, 1.0, doFog() );","}","vec3 color = texture2D( tDiffuse, vUv ).rgb;","vec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );","float lum = dot( color.rgb, lumcoeff );","vec3 luminance = vec3( lum );","vec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","if ( onlyAO ) {","final = onlyAOColor * vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","}","gl_FragColor = vec4( final, 1.0 );","}"].join("\n")},colorify:{uniforms:{tDiffuse:{type:"t",value:null},color:{type:"c",value:new THREE.Color(16777215)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","gl_FragColor = vec4( v * color, texel.w );","}"].join("\n")},unpackDepthRGBA:{uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","void main() {","float depth = 1.0 - unpackDepth( texture2D( tDiffuse, vUv ) );","gl_FragColor = opacity * vec4( vec3( depth ), 1.0 );","}"].join("\n")},buildKernel:function(f){function e(i,k){return Math.exp(-(i*i)/(2*k*k))}var c,b,d,h,g=25,a=2*Math.ceil(f*3)+1;if(a>g){a=g}h=(a-1)*0.5;b=new Array(a);d=0;for(c=0;c<a;++c){b[c]=e(c-h,f);d+=b[c]}for(c=0;c<a;++c){b[c]/=d}return b}};function GCodeModel(){this.codes=[]}GCodeModel.prototype.toString=function(){var b=this,a="";b.codes.forEach(function(c){a+=c.toString()+"\n"});return a};function GCode(){this.words=[];this.comments=[];this.index=0}GCode.prototype.toString=function(){var b=this,a="";if(b.comments.length>0){a=b.comments.join(" ")+"\n"}b.words.forEach(function(c){a+=c.toString()+"\n"});return a};function GWord(b,c,a){this.letter=b;this.value=c;this.raw=a}GWord.prototype.toString=function(){return this.letter+":"+this.value+" ("+this.raw+")"};function GCodeParser(){this.model=new GCodeModel()}GCodeParser.prototype.parseComments=function(a){var b=this,d=[];function c(e){if(e){e.forEach(function(f){d.push(f)})}}c(a.match(/\((.*)\)$/g,""));c(a.match(/\((.*?)\)/g,""));c(a.match(/;(.*$)/g,""));return d};GCodeParser.prototype.parseWord=function(c){if(!c.length){throw new Error('Bad word format: "'+c+'"')}var a=c[0].toUpperCase(),b;if((a<"A")||(a>"Z")){throw new Error("Unexpected command letter: "+a+" from word: "+c)}b=c.slice(1);return new GWord(a,b,c)};GCodeParser.prototype.parseLine=function(b){var c=this,h,d=0,a=0,k=new GCode(),f;k.comments=c.parseComments(b);k.comments.forEach(function(e){b=b.replace(e,"")});h=b.trim().split(" ");a=h.length;for(;d<a;d++){if(!h[d]||h[d].length<=0){continue}try{f=this.parseWord(h[d]);k.words.push(f)}catch(g){console.log(g.message)}}return k};GCodeParser.prototype.parse=function(f){var b=f.split("\n"),d=0,h=0,a=b.length,c=this,g,e=new GCode();for(;d<a;d++){g=c.parseLine(b[d]);g.words.forEach(function(i){switch(i.letter){case"G":case"M":if(e.words.length>0){c.model.codes.push(e);e=new GCode();e.index=++h}break}e.words.push(i)})}c.model.codes.push(e);return c.model};function OldGCodeParser(a){this.handlers=a||{}}OldGCodeParser.prototype.parseLine=function(e){e=e.replace(/[;(].*$/,"").trim();if(e){var d=e.split(" ");if(d){var c=d[0];var a={cmd:c};d.splice(1).forEach(function(g){var f=g[0].toLowerCase(),h=parseFloat(g.substring(1));a[f]=h});var b=this.handlers[c]||this.handlers["default"];if(b){return b(a,e)}}}};OldGCodeParser.prototype.parse=function(d){var b=d.split("\n"),c=0,a=b.length;for(;c<a;c++){if(this.parseLine(b[c])===false){break}}};var settings={default_feed_rate:undefined,steps_per_mm:new Array(3),default_seek_rate:undefined};var sys={opt_stop:undefined,coord_select:undefined};var X_AXIS=0,Y_AXIS=1,Z_AXIS=2;function GCodeInterpreter(){this.gc=new GCodeInterpreterState()}function GCodeInterpreterState(){this.status_code;this.motion_mode;this.inverse_feed_rate_mode;this.inches_mode=false;this.absolute_mode=true;this.program_flow;this.spindle_direction;this.feed_rate=settings.default_feed_rate;this.seek_rate=settings.default_seek_rate;this.position=new Array(3);this.tool;this.spindle_speed;this.plane_axis_0;this.plane_axis_1;this.plane_axis_2;this.selectPlane(X_AXIS,Y_AXIS,Z_AXIS)}GCodeInterpreterState.prototype.selectPlane=function(c,b,a){this.plane_axis_0=c;this.plane_axis_1=b;this.plane_axis_2=a};var MODAL_GROUP_NONE=0,MODAL_GROUP_0=1,MODAL_GROUP_1=2,MODAL_GROUP_2=3,MODAL_GROUP_3=4,MODAL_GROUP_4=5,MODAL_GROUP_5=6,MODAL_GROUP_6=7,MODAL_GROUP_7=8,MODAL_GROUP_8=9,MODAL_GROUP_9=10,MODAL_GROUP_10=11,MODAL_GROUP_12=12,MODAL_GROUP_13=13;var MOTION_MODE_SEEK=0,MOTION_MODE_LINEAR=1,MOTION_MODE_CW_ARC=2,MOTION_MODE_CCW_ARC=3,MOTION_MODE_CANCEL=4;var PROGRAM_FLOW_RUNNING=0,PROGRAM_FLOW_PAUSED=1,PROGRAM_FLOW_COMPLETED=2;var NON_MODAL_NONE=0,NON_MODAL_DWELL=1,NON_MODAL_SET_COORDINATE_DATA=2,NON_MODAL_GO_HOME=3,NON_MODAL_SET_COORDINATE_OFFSET=4,NON_MODAL_RESET_COORDINATE_OFFSET=5;var STATUS_UNSUPPORTED_STATEMENT="Unsupported statement.";GCodeInterpreter.prototype.interpretGCode=function(d){var b=MODAL_GROUP_NONE,f,c=NON_MODAL_NONE,a=false,e=this.gc;d.words.forEach(function(h){f=parseInt(h.value,10);switch(h.letter){case"G":switch(f){case 4:case 10:case 28:case 30:case 53:case 92:b=MODAL_GROUP_0;break;case 0:case 1:case 2:case 3:case 80:case 38:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:b=MODAL_GROUP_1;break;case 17:case 18:case 19:b=MODAL_GROUP_2;break;case 90:case 91:b=MODAL_GROUP_3;break;case 93:case 94:b=MODAL_GROUP_5;break;case 20:case 21:b=MODAL_GROUP_6;break;case 40:case 41:case 42:b=MODAL_GROUP_7;break;case 43:case 49:b=MODAL_GROUP_8;break;case 98:case 99:b=MODAL_GROUP_10;break;case 54:case 55:case 56:case 57:case 58:case 59:b=MODAL_GROUP_12;break;case 61:case 64:b=MODAL_GROUP_13;break}switch(f){case 0:e.motion_mode=MOTION_MODE_SEEK;console.log("MOTION_MODE_SEEK");break;case 1:e.motion_mode=MOTION_MODE_LINEAR;console.log("MOTION_MODE_LINEAR");break;case 2:e.motion_mode=MOTION_MODE_CW_ARC;console.log("MOTION_MODE_CW_ARC");break;case 3:e.motion_mode=MOTION_MODE_CCW_ARC;console.log("MOTION_MODE_CCW_ARC");break;case 4:c=NON_MODAL_DWELL;console.log("NON_MODAL_DWELL");break;case 10:c=NON_MODAL_SET_COORDINATE_DATA;console.log("NON_MODAL_SET_COORDINATE_DATA");break;case 17:e.selectPlane(X_AXIS,Y_AXIS,Z_AXIS);console.log("PLANE: XYZ");break;case 18:e.selectPlane(X_AXIS,Z_AXIS,Y_AXIS);console.log("PLANE: XZY");break;case 19:e.selectPlane(Y_AXIS,Z_AXIS,X_AXIS);console.log("PLANE: YZX");break;case 20:e.inches_mode=true;console.log("UNITS: inches");break;case 21:e.inches_mode=false;console.log("UNITS: millimeters");break;case 28:case 30:c=NON_MODAL_GO_HOME;console.log("NON_MODAL_GO_HOME");break;case 53:a=true;console.log("absolute_override ON");break;case 54:case 55:case 56:case 57:case 58:case 59:f-=54;if(f<N_COORDINATE_SYSTEM){sys.coord_select=f}else{throw new Error(STATUS_UNSUPPORTED_STATEMENT)}console.log("coordinate system selection");break;case 80:e.motion_mode=MOTION_MODE_CANCEL;console.log("MOTION_MODE_CANCEL");break;case 90:e.absolute_mode=true;console.log("absolute_mode ON");break;case 91:e.absolute_mode=false;console.log("absolute_mode OFF");break;case 92:f=parseInt(10*h.value);switch(f){case 920:c=NON_MODAL_SET_COORDINATE_OFFSET;console.log("NON_MODAL_SET_COORDINATE_OFFSET");break;case 921:c=NON_MODAL_RESET_COORDINATE_OFFSET;console.log("NON_MODAL_RESET_COORDINATE_OFFSET");break;default:throw new Error(STATUS_UNSUPPORTED_STATEMENT)}break;case 93:e.inverse_feed_rate_mode=true;console.log("inverse_feed_rate_mode ON");break;case 94:e.inverse_feed_rate_mode=false;console.log("inverse_feed_rate_mode OFF");break;default:throw new Error(STATUS_UNSUPPORTED_STATEMENT)}break;case"M":switch(f){case 0:case 1:case 2:case 30:case 60:b=MODAL_GROUP_4;break;case 6:b=MODAL_GROUP_6;break;case 3:case 4:case 5:b=MODAL_GROUP_7;break;case 7:case 8:case 9:b=MODAL_GROUP_8;break;case 48:case 49:b=MODAL_GROUP_9;break}}var g=h+" code: "+h.letter+" val: "+h.value+" group: ";switch(b){case MODAL_GROUP_NONE:g+="no group";break;case MODAL_GROUP_0:g+="non modal";break;case MODAL_GROUP_1:g+="motion";break;case MODAL_GROUP_2:g+="plane selection";break;case MODAL_GROUP_3:g+="distance mode";break;case MODAL_GROUP_4:g+="stopping";break;case MODAL_GROUP_5:g+="feed rate mode";break;case MODAL_GROUP_6:g+="units";break;case MODAL_GROUP_7:g+=(h.letter=="G"?"cutter radius compensation":"spindle turning");break;case MODAL_GROUP_8:g+=(h.letter=="G"?"tool length offset":"coolant");break;case MODAL_GROUP_9:g+="enable/disable feed and speed override switches";break;case MODAL_GROUP_10:g+="return mode in canned cycles";break;case MODAL_GROUP_12:g+="coordinate system selection";break;case MODAL_GROUP_13:g+="path control mode";break}console.log(g)})};GCodeInterpreter.prototype.interpret=function(b){var a=this;a.model=b;a.model.codes.forEach(function(c){a.interpretGCode(c)})};function FileIO(){}FileIO.error=function(a){alert(a)};FileIO.loadPath=function(b,c){var a=this;$.get(b,null,c,"text").error(function(){a.error("Unable to load gcode.")})};FileIO.load=function(d,e){if(d.length){var c=0,b=d.length;for(;c<b;c++){FileIO.load(d[c],e)}}else{var a=new FileReader();a.onload=function(){e(a.result)};a.readAsText(d)}};function GCodeViewModel(a){this.code=a;this.vertexIndex=0;this.vertexLength=0}function GCodeRenderer(){var a=this;this.viewModels=[];this.index=0;this.baseObject=new THREE.Object3D();this.motionGeo=new THREE.Geometry();this.motionMat=new THREE.LineBasicMaterial({opacity:0.2,transparent:true,linewidth:1,vertexColors:THREE.VertexColors});this.motionIncGeo=new THREE.Geometry();this.motionIncMat=new THREE.LineBasicMaterial({opacity:0.2,transparent:true,linewidth:1,vertexColors:THREE.VertexColors});this.feedAllGeo=new THREE.Geometry();this.feedGeo=new THREE.Geometry();this.feedMat=new THREE.LineBasicMaterial({opacity:0.8,transparent:true,linewidth:2,vertexColors:THREE.VertexColors});this.feedIncGeo=new THREE.Geometry();this.feedIncMat=new THREE.LineBasicMaterial({opacity:0.2,transparent:true,linewidth:2,vertexColors:THREE.VertexColors});this.lastLine={x:0,y:0,z:0,e:0,f:0};this.relative=false;this.bounds={min:{x:100000,y:100000,z:100000},max:{x:-100000,y:-100000,z:-100000}};this.geometryHandlers={G0:function(c){var d={};c.code.words.forEach(function(f){switch(f.letter){case"X":case"Y":case"Z":case"E":case"F":var e=f.letter.toLowerCase();d[e]=a.absolute(a.lastLine[e],parseFloat(f.value));break}});["x","y","z","e","f"].forEach(function(e){if(d[e]===undefined){d[e]=a.lastLine[e]}});c.vertexIndex=a.motionGeo.vertices.length;var b=GCodeRenderer.motionColors[c.code.index%GCodeRenderer.motionColors.length];a.motionGeo.vertices.push(new THREE.Vector3(a.lastLine.x,a.lastLine.y,a.lastLine.z));a.motionGeo.vertices.push(new THREE.Vector3(d.x,d.y,d.z));a.motionGeo.colors.push(b);a.motionGeo.colors.push(b);c.vertexLength=a.motionGeo.vertices.length-c.vertexIndex;a.lastLine=d;return a.motionGeo},G1:function(c){var f={};c.code.words.forEach(function(h){switch(h.letter){case"X":case"Y":case"Z":case"E":case"F":var g=h.letter.toLowerCase();f[g]=a.absolute(a.lastLine[g],parseFloat(h.value));break}});["x","y","z","e","f"].forEach(function(g){if(f[g]===undefined){f[g]=a.lastLine[g]}});var b=GCodeRenderer.feedColors[c.code.index%GCodeRenderer.feedColors.length];var e=new THREE.Vector3(a.lastLine.x,a.lastLine.y,a.lastLine.z);var d=new THREE.Vector3(f.x,f.y,f.z);c.vertexIndex=a.feedAllGeo.vertices.length;if(c.code.index<=a.index){a.feedGeo.vertices.push(e);a.feedGeo.vertices.push(d);a.feedGeo.colors.push(b);a.feedGeo.colors.push(b)}else{a.feedIncGeo.colors.push(b);a.feedIncGeo.colors.push(b);a.feedIncGeo.vertices.push(e);a.feedIncGeo.vertices.push(d)}a.feedAllGeo.vertices.push(e);a.feedAllGeo.vertices.push(d);a.feedAllGeo.colors.push(b);a.feedAllGeo.colors.push(b);c.vertexLength=a.feedAllGeo.vertices.length-c.vertexIndex;a.lastLine=f;return a.feedGeo},G2:function(b){}};this.materialHandlers={G0:function(b){return this.motionMat},G1:function(b){return this.feedMat},G2:function(b){return this.feedMat}}}GCodeRenderer.motionColors=[new THREE.Color(14540253)];GCodeRenderer.feedColors=[new THREE.Color(6737151),new THREE.Color(2276130),new THREE.Color(13395711),new THREE.Color(16776806),new THREE.Color(16737894)];GCodeRenderer.prototype.absolute=function(b,a){return this.relative?b+a:a};GCodeRenderer.prototype.render=function(b){var a=this;a.model=b;a.model.codes.forEach(function(g){a.renderGCode(g)});a.updateLines();a.feedAllGeo.computeBoundingBox();a.bounds=a.feedAllGeo.boundingBox;a.center=new THREE.Vector3(a.bounds.min.x+((a.bounds.max.x-a.bounds.min.x)/2),a.bounds.min.y+((a.bounds.max.y-a.bounds.min.y)/2),a.bounds.min.z+((a.bounds.max.z-a.bounds.min.z)/2));var c=window.innerHeight/(a.bounds.max.z-a.bounds.min.z),d=window.innerWidth/(a.bounds.max.y-a.bounds.min.y),e=window.innerWidth/(a.bounds.max.x-a.bounds.min.x),f=Math.min(c,Math.min(e,d));a.baseObject.position=a.center.multiplyScalar(-f);a.baseObject.scale.multiplyScalar(f);return a.baseObject};GCodeRenderer.prototype.updateLines=function(){var b=this;while(b.baseObject.children.length>0){b.baseObject.remove(b.baseObject.children[0])}var a=new THREE.Line(this.motionGeo,this.motionMat,THREE.LinePieces);var d=new THREE.Line(this.feedGeo,this.feedMat,THREE.LinePieces);var c=new THREE.Line(this.feedIncGeo,this.feedIncMat,THREE.LinePieces);b.baseObject.add(a);b.baseObject.add(d);b.baseObject.add(c)};GCodeRenderer.prototype.renderGCode=function(b){var c=b.words[0].letter+b.words[0].value;var a=new GCodeViewModel(b);var e=this.geometryHandlers[c]||this.geometryHandlers["default"];if(e){e(a)}var d=this.materialHandlers[c]||this.materialHandlers["default"];if(d){d(a)}if(a.vertexLength>0){this.viewModels.push(a)}};GCodeRenderer.prototype.setIndex=function(c){c=Math.floor(c);if(this.index==c){return}if(c<0||c>=this.viewModels.length){if(c>=this.viewModels.length){return"finish"}throw new Error("invalid index",c)}var d=this.viewModels[c];this.feedGeo=new THREE.Geometry();var b=this.feedAllGeo.vertices.slice(0,d.vertexIndex+d.vertexLength);Array.prototype.push.apply(this.feedGeo.vertices,b);var a=this.feedAllGeo.colors.slice(0,d.vertexIndex+d.vertexLength);Array.prototype.push.apply(this.feedGeo.colors,a);this.index=c;this.updateLines()};var Viewport=function(a,F){var H=a.signals;var D=document.getElementById(F);D.dom=document.createElement("div");D.dom.className="Panel";D.dom.style.height=D.offsetHeight+"px";var r=a.scene;var t=a.sceneHelpers;var f=new aseLight();for(var O=0;O<=f.length;O++){r.add(f[O])}var K=[];var J=new asePlane(152,246,100,5,50);J.name="bed";t.add(J);J.position.set(0,0,0);var n=a.camera;n.position.set(160,120,100);n.lookAt(new THREE.Vector3());var p=new THREE.BoxHelper();p.material.depthTest=false;p.material.transparent=true;p.visible=false;p.material=aseMaterial.get("box");t.add(p);var I=new THREE.TransformControls(n,D.dom);I.addEventListener("change",function(){var i=I.object;if(i!==undefined){if(a.helpers[i.id]!==undefined){a.helpers[i.id].update()}}v()});I.addEventListener("mouseDown",function(){s.enabled=false});I.addEventListener("mouseUp",function(){H.objectChanged.dispatch(I.object);s.enabled=true});t.add(I);var b="None";var G=11184810;var A=1;var d=5000;var C=0.00025;var B=new THREE.Raycaster();var u=new THREE.Vector2();var R=function(i,V){u.set((i.x*2)-1,-(i.y*2)+1);B.setFromCamera(u,n);if(V instanceof Array){return B.intersectObjects(V)}return B.intersectObject(V)};var U=new THREE.Vector2();var q=new THREE.Vector2();var h=new THREE.Vector2();var o=function(W,i,X){var V=W.getBoundingClientRect();return[(i-V.left)/V.width,(X-V.top)/V.height]};var c=function(){if(U.distanceTo(q)==0){var V=R(q,K);if(V.length>0){var i=V[0].object;if(i.userData.object!==undefined){a.select(i.userData.object)}else{a.select(i)}}else{a.select(null)}v()}};var P=function(i){i.preventDefault();var V=o(D.dom,i.clientX,i.clientY);U.fromArray(V);document.addEventListener("mouseup",T,false)};var T=function(i){var V=o(D.dom,i.clientX,i.clientY);q.fromArray(V);c();document.removeEventListener("mouseup",T,false)};var Q=function(i){var W=i.changedTouches[0];var V=o(D.dom,W.clientX,W.clientY);U.fromArray(V);document.addEventListener("touchend",L,false)};var L=function(i){var W=i.changedTouches[0];var V=o(D.dom,W.clientX,W.clientY);q.fromArray(V);c();document.removeEventListener("touchend",L,false)};var e=function(W){var X=o(D.dom,W.clientX,W.clientY);h.fromArray(X);var V=R(h,K);if(V.length>0){var i=V[0];H.objectFocused.dispatch(i.object)}};D.dom.addEventListener("mousedown",P,false);D.dom.addEventListener("touchstart",Q,false);D.dom.addEventListener("dblclick",e,false);var s=new THREE.EditorControls(n,D.dom);s.center.fromArray(a.config.getKey("camera/target"));s.addEventListener("change",function(){I.update();H.cameraChanged.dispatch(n)});H.editorCleared.add(function(){s.center.set(0,0,0);v()});H.themeChanged.add(function(i){M=14807538;E.setClearColor(M);v()});H.saveObjects.add(function(){var Y={};var X,V;var Z=a.scene.children[0].children;for(var W in Z){if(Z[W].fileId!==undefined){X=Z[W].toJSON();V=X.object.matrix;if(Z[W].startOffset!==undefined){V[3]=Z[W].startOffset[12];V[7]=Z[W].startOffset[13];V[11]=Z[W].startOffset[14]}Y[Z[W].fileId]=V}}a.exportObjects(Y)});H.objectCenter.add(function(){if(a.selected!=undefined){var i=THREE.GeometryUtils.center(a.selected.geometry);var V=new THREE.BoundingBoxHelper(a.selected);V.update();a.selected.position.set(i.x,i.y,a.selected.position.z-=V.position.y-(V.box.max.y-V.box.min.y)/2);a.selected.updateMatrix();I.update();v()}});H.objectMove.add(function(V,Z,Y){if(a.selected!=undefined){var i=THREE.GeometryUtils.center(a.selected.geometry);var X=a.selected.geometry;X.computeBoundingBox();X.computeBoundingSphere();var W=new THREE.BoundingBoxHelper(X);a.selected.position.set(V,Z,Y+(W.object.boundingBox.max.z-W.object.boundingBox.min.z)/2);a.selected.updateMatrix();I.update();v()}});H.objectRotate.add(function(i,W,V){if(a.selected!=undefined){a.selected.rotation.set(i,W,V);a.selected.updateMatrix();I.update();v()}});H.objectScale.add(function(i,W,V){if(a.selected!=undefined){a.selected.scale.set(i,W,V);a.selected.updateMatrix();I.update();v()}});H.objectReset.add(function(){if(a.selected!=undefined){a.selected.matrix.set(a.selected.startMatrix[0],a.selected.startMatrix[1],a.selected.startMatrix[2],a.selected.startMatrix[3],a.selected.startMatrix[4],a.selected.startMatrix[5],a.selected.startMatrix[6],a.selected.startMatrix[7],a.selected.startMatrix[8],a.selected.startMatrix[9],a.selected.startMatrix[10],a.selected.startMatrix[11],a.selected.startMatrix[12],a.selected.startMatrix[13],a.selected.startMatrix[14],a.selected.startMatrix[15]);for(var V in a.selected.startMatrix){}a.selected.matrixAutoUpdate=false;a.selected.updateMatrix();v()}});H.onBed.add(function(){if(a.selected!=undefined){var i=new THREE.BoundingBoxHelper(a.selected);i.update();var V=i.position.y;i.position.y=(i.box.max.y-i.box.min.y)/2;i.updateMatrix();a.selected.position.z-=V-(i.box.max.y-i.box.min.y)/2;a.selected.updateMatrix();p.update(a.selected);I.update();v()}});H.transformModeChanged.add(function(i){I.setMode(i)});H.snapChanged.add(function(i){I.setSnap(i)});H.spaceChanged.add(function(i){I.setSpace(i)});H.rendererChanged.add(function(V,i){D.dom.removeChild(E.domElement);E=g(V,i);E.setClearColor(M);E.setPixelRatio(window.devicePixelRatio);E.setSize(D.dom.offsetWidth,D.dom.offsetHeight);D.dom.appendChild(E.domElement);v()});H.sceneGraphChanged.add(function(){v()});var m;H.cameraChanged.add(function(){v()});H.objectSelected.add(function(i){p.visible=false;I.detach();if(i!==null){if(i.geometry!==undefined&&i instanceof THREE.Sprite===false){p.update(i);p.visible=true}I.attach(i)}v()});H.objectFocused.add(function(i){s.focus(i)});H.geometryChanged.add(function(i){p.update(a.selected);v()});H.objectAdded.add(function(i){var V=false;i.traverse(function(W){if(W instanceof THREE.Light){V=true}K.push(W)});if(V===true){l()}});H.objectChanged.add(function(i){I.update();if(i.geometry!==undefined){p.update(i)}if(i instanceof THREE.PerspectiveCamera){i.updateProjectionMatrix()}if(a.helpers[i.id]!==undefined){a.helpers[i.id].update()}v()});H.objectRemoved.add(function(i){var V=false;i.traverse(function(W){if(W instanceof THREE.Light){V=true}K.splice(K.indexOf(W),1)});if(V===true){l()}});H.helperAdded.add(function(i){K.push(i.getObjectByName("picker"))});H.helperRemoved.add(function(i){K.splice(K.indexOf(i.getObjectByName("picker")),1)});H.materialChanged.add(function(i){v()});H.fogTypeChanged.add(function(i){if(i!==b){if(i==="None"){r.fog=null}else{if(i==="Fog"){r.fog=new THREE.Fog(G,A,d)}else{if(i==="FogExp2"){r.fog=new THREE.FogExp2(G,C)}}}l();b=i}v()});H.fogColorChanged.add(function(i){G=i;k(r);v()});H.fogParametersChanged.add(function(W,V,i){A=W;d=V;C=i;k(r);v()});H.windowResize.add(function(){n.aspect=D.dom.offsetWidth/D.dom.offsetHeight;n.updateProjectionMatrix();E.setSize(D.dom.offsetWidth,D.dom.offsetHeight);v()});H.showGridChanged.add(function(i){J.visible=i;v()});var S=[];H.playAnimation.add(function(i){S.push(i)});H.stopAnimation.add(function(V){var i=S.indexOf(V);if(i!==-1){S.splice(i,1)}});var g=function(V,i){if(V==="WebGLRenderer"&&System.support.webgl===false){V="CanvasRenderer"}var W=new THREE[V]({antialias:i});W.autoClear=false;W.autoUpdateScene=false;return W};var M;var E=g(a.config.getKey("renderer"),a.config.getKey("renderer/antialias"));D.dom.appendChild(E.domElement);N();function l(){a.scene.traverse(function(W){if(W.material){W.material.needsUpdate=true;if(W.material instanceof THREE.MeshFaceMaterial){for(var V=0;V<W.material.materials.length;V++){W.material.materials[V].needsUpdate=true}}}})}function k(i){if(i.fog){i.fog.color.setHex(G);if(i.fog.near!==undefined){i.fog.near=A}if(i.fog.far!==undefined){i.fog.far=d}if(i.fog.density!==undefined){i.fog.density=C}}}function N(){requestAnimationFrame(N);if(THREE.AnimationHandler.animations.length>0){THREE.AnimationHandler.update(0.016);for(var W=0,V=t.children.length;W<V;W++){var X=t.children[W];if(X instanceof THREE.SkeletonHelper){X.update()}}v()}}function v(){t.updateMatrixWorld();r.updateMatrixWorld();E.clear();E.render(r,n);if(E instanceof THREE.RaytracingRenderer===false){E.render(t,n)}}return D};Viewport.Info=function(f){var b=f.signals;var a=new UI.Panel();a.setId("info");a.setPosition("absolute");a.setLeft("10px");a.setBottom("10px");a.setFontSize("12px");a.setColor("#fff");var d=new UI.Text("0").setMarginLeft("6px");var c=new UI.Text("0").setMarginLeft("6px");var e=new UI.Text("0").setMarginLeft("6px");a.add(new UI.Text("objects"),d,new UI.Break());a.add(new UI.Text("vertices"),c,new UI.Break());a.add(new UI.Text("triangles"),e,new UI.Break());b.objectAdded.add(g);b.objectRemoved.add(g);b.geometryChanged.add(g);function g(){var q=f.scene;var p=0,m=0,o=0;for(var n=0,h=q.children.length;n<h;n++){var k=q.children[n];k.traverseVisible(function(i){p++;if(i instanceof THREE.Mesh){var l=i.geometry;if(l instanceof THREE.Geometry){m+=l.vertices.length;o+=l.faces.length}else{if(l instanceof THREE.BufferGeometry){m+=l.attributes.position.array.length/3;if(l.attributes.index!==undefined){o+=l.attributes.index.array.length/3}else{o+=l.attributes.position.array.length/9}}}}})}d.setValue(p.format());c.setValue(m.format());e.setValue(o.format())}return a};var PaneleEditor=function(a){var W=a.signals;var T=new UI.CollapsiblePanel();T.setCollapsed(a.config.getKey("ui/sidebar/object3d/collapsed"));T.onCollapsedChange(function(ah){a.config.setKey("ui/sidebar/object3d/collapsed",ah)});var N=new UI.Text().setTextTransform("uppercase");T.addStatic(N);T.add(new UI.Break());var n=new UI.Panel();var p=new UI.Input().setWidth("115px").setColor("#444").setFontSize("12px").setDisabled(true);var R=new UI.Button("").setMarginLeft("7px").onClick(function(){p.setValue(THREE.Math.generateUUID());a.selected.uuid=p.getValue()});n.add(new UI.Text("UUID").setWidth("90px"));n.add(p);n.add(R);T.add(n);var d=new UI.Panel();var ab=new UI.Input().setWidth("150px").setFontSize("12px").onChange(function(){a.setObjectName(a.selected,ab.getValue())});d.add(new UI.Text("Name").setWidth("90px"));d.add(ab);T.add(d);var b=new UI.Panel();var F=new UI.Select().setWidth("150px").setFontSize("12px").onChange(S);b.add(new UI.Text("Parent").setWidth("90px"));b.add(F);T.add(b);var O=new UI.Panel();var B=new UI.Number().setWidth("50px").onChange(S);var A=new UI.Number().setWidth("50px").onChange(S);var v=new UI.Number().setWidth("50px").onChange(S);O.add(new UI.Text("Position").setWidth("90px"));O.add(B,A,v);T.add(O);var q=new UI.Panel();var h=new UI.Number().setWidth("50px").onChange(S);var g=new UI.Number().setWidth("50px").onChange(S);var c=new UI.Number().setWidth("50px").onChange(S);q.add(new UI.Text("Rotation").setWidth("90px"));q.add(h,g,c);T.add(q);var Q=new UI.Panel();var Y=new UI.Checkbox().setPosition("absolute").setLeft("75px");var ac=new UI.Number(1).setRange(0.01,Infinity).setWidth("50px").onChange(L);var aa=new UI.Number(1).setRange(0.01,Infinity).setWidth("50px").onChange(J);var Z=new UI.Number(1).setRange(0.01,Infinity).setWidth("50px").onChange(I);Q.add(new UI.Text("Scale").setWidth("90px"));Q.add(Y);Q.add(ac,aa,Z);T.add(Q);var ae=new UI.Panel();var t=new UI.Number().onChange(S);ae.add(new UI.Text("Fov").setWidth("90px"));ae.add(t);T.add(ae);var U=new UI.Panel();var o=new UI.Number().onChange(S);U.add(new UI.Text("Near").setWidth("90px"));U.add(o);T.add(U);var l=new UI.Panel();var ag=new UI.Number().onChange(S);l.add(new UI.Text("Far").setWidth("90px"));l.add(ag);T.add(l);var M=new UI.Panel();var D=new UI.Number().setRange(0,Infinity).onChange(S);M.add(new UI.Text("Intensity").setWidth("90px"));M.add(D);T.add(M);var P=new UI.Panel();var u=new UI.Color().onChange(S);P.add(new UI.Text("Color").setWidth("90px"));P.add(u);T.add(P);var i=new UI.Panel();var E=new UI.Color().onChange(S);i.add(new UI.Text("Ground color").setWidth("90px"));i.add(E);T.add(i);var f=new UI.Panel();var V=new UI.Number().setRange(0,Infinity).onChange(S);f.add(new UI.Text("Distance").setWidth("90px"));f.add(V);T.add(f);var s=new UI.Panel();var m=new UI.Number().setPrecision(3).setRange(0,Math.PI/2).onChange(S);s.add(new UI.Text("Angle").setWidth("90px"));s.add(m);T.add(s);var G=new UI.Panel();var r=new UI.Number().setRange(0,Infinity).onChange(S);G.add(new UI.Text("Exponent").setWidth("90px"));G.add(r);T.add(G);var k=new UI.Panel();var H=new UI.Checkbox().onChange(S);k.add(new UI.Text("Visible").setWidth("90px"));k.add(H);T.add(k);var ad;var C=new UI.Panel();var K=new UI.TextArea().setWidth("150px").setHeight("40px").setColor("#444").setFontSize("12px").onChange(S);K.onKeyUp(function(){try{JSON.parse(K.getValue());K.dom.classList.add("success");K.dom.classList.remove("fail")}catch(ah){K.dom.classList.remove("success");K.dom.classList.add("fail")}});C.add(new UI.Text("User data").setWidth("90px"));C.add(K);T.add(C);function L(){var ah=a.selected;if(Y.getValue()===true){var ai=ac.getValue()/ah.scale.x;aa.setValue(aa.getValue()*ai);Z.setValue(Z.getValue()*ai)}S()}function J(){var ah=a.selected;if(Y.getValue()===true){var ai=aa.getValue()/ah.scale.y;ac.setValue(ac.getValue()*ai);Z.setValue(Z.getValue()*ai)}S()}function I(){var ah=a.selected;if(Y.getValue()===true){var ai=Z.getValue()/ah.scale.z;ac.setValue(ac.getValue()*ai);aa.setValue(aa.getValue()*ai)}S()}function S(){var ah=a.selected;if(ah!==null){if(ah.parent!==undefined){var aj=parseInt(F.getValue());if(ah.parent.id!==aj&&ah.id!==aj){a.parent(ah,a.scene.getObjectById(aj,true))}}ah.position.x=B.getValue();ah.position.y=A.getValue();ah.position.z=v.getValue();ah.rotation.x=h.getValue();ah.rotation.y=g.getValue();ah.rotation.z=c.getValue();ah.scale.x=ac.getValue();ah.scale.y=aa.getValue();ah.scale.z=Z.getValue();if(ah.fov!==undefined){ah.fov=t.getValue();ah.updateProjectionMatrix()}if(ah.near!==undefined){ah.near=o.getValue()}if(ah.far!==undefined){ah.far=ag.getValue()}if(ah.intensity!==undefined){ah.intensity=D.getValue()}if(ah.color!==undefined){ah.color.setHex(u.getHexValue())}if(ah.groundColor!==undefined){ah.groundColor.setHex(E.getHexValue())}if(ah.distance!==undefined){ah.distance=V.getValue()}if(ah.angle!==undefined){ah.angle=m.getValue()}if(ah.exponent!==undefined){ah.exponent=r.getValue()}ah.visible=H.getValue();try{ah.userData=JSON.parse(K.getValue())}catch(ai){console.warn(ai)}W.objectChanged.dispatch(ah)}}function e(ah){var ai={parent:b,fov:ae,near:U,far:l,intensity:M,color:P,groundColor:i,distance:f,angle:s,exponent:G};for(var aj in ai){ai[aj].setDisplay(ah[aj]!==undefined?"":"none")}}function X(ah){if(ah instanceof THREE.Light||(ah instanceof THREE.Object3D&&ah.userData.targetInverse)){q.setDisplay("none");Q.setDisplay("none")}else{q.setDisplay("");Q.setDisplay("")}}W.objectSelected.add(function(ah){if(ah!==null){T.setDisplay("block");e(ah);af(ah)}else{T.setDisplay("none")}});W.sceneGraphChanged.add(function(){var ai=a.scene;var ah={};ai.traverse(function(aj){ah[aj.id]=aj.name});F.setOptions(ah)});W.objectChanged.add(function(ah){if(ah!==a.selected){return}af(ah)});function af(ai){N.setValue(ai.type);p.setValue(ai.uuid);ab.setValue(ai.name);if(ai.parent!==undefined){F.setValue(ai.parent.id)}B.setValue();A.setValue(ai.position.y);v.setValue(ai.position.z);if(window.setPositionObject!=undefined){setPositionObject(ai.position.x,ai.position.y,ai.position.z)}h.setValue(ai.rotation.x);g.setValue(ai.rotation.y);c.setValue(ai.rotation.z);if(window.setRotateObject!=undefined){setRotateObject(ai.rotation.x,ai.rotation.z,ai.rotation.y)}ac.setValue(ai.scale.x);aa.setValue(ai.scale.y);Z.setValue(ai.scale.z);if(window.setScaleObject!=undefined){setScaleObject(ai.scale.x,ai.scale.y,ai.scale.z)}if(ai.fov!==undefined){t.setValue(ai.fov)}if(ai.near!==undefined){o.setValue(ai.near)}if(ai.far!==undefined){ag.setValue(ai.far)}if(ai.intensity!==undefined){D.setValue(ai.intensity)}if(ai.color!==undefined){u.setHexValue(ai.color.getHexString())}if(ai.groundColor!==undefined){E.setHexValue(ai.groundColor.getHexString())}if(ai.distance!==undefined){V.setValue(ai.distance)}if(ai.angle!==undefined){m.setValue(ai.angle)}if(ai.exponent!==undefined){r.setValue(ai.exponent)}H.setValue(ai.visible);try{K.setValue(JSON.stringify(ai.userData,null,"  "))}catch(ah){console.log(ah)}K.setBorderColor("#ccc");K.setBackgroundColor("");X(ai)}return T};